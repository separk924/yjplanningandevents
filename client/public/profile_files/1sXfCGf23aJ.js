;/*FB_PKG_DELIM*/

__d("ArmadilloReceiveWriteDbSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5721");b=d("FalcoLoggerInternal").create("armadillo_receive_write_db_success",a);e=b;g["default"]=e}),98);
__d("Cache",["TimeSlice"],(function(a,b,c,d,e,f,g){"use strict";var h=6e4;a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a,b){a=this.__getRaw(a);return!a?b:a.$2};b.getAll=function(a,b){var c=this,d=new Map();a.forEach(function(a){return d.set(a,c.get(a,b))});return d};b["delete"]=function(a){var b=this.__getRaw(a);b&&b.$3&&clearTimeout(b.$3);return this.$1["delete"](a)};b.clear=function(){this.$1.forEach(function(a){a&&a.$3&&clearTimeout(a.$3)}),this.$1.clear()};b.set=function(a,b,d,e){if(!this.shouldUpdate(a,d))return!1;var f=this.__getRaw(a);f||(f=this.__getNewRawObject());delete f.$2;delete f.$4;f.$3&&clearTimeout(f.$3);delete f.$3;f.$2=b;d!=null&&(f.$4=d);e!=null&&e>=0&&(f.$3=setTimeout(c("TimeSlice").guard(this["delete"].bind(this,a),"Cache expiration timeout"),e*h));this.__setRaw(a,f);return!0};b.shouldUpdate=function(a,b){a=this.__getRaw(a);return a==null||a.$4==null||b==null||b>a.$4};b.size=function(){return this.$1.size};b.__getRaw=function(a){return this.$1.get(a)};b.__setRaw=function(a,b){this.$1.set(a,b)};b.__getNewRawObject=function(){return{$2:null,$3:null,$4:null,$5:null,$6:null}};b.__keys=function(){return this.$1.keys()};return a}();g["default"]=a}),98);
__d("EBEpochChangeListener",["EBIsEbEnabled","EBIsEbEnabledSubscriber","Promise","ReQL","WAPubSub","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(a){this.$1=d("WAPubSub").simplePubSub(),this.$3=a}var c=a.prototype;c.initialize=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;(yield d("EBIsEbEnabled").isEbEnabledLS(this.$3.tables))&&this.$4(this.$3);yield d("EBIsEbEnabledSubscriber").isEbEnabledSubscriber().then(function(b){b.subscribe(function(b){b?a.$4(a.$3):a.$2==null||a.$2()})})});function c(){return a.apply(this,arguments)}return c}();c.$4=function(a){var b=this;this.$2==null&&(this.$2=d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs).subscribe(function(a,c){b.$1.publish(c)}));return this.$2};c.subscribe=function(a){return this.$1.subscribe(a)};return a}(),j;function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(j!=null)return(h||(h=b("Promise"))).resolve();j=new i(a);yield j.initialize()});return k.apply(this,arguments)}function e(a){if(j==null)throw c("err")("EBEpochChangeListener is not initialized");return j.subscribe(a)}g.initEBEpochChangeListener=a;g.subscribeToEpochChanges=e}),98);
__d("EBSMProperties",[],(function(a,b,c,d,e,f){"use strict";a=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"];b=new Set(["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"]);c={dbVersion:5,mandatoryTables:b,persistedTables:new Set(a),persistedTablesArray:a};d=c;f["default"]=d}),66);
__d("MWEncryptedBackupsFirstRestoreUpsellTime",["EBAPIWorkerCheck","FBLogger","WebStorage","getMWEncryptedBackupsIsLocalStorageSupported"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mw_encrypted_backups_restore_upsell_first_impression_time_key";function a(){var a=Date.now().toString();if(d("EBAPIWorkerCheck").runningInWorker())return k(a);if(!d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported())return a;try{var b;b=(b=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:b.getItem(i);if(b==null){var e;(e=(h||(h=c("WebStorage"))).getLocalStorage())==null||e.setItem(i,a);return a}return b}catch(b){c("FBLogger")("labyrinth_web").warn("[labyrinth][web] Failed to set EB session identifier due to %s",b);return a}}var j=null;function k(a){j==null&&(j=a);return j}g.getFirstRestoreUpsellTime=a;g.getFirstRestoreUpsellTimeForEBLS=k}),98);
__d("QPLMemoryUtils",["MemoryUtils","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeStart:b}})}function b(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeEnd:b}})}g.logMemoryForQPLStart=a;g.logMemoryForQPLEnd=b}),98);
__d("MWBroadcastChannelPolyfill",["FBLogger","LocalStorageWrapper","MessengerLogHistory","Random","recoverableViolation","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MessengerLogHistory").getInstance("client_init");function a(a){h.debug("[MWBroadcastChannelPolyfill] "+a)}function i(a){c("FBLogger")("messenger_web").mustfix(a)}var j={},k=d("LocalStorageWrapper").getStorage(a);function b(a){var b="$BroadcastChannel$"+a+"$",e=!1,f=function(a){if(a.storageArea!==k)return;var c=a.newValue;if(c==null||c==="")return;if(((a=a.key)==null?void 0:a.substring(0,b.length))!==b)return;var d=JSON.parse(c);(a=j[b])==null||a.forEach(function(a){a({data:d})})};window.addEventListener("storage",f);return{addEventListener:function(a,c){j[b]=j[b]||new Set(),j[b].add(c)},close:function(){if(e)return;e=!0;j={};window.removeEventListener("storage",f)},postMessage:function(a){if(e){c("recoverableViolation")("Broadcast channel is closed","ls_web_init");return}a=JSON.stringify(a);var f=b+String(Date.now())+"$"+String(c("Random").uint32());d("LocalStorageWrapper").setItemGuarded(k,f,a,i);c("setTimeout")(function(){d("LocalStorageWrapper").removeItemGuarded(k,f,i)},500)},removeEventListener:function(a,c){(a=j[b])==null||a["delete"](c)}}}g["default"]=b}),98);
__d("MWBroadcastChannel",["MWBroadcastChannelPolyfill"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return self.BroadcastChannel!=null?new self.BroadcastChannel(a):c("MWBroadcastChannelPolyfill")(a)}g.MWBroadcastChannel=a}),98);
__d("MWLSDatabaseNames",[],(function(a,b,c,d,e,f){"use strict";a="LightSpeed";b=a+"V3";f.name=a;f.lightspeedPrefix=b}),66);
__d("MWLSIndexedDBName",["MAWCurrentUser","MWLSDatabaseNames"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWCurrentUser").getID();return d("MWLSDatabaseNames").lightspeedPrefix+a}g.dbName=a}),98);
__d("ReStoreTabNotifier",["CurrentMessengerUser","FBLogger","MWBroadcastChannel","MWLSIndexedDBName"],(function(a,b,c,d,e,f,g){"use strict";var h=d("CurrentMessengerUser").getIDorEIMU();function a(a){var b=d("MWBroadcastChannel").MWBroadcastChannel(a==="restore-table-"+h+"-"+d("MWLSIndexedDBName").dbName()?"mwChat-"+h:a);function e(a,d){try{b.postMessage([a,d])}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to broadcast changes")}}function f(a,c){b.addEventListener("message",function(b){b=b.data;var d=b[0];d===a&&c(b[1])})}return{onEventReceive:f,postMessage:e}}g["default"]=a}),98);
__d("createReStoreEBSMTablesPersistence",["CurrentMessengerUser","EBLogger","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","Promise","QPLMemoryUtils","QPLUserFlow","Random","ReStorePersistence","ReStoreTabNotifier","WebSession","asyncToGeneratorRuntime","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;e=d("CurrentMessengerUser").getIDorEIMU();var l=c("ReStoreTabNotifier")==null?void 0:c("ReStoreTabNotifier")("mwChat-"+e),m=null,n=!1,o=!1,p=d("EBLogger").EBLogger.tags(["EBSM","Pesistence","MainThread"]);function q(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a){var e=(k||(k=b("Promise"))).resolve(),f="flushChangesV2",g=new Map();function r(a){return q(g,a,function(){return new Map()})}var s=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").start(c("qpl")._(521481876,"1407"),{annotations:{string:{ebSessionIdentifier:s,sessionTabId:d("WebSession").getId()}}});(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").START);d("QPLMemoryUtils").logMemoryForQPLStart(c("qpl")._(521481876,"1407"));function t(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield a.rehydrateEBSMFromEBDB(r),d("QPLMemoryUtils").logMemoryForQPLEnd(c("qpl")._(521481876,"1407")),c("QPLUserFlow").endSuccess(c("qpl")._(521481876,"1407")),(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").SUCCESS)}catch(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED"),p.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data: ",""])),a),c("QPLUserFlow").endFailure(c("qpl")._(521481876,"1407"),"Hydration failed."),(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").FAIL)}});return u.apply(this,arguments)}m=t();l==null||l.onEventReceive("flushChangesV2",function(b){b=b.changeSet;var e=new Map();b.forEach(function(a,b){e.set(b,{toAdd:[],toDelete:[]});var c=r(b);a.forEach(function(a,f){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var g;(g=e.get(b))==null||g.toDelete.push(c.get(f))}else{(g=e.get(b))==null||g.toAdd.push(a)}})});if(a.updateEBSM==null){p.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["ebdbEbsmApi.updateEBSM is not defined"])));return}c("promiseDone")(a.updateEBSM(e,f))});return{flush:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var g;if(b.size===0)return;b.size>0&&b.forEach(function(a,c){a.size===0&&b["delete"](c)});if(b.size===0)return;e=((g=e.actionSource)==null?void 0:g.type)==="user_initiated"&&((g=e.actionSource)==null?void 0:g.source)===f;if(e){b.forEach(function(a,b){var c=r(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)?c["delete"](b):c.set(b,a)})});return}var h=new Map();b.forEach(function(a,b){h.set(b,{toAdd:[],toDelete:[]});var c=r(b);a.forEach(function(a,e){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var f;(f=h.get(b))==null||f.toDelete.push(c.get(e));c["delete"](e)}else{(f=h.get(b))==null||f.toAdd.push(a);c.set(e,a)}})});l==null||l.postMessage("flushChangesV2",{changeSet:b,fromVersion:"",sentinelDeleted:d("ReStorePersistence").sentinelDeleted,version:""});g=d("Random").uint32();e=Array.from(b.keys());c("QPLUserFlow").start(c("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0},string_array:{tables:e}},instanceKey:g});yield m;yield a.flushEBSMtoEBDB(h)["catch"](function(){})});function g(a,b){return e.apply(this,arguments)}return g}(),get:function(a,c,d){var e=r(c);if(n)return e.get(d);return m==null?(k||(k=b("Promise"))).reject("rehydration is not complete"):m.then(function(){n=!0;return e.get(d)})},logError:function(b,e,f,g){(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR,b);if(f==="dbCorruption"){(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,b);f="Got unexpected undefined in ebsm, mode: "+e+", table: "+b+", id: "+((f=g==null?void 0:g.id)!=null?f:"")+", deletedInThisTxn: "+((e=g==null?void 0:g.deletedInThisTxn)!=null?e:"")+". Deleting EBSM db";p.mustfix(f);g=d("Random").uint32();d("MAWUnrecoverableDbErrors").setError(new(d("MAWUnrecoverableDbErrors").EbsmHydrationError)(f,!0,g,b),function(){c("promiseDone")(a.clearEbStores(),function(){(j||(j=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.main_thread")})});o||(o=!0,d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(a){return new(k||(k=b("Promise")))(function(c,d){e=e.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield a()),e=b[0];b[1];try{c(yield e())}catch(a){d(a)}}))})},shouldApplySync:function(){return!1},shouldInline:function(a,b){return!1},shouldSync:function(a,b){return a==="notifyInMemoryTable"?!1:!0},tabTablesNotifier:function(){return l},types:["ephemeral"],uniqueId:""}}g["default"]=a}),98);
__d("createReStoreTableNameAllowListPersistence",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e;return{clearCache:function(){a.clearCache==null||a.clearCache(),c.clearCache==null||c.clearCache()},close:function(){a.close==null||a.close(),c.close==null||c.close()},flush:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,f){var h=new Map(),i=new Map();e.forEach(function(a,b){d.has(b)?i.set(b,a):h.set(b,a)});yield (g||(g=b("Promise"))).all([a.flush(h,f),c.flush(i,f)])});function f(a,b){return e.apply(this,arguments)}return f}(),get:function(b,e,f,g){return d.has(e)?c.get(b,e,f,g):a.get(b,e,f,g)},isClosed:function(){return(a.isClosed==null?void 0:a.isClosed())||!1},isPersistenceSupported:a.isPersistenceSupported,logError:function(b,e,f,g){d.has(b)?c.logError==null||c.logError(b,e,f,g):a.logError==null||a.logError(b,e,f,g)},permitsSynchronousIO:function(b){if(d.has(b)){var e;return(e=c.permitsSynchronousIO==null?void 0:c.permitsSynchronousIO(b))!=null?e:!1}else{return(e=a.permitsSynchronousIO==null?void 0:a.permitsSynchronousIO(b))!=null?e:!1}},runExclusively:function(d,e){return a.runExclusively(function(){return new(g||(g=b("Promise")))(function(a,f){var h=c.runExclusively(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield d()),e=c[0],f=c[1],i=new(g||(g=b("Promise")))(function(b){a([function(){b();return h},f])});return[b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield i;return e()}),f]}),e);h["catch"](f)})},e)},shouldApplySync:function(b,e){if(d.has(e))return c.shouldApplySync(b,e);else return a.shouldApplySync(b,e)},shouldInline:function(b,e){return d.has(b)?c.shouldInline(b,e):a.shouldInline(b,e)},shouldSync:function(b,e){if(d.has(e))return c.shouldSync(b,e);else return a.shouldSync(b,e)},tabTablesNotifier:(e=a.tabTablesNotifier)!=null?e:c.tabTablesNotifier,types:[].concat(a.types,c.types),uniqueId:c.uniqueId+a.uniqueId}}f["default"]=a}),66);
__d("LSJSEBInMemoryStorage",["EBSMProperties","createLSReStoreEphemeralPersistence","createReStoreEBSMTablesPersistence","createReStoreTableNameAllowListPersistence"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=c("createReStoreTableNameAllowListPersistence")(d("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),c("createReStoreEBSMTablesPersistence")(a),c("EBSMProperties").persistedTables);return a}g.makeReStorePersistence=a}),98);
__d("WADbSignal",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a,b,c){return a+"_"+b+"_"+c}c={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion",deviceRegUnixTime:"deviceRegUnixTime"};({msgrDeviceId:"msgrDeviceId"});d={registrationHistory:"registrationHistory"};f.unsafeCoerceToSenderKeySessionId=a;f.buildSenderKeySessionId=b;f.MetaKeysEnum=c;f.PlainTextMetaKeysEnum=d}),66);
__d("WAHandleFailureUtils",["WABridge","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";c={GENERIC_FAILURE:"400",NOT_AUTHORIZED:"401",TEMP_BANNED:"402",BANNED:"403",CAT_EXPIRED:"413",CAT_INVALID:"414",NOT_FOUND:"415",CAT_SESSION_INVALID:"418",INTERNAL_ERROR:"500",SERVER_UNAVAILABLE:"503"};function h(){return d("WAGlobals").getDependencies().clearSignalAndTempStores()}function a(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}function b(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","reregisterDevice",{})})}g.FAILURE_CODES=c;g.clearRegistrationAndTempData=h;g.deregisterPhone=a;g.reregisterPhone=b}),98);
__d("WASignalDB",["BrowserLockManager","QPLFlow","WAHandleFailureUtils","WAHex","WAIDBTypes","WALogger","WAResolvable","Worm","WormEAR","WormIDbDriver","WormIDbUtils","asyncToGeneratorRuntime","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i={identity:{primaryKey:"deviceJid",indexes:{userJid:{fields:["userJid"],unique:!1}}},contacts:{primaryKey:"contactJid",indexes:{}},session:{indexes:{},primaryKey:"id"},senderKeySessions:{primaryKey:"id",indexes:{groupJid:{fields:["groupJid"],unique:!1},userJid:{fields:["userJid"],unique:!1}}},prekey:{indexes:{},primaryKey:"keyId"},prekeyGeneration:{indexes:{},primaryKey:"generationId"},signedPrekey:{indexes:{},primaryKey:"keyId"},meta:{indexes:{},primaryKey:"key"},plaintextMeta:{indexes:{},primaryKey:"key",secure:!1},icdcFails:{indexes:{},primaryKey:"contactJid"},personalSenderKeyStatuses:{indexes:{},primaryKey:"groupJid"}},j,k=new(d("WAResolvable").Resolvable)();function a(a,b,c,d,e,f){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,l,m){var o=m!=null?d("QPLFlow").startQPLFlow(m,{timeoutInMs:c("justknobx")._("3415"),annotations:{string:{operationType:"initDb"}}}):null;try{yield n(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=d("WAHex").parseHex(e),c="signalDb";b=new(d("WormEAR").WormEAR)(i,c,b);c=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,c,i,b,l,{blockingErrorThreshold:f,onBlockingError:g,safeToDeleteStores:new Set(["stanzaQueue","danglingQueue","migration"]),onTransactionError:function(b){if(b instanceof d("WormEAR").DecryptionError){b=b;if(b.store==="icdcFails")return;void d("WormIDbUtils").promisifyIDbRequest(d("WAIDBTypes").idb().deleteDatabase(a)).then(function(){return d("WAHandleFailureUtils").reregisterPhone()})}}}),m);j=c;yield c.init({eventFlow:o});k.resolve(c);o==null||o.endSuccess()}))}catch(a){o==null||o.endFail("error");d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[WORM] Error performing initDb: ",""])),a);throw a}});return l.apply(this,arguments)}function e(){if(j==null)throw c("err")("Signal Db v3 is not initialized");return j}function f(){return k.promise}function m(a){return"Signal - "+a}function n(a){return c("BrowserLockManager")!=null?c("BrowserLockManager").request("wajs_make_signal_v3_db",a):a()}g.makeSignalDb=a;g.getDb=e;g.getDbPromise=f;g.signalOp=m}),98);
__d("WACryptoPrimitives",["tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";b={scalarbase:(a=d("tweetnacl")).lowlevel.scalarbase,crypto_hash:a.lowlevel.crypto_hash,modL:a.lowlevel.modL,pack25519:a.lowlevel.pack25519,S:a.lowlevel.S,M:a.lowlevel.M,A:a.lowlevel.A,Z:a.lowlevel.Z,D:a.lowlevel.D,unpack25519:a.lowlevel.unpack25519,pow2523:a.lowlevel.pow2523,crypto_verify_32:a.lowlevel.crypto_verify_32,set25519:a.lowlevel.set25519,add:a.lowlevel.add,scalarmult:a.lowlevel.scalarmult};g.hash=a.hash;g.scalarMult=a.scalarMult;g.verify=a.verify;g.lowlevel=b;g.keypairFromSecretKey=a.box.keyPair.fromSecretKey;g.keyPair=a.box.keyPair;g.signDetachedVerify=a.sign.detached.verify}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={};a.internalSpec={sessionVersion:[1,(d=d("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,d.TYPES.BYTES],remoteIdentityPublic:[3,d.TYPES.BYTES],rootKey:[4,d.TYPES.BYTES],previousCounter:[5,d.TYPES.UINT32],senderChain:[6,d.TYPES.MESSAGE,e],receiverChains:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],pendingKeyExchange:[8,d.TYPES.MESSAGE,c],pendingPreKey:[9,d.TYPES.MESSAGE,b],remoteRegistrationId:[10,d.TYPES.UINT32],localRegistrationId:[11,d.TYPES.UINT32],needsRefresh:[12,d.TYPES.BOOL],aliceBaseKey:[13,d.TYPES.BYTES]};b.internalSpec={preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[3,d.TYPES.INT32],baseKey:[2,d.TYPES.BYTES]};c.internalSpec={sequence:[1,d.TYPES.UINT32],localBaseKey:[2,d.TYPES.BYTES],localBaseKeyPrivate:[3,d.TYPES.BYTES],localRatchetKey:[4,d.TYPES.BYTES],localRatchetKeyPrivate:[5,d.TYPES.BYTES],localIdentityKey:[7,d.TYPES.BYTES],localIdentityKeyPrivate:[8,d.TYPES.BYTES]};e.internalSpec={senderRatchetKey:[1,d.TYPES.BYTES],senderRatchetKeyPrivate:[2,d.TYPES.BYTES],chainKey:[3,d.TYPES.MESSAGE,h],messageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f]};f.internalSpec={index:[1,d.TYPES.UINT32],cipherKey:[2,d.TYPES.BYTES],macKey:[3,d.TYPES.BYTES],iv:[4,d.TYPES.BYTES]};h.internalSpec={index:[1,d.TYPES.UINT32],key:[2,d.TYPES.BYTES]};i.internalSpec={currentSession:[1,d.TYPES.MESSAGE,a],previousSessions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,a]};j.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES]};k.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES],signature:[4,d.TYPES.BYTES],timestamp:[5,d.TYPES.FIXED64]};l.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};m.internalSpec={senderKeyId:[1,d.TYPES.UINT32],senderChainKey:[2,d.TYPES.MESSAGE,p],senderSigningKey:[3,d.TYPES.MESSAGE,n],senderMessageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,o]};n.internalSpec={"public":[1,d.TYPES.BYTES],"private":[2,d.TYPES.BYTES]};o.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};p.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};q.internalSpec={senderKeyStates:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};g.SessionStructureSpec=a;g.SessionStructure$PendingPreKeySpec=b;g.SessionStructure$PendingKeyExchangeSpec=c;g.SessionStructure$ChainSpec=e;g.SessionStructure$Chain$MessageKeySpec=f;g.SessionStructure$Chain$ChainKeySpec=h;g.RecordStructureSpec=i;g.PreKeyRecordStructureSpec=j;g.SignedPreKeyRecordStructureSpec=k;g.IdentityKeyPairStructureSpec=l;g.SenderKeyStateStructureSpec=m;g.SenderKeyStateStructure$SenderSigningKeySpec=n;g.SenderKeyStateStructure$SenderMessageKeySpec=o;g.SenderKeyStateStructure$SenderChainKeySpec=p;g.SenderKeyRecordStructureSpec=q}),98);
__d("WATypedArraysCast",["WABase64"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b instanceof a)return b;return typeof b==="string"?new a(d("WABase64").decodeB64(b)):new a(b)}g.castTypedArrays=a}),98);
__d("WACryptoHmac",["WACryptoDependencies","WATypedArraysCast"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=new Uint8Array(h),j={name:"HMAC",hash:"SHA-256"},k={name:"HMAC",hash:"SHA-512"},l={name:"HMAC",hash:"SHA-1"};function m(a,b){b=d("WATypedArraysCast").castTypedArrays(Uint8Array,b);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",b,a,!1,["sign"]).then(function(b){return{key:b,algo:a}})}function a(a){return m(j,a)}function n(a,b,c){var e=a.key;a=a.algo;return d("WACryptoDependencies").getCrypto().subtle.sign(a,e,b).then(function(a){return c!=null&&c!==0?a.slice(0,c):a})}function b(a,b){return m(j,a!=null?a:i).then(function(a){return n(a,b)})}function c(a,b,c){return m(j,a).then(function(a){return n(a,b,c)})}function e(a,b,c){return m(k,a).then(function(a){return n(a,b,c)})}function f(a,b,c){return m(l,a).then(function(a){return n(a,b,c)})}g.SHA256_BYTE_LENGTH=h;g.DEFAULT_SALT=i;g.encodeKeySha256=a;g.sign=n;g.extractSha256=b;g.hmacSha256=c;g.hmacSha512=e;g.hmacSha1=f}),98);
__d("WACryptoHkdf",["Promise","WABinary","WACryptoHmac","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=255*d("WACryptoHmac").SHA256_BYTE_LENGTH;function j(a,e,f){if(f<0||f>i)return(h||(h=b("Promise"))).reject(c("err")("HKDF::expand given bad length "+f));var g,j=Math.ceil(f/d("WACryptoHmac").SHA256_BYTE_LENGTH),k=d("WABinary").Binary.build(e).readByteArrayView(),l=new(d("WABinary").Binary)(),m=d("WACryptoHmac").encodeKeySha256(a).then(function(a){g=a;return new Uint8Array(0)});e=function(a){m=m.then(function(b){return d("WACryptoHmac").sign(g,d("WABinary").Binary.build(b,k,a).readByteArrayView())}).then(function(a){a=new Uint8Array(a);l.writeByteArray(a);return a})};for(a=1;a<=j;a++)e(a);return m.then(function(){return l.readBuffer(f)})}function a(a,b,c){return d("WACryptoHmac").extractSha256(null,a).then(function(a){return j(new Uint8Array(a),b,c)})}function e(a,b,c,e){return d("WACryptoHmac").extractSha256(b,a).then(function(a){return j(new Uint8Array(a),c,e)})}g.expand=j;g.extractAndExpand=a;g.extractWithSaltAndExpand=e}),98);
__d("WACryptoUtils",["WACryptoDependencies","WACryptoPrimitives","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(new Uint8Array(a),new Uint8Array(b))}function b(a,b){var c=new TextDecoder();return c.decode(a).toLowerCase()===c.decode(b).toLowerCase()}function h(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function e(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function f(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function i(a){if(a!==(a|0))throw c("err")("bound must be int32");if(a<=0)throw c("err")("bound must not be positive");var b=new Int32Array(1),e=-1>>>1;e=a*Math.floor(e/a);var f=-1;while(f===-1){d("WACryptoDependencies").getCrypto().getRandomValues(b);var g=b[0]>>>1;g<e&&(f=g%a)}return f}g.arrayBuffersEqual=a;g.arrayBuffersEqualCaseInsensitive=b;g.uint8ArraysEqual=h;g.rawKeysEqual=e;g.serializedPubKeysEqual=f;g.randomNumberLessThan=i}),98);
__d("WAXmlParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.parser=a,this.reason=b}var b=a.prototype;b.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason};return a}();f.XmlParsingFailure=a}),66);
__d("WAParsableXmlNode",["WAHasProperty","WAXmlParsingFailure","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var c=this;this.$1=a;this.$2=b;this.$3=Array.isArray(b.content)?b.content.map(function(b){return new c.constructor(a,b)}):null}var b=a.prototype;b.name=function(){return this.$1};b.node=function(){return this.$2};b.hasAttr=function(a){return c("WAHasProperty")(this.$2.attrs,a)};b.assertTag=function(a){this.$2.tag!==a&&this["throw"]("to be <"+a+">")};b.tag=function(){return this.$2.tag};b.maybeChild=function(a){var b=this.$3;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].tag()===a)return b[c];return null};b.hasChild=function(a){return!!this.maybeChild(a)};b.child=function(a){var b=this.maybeChild(a);return!b?this["throw"]("to have child <"+a+">"):b};b.assertAttr=function(a,b){var c=this.attrString(a);c!==b&&this["throw"]('to have "'+a+'"="'+b+'", but instead has "'+c+'"')};b.attrString=function(a){return!c("WAHasProperty")(this.$2.attrs,a)?this["throw"]('to have attribute "'+a+'"'):this.decodeAsString(this.$2.attrs[a])};b.forEachAttributeKey=function(a){var b=this.$2.attrs;Object.keys(b).forEach(function(b){return a(b)})};b.maybeAttrString=function(a){return this.hasAttr(a)?this.decodeAsString(this.$2.attrs[a]):null};b.maybeAttrInt=function(a,b,c){return this.hasAttr(a)?this.attrInt(a,b,c):null};b.attrEnumValues=function(a,b,c){b=new Set(b);var d=this.attrString(a);if(!b.has(d)){if(c!=null)return c;c=Array.from(b).join("|");return this["throw"]('to have "'+a+'"={'+c+'} but has value "'+d+'"')}return d};b.attrEnum=function(a,b){var d=this.attrString(a);if(!c("WAHasProperty")(b,d)){var e=Object.keys(b).join("|");return this["throw"]('to have "'+a+'"={'+e+'} but has value "'+d+'"')}return b[d]};b.attrEnumOrNullIfUnknown=function(a,b){a=this.attrString(a);return!c("WAHasProperty")(b,a)?null:b[a]};b.attrEnumOrDefault=function(a,b,c){return this.hasAttr(a)?this.attrEnum(a,b):c};b.attrInt=function(a,b,c){var d=this.attrString(a);return this.$4(d,a,b,c)};b.$4=function(a,b,c,d){var e=parseInt(a,10);if(Number.isNaN(e))return this["throw"]('to have "'+b+'"={integer} but has value "'+a+'"');else if(c!==void 0&&e<c)return this["throw"]('to have "'+b+'"={at least '+c+"} but has value "+e);else if(d!==void 0&&e>=d)return this["throw"]('to have "'+b+'"={below '+d+"} but has value "+e);return e};b.forEachChild=function(a){var b=this.$3;if(b)b.forEach(function(b){return a(b)});else if(this.$2.content!=null)return this["throw"]("to have children")};b.forEachChildWithTag=function(a,b){this.forEachChild(function(c){c.tag()===a&&b(c)})};b.mapChildren=function(a){var b=this.$3;return!b&&this.$2.content!=null?this["throw"]("to have children"):b?b.map(function(b){return a(b)}):[]};b.mapChildrenWithTag=function(a,b){var c=this.$3;return!c&&this.$2.content!=null?this["throw"]("to have children"):c?c.filter(function(b){return b.tag()===a}).map(function(a){return b(a)}):[]};b.mapFirstChild=function(a){var b=this.$3;return!b||b.length===0?this["throw"]("to have children"):a(b[0])};b.hasContent=function(){return!this.$3&&!!this.$2.content};b.hasChildren=function(){return this.$3!=null};b.getChildren=function(){return this.$3};b.mapAttrKeys=function(a){var b=this.getAttrKeys();return b&&b.length?b.map(a):[]};b.getAttrKeys=function(){return Object.keys(this.$2.attrs)};b.hasAttrs=function(){var a=this.$2.attrs?Object.keys(this.$2.attrs):[];return a.length>0};b.getNode=function(){return this.$2};b.unsafeSetChildren=function(a){this.$3=a};b.unsafeSetNodeContent=function(a){this.$2.content=a};b.contentUint=function(a){var b=this.contentBytes(a);return h(b,a)};b.contentBytes=function(a){a===void 0&&(a=-1);if(this.$3)return this["throw"]("to have binary content, but has children instead");else if(this.$2.content!=null){var b=this.$2.content;return a!==-1&&b.length!==a?this["throw"]("to be "+a+" bytes, but got "+b.length+" instead"):b}else return this["throw"]("to have content")};b.contentString=function(){if(this.$3)return this["throw"]("to have string content, but has children instead");else if(this.$2.content!=null)return this.$2.content;else return this["throw"]("to have content")};b.contentInt=function(a,b){var c=this.contentString();return this.$4(c,"content",a,b)};b.contentEnum=function(a){var b=this.contentString();if(!c("WAHasProperty")(a,b)){var d=Object.keys(a).join("|");return this["throw"]("to have content {"+d+'} but has value "'+b+'"')}return a[b]};b.decodeAsString=function(a){if(typeof a!=="string")throw c("err")("decodeAsString: attribute is "+typeof a+" not a string: "+a);return a};b["throw"]=function(a){throw new(d("WAXmlParsingFailure").XmlParsingFailure)(this.$1,"expected <"+this.$2.tag+"> "+a)};b.toString=function(){return this.$2.toString()};return a}();function h(a,b){var c=0;for(var d=0;d<b;d++)c=c*256+a[d];return c}g.ParsableXmlNode=a;g.convertBytesToUint=h}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAParsableXmlNode","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h={name:"AES-CBC"},i={name:"HMAC",hash:"SHA-256"};function j(a,b){if(a.length!==b)throw c("err")("Signal expected "+b+" bytes, given "+a.length);return a}function a(a,b){return j(new Uint8Array(a),b)}function b(a){var b=a.buffer,c=a.byteOffset;a=a.length;return c===0&&a===b.byteLength?b:b.slice(c,c+a)}function e(a,b){return a.readByteArrayView(b)}function f(a){return new Uint8Array(a)}function k(a,b,d){if(a.length-b<d)throw c("err")("Can not split off "+d+" bytes from index "+b+" of "+a.length+" bytes");return a.slice(b,b+d)}function l(a){a=a==="extendedRange"?(-1>>>1)-1:16380;return d("WACryptoUtils").randomNumberLessThan(a)+1}function m(a){return q(a)}function n(a){return d("WAParsableXmlNode").convertBytesToUint(a,4)}function o(){var a=-1>>>1;return d("WACryptoUtils").randomNumberLessThan(a)+1}function p(a){return q(a)}function q(a,b,d){b===void 0&&(b=0);d===void 0&&(d=4294967296);if(typeof a==="number"&&b<=a&&a<d&&Math.floor(a)===a)return a;else throw c("err")("Expected integer in range ["+b+", "+d+"), given "+String(a))}function r(a,b){return d("encodeProtobuf").encodeProtobuf(a,b).readByteArrayView()}function s(a,b,c){return c(d("decodeProtobuf").decodeProtobuf(a,b))}function t(a,b,c,e){return d("WACryptoHkdf").extractWithSaltAndExpand(a,b,c,e).then(function(a){return new Uint8Array(a)})}function u(a,b){var c,e;b==="hmac-sha256"?(c=i,e=["sign"]):(b,c=h,e=["encrypt","decrypt"]);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,c,!1,e)}function v(a){return a}function w(a){return a}function x(a,b){return d("WACryptoUtils").arrayBuffersEqual(a,b)}g.AES_CBC=h;g.HMAC_SHA256=i;g.ensureSize=j;g.toBytes=a;g.toBuffer=b;g.readBytes=e;g.makeBytes=f;g.sliceBytes=k;g.makeRegistrationId=l;g.castRegistrationId=m;g.castRegistrationIdFromBytes=n;g.makeSenderKeyId=o;g.castSenderKeyId=p;g.ensureIntInRange=q;g.encodeSignalProto=r;g.decodeSignalProto=s;g.hkdf=t;g.makeCryptoKey=u;g.castToByteEncoded=v;g.castToSessionHash=w;g.areSessionHashesEqual=x}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WALogger","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=5,j=16777215;function k(a,b){return{publicKey:a,privateKey:b}}function a(a){a=d("WACryptoPrimitives").keypairFromSecretKey(a);var b=a.publicKey;a=a.secretKey;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function b(a,b){return{publicKey:d("WASignalOther").toBytes(a,32),privateKey:d("WASignalOther").toBytes(b,32)}}function l(){var a=d("WACryptoPrimitives").keyPair(),b=a.publicKey;a=a.secretKey;a[0]&=248;a[31]=64|a[31]&63;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function m(a,b){return k(d("WASignalOther").sliceBytes(b,1,32),a)}function n(a,b){return{serializedPubKey:b,privateKey:a}}function e(){var a=l();return n(a.privateKey,o(a))}function o(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(a.publicKey,1);return b}function f(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(d("WASignalOther").ensureSize(a,32),1);return b}function p(a){return n(a.privateKey,o(a))}function q(a,b){a=(a-1)%j;a<=0&&(a+=j);var c=[];for(var e=0;e<b;e++){var f=a===j?1:a+1,g=l(),h=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:f,publicKey:o(g),privateKey:g.privateKey});c.push({plainObject:{id:f,keyPair:g},record:h});a=f}return c}function r(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey;a=a.privateKey;return b==null||c==null||a==null?null:{id:s(b),keyPair:m(d("WASignalOther").toBytes(a,32),u(new Uint8Array(c)))}}catch(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["deserializePreKey error ",""])),a);return null}}function s(a){return d("WASignalOther").ensureIntInRange(a,1,j)}function t(a){return d("WASignalOther").ensureIntInRange(a,0,j)}function u(a){if(a.length===0||a[0]!==i)throw c("err")("Unrecognized public key type");return d("WASignalOther").ensureSize(a,33)}function v(){var a=d("WASignalOther").makeBytes(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function w(a,b){return d("WACryptoPrimitives").scalarMult(a,b.subarray(1)).buffer}g.KEY_TYPE=i;g.makeKeyPairFrom=a;g.makeKeyPairFromArrayBuffers=b;g.makeKeyPair=l;g.makeKeyPairFromSerialized=m;g.makeSerializedKeyPairFrom=n;g.makeSerializedKeyPair=e;g.serializePubKey=o;g.serializeIdentity=f;g.toSerializedKeyPair=p;g.makePreKeys=q;g.deserializePreKey=r;g.castToPreKeyId=s;g.castToSignedPreKeyId=t;g.castToSerializedPubKey=u;g.makeRawSenderKey=v;g.ecdh=w}),98);
__d("WAGetLocalPublicPrivateIdentityKeyApi",["WADbSignal","WALogger","WASignalDB","WASignalKeys","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=(yield a.stores.meta.get(d("WADbSignal").MetaKeysEnum.identityKeyPair));if((a==null||(b=a.value)==null?void 0:b.identityKeyPair)==null){var e="[Remote Presence Error] Identity key pair was null";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),e);throw c("err")(e)}return d("WASignalKeys").toSerializedKeyPair(a.value.identityKeyPair)});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getLocalPublicPrivateIdentityKey"))};g.getLocalPublicPrivateIdentityKey=a}),98);
__d("EBWorkerAddDeviceUtils",["EBDB","EBDBEbsmApi","EBSMProperties","I64","LSAuthorityLevel","LSIntEnum","LSJSEBInMemoryStorage","LSMetadata","LSReStoreWrapper","MAWLSVaultingHooks","Promise","ReQL","WAGetLocalPublicPrivateIdentityKeyApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGetLocalPublicPrivateIdentityKeyApi").getLocalPublicPrivateIdentityKey()),b=a.privateKey;a=a.serializedPubKey;return{identityPrivateKey:b,identityPublicKey:a}});return k.apply(this,arguments)}function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)));if(g!=null)return"dest_table_not_empty";g={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB,updateEBSM:function(){return(j||(j=b("Promise"))).resolve()}};g=(yield d("LSJSEBInMemoryStorage").makeReStorePersistence(g));if(g==null)throw c("err")("persistence is null");g=d("LSReStoreWrapper").createLSReStore(g,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);var k=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_epochs)));return k.filter(function(a){return(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).length===0?"source_epoch_not_authoritative":g.runInTransaction(function(c){return e.runInTransaction(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d){var e=(yield (j||(j=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c[a];b=b.entries(new WeakMap());var e=(yield b.next());if(e.done)return"source_table_empty";a=d[a];while(!e.done){var f=e.value,g=f[0];f=f[1];yield a.upsert(g,f);e=(yield b.next())}return"success"});return function(b){return a.apply(this,arguments)}}())));e=new Set(e);if(e.has("source_table_empty"))return"source_table_empty";else if(e.has("success")&&e.size===1)return"success";return"fail"});return function(a){return d.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":111")},"readonly",void 0,void 0,f.id+":109")});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.runInTransaction(function(a){return(j||(j=b("Promise"))).all(c("EBSMProperties").persistedTablesArray.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=a[b];var c=b.entries(new WeakMap()),d=(yield c.next());while(!d.done)yield b["delete"].apply(b,d.value[0]),d=(yield c.next())});return function(a){return c.apply(this,arguments)}}()))},"readwrite",void 0,void 0,f.id+":152")});return n.apply(this,arguments)}g.getIdentityKeysInWorker=a;g.copyEBStateTablesFromMainthreadToWorker=e;g.clearLSEBSMTables=m}),98);
__d("LSDedicatedMqttChannel",["FBMqttChannel","cr:1232"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:1232")!=null&&b("cr:1232").shutdownAndClear()}function d(a,d,e,f,g,h){return function(i){if(b("cr:1232")!=null)return b("cr:1232").getInstance(i,a,d,e,f,g,h);else return c("FBMqttChannel")}}g.shutdownAndClear=a;g.getInstance=d}),98);
__d("MAWEBLSInWorkerSwitch",["MAWEBEnabledStateManager"],(function(a,b,c,d,e,f,g){"use strict";a=new(d("MAWEBEnabledStateManager").MAWEBEnabledStateManager)();b=a;g["default"]=b}),98);
__d("LSIssueNewEbTaskAndGetTaskIDV2",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],void 0,void 0,c.i64.cast([0,0]),a[3],a[4],void 0,a[5],a[7]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueNewEbTaskAndGetTaskIDV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSFetchBackupIds",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] Beginning execution."),d[11]=c.i64.cast([0,0]),d[7]=d[11],d[8]=new c.Map(),d[8].set("backup_tenancy",a[0]),d[8].set("trace_id",void 0),d[9]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50008]),d[9],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,d[7]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupIdsStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFetchBackupIdsStoredProcedure";a.__tables__=["encrypted_backups"];e.exports=a}),null);
__d("LSFetchBackupIdsStoredProcedure",["LSFetchBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSFetchBackupIds"),e.backupTenancy,e.traceId,e.isUiBlocking);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,100])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[2]=e[0],d[3]=e[1]):(b=a.item,e=[b.clientThreadPk,void 0],d[2]=e[0],d[3]=e[1])})},function(a){return c.i64.neq(d[2],void 0)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,7])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),c.i64.neq(void 0,void 0)?(a=[void 0,d[13]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,100])),d[16].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[16].set("error_message",""),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1]),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1]),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure";a.__tables__=["mi_act_mapping_table"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueMessageRangeQueryTask] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[11]=c.i64.gt(a[1],c.i64.cast([0,0]))&&c.i64.gt(a[5],c.i64.cast([0,0])),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[35]=void 0,c.i64.neq(d[35],void 0)?c.resolve(d[36]=d[35]):c.sequence([function(a){return d[41]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[51]=(d[41].push(c.i64.cast([0,0])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[51]=(d[41].push(c.i64.cast([0,2])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[51]=(d[41].push(c.i64.cast([0,3])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[51]=(d[41].push(c.i64.cast([0,4])),d[41]):0,d[46]=c.createArray(),d[47]=c.i64.of_int32(d[41].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=(d[46].push(d[52]),d[46])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[54]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[57]=(d[51].push(c.i64.to_string(d[55])),d[51])}])}):c.resolve()},function(a){return d[53]=d[51].join(","),d[48]=d[53]}])},function(a){return d[46].some(function(a){return c.i64.eq(d[29],a)})?d[49]=d[29]:d[49]=void 0,c.i64.neq(d[49],void 0)?d[50]=d[49]:d[50]=void 0,d[36]=d[50]}])},function(e){return c.i64.neq(d[36],void 0)?d[37]=d[36]:d[37]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[38]=d[28]:d[38]=c.i64.cast([0,1]),c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(e){return c.i64.neq(d[39],void 0)?d[11]?c.sequence([function(a){return d[41]=c.i64.random(),d[42]=void 0==null?c.i64.to_string(d[41]):void 0,d[42]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[42],!0,void 0):c.resolve()},function(a){return d[42]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[42],"issue_task"):c.resolve()},function(a){return d[42]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[42],"request_type","ENCRYPTED_BACKUPS_MESSAGE_SURROUNDING_QUERY"):c.resolve()},function(e){return c.i64.eq(d[38],c.i64.cast([0,3]))?d[43]=c.i64.cast([0,4]):d[43]=c.i64.cast([0,0]),d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("request_id",d[42]),d[44].set("tam_thread_subtype",d[43]),d[44].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[59]=(d[48].push(a.epochId),d[48])})},function(a){return d[57]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[58]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[57],d[50],d[58]].join("")),c.resolve()},function(e){return d[51]=new c.Map(),d[51].set("device_id",d[27]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[52]=new c.Map(),d[52].set("reference_timestamp",a[2]),d[52].set("server_thread_key",void 0),d[52].set("device_context",d[51]),d[52].set("source",a[6]),d[53]=new c.Map(),d[53].set("restore_context",d[44]),d[53].set("success",d[52]),d[54]=d[53].get("restore_context"),d[55]=d[54].get("act_thread_id"),d[56]=c.toJSON(d[53]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[55]].join(""),c.i64.cast([0,50031]),d[56],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.i64.gt(a[1],c.i64.cast([0,0]))?c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return c.i64.eq(a[6],c.i64.cast([0,21]))?c.resolve(d[59]=a[4]):c.sequence([function(a){return d[60]=c.i64.random(),d[61]=void 0==null?c.i64.to_string(d[60]):void 0,d[61]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[61],!0,void 0):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[61],"issue_task"):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[61],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[59]=d[61]}])},function(a){return d[41]=d[59]}]):c.sequence([function(a){return d[59]=c.i64.random(),d[60]=void 0==null?c.i64.to_string(d[59]):void 0,d[60]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[60],!0,void 0):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[60],"issue_task"):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[60],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[41]=d[60]}])},function(e){return c.i64.eq(d[38],c.i64.cast([0,3]))?d[42]=c.i64.cast([0,4]):d[42]=c.i64.cast([0,0]),a[7]===!0?d[43]=!0:d[43]=!1,d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("request_id",d[41]),d[44].set("tam_thread_subtype",d[42]),d[44].set("reference_id",void 0),d[44].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[59]=(d[48].push(a.epochId),d[48])})},function(a){return d[57]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[58]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[57],d[50],d[58]].join("")),c.resolve()},function(e){return d[51]=new c.Map(),d[51].set("device_id",d[27]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[52]=new c.Map(),d[52].set("reference_timestamp",a[2]),d[52].set("direction",c.i64.cast([0,1])),d[52].set("server_thread_key",void 0),d[52].set("device_context",d[51]),d[52].set("source",a[6]),d[52].set("include_offset",d[43]),d[53]=new c.Map(),d[53].set("restore_context",d[44]),d[53].set("success",d[52]),d[53].set("queue_name",void 0),d[54]=d[53].get("queue_name"),d[54]!==void 0?d[55]=d[54]:(d[59]=d[53].get("restore_context"),d[60]=d[59].get("act_thread_id"),d[55]=["encrypted_backups_restore",":",d[60]].join("")),d[56]=c.toJSON(d[53]),c.storedProcedure(b("LSIssueNewTask"),d[55],c.i64.cast([0,50030]),d[56],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return c.i64.eq(a[6],c.i64.cast([0,21]))?c.resolve(d[59]=a[4]):c.sequence([function(a){return d[60]=c.i64.random(),d[61]=void 0==null?c.i64.to_string(d[60]):void 0,d[61]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[61],!0,void 0):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[61],"issue_task"):c.resolve()},function(a){return d[61]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[61],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[59]=d[61]}])},function(a){return d[41]=d[59]}]):c.sequence([function(a){return d[59]=c.i64.random(),d[60]=void 0==null?c.i64.to_string(d[59]):void 0,d[60]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[60],!0,void 0):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[60],"issue_task"):c.resolve()},function(a){return d[60]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[60],"request_type","ENCRYPTED_BACKUPS_MESSAGE_RANGE_QUERY"):c.resolve()},function(a){return d[41]=d[60]}])},function(e){return c.i64.eq(d[38],c.i64.cast([0,3]))?d[42]=c.i64.cast([0,4]):d[42]=c.i64.cast([0,0]),a[7]===!0?d[43]=!0:d[43]=!1,d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("request_id",d[41]),d[44].set("tam_thread_subtype",d[42]),d[44].set("reference_id",void 0),d[44].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[59]=(d[48].push(a.epochId),d[48])})},function(a){return d[57]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[58]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[57],d[50],d[58]].join("")),c.resolve()},function(e){return d[51]=new c.Map(),d[51].set("device_id",d[27]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[52]=new c.Map(),d[52].set("reference_timestamp",a[2]),d[52].set("direction",c.i64.cast([0,2])),d[52].set("server_thread_key",void 0),d[52].set("device_context",d[51]),d[52].set("source",a[6]),d[52].set("include_offset",d[43]),d[53]=new c.Map(),d[53].set("restore_context",d[44]),d[53].set("success",d[52]),d[53].set("queue_name",void 0),d[54]=d[53].get("queue_name"),d[54]!==void 0?d[55]=d[54]:(d[59]=d[53].get("restore_context"),d[60]=d[59].get("act_thread_id"),d[55]=["encrypted_backups_restore",":",d[60]].join("")),d[56]=c.toJSON(d[53]),c.storedProcedure(b("LSIssueNewTask"),d[55],c.i64.cast([0,50030]),d[56],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return d[11]?(d[43]=new c.Map(),d[43].set("error_code",c.i64.cast([0,100])),d[43].set("error_message",""),d[43].set("stored_procedure","issueMessageRangeQueryTask"),d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[45]=new c.Map(),d[45].set("restore_context",d[44]),d[45].set("failure",d[43]),d[46]=d[45].get("restore_context"),d[47]=d[46].get("act_thread_id"),d[48]=c.toJSON(d[45]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[47]].join(""),c.i64.cast([0,50031]),d[48],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[55]=new c.Map(),d[55].set("error_msg","Expected a nonempty query result"),d[55].set("code",c.i64.cast([0,3])),d[55].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[56]=c.createArray(),d[57]=(d[56].push(d[55]),d[56]),e=[void 0,d[56]],d[43]=e[0],d[44]=e[1]):(b=a.item,d[55]=new c.Map(),d[55].set("backup_id",b.backupId),d[55].set("device_public_key_blob",b.devicePublicKeyBlob),d[55].set("device_private_key_blob",b.devicePrivateKeyBlob),d[55].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[55].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[55].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[55].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[55].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[55].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[55].set("orf_client_state_v2_blob",void 0),d[55].set("orf_v2_authority_level",void 0),d[55].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[55].set("device_id",b.deviceId),d[55].set("backup_tenancy",b.backupTenancy),d[55].set("encryption_version",b.encryptionVersion),d[55].set("revision_version",b.revisionVersion),d[55].set("initialize_restore_result",void 0),d[55].set("device_creation_timestamp_sec",void 0),d[55].set("authority_level",b.authorityLevel),e=[d[55],void 0],d[43]=e[0],d[44]=e[1])})},function(a){return d[46]=new c.Map(),d[46].set("value",d[43]),d[46].set("errors",d[44]),d[47]=d[46].get("value"),d[47]!==void 0?c.sequence([function(a){return d[55]=d[47].get("backup_id"),d[56]=d[47].get("device_public_key_blob"),d[57]=d[47].get("device_private_key_blob"),d[58]=d[47].get("epoch_storage_public_key_blob"),d[59]=d[47].get("epoch_storage_private_key_blob"),d[60]=d[47].get("epoch_auth_public_key_blob"),d[61]=d[47].get("epoch_auth_private_key_blob"),d[62]=d[47].get("mailbox_root_key_blob"),d[63]=d[47].get("ocmf_client_state_blob"),d[64]=d[47].get("orf_client_state_v2_blob"),d[65]=d[47].get("orf_v2_authority_level"),d[66]=d[47].get("oblivious_validation_token_blob"),d[67]=d[47].get("device_id"),d[68]=d[47].get("backup_tenancy"),d[69]=d[47].get("encryption_version"),d[70]=d[47].get("revision_version"),d[71]=d[47].get("initialize_restore_result"),d[72]=d[47].get("device_creation_timestamp_sec"),d[73]=d[47].get("authority_level"),c.i64.neq(d[67],void 0)?c.sequence([function(a){return d[75]=void 0,c.i64.neq(d[75],void 0)?c.resolve(d[76]=d[75]):c.sequence([function(a){return d[79]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]?d[89]=(d[79].push(c.i64.cast([0,0])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]?d[89]=(d[79].push(c.i64.cast([0,2])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]?d[89]=(d[79].push(c.i64.cast([0,3])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[83]?d[89]=(d[79].push(c.i64.cast([0,4])),d[79]):0,d[84]=c.createArray(),d[85]=c.i64.of_int32(d[79].length),c.i64.gt(d[85],c.i64.cast([0,0]))?c.loopAsync(d[85],function(a){return d[89]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[79],d[89]).then(function(a){return a=a,d[90]=a[0],d[91]=a[1],a})},function(a){return d[92]=(d[84].push(d[90]),d[84])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[89]=c.createArray(),d[90]=c.i64.of_int32(d[84].length),c.i64.gt(d[90],c.i64.cast([0,0]))?c.loopAsync(d[90],function(a){return d[92]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[84],d[92]).then(function(a){return a=a,d[93]=a[0],d[94]=a[1],a})},function(a){return d[95]=(d[89].push(c.i64.to_string(d[93])),d[89])}])}):c.resolve()},function(a){return d[91]=d[89].join(","),d[86]=d[91]}])},function(a){return d[84].some(function(a){return c.i64.eq(d[69],a)})?d[87]=d[69]:d[87]=void 0,c.i64.neq(d[87],void 0)?d[88]=d[87]:d[88]=void 0,d[76]=d[88]}])},function(a){return c.i64.neq(d[76],void 0)?d[77]=d[76]:d[77]=c.i64.cast([0,0]),c.i64.neq(d[68],void 0)?d[78]=d[68]:d[78]=c.i64.cast([0,1]),d[74]=d[67]}]):c.resolve(d[74]=void 0)},function(a){return d[48]=d[74]}]):c.resolve((d[55]=d[46].get("errors"),d[56]=d[46].get("errors"),d[48]=void 0))},function(e){return d[49]=new c.Map(),d[49].set("error_code",c.i64.cast([0,100])),d[49].set("error_message",void 0==null?"":void 0),d[49].set("stored_procedure","issueMessageRangeQueryTask"),d[50]=new c.Map(),d[50].set("act_thread_id",a[0]),d[50].set("source",a[6]),d[50].set("restore_operation_type",c.i64.cast([0,2])),d[50].set("request_id",a[4]),d[50].set("device_id",d[48]),d[51]=new c.Map(),d[51].set("restore_context",d[50]),d[51].set("failure",d[49]),d[52]=d[51].get("queue_name"),d[52]!==void 0?d[53]=d[52]:(d[55]=d[51].get("restore_context"),d[56]=d[55].get("act_thread_id"),d[53]=["encrypted_backups_restore",":",d[56]].join("")),d[54]=c.toJSON(d[51]),c.storedProcedure(b("LSIssueNewTask"),d[53],c.i64.cast([0,50030]),d[54],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[42]="threak pk not found for jid",d[42]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[42]].join("")),d[43]=c.createArray(),a[4]!==void 0?d[44]=(d[43].push(a[4]),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[42],d[43],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]?d[41]=c.i64.cast([0,5]):d[41]=c.i64.cast([0,2])}])},function(a){return d[34]=!0}]):c.sequence([function(e){return d[11]?(d[37]=new c.Map(),d[37].set("error_code",c.i64.cast([0,1])),d[37].set("error_message",""),d[37].set("stored_procedure","issueMessageRangeQueryTask"),d[38]=new c.Map(),d[38].set("act_thread_id",a[0]),d[39]=new c.Map(),d[39].set("restore_context",d[38]),d[39].set("failure",d[37]),d[40]=d[39].get("restore_context"),d[41]=d[40].get("act_thread_id"),d[42]=c.toJSON(d[39]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[41]].join(""),c.i64.cast([0,50031]),d[42],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[49]=new c.Map(),d[49].set("error_msg","Expected a nonempty query result"),d[49].set("code",c.i64.cast([0,3])),d[49].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[50]=c.createArray(),d[51]=(d[50].push(d[49]),d[50]),e=[void 0,d[50]],d[37]=e[0],d[38]=e[1]):(b=a.item,d[49]=new c.Map(),d[49].set("backup_id",b.backupId),d[49].set("device_public_key_blob",b.devicePublicKeyBlob),d[49].set("device_private_key_blob",b.devicePrivateKeyBlob),d[49].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[49].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[49].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[49].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[49].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[49].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[49].set("orf_client_state_v2_blob",void 0),d[49].set("orf_v2_authority_level",void 0),d[49].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[49].set("device_id",b.deviceId),d[49].set("backup_tenancy",b.backupTenancy),d[49].set("encryption_version",b.encryptionVersion),d[49].set("revision_version",b.revisionVersion),d[49].set("initialize_restore_result",void 0),d[49].set("device_creation_timestamp_sec",void 0),d[49].set("authority_level",b.authorityLevel),e=[d[49],void 0],d[37]=e[0],d[38]=e[1])})},function(a){return d[40]=new c.Map(),d[40].set("value",d[37]),d[40].set("errors",d[38]),d[41]=d[40].get("value"),d[41]!==void 0?c.sequence([function(a){return d[49]=d[41].get("backup_id"),d[50]=d[41].get("device_public_key_blob"),d[51]=d[41].get("device_private_key_blob"),d[52]=d[41].get("epoch_storage_public_key_blob"),d[53]=d[41].get("epoch_storage_private_key_blob"),d[54]=d[41].get("epoch_auth_public_key_blob"),d[55]=d[41].get("epoch_auth_private_key_blob"),d[56]=d[41].get("mailbox_root_key_blob"),d[57]=d[41].get("ocmf_client_state_blob"),d[58]=d[41].get("orf_client_state_v2_blob"),d[59]=d[41].get("orf_v2_authority_level"),d[60]=d[41].get("oblivious_validation_token_blob"),d[61]=d[41].get("device_id"),d[62]=d[41].get("backup_tenancy"),d[63]=d[41].get("encryption_version"),d[64]=d[41].get("revision_version"),d[65]=d[41].get("initialize_restore_result"),d[66]=d[41].get("device_creation_timestamp_sec"),d[67]=d[41].get("authority_level"),c.i64.neq(d[61],void 0)?c.sequence([function(a){return d[69]=void 0,c.i64.neq(d[69],void 0)?c.resolve(d[70]=d[69]):c.sequence([function(a){return d[73]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[74]?d[83]=(d[73].push(c.i64.cast([0,0])),d[73]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[75]?d[83]=(d[73].push(c.i64.cast([0,2])),d[73]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]?d[83]=(d[73].push(c.i64.cast([0,3])),d[73]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[77]?d[83]=(d[73].push(c.i64.cast([0,4])),d[73]):0,d[78]=c.createArray(),d[79]=c.i64.of_int32(d[73].length),c.i64.gt(d[79],c.i64.cast([0,0]))?c.loopAsync(d[79],function(a){return d[83]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[73],d[83]).then(function(a){return a=a,d[84]=a[0],d[85]=a[1],a})},function(a){return d[86]=(d[78].push(d[84]),d[78])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[83]=c.createArray(),d[84]=c.i64.of_int32(d[78].length),c.i64.gt(d[84],c.i64.cast([0,0]))?c.loopAsync(d[84],function(a){return d[86]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[78],d[86]).then(function(a){return a=a,d[87]=a[0],d[88]=a[1],a})},function(a){return d[89]=(d[83].push(c.i64.to_string(d[87])),d[83])}])}):c.resolve()},function(a){return d[85]=d[83].join(","),d[80]=d[85]}])},function(a){return d[78].some(function(a){return c.i64.eq(d[63],a)})?d[81]=d[63]:d[81]=void 0,c.i64.neq(d[81],void 0)?d[82]=d[81]:d[82]=void 0,d[70]=d[82]}])},function(a){return c.i64.neq(d[70],void 0)?d[71]=d[70]:d[71]=c.i64.cast([0,0]),c.i64.neq(d[62],void 0)?d[72]=d[62]:d[72]=c.i64.cast([0,1]),d[68]=d[61]}]):c.resolve(d[68]=void 0)},function(a){return d[42]=d[68]}]):c.resolve((d[49]=d[40].get("errors"),d[50]=d[40].get("errors"),d[42]=void 0))},function(e){return d[43]=new c.Map(),d[43].set("error_code",c.i64.cast([0,1])),d[43].set("error_message",void 0==null?"":void 0),d[43].set("stored_procedure","issueMessageRangeQueryTask"),d[44]=new c.Map(),d[44].set("act_thread_id",a[0]),d[44].set("source",a[6]),d[44].set("restore_operation_type",c.i64.cast([0,2])),d[44].set("request_id",a[4]),d[44].set("device_id",d[42]),d[45]=new c.Map(),d[45].set("restore_context",d[44]),d[45].set("failure",d[43]),d[46]=d[45].get("queue_name"),d[46]!==void 0?d[47]=d[46]:(d[49]=d[45].get("restore_context"),d[50]=d[49].get("act_thread_id"),d[47]=["encrypted_backups_restore",":",d[50]].join("")),d[48]=c.toJSON(d[45]),c.storedProcedure(b("LSIssueNewTask"),d[47],c.i64.cast([0,50030]),d[48],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[36]="backup not found",d[36]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[36]].join("")),d[37]=c.createArray(),a[4]!==void 0?d[38]=(d[37].push(a[4]),d[37]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[36],d[37],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]?d[35]=c.i64.cast([0,5]):d[35]=c.i64.cast([0,2]),d[34]=!1}])},function(a){return d[7]=d[34]}]):c.sequence([function(e){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[11]?(d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("error_message",""),d[19].set("stored_procedure","issueMessageRangeQueryTask"),d[20]=new c.Map(),d[20].set("act_thread_id",a[0]),d[21]=new c.Map(),d[21].set("restore_context",d[20]),d[21].set("failure",d[19]),d[22]=d[21].get("restore_context"),d[23]=d[22].get("act_thread_id"),d[24]=c.toJSON(d[21]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[23]].join(""),c.i64.cast([0,50031]),d[24],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[31]=new c.Map(),d[31].set("error_msg","Expected a nonempty query result"),d[31].set("code",c.i64.cast([0,3])),d[31].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[32]=c.createArray(),d[33]=(d[32].push(d[31]),d[32]),e=[void 0,d[32]],d[19]=e[0],d[20]=e[1]):(b=a.item,d[31]=new c.Map(),d[31].set("backup_id",b.backupId),d[31].set("device_public_key_blob",b.devicePublicKeyBlob),d[31].set("device_private_key_blob",b.devicePrivateKeyBlob),d[31].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[31].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[31].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[31].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[31].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[31].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[31].set("orf_client_state_v2_blob",void 0),d[31].set("orf_v2_authority_level",void 0),d[31].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[31].set("device_id",b.deviceId),d[31].set("backup_tenancy",b.backupTenancy),d[31].set("encryption_version",b.encryptionVersion),d[31].set("revision_version",b.revisionVersion),d[31].set("initialize_restore_result",void 0),d[31].set("device_creation_timestamp_sec",void 0),d[31].set("authority_level",b.authorityLevel),e=[d[31],void 0],d[19]=e[0],d[20]=e[1])})},function(a){return d[22]=new c.Map(),d[22].set("value",d[19]),d[22].set("errors",d[20]),d[23]=d[22].get("value"),d[23]!==void 0?c.sequence([function(a){return d[31]=d[23].get("backup_id"),d[32]=d[23].get("device_public_key_blob"),d[33]=d[23].get("device_private_key_blob"),d[34]=d[23].get("epoch_storage_public_key_blob"),d[35]=d[23].get("epoch_storage_private_key_blob"),d[36]=d[23].get("epoch_auth_public_key_blob"),d[37]=d[23].get("epoch_auth_private_key_blob"),d[38]=d[23].get("mailbox_root_key_blob"),d[39]=d[23].get("ocmf_client_state_blob"),d[40]=d[23].get("orf_client_state_v2_blob"),d[41]=d[23].get("orf_v2_authority_level"),d[42]=d[23].get("oblivious_validation_token_blob"),d[43]=d[23].get("device_id"),d[44]=d[23].get("backup_tenancy"),d[45]=d[23].get("encryption_version"),d[46]=d[23].get("revision_version"),d[47]=d[23].get("initialize_restore_result"),d[48]=d[23].get("device_creation_timestamp_sec"),d[49]=d[23].get("authority_level"),c.i64.neq(d[43],void 0)?c.sequence([function(a){return d[51]=void 0,c.i64.neq(d[51],void 0)?c.resolve(d[52]=d[51]):c.sequence([function(a){return d[55]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[65]=(d[55].push(c.i64.cast([0,0])),d[55]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[57]?d[65]=(d[55].push(c.i64.cast([0,2])),d[55]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]?d[65]=(d[55].push(c.i64.cast([0,3])),d[55]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[59]=a[0],a})},function(a){return d[59]?d[65]=(d[55].push(c.i64.cast([0,4])),d[55]):0,d[60]=c.createArray(),d[61]=c.i64.of_int32(d[55].length),c.i64.gt(d[61],c.i64.cast([0,0]))?c.loopAsync(d[61],function(a){return d[65]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[55],d[65]).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[68]=(d[60].push(d[66]),d[60])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[65]=c.createArray(),d[66]=c.i64.of_int32(d[60].length),c.i64.gt(d[66],c.i64.cast([0,0]))?c.loopAsync(d[66],function(a){return d[68]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[60],d[68]).then(function(a){return a=a,d[69]=a[0],d[70]=a[1],a})},function(a){return d[71]=(d[65].push(c.i64.to_string(d[69])),d[65])}])}):c.resolve()},function(a){return d[67]=d[65].join(","),d[62]=d[67]}])},function(a){return d[60].some(function(a){return c.i64.eq(d[45],a)})?d[63]=d[45]:d[63]=void 0,c.i64.neq(d[63],void 0)?d[64]=d[63]:d[64]=void 0,d[52]=d[64]}])},function(a){return c.i64.neq(d[52],void 0)?d[53]=d[52]:d[53]=c.i64.cast([0,0]),c.i64.neq(d[44],void 0)?d[54]=d[44]:d[54]=c.i64.cast([0,1]),d[50]=d[43]}]):c.resolve(d[50]=void 0)},function(a){return d[24]=d[50]}]):c.resolve((d[31]=d[22].get("errors"),d[32]=d[22].get("errors"),d[24]=void 0))},function(e){return d[25]=new c.Map(),d[25].set("error_code",c.i64.cast([0,1])),d[25].set("error_message",void 0==null?"":void 0),d[25].set("stored_procedure","issueMessageRangeQueryTask"),d[26]=new c.Map(),d[26].set("act_thread_id",a[0]),d[26].set("source",a[6]),d[26].set("restore_operation_type",c.i64.cast([0,2])),d[26].set("request_id",a[4]),d[26].set("device_id",d[24]),d[27]=new c.Map(),d[27].set("restore_context",d[26]),d[27].set("failure",d[25]),d[28]=d[27].get("queue_name"),d[28]!==void 0?d[29]=d[28]:(d[31]=d[27].get("restore_context"),d[32]=d[31].get("act_thread_id"),d[29]=["encrypted_backups_restore",":",d[32]].join("")),d[30]=c.toJSON(d[27]),c.storedProcedure(b("LSIssueNewTask"),d[29],c.i64.cast([0,50030]),d[30],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[18]="backup not found",d[18]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[18]].join("")),d[19]=c.createArray(),a[4]!==void 0?d[20]=(d[19].push(a[4]),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[18],d[19],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]?d[17]=c.i64.cast([0,5]):d[17]=c.i64.cast([0,2]),d[7]=!1}])},function(a){return d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[14]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRangeQueryTask] ",d[10],d[12],d[10],d[13],d[10],d[14]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueMessageRangeQueryTask",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTaskStoredProcedure",["LSIssueMessageRangeQueryTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageRangeQueryTask"),e.threadId,e.numMessages,e.startSortKey,e.isPointQuery,e.traceId,e.newerNumMessages,e.source,e.includeOffset);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWChatEncryptedBackupsLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","ODS","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=a.cancelEndPoint,d=a.event,e=a.instanceKey;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(d,{string:{source:a}},{instanceKey:e});c("QPLUserFlow").addPoint(d,"cancel",{instanceKey:e});c("QPLUserFlow").addAnnotations(d,{string:{cancel_end_point:b}},{instanceKey:e});c("QPLUserFlow").endCancel(d,{instanceKey:e})}function a(a){var b=a.event,d=a.instanceKey,e=a.onClose;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(b,{string:{source:a}},{instanceKey:d});i({cancelEndPoint:"dialog_x_button",event:b,instanceKey:d});e()}function b(a){var b=a.annotations,e=a.event,f=a.instanceKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(e,"success",{instanceKey:f});c("QPLUserFlow").endSuccess(e,{annotations:b,instanceKey:f});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,c("MWEBODSEntityKey.enum").SUCCESS)}function e(a){var b=a.annotations,e=a.errorName,f=a.event,g=a.instanceKey,i=a.odsEntityKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(f,"failure",{instanceKey:g});c("QPLUserFlow").endFailure(f,e,{annotations:b,instanceKey:g});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,i!=null?i:c("MWEBODSEntityKey.enum").FAIL)}g.cancelFlow=i;g.closeDialogCancelFlow=a;g.endSuccess=b;g.endFailure=e}),98);
__d("MWChatEncryptedBackupsQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("qpl"))._(521476140,"378");d=a._(521472542,"295");e=a._(521484256,"3212");f=a._(521482085,"409");c=a._(521485406,"272");var h=a._(521482763,"296"),i=a._(521484295,"1460"),j=a._(521482969,"1519"),k=a._(521479124,"1939"),l=a._(521474385,"263"),m=a._(521476098,"504"),n=a._(521482858,"1290"),o=a._(521473194,"1331");a=a._(521471024,"2275");g.pinCodeChangeQplEvent=b;g.optOutQplEvent=d;g.resetBackupQplEvent=e;g.backupSetupQplEvent=f;g.mobileOnboardingQplEvent=c;g.restoreQplEvent=h;g.restoreDeviceAuthQplEvent=i;g.messageRestoreQplEvent=j;g.restoreWithAutoRestoreConsentQplEvent=k;g.hsmFleetMigrationQplEvent=l;g.virtualDeviceRevocationQplEvent=m;g.onboardingAuthQplEvent=n;g.processBackupIdsQPLEvent=o;g.fetchBackupIdsQPLEvent=a}),98);
__d("LSProcessBackupIds",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] Beginning execution."),c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1487]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.db.table(172).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1488]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.cast([0,0])}]):(f=e.item,c.sequence([function(e){return d[11]=f.backupId,d[10]=f.authorityLevel,c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(d[9]=c.i64.cast([0,1])):c.sequence([function(e){return c.i64.eq(d[10],c.i64.cast([0,80]))?c.sequence([function(e){return c.i64.eq(d[11],void 0)?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1492]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[17],d[16],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[13]=c.i64.cast([0,2])}]):c.sequence([function(e){return c.i64.eq(d[11],c.i64.cast([-1,4294967295]))?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[19]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[18],d[17],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[14]=c.i64.cast([-1,4294967295])}]):c.sequence([function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.backupId,d[11])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1490]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,4])}]):(e.item,c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1491]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,3])}]))})},function(a){return d[14]=d[15]}])},function(a){return d[13]=d[14]}])},function(a){return d[12]=d[13]}]):c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[16]].join("")),d[15]=c.createArray(),void 0!==void 0?d[17]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[16],d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]=c.i64.cast([-1,4294967295])}])},function(a){return d[9]=d[12]}])},function(a){return d[1]=d[9]}]))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsProcessBackupIdsStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsProcessBackupIdsStoredProcedure";a.__tables__=["encrypted_backups","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSProcessBackupIdsStoredProcedure",["LSProcessBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSProcessBackupIds"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWEncryptedBackupsProcessBackupIdsDEPRECATED",["FBLogger","LSFactory","LSIntEnum","LSProcessBackupIdsStoredProcedure","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLEvent","QPLUserFlow","ReQL","WebSession","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("gkx")("23914");function l(a){if(k){var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((i||(i=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});return a.runInTransaction(function(a){return c("LSProcessBackupIdsStoredProcedure")(c("LSFactory")(a))},"readwrite",void 0,void 0,f.id+":53").then(function(a){a=(j||(j=d("LSIntEnum"))).unwrapIntEnum(a[0]);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+".");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return a})}else return(h||(h=b("Promise"))).resolve(0)}function a(a,b){return a.tables.encrypted_backups.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)),function(d){if(d!=null){c("promiseDone")(l(a),b,function(a){c("FBLogger")("labyrinth_web").catching(a).info("Error in db transaction")});return}})})}g.processBackupIdsStoredProcedure=l;g.subscribeToEncryptedBackupsRow=a}),98);
__d("MWEncryptedBackupsListenForChangesToBackupStateInitPath",["EBAPIWorkerCheck","I64","LSAuthorityLevel","LSDataTraceType","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWEBRestoreTrackingUtils","MAWMainTraceUtils","MAWOfflineQueueStatus","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsProcessBackupIdsDEPRECATED","Promise","QPLEvent","QPLUserFlow","ReQL","WAJids","WATagsLogger","WebSession","gkx","isInstamadilloEB","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=c("gkx")("23961"),n=c("qex")._("121")===!0;function a(a){function b(){var b=d("ReQL").fromTableAscending(a.tables.encrypted_backups),e=b.subscribe(function(a,b){if(b.operation==="delete"||!(j||(j=d("I64"))).equal(b.value.authorityLevel,(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return;e();c("QPLUserFlow").getActiveFlowIDs().includes((l||(l=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))&&d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})});b=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((l||(l=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:b,fetchBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});c("promiseDone")(a.runInTransaction(function(a){return c("LSFetchBackupIdsStoredProcedure")(c("LSFactory")(a),{backupTenancy:(k||(k=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1})},"readwrite",void 0,void 0,f.id+":93"),function(){return p(a)})}(n||c("isInstamadilloEB")())&&b();var e=d("ReQL").fromTableAscending(a.tables.encrypted_backups_status_trigger);return e.subscribe(b)}function o(a){return a.runInTransaction(function(a){var e=d("MAWOfflineQueueStatus").getAllThreadsWithOfflineQueueIncomplete();return(i||(i=b("Promise"))).all(e.map(function(b){var e=d("WAJids").threadIdForChatJid(b),f=d("MAWMainTraceUtils").createTraceId();c("promiseDone")(d("MAWMainTraceUtils").startTraceWithTxn(a,(j||(j=d("I64"))).of_float(Date.now()),f,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE)));e={isPointQuery:!1,newerNumMessages:j.zero,numMessages:j.of_int32(20),source:k.ofNumber(c("LSMEBTaskCreationSource").UNKNOWN),threadId:e,traceId:f};d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",f]).LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[EB Prefetch] Issuing message range query for thread "," with params ",""])),b,JSON.stringify(e));d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(c("LSMEBTaskCreationSource").UNKNOWN,f,!1);return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),e)}))},"readonly",void 0,void 0,f.id+":122")}function p(a){var b=d("MAWOfflineQueueStatus").isOfflineQueueComplete();m&&!b&&c("promiseDone")(d("MWEncryptedBackupsProcessBackupIdsDEPRECATED").processBackupIdsStoredProcedure(a),function(b){if(d("EBAPIWorkerCheck").runningInWorker())return;b===3&&c("promiseDone")(o(a))})}e={listenForChangesToBackupState:a,preloadEBData:p};g["default"]=e}),98);
__d("WorkerSchedulerPriority",[],(function(a,b,c,d,e,f){"use strict";a=2;b=1;c=0;f.BACKGROUND_PRIORITY=a;f.REGULAR_PRIORITY=b;f.BLOCKING_PRIORITY=c}),66);
__d("WorkerScheduler",["$InternalEnum","Promise","QPLFlow","QuickPerformanceLogger","WAGetSafeQPLError","WAResolvable","WAShiftTimer","WATagsLogger","WATimeUtils","WorkerSchedulerPriority","err","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=d("WATagsLogger").TAGS(["WorkerScheduler"]),w=0,x=100,y=3e4,z=10,A=6e4,B=b("$InternalEnum")({CREATED:0,SCHEDULED:1,RUNNING:2,COMPLETED:3,CANCELLED:-3,FAILED:-2,STUCK:-1}),C=function(){function a(a,b){var c;this.$3=!1;this.$4=new Map();this.$5=new Map();this.$6=new Map();this.$7=[new Set(),new Set(),new Set()];this.$8=[new((c=d("WAResolvable")).Resolvable)(),new c.Resolvable(),new c.Resolvable()];this.$9=new c.Resolvable();this.$1=a;this.config=b;this.$2=v.TAGS([a])}var e=a.prototype;e.waitUntilEndReached=function(){return this.$9.promise};e.waitUntilBlockingEnded=function(){return this.$8[d("WorkerSchedulerPriority").BLOCKING_PRIORITY].promise};e.waitUntilRegularEnded=function(){return this.$8[d("WorkerSchedulerPriority").REGULAR_PRIORITY].promise};e.waitUntilBackgroundEnded=function(){return this.$8[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY].promise};e.getDebugState=function(){var a=this,b=Date.now();return{activeTasks:Array.from(this.$6.entries()).map(function(c){var d=c[0];c=c[1];d=a.$5.get(d);return!d||d.startTime==null?null:{executionTimeMs:b-d.startTime,priority:c,task:d.name,waitTimeMs:b-d.scheduledTime}}).filter(Boolean),pendingTasksByPriority:this.$7.map(function(c){var d=[];c.forEach(function(c){c=a.$5.get(c);if(!c)return;d.push({task:c.name,waitTimeMs:b-c.scheduledTime})});return d})}};e.$10=function(){if(this.$6.size<this.config.maxConcurrency){var a=this.pendingTasksTick({increaseCounter:!1,lowestTier:this.$3?d("WorkerSchedulerPriority").BACKGROUND_PRIORITY:d("WorkerSchedulerPriority").BLOCKING_PRIORITY,tasksToPick:1,tickDelta:0});a=a.candidates;var b=E.getHighestActivePriority();a.length>0&&this.maybeStartTask(a[0].id,b)}};e.runTask=function(a){return this.task(a).run()};e.task=function(a){var b,c=this.$1+":"+a.name+":"+w++;b=(b=a.priority)!=null?b:d("WorkerSchedulerPriority").REGULAR_PRIORITY;a=this.$11(c,{annotations:a.annotations,customFlags:a.customFlags,eventSamplingRate:a.eventSamplingRate,fn:a.fn,name:a.name,priority:b});this.$4.set(c,a);return a.publicApi};e.$12=function(a){var d=this.$4.get(a);if(d==null)return(u||(u=b("Promise"))).reject(c("err")("Cannot run task from Scheduler:"+this.$1+" Task was already cancelled"));d.publicApi.status=B.SCHEDULED;this.$5.set(a,d);this.$7[d.priority].add(a);this.$13(d.priority);d.metric.addPoint("schedule_start");E.scheduleTimerIfNeeded();this.$10();return d.resolvable.promise};e.$11=function(a,b){var c,e=this,f=new(d("WAResolvable").Resolvable)();c=d("QPLFlow").startQplFlowWithCoinflip(F,b.eventSamplingRate!=null?b.eventSamplingRate:this.config.defaultSamplingRate,{annotations:{bool:babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c.bool,b.customFlags),"int":babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c["int"],{originalPriority:b.priority}),string:babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c.string,{name:b.name,scheduler:this.$1,workerID:self!=null&&"worker_id"in self?self.worker_id:void 0})}});var g={fn:b.fn,id:a,loggingParams:{},maxTickDelta:0,metric:c,name:b.name,priority:b.priority,publicApi:{cancel:function(){if(g.publicApi.status!==B.CREATED&&g.publicApi.status!==B.SCHEDULED)return!1;e.$14(a,B.CANCELLED);return e.$4["delete"](a)},id:a,name:b.name,promise:f.promise,promote:function(a){e.$2.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Promoting "," from "," to ",""])),g.id,g.priority,a);if((g.publicApi.status===B.CREATED||g.publicApi.status===B.SCHEDULED)&&g.priority>a){e.$15(g,a);return!0}return!1},run:function(){return e.$12(a)},status:B.CREATED},resolvable:f,scheduledTime:Date.now(),startTime:null,tickCounter:0,waitCounter:0};return g};e.$14=function(a,b){var c=this.$5.get(a),e=c==null?void 0:c.publicApi.status;if(c==null||e===B.COMPLETED||e===B.FAILED||e===B.STUCK)return;this.$5["delete"](a);this.$6["delete"](a);c.publicApi.status=b;var f=[this.$7[d("WorkerSchedulerPriority").BLOCKING_PRIORITY].size===0,this.$7[d("WorkerSchedulerPriority").REGULAR_PRIORITY].size===0,this.$7[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY].size===0];this.$6.forEach(function(a){f[a]=!1});f[d("WorkerSchedulerPriority").BLOCKING_PRIORITY]&&f[d("WorkerSchedulerPriority").REGULAR_PRIORITY]&&f[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY]&&this.$9.resolve();for(e=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;e<=d("WorkerSchedulerPriority").BACKGROUND_PRIORITY;e++)f[e]&&this.$8[e].resolve()};e.maybeStartTask=function(a,b){var c=this.$5.get(a);if(c==null){this.$2.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Task without corresponding record: Task: ",", Scheduler: ",""])),a,this.$1);return}if(b==null||this.$3===!0)return this.$16(c);if(b<c.priority)return;return this.$16(c)};e.$16=function(a){var c=this;this.$7[a.priority]["delete"](a.id);this.$6.set(a.id,a.priority);this.$2.TAGS([a.name]).LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Started: ",""])),a.id);a.startTime=Date.now();a.publicApi.status=B.RUNNING;a.metric.addPoint("schedule_end",{"int":{priorityTier:a.priority,waitTicks:a.waitCounter}});a.metric.addPoint("run_start",{"int":{startPriority:a.priority}});var e;try{e=a.fn({metric:a.metric})}catch(a){e=(u||(u=b("Promise"))).reject(a)}e.then(function(b){a.resolvable.resolve(b),c.$2.TAGS([a.name]).LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Completed: ",""])),a.id),a.metric.addPoint("run_end",{"int":{executionTicks:a.tickCounter}}),c.$14(a.id,B.COMPLETED),a.metric.endSuccess({"int":{maxTickDeltaMs:a.maxTickDelta}}),c.$10()})["catch"](function(b){a.resolvable.reject(b),c.$2.TAGS([a.name]).WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Failed: ",""])),a.id),a.metric.addPoint("run_fail"),c.$2.TAGS([a.name]).ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Debug params: "," failed: ",""])),a.loggingParams,b),c.$14(a.id,B.FAILED),a.metric.endFail("runtime",{"int":{maxTickDeltaMs:a.maxTickDelta},string:{jsError:d("WAGetSafeQPLError").getSafeQPLErrorMessage(b)}}),c.$10()})};e.$13=function(a){for(var b=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;b<=a;b++)this.$8[b].resolveWasCalled()&&(this.$8[b]=new(d("WAResolvable").Resolvable)());this.$9.resolveWasCalled()&&(this.$9=new(d("WAResolvable").Resolvable)())};e.getHighestActivePriority=function(){var a=this,b=null;this.$6.forEach(function(c,d){c=a.$5.get(d);if(c==null){v.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""])),d,a.$1);a.$6["delete"](d);return}(b==null||b>c.priority)&&(b=c.priority)});return b};e.activeTasksTick=function(a){var b=this,d=null;this.$6.forEach(function(e,f){e=b.$5.get(f);if(e==null){v.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""])),f,b.$1);b.$6["delete"](f);return}e.tickCounter++;e.maxTickDelta=Math.max(a,e.maxTickDelta);(d==null||d>e.priority)&&(d=e.priority);e.tickCounter>b.config.ticksToStuck&&e.publicApi.status===B.RUNNING&&(v.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Possibly stuck: ",""])),e.name),b.$14(e.id,B.STUCK),e.resolvable.reject(c("err")("Stuck")),e.metric.endFail("stuck",{"int":{maxTickDeltaMs:e.maxTickDelta}}))});return d};e.$15=function(a,b){function c(){switch(e){case d("WorkerSchedulerPriority").BACKGROUND_PRIORITY:return d("WorkerSchedulerPriority").REGULAR_PRIORITY;case d("WorkerSchedulerPriority").REGULAR_PRIORITY:return d("WorkerSchedulerPriority").BLOCKING_PRIORITY;default:return d("WorkerSchedulerPriority").BLOCKING_PRIORITY}}var e=a.priority;b=b!=null?b:c();if(b===e)return;a.metric.addPoint("promote_to_"+b);this.$7[e]["delete"](a.id);a.priority=b;this.$7[b].add(a.id)};e.pendingTasksTick=function(a){var b=this,c=a.increaseCounter,e=a.lowestTier,f=a.tasksToPick,g=a.tickDelta,h=[],i=!0;a=function(a){i&&(i=b.$7[a].size===0),b.$7[a].forEach(function(e){var i=b.$5.get(e);if(i==null){v.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Pending task without corresponding record: Task: ",", Scheduler: ",""])),e,b.$1);b.$7[a]["delete"](e);return}c&&(i.waitCounter++,i.maxTickDelta=Math.max(g,i.maxTickDelta),i.priority>d("WorkerSchedulerPriority").REGULAR_PRIORITY&&i.waitCounter>=b.config.throttleTicks&&b.$15(i),i.priority===d("WorkerSchedulerPriority").REGULAR_PRIORITY&&i.waitCounter>=E.maxWaitTicksMultiplierForFinalPromotion*b.config.throttleTicks&&(v.LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Promoting task ",":"," to blocking priority"])),b.$1,i.name),b.$15(i)));if(h.length>=f)return;if(b.$6.size+h.length>=b.config.maxConcurrency)return;h.push(i)})};for(var j=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;j<=e;j++)a(j);return{candidates:h.map(function(a){return{id:a.id,priority:a.priority}}),isEmpty:i}};e.TEST_ONLY_ignore_delays=function(){this.$3=!0};return a}(),D=function(){function a(){var a=this;this.$1=new Map();this.tickFrequencyMs=x;this.maxThrottleMs=A;this.maxWaitTicksMultiplierForFinalPromotion=z;this.$2=null;this.$3=new(d("WAShiftTimer").ShiftTimer)(function(){var b=!1;try{var c,e=d("WATimeUtils").performanceAbsoluteNow();b=a.$4(e-((c=a.$2)!=null?c:e))}catch(a){v.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Scheduler fatal: ",""])),a)}finally{b===!1?(a.$2=d("WATimeUtils").performanceAbsoluteNow(),a.$3.onOrBefore(a.tickFrequencyMs)):a.$2=null}});this.$5=new Map()}var b=a.prototype;b.getHighestActivePriority=function(){var a=null;this.$5.forEach(function(b){b=b.getHighestActivePriority();a!=null&&b!=null&&a<b&&(a=b);a==null&&b!=null&&(a=b)});return a};b.$4=function(a){var b,c=!0,e=null;this.$5.forEach(function(b){b=b.activeTasksTick(a);e!=null&&b!=null&&e<b&&(e=b);e==null&&b!=null&&(e=b)});var f=[[],[],[]];this.$5.forEach(function(b){var e=b.pendingTasksTick({increaseCounter:!0,lowestTier:d("WorkerSchedulerPriority").BACKGROUND_PRIORITY,tasksToPick:b.config.concurrency,tickDelta:a}),g=e.candidates;e=e.isEmpty;c&&(c=e);g.forEach(function(a){f[a.priority].push({id:a.id,scheduler:b})})});b=(b=f.find(function(a){return a.length>0}))!=null?b:[];for(b of b){var g=b.id,h=b.scheduler;h.maybeStartTask(g,e)}return c};b.scheduleTimerIfNeeded=function(){this.$3.onOrBefore(this.tickFrequencyMs)};b.newScheduler=function(a,b){var c=this.$5.get(a);if(c)return c;c=new C(a,b);this.$5.set(a,c);return c};b.TEST_ONLY_reset=function(){this.$5=new Map(),this.$1=new Map()};return a}(),E=new D(),F=c("qpl")._(1056838280,"1566");function a(a,b){return E.newScheduler(a,{concurrency:(a=b.concurrency)!=null?a:1,defaultSamplingRate:(a=b.defaultSamplingRate)!=null?a:1e4,maxConcurrency:b.maxConcurrency,throttleTicks:Math.round(((a=b.maxThrottleMs)!=null?a:E.maxThrottleMs)/E.tickFrequencyMs),ticksToStuck:Math.round(((a=b.timeToStuckMs)!=null?a:y)/E.tickFrequencyMs)})}function e(a){a.tickFrequencyMs!=null&&(E.tickFrequencyMs=a.tickFrequencyMs),a.maxThrottleMs!=null&&(E.maxThrottleMs=a.maxThrottleMs),a.maxWaitTicksMultiplierForFinalPromotion!=null&&(E.maxWaitTicksMultiplierForFinalPromotion=a.maxWaitTicksMultiplierForFinalPromotion),a.qplEventType!=null&&(F=a.qplEventType),(t||(t=c("QuickPerformanceLogger"))).setAlwaysOnSampleRate(F,1)}function f(){E.TEST_ONLY_reset()}g.BACKGROUND_PRIORITY=d("WorkerSchedulerPriority").BACKGROUND_PRIORITY;g.BLOCKING_PRIORITY=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;g.REGULAR_PRIORITY=d("WorkerSchedulerPriority").REGULAR_PRIORITY;g.SchedulerExecutionState=B;g.makeScheduler=a;g.configWorkerScheduler=e;g.TEST_ONLY_reset=f}),98);
__d("WAWaitForUserUnblocked",["WAResolvable","WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";f=2*60*1e3;var h=new(d("WAResolvable").Resolvable)(),i=d("WorkerScheduler").makeScheduler("offline-queue",{concurrency:1,maxConcurrency:1,defaultSamplingRate:1e3,timeToStuckMs:f});function a(){h.resolveWasCalled()&&(h=new(d("WAResolvable").Resolvable)(),j())}function j(){void i.runTask({name:"offline-queue",fn:function(){return h.promise},priority:d("WorkerScheduler").BLOCKING_PRIORITY})}function b(){return h.promise}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}g.maybeResetWaitForUserUnblocked=a;g.markOfflineQueueAsStarted=j;g.waitForUserUnblocked=b;g.unblockUser=c;g.isStillWaitingForUserUnblocked=e}),98);
__d("EBLS",["EBDB","EBDBEbsmApi","EBEpochChangeListener","EBIsEbEnabledSubscriber","EBLogger","EBReadyNotifier","EBReenrollmentTriggerListener","EBWorkerAddDeviceUtils","I64","LSAuthorityLevel","LSDataTraceFlushDeferred","LSDatascriptEvaluatorMaybeDeferred","LSDedicatedMqttChannel","LSDefaultSyncGroups","LSDeleteAllAndInsertConnectivityStatusStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSInternetConnectionState","LSJSEBInMemoryStorage","LSMetadata","LSPlatformDeviceId","LSPlatformMessengerSyncParams","LSPlatformMqttRealtimeTransport","LSPlatformRealtimeTransport","LSPlatformTaskSystemTransport","LSReStoreWrapper","LSVersion","MAWBridge","MAWEBLSInWorkerSwitch","MAWEncryptedBackupsStateManager","MAWLSVaultingHooks","MAWVaultMaterialsStorage","MWEncryptedBackupsListenForChangesToBackupStateInitPath","MWEncryptedBackupsProcessBackupIdsDEPRECATED","MWPlatformTaskSystem","MqttEnv","Promise","QPLUserFlow","ReQL","ServerAppID","WAAssertUnreachable","WAResolvable","WAWaitForUserUnblocked","asyncToGeneratorRuntime","cr:7533","emptyFunction","err","getMWLSRegion","gkx","nullthrows","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=d("EBLogger").EBLogger.tags(["EBLS"]),D=c("qpl")._(521478817,"2806");function a(){return H()}var E,F,G;function H(){return E?E.promise:I({copyKeys:!0,getNewDB:!1}).promise}function I(a){E!=null&&!E.isSettled&&E.reject(c("err")("LSClient is not settled"));F!=null&&!F.isSettled&&F.reject(c("err")("LSDBStorage is not settled"));var b=new(d("WAResolvable").Resolvable)();E=b;F=null;void L(a).then(function(a){b.resolve(a)},function(a){b.reject(a)});return b}function J(){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("QPLUserFlow").addPoint(D,"offline_queue_wait_start"),yield d("WAWaitForUserUnblocked").waitForUserUnblocked(),c("QPLUserFlow").addPoint(D,"offline_queue_wait_end")});return K.apply(this,arguments)}function L(a){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e;a=a.getNewDB;d("EBReadyNotifier").resetEBReady();(e=c("QPLUserFlow")).start(D,{timeoutInMs:6e4});e.addPoint(D,"ls_storage_creation_start");a=(yield N(a));e.addPoint(D,"ls_storage_creation_end");e.addPoint(D,"eb_worker_add_device_skipped");e.endSuccess(D);d("EBReadyNotifier").markEBReady();C.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Initialised db"])));e={appId:c("nullthrows")(c("ServerAppID").app_id),executeGraphQLLightSpeedRequest:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];var e=(yield d("MAWBridge").getBridge().sendAndReceive("event","executeGraphQLLightSpeedRequest",{args:b}));return e});function c(){return a.apply(this,arguments)}return c}(),getDb:N,getEval:function(){return c("LSDatascriptEvaluatorMaybeDeferred")()},platformName:"Messenger",realtimeUnderylingTransport:function(){return(B||(B=b("Promise"))).resolve(function(b,a){return c("LSPlatformMqttRealtimeTransport")(c("LSVersion"),a,{getInstance:d("LSDedicatedMqttChannel").getInstance(function(){return!0},(b={},b[d("MqttEnv").MqttGkNames.mqttweb_global_connection_counter]=!1,b),function(a,b){return b},c("emptyFunction")),shutdownAndClear:d("LSDedicatedMqttChannel").shutdownAndClear})})},region:c("getMWLSRegion")(),schemaVersion:c("LSVersion"),sendHardcodedInitSync:!1,syncParams:c("LSPlatformMessengerSyncParams")};C.DEBUG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["created config"])));c("QPLUserFlow").addAnnotations(D,{string:{appId:e.appId}});var f=d("LSPlatformDeviceId").getDeviceIdForProviderType("ephemeral");c("QPLUserFlow").addPoint(D,"platform_client_init_start");e=(yield S(a,e,f));c("QPLUserFlow").addPoint(D,"platform_client_init_end");G=U(a);yield d("EBIsEbEnabledSubscriber").initIsEbEnabledPubSub(a);yield d("EBEpochChangeListener").initEBEpochChangeListener(a);yield d("EBReenrollmentTriggerListener").initEBReenrollmentTriggerListener(a);C.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["finished init successfully"])));return e});return M.apply(this,arguments)}function N(a){return O.apply(this,arguments)}function O(){O=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!1);if(!a&&F!=null)return F.promise;a=new(d("WAResolvable").Resolvable)();F=a;yield d("MAWVaultMaterialsStorage").setupVaultMaterials();var e={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB},g=(yield d("LSJSEBInMemoryStorage").makeReStorePersistence(e));g=d("LSReStoreWrapper").createLSReStore(g,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);e.updateEBSM=d("EBDBEbsmApi").updateEBSM(g);yield g.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("LSDefaultSyncGroups").seedDb(a,void 0)});return function(b){return a.apply(this,arguments)}}(),"readwrite","ui",void 0,f.id+":236");a.resolve(g);return g});return O.apply(this,arguments)}function e(){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(b("cr:7533")!=null||E==null)return;yield d("EBWorkerAddDeviceUtils").clearLSEBSMTables(yield N())});return P.apply(this,arguments)}function Q(a){var b=c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").listenForChangesToBackupState(a);return function(){b&&b()}}function R(a,b){var e=b==="Connected"?(z||(z=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").CONNECTED):(z||(z=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").NOT_CONNECTED);C.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status: ",""])),b);c("promiseDone")(a.runInTransaction(function(a){return c("LSDeleteAllAndInsertConnectivityStatusStoredProcedure")(c("LSFactory")(a),{internetConnectionState:e})},"readwrite",void 0,void 0,f.id+":276"),function(){C.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set successfully"])))},function(a){C.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set failed: ",""])),a==null?void 0:a.message);throw a})}function S(a,b,c){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){C.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting..."])));var g=(yield e.getEval());C.DEBUG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Getting datascript evaluator success"])));var h=g()(a);C.DEBUG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Clearing epoch before resume sync..."])));C.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Starting realtime transport"])));g=(yield e.realtimeUnderylingTransport());var i=d("LSPlatformRealtimeTransport").LSPlatformRealtimeTransport(g,e.appId,f);C.DEBUG(t||(t=babelHelpers.taggedTemplateLiteralLoose(["Starting task system"])));var j=new(c("MWPlatformTaskSystem"))(a,new(c("LSPlatformTaskSystemTransport"))(a,i,h,e.schemaVersion));C.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Starting backup state listeners"])));var k=null;b("cr:7533")!=null?c("promiseDone")(J().then(function(a){return b("cr:7533")()}),function(b){c("QPLUserFlow").addPoint(D,"sync_system_creation_start"),k=b(a,i,h,e.schemaVersion,f,e.executeGraphQLLightSpeedRequest),c("QPLUserFlow").addPoint(D,"sync_system_creation_end")}):c("QPLUserFlow").addPoint(D,"sync_system_creation_skipped");var l=Q(a);C.DEBUG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Watching for expired traces"])));var m;c("promiseDone")(d("LSDataTraceFlushDeferred").watchForExpiredTraces(a).then(function(a){m=a}));C.DEBUG(w||(w=babelHelpers.taggedTemplateLiteralLoose(["Subscribing to mqtt sync status change events"])));i.onConnectionStatusChange(function(b){R(a,b)});C.DEBUG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting sucess"])));return{cleanup:function(){var a;C.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync cleaning up"])));j==null||j.cleanup();i.cleanup();(a=k)==null||a.cleanup();l();m==null||m();G.forEach(function(a){return a()})},db:a}});return T.apply(this,arguments)}function U(a){var b=[];if(c("gkx")("12414")){var e=function(a){d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a),d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"UpdateEBState",value:{newState:a}}]})},f=a.tables.encrypted_backups.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)),function(b){if(b!=null){c("promiseDone")(d("MWEncryptedBackupsProcessBackupIdsDEPRECATED").processBackupIdsStoredProcedure(a),e,function(a){C.catching(a).mustfix("Process backup ids failed")});return}})});b.push(f)}else{f=V(a);b.push(f)}return b}function V(a){d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)).then(function(a){a!=null&&c("MAWEBLSInWorkerSwitch").set(W(a))})["catch"](function(a){C.catching(a).MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to get initial state for EBLS Switch"])))});return a.tables.secure_encrypted_backups_client_state.subscribe(function(a,b){C.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state changed. operation: ",""])),b.operation);switch(b.operation){case"delete":c("MAWEBLSInWorkerSwitch").set(!1);break;case"add":case"put":c("MAWEBLSInWorkerSwitch").set(W(b.value));break;default:b.operation;throw c("WAAssertUnreachable")(b.operation)}})}function W(a){var b=a.authorityLevel;a=a.backupTenancy;if(b==null)return!1;a=a!=null?a:(z||(z=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION);return(A||(A=d("I64"))).equal(a,(z||(z=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))&&(A||(A=d("I64"))).equal(b,(z||(z=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}g.init=a;g.genLSClient=H;g.getLSStorage=N;g.clearEBSMStorage=e;g.platformClientInit=S}),98);
__d("EBSMAPI",["Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(a=c("requireDeferred"))("EBAddDeviceWithKeys").__setRef("EBSMAPI"),j=a("EBAddDeviceWithRecoveryCode").__setRef("EBSMAPI"),k=a("EBDeleteMailbox").__setRef("EBSMAPI"),l=a("EBFetchBackupIds").__setRef("EBSMAPI"),m=a("EBGetEBState").__setRef("EBSMAPI"),n=a("EBGetLSVirtualDevices").__setRef("EBSMAPI"),o=a("EBInitializeBackup").__setRef("EBSMAPI"),p=a("EBIsEbEnabled").__setRef("EBSMAPI");d={addDeviceWithEBKeys:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.load().then(function(a){return a.addDeviceWithEBKeys.apply(a,b)})},addDeviceWithRecoveryCode:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return j.load().then(function(a){return a.addDeviceWithRecoveryCode.apply(a,b)})},deleteMailbox:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return k.load().then(function(a){return a.deleteMailbox.apply(a,b)})},fetchBackupIds:function(a,b){return l.load().then(function(c){return c.fetchBackupIds(a,b)})},getEBState:function(){return m.load().then(function(a){return a.GetEbState()})},getLSVirtualDevices:function(a){return n.load().then(function(b){return b.getLSVirtualDevices(a)})},initializeBackup:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return o.load().then(function(a){return a.initializeBackup.apply(a,b)})},isEbEnabled:function(){return p.load().then(function(a){return a.isEbEnabledEbSwitch()})},optOutOfBackup:function(){return(h||(h=b("Promise"))).resolve()}};e=d;g["default"]=e}),98);
__d("EncryptedBackupTaskFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5725");b=d("FalcoLoggerInternal").create("encrypted_backup_task_failure",a);e=b;g["default"]=e}),98);
__d("LFUCache",["Cache","ExecutionEnvironment"],(function(a,b,c,d,e,f,g){"use strict";var h,i=15,j=1,k=6e4;a=function(a){function b(b,d){var e;e=a.call(this)||this;e.$LFUCache2=b&&b>0?b:i;e.$LFUCache3=d&&d>0?d:j;((h||(h=c("ExecutionEnvironment"))).canUseDOM||(h||(h=c("ExecutionEnvironment"))).isInWorker)&&e.$LFUCache4();return e}babelHelpers.inheritsLoose(b,a);var d=b.prototype;d.$LFUCache4=function(){clearTimeout(this.$LFUCache1),this.$LFUCache1=setTimeout(this.purge.bind(this),this.$LFUCache2*k)};d.destroy=function(){clearTimeout(this.$LFUCache1)};d.get=function(b,c){this.has(b)&&this.$LFUCache5(b);return a.prototype.get.call(this,b,c)};d.set=function(b,c,d,e){var f=this.has(b);c=a.prototype.set.call(this,b,c,d,e);c&&(f?this.$LFUCache5(b):this.$LFUCache6(b,this.$LFUCache3));return c};d.purge=function(){var a=this,b=Array.from(this.__keys());b.forEach(function(b){a.$LFUCache7(b)<a.$LFUCache3?a["delete"](b):a.$LFUCache6(b,0)});this.$LFUCache4()};d.$LFUCache5=function(a){var b=this.$LFUCache7(a)+1;this.$LFUCache6(a,b);return b};d.$LFUCache7=function(a){a=this.__getRaw(a);return a&&a.$LFUCache8?a.$LFUCache8:0};d.$LFUCache6=function(a,b){var c=this.__getRaw(a);c||(c=this.__getNewRawObject());c.$LFUCache8=b;this.__setRaw(a,c);return!0};return b}(c("Cache"));g["default"]=a}),98);
__d("LSEBPayloadSerializerError",[],(function(a,b,c,d,e,f){a=Object.freeze({INVALID_BACKUP_OPERATION:-7,INVALID_CONTENT_TYPE:-6,INVALID_PAYLOAD_FORMAT:-5,CQL_DB_ERROR:-4,REQUIRED_COLUMN_NOT_PRESENT_ON_CLIENT:-3,DEPRECATED_SPROC:-2,UNKNOWN_ERROR:-1,NOT_AN_ERROR:0,BACKUP_NOT_FOUND:1,REQUIRED_TABLE_NOT_FOUND:2,NATIVE_OP_NOT_FOUND:3,BACKUP_UPLOAD_KILLSWITCHED:4,TASK_ID_NOT_FOUND:5,NOT_IMPLEMENTED:6,NOT_SUPPORTED_ON_WEB:7,DUPLICATE_TASK:8,CLIENT_STATE_NOT_LOADED:9,RECOVERY_CODE_NOT_FOUND:10,EPOCH_KEYS_NOT_FOUND:11,DEVICE_PAYLOAD_NOT_CREATED:12,NULL_DEVICE_PAYLOAD:13,EPOCH_PAYLOAD_NOT_CREATED:14,NULL_EPOCH_PAYLOAD:15,VIRTUAL_DEVICE_PAYLOAD_NOT_CREATED:16,NULL_VIRTUAL_DEVICE_PAYLOAD:17,DEVICE_METADATA_NOT_FOUND:18,NO_MATCHING_DEVICE_PUBLIC_KEY:19,NULL_MAILBOX_ROOT_KEY:20,NULL_ENCRYPTION_VERSION:21,NULL_OCMF_KEY:22,NULL_EPOCH_KEYS:23,NULL_DEVICE_ID:24,OPE_KEY_DERIVATION_FAILED:25,MESSAGE_KEY_DERIVATION_FAILED:26,NULL_MAILBOX_ROOT_KEY_V2:27,ECHO_DOCUMENT_ENCODING_FAILED:30,ECHO_PAYLOAD_CREATION_DISABLED:31,ECHO_DOCUMENT_ENCODING_SKIPPED:32,MESSAGE_PAYLOAD_ENCRYPTION_FAILED:40,SERVER_THREAD_ID_NOT_FOUND_FOR_JID:52,UNKNOWN_PROTOBUF_TYPE:60,SUPPLEMENTARY_DATA_KEY_UNEXPECTED:61,PROTOBUF_ENCRYPTION_FAILED:62,PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE:63,PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE:64,SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE:65,SUPPLEMENTAL_ENCRYPTION_FAILED:66,PROTOBUF_CONTEXT_ROW_NOT_FOUND:67,PROTOBUF_FORMATTING_FAILED:68,SUPPLEMENTAL_FORMATTING_FAILED:69,PROTOBUF_ALREADY_DELETED:70,PROTOBUF_NOT_FOUND_IN_DELETED_MESSAGES_TABLE:71,DELETION_PROTOBUF_IS_NULL:72,PROTOBUF_PAYLOAD_IN_CONTEXT_ROW_IS_NOT_FOUND:73,PROTOBUF_ENCRYPTION_FAILED_RETRYABLE:74,VALUE_SECRET_REF_INVALID:75,MINOS_ENCRYPTION_RESULT_NULL:76,SUPPLEMENTAL_OTID_NOT_SET_IN_CONTEXT_TABLE:77,SNAPSHOT_NOT_FOUND_FAILURE:78,THREAD_PK_NOT_FOUND_FOR_JID:100,MESSAGE_DECRYPTION_FAILED:101,EPOCH_KEY_FETCH_FAILED:102,TOO_MANY_OPEN_EPOCHS:103,MESSAGE_RANGE_PREPARE_FAILURE:104,ECHO_DOCUMENT_RESTORE_FAILED:105,MISMATCH_POINT_QUERY_MESSAGE_AND_RANGE_LENGTH:106,INITIAL_THREADS_FETCH_FOR_RESTORE_FAILED:107,MISSING_SUPPLEMENTAL_KEY_CIPHERTEXT:108,SUPPLEMENTAL_KEY_DECRYPTION_FAILURE:109,DEVICE_ID_MISMATCH:110,RESTORE_TO_TAM_INFO:111,MISSING_SERVER_THREAD_KEY:112,EB_ADD_DEVICE_FOUND_NO_LOCAL_THREADS:113,EB_MORE_THREADS_IN_MAPPING_TABLE:114,RESTORE_INTEGRITY_CHECK_FAILED:115,RESTORE_TOP_LEVEL_PROTOBUF_NULL:116,DECRYPT_MINOS_PROTOBUF_FAILURE:117,MESSAGE_PK_NOT_FOUND_IN_CLIENT_MESSAGES:200,OTID_NOT_FOUND_IN_ACT_MESSAGES:201,THREAD_ID_NOT_FOUND_IN_ACT_THREADS:202,THREAD_PK_NOT_FOUND_IN_CLIENT_THREADS:203,FAILED_TO_GET_THREAD_SORT_KEY:204,MEDIA_INFO_INVALID:205,REVERB_DB_NOT_ENABLED_FOR_INSTAMADILLO:206,SKIPPED_EB_DISABLED:300,SKIPPED_THREAD_NOT_ELIGIBLE:301,SKIPPED_MESSAGE_NOT_ELIGIBLE:302,NO_EPOCHS_FOUND:400,LATEST_EPOCH_QUERY_BY_ID_FAILED:401,FOUND_EPOCH_WITH_NULL_ROOT_KEY:402,FOUND_EPOCH_WITH_NULL_ANON_ID:403,NO_RECOVERY_CODE:501,NO_ERROR:601,ERROR_GENERAL:602,UNKNOWN:603,ONBOARDING_MATERIAL_DERIVATION_FAILURE:604,NULL_DEVICE_HMAC:605,MISSING_LATEST_EPOCH_AT_ONBOARDING:606,NO_THREADS_TO_COMPARE:701,START_SORT_KEY_FAILURE:702,END_SORT_KEY_FAILURE:703,LOOPING_UPLOAD_PAYLOAD_NOT_FOUND:704,NULL_ECHO_IDENTIFIERS:705,ECHO_TIMESTAMP_CONVERSION_FAILED:706,ECHO_PROTOBUF_THREAD_ID_MISMATCH:707,ECHO_PROTOBUF_TIMESTAMP_MISMATCH:708,ECHO_PROTOBUF_OTID_MISMATCH:709,NULL_ECHO_DOCUMENT:710,INVALID_PROTOBUF_BACKUP_ACTION:711,EMPTY_ENCODED_ECHO_DOCUMENT:712,LOOPING_UPLOAD_TASK_QUEUE_FULL:713,ECHO_DOCUMENT_ENCODING_UNKNOWN_ENCODING_ERROR:750,ECHO_DOCUMENT_ENCODING_MESSAGE_PK_NOT_FOUND_ERROR:751,ECHO_DOCUMENT_ENCODING_DISK_WRITE_CHECK_FAILED:752,ECHO_DOCUMENT_ENCODING_THREAD_TRANSPORT_ID_FETCH_FAILED:753,ECHO_DOCUMENT_ENCODING_FILE_WRITE_FAILED:754,ECHO_DOCUMENT_ENCODING_DISK_WRITE_DISABLED:755,ECHO_DOCUMENT_ENCODING_SHOULD_NOT_PERSIST:756,MISSING_SUPPLEMENTAL_DATA:757,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REPLY_PROXY_ERROR:758,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_QUERY_ERROR:759,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_ERROR:760,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_RECEIPTS_ERROR:761,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REACTIONS_ERROR:762,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_VISUAL_MESSAGE_ACTIONS_ERROR:763,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_POLLS_ERROR:764,READ_CLIENT_STATE_FROM_MAIN_DB_ERROR:801,NOT_SUPPORTED_ON_MAIN_DB:802,SKIP_MPS_WRITE_DUE_TO_HIGHER_TIMESTAMP_AVAILABILITY:851,MESSAGE_ALREADY_DELETED:852});f["default"]=a}),66);
__d("MAWAdminMsgTypesGrouped",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";b=[(a=d("MAWLocalizationType")).LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE];c=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE];e=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS];f=[a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER];d=[a.LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS];var h=[a.LOCALIZATION_TYPE.CURRENT_USER_LEFT_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP],i=[a.LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_AI_THEME],j=[a.LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_AI_THEME,a.LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME],k=[a.LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE],l=[a.LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED,a.LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED,a.LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED,a.LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED],m=[a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED,a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT],n=[a.LOCALIZATION_TYPE.CURRENT_USER_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_BUMP_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK],o=[a.LOCALIZATION_TYPE.PARTICIPANT_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_UNAVAILABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_FALLBACK,a.LOCALIZATION_TYPE.RTC_XMA_FALLBACK],p=[a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE],q=[a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE],r=[a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.EPHEMERAL_SETTINGS_AUTO_RESET],s=[a.LOCALIZATION_TYPE.YOUR_DEVICE_ICDC_ALERT_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE],t=[a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL],u=[a.LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED],v=[a.LOCALIZATION_TYPE.CURRENT_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_POST,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG,a.LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE],w=[a.LOCALIZATION_TYPE.PARTICIPANT_CREATED_GROUP,a.LOCALIZATION_TYPE.UNKNOWN_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_POST,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT];a=[a.LOCALIZATION_TYPE.EMPTY_SNIPPET];g.cutoverAdminMsgs=b;g.deviceChanges=c;g.currentUserAddRemoveParticipant=e;g.otherUserAddRemoveParticipant=f;g.groupPermissionsChanged=d;g.participantLeftGroup=h;g.chatCustomizedByCurrentUser=i;g.chatCustomizedByOtherUser=j;g.pinnedMessageUpdate=k;g.limitSharingUpdate=l;g.twoUsersConnected=m;g.fallbackMsgFromCurrentUser=n;g.fallbackMsgFromOtherUser=o;g.currentUserBumpsMessage=p;g.otherUserBumpsMessage=q;g.ephemeralSettingChanges=r;g.icdcAlerts=s;g.callActionToNotifyAbout=t;g.callActionNotToNotifyAbout=u;g.otherNonAdminMsgToBeBumped=v;g.otherNonAdminMsgToBeMarkedAsUnread=w;g.otherNonAdminMsgToNotTriggerUpdate=a}),98);
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={};a.name="ProtocolMsgId";a.internalSpec={externalId:[1,(d=d("WAProtoConst")).TYPES.STRING],author:[2,d.TYPES.STRING],chat:[3,d.TYPES.STRING]};b.name="MetaSyncMessageKeyProto";b.internalSpec={fromMe:[1,d.TYPES.BOOL],id:[2,d.TYPES.STRING]};c.name="MetaSyncMessageProto";c.internalSpec={key:[1,d.TYPES.MESSAGE,b],ts:[2,d.TYPES.INT64]};e.name="MetaSyncMessageRangeProto";e.internalSpec={lastMessageTimestamp:[1,d.TYPES.INT64],lastSystemMessageTimestamp:[2,d.TYPES.INT64],messages:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c]};f.name="MetaSyncChatActionProto";f.internalSpec={type:[1,d.TYPES.STRING],chatJid:[2,d.TYPES.STRING],archived:[3,d.TYPES.BOOL],ts:[4,d.TYPES.INT64],messageRange:[5,d.TYPES.MESSAGE,e],read:[6,d.TYPES.BOOL]};h.name="MetaSyncMessageActionProto";h.internalSpec={type:[1,d.TYPES.STRING],protocolMsgId:[2,d.TYPES.MESSAGE,a]};i.name="MetaSyncActionProto";i.internalSpec={chatAction:[1,d.TYPES.MESSAGE,f],messageAction:[2,d.TYPES.MESSAGE,h],__oneofs__:{action:["chatAction","messageAction"]}};j.name="MetaSyncAppDataProto";j.internalSpec={actions:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};k.name="EncryptedBackupsSecretsEpochProto";k.internalSpec={id:[1,d.TYPES.UINT64],anonId:[2,d.TYPES.BYTES],rootKey:[3,d.TYPES.BYTES],status:[4,d.TYPES.INT32]};l.name="EncryptedBackupsSecretsProto";l.internalSpec={backupId:[1,d.TYPES.UINT64],serverDataId:[2,d.TYPES.UINT64],epoch:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,k],tempOcmfClientState:[4,d.TYPES.BYTES],mailboxRootKey:[5,d.TYPES.BYTES],obliviousValidationToken:[6,d.TYPES.BYTES]};m.name="FingerprintProto";m.internalSpec={currentIndex:[1,d.TYPES.UINT32],deviceIndexes:[2,d.FLAGS.REPEATED|d.TYPES.UINT32],rawId:[3,d.TYPES.UINT32]};n.name="SyncKeyDataProto";n.internalSpec={keyId:[1,d.TYPES.BYTES],keyData:[2,d.TYPES.BYTES],keyEpoch:[3,d.TYPES.UINT32],timestamp:[4,d.TYPES.INT64],fingerprint:[5,d.TYPES.MESSAGE,m]};o.name="SyncKeyShareProto";o.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,n],orphanKeys:[2,d.FLAGS.REPEATED|d.TYPES.BYTES]};p.name="SyncKeyRequestProto";p.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.BYTES]};q.name="AppDataProto";q.internalSpec={type:[1,d.TYPES.STRING],actions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],encryptedBackupsSecrets:[3,d.TYPES.MESSAGE,l],syncKeyShare:[4,d.TYPES.MESSAGE,o],syncKeyRequest:[5,d.TYPES.MESSAGE,p]};r.name="IdentitiesPerDeviceProto";r.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};s.name="AppDataTableSchemaProto";s.internalSpec={externalId:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64],contents:[3,d.TYPES.MESSAGE,q],permittedIdentitiesPerDevice:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,r],ack:[5,d.TYPES.INT32],appDataId:[6,d.TYPES.INT32],recipientDevices:[7,d.FLAGS.REPEATED|d.TYPES.STRING],sendPartial:[8,d.TYPES.BOOL]};g.ProtocolMsgIdSpec=a;g.MetaSyncMessageKeyProtoSpec=b;g.MetaSyncMessageProtoSpec=c;g.MetaSyncMessageRangeProtoSpec=e;g.MetaSyncChatActionProtoSpec=f;g.MetaSyncMessageActionProtoSpec=h;g.MetaSyncActionProtoSpec=i;g.MetaSyncAppDataProtoSpec=j;g.EncryptedBackupsSecretsEpochProtoSpec=k;g.EncryptedBackupsSecretsProtoSpec=l;g.FingerprintProtoSpec=m;g.SyncKeyDataProtoSpec=n;g.SyncKeyShareProtoSpec=o;g.SyncKeyRequestProtoSpec=p;g.AppDataProtoSpec=q;g.IdentitiesPerDeviceProtoSpec=r;g.AppDataTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="DbAppMetaValuesProto";a.internalSpec={msgTypeVersion:[1,(c=d("WAProtoConst")).TYPES.INT32],hmacKey:[2,c.TYPES.BYTES],allowSecurityAlert:[3,c.TYPES.BOOL],hotlikeSticker:[4,c.TYPES.BYTES],isBackfilledForOccamadillo:[5,c.TYPES.BOOL],allowSecurityAlertForSelf:[11,c.TYPES.BOOL],hasMigratedFromDexie:[12,c.TYPES.BOOL],restoreMigrationAttempts:[13,c.TYPES.INT32],deviceJid:[14,c.TYPES.STRING],restoreToDexieMigrationComplete:[15,c.TYPES.BOOL],dbMigrationVersion:[16,c.TYPES.INT32]};b.name="AppMetaTableSchemaProto";b.internalSpec={key:[1,c.TYPES.STRING],value:[2,c.TYPES.MESSAGE,a]};g.DbAppMetaValuesProtoSpec=a;g.AppMetaTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="CollectionVersionsTableSchemaProto";a.internalSpec={collection:[1,(b=d("WAProtoConst")).TYPES.STRING],version:[2,b.TYPES.INT32],state:[3,b.TYPES.STRING],finiteFailureStartTime:[4,b.TYPES.INT64],ltHash:[5,b.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,b.TYPES.BOOL],isCollectionLthashInconsistent:[7,b.TYPES.BOOL]};g.CollectionVersionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="EphemeralSettingProto";a.internalSpec={ephemeralExpirationInSec:[1,(c=d("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,c.TYPES.INT64]};b.name="EphemeralSyncResponseBackoffInfo";b.internalSpec={syncResponseRetries:[1,c.TYPES.INT32],syncResponseSentTs:[2,c.TYPES.INT64]};g.EphemeralSettingProtoSpec=a;g.EphemeralSyncResponseBackoffInfoSpec=b}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="DeletedMessagesTableSchemaProto";a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],chat:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reason:[4,b.TYPES.STRING]};g.DeletedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="DeviceChangeAlertsTableSchemaProto";a.internalSpec={action:[1,(b=d("WAProtoConst")).TYPES.STRING],isArchived:[2,b.TYPES.BOOL],deviceChangeAlertsId:[3,b.TYPES.INT64],location:[4,b.TYPES.STRING],model:[5,b.TYPES.STRING],ts:[6,b.TYPES.INT64],loggedOut:[7,b.TYPES.BOOL],deviceJid:[8,b.TYPES.STRING],identity:[9,b.TYPES.BYTES],platform:[10,b.TYPES.STRING],latitude:[11,b.TYPES.STRING],longitude:[12,b.TYPES.STRING],isConfirmed:[13,b.TYPES.BOOL],isNotified:[14,b.TYPES.BOOL]};g.DeviceChangeAlertsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={BACKUP_RESTORE:0,E2E_DYI:1};b={};b.name="DyiBatchTableSchemaProto";b.internalSpec={batchId:[1,(c=d("WAProtoConst")).TYPES.INT32],numMessages:[2,c.TYPES.INT32],oldestTs:[3,c.TYPES.INT64],threadId:[4,c.TYPES.STRING],isThread:[5,c.TYPES.BOOL],numMessagesRestored:[6,c.TYPES.INT32],qplInstanceKeyForThread:[7,c.TYPES.INT64],qplFlowDescriptor:[8,c.TYPES.ENUM,a],qplInstanceKeyE2E:[9,c.TYPES.INT64],numThreadsRestored:[10,c.TYPES.INT64]};g.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=a;g.DyiBatchTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="EBMsgRangesTableSchemaProto";a.internalSpec={rangeId:[1,(b=d("WAProtoConst")).TYPES.UINT32],threadJid:[2,b.TYPES.STRING],minMsgExternalId:[3,b.TYPES.STRING],maxMsgExternalId:[4,b.TYPES.STRING],minMsgSortOrderMs:[5,b.TYPES.UINT64],maxMsgSortOrderMs:[6,b.TYPES.UINT64],creationTime:[7,b.TYPES.INT64]};g.EBMsgRangesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={};a.name="MsgContentProto";a.internalSpec={content:[1,(h=d("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,h.FLAGS.REPEATED|h.TYPES.STRING],adminType:[3,h.TYPES.STRING],obsoleteExpiration:[4,h.TYPES.INT32],obsoleteTs:[5,h.TYPES.INT64],subtype:[6,h.TYPES.STRING],protobuf:[7,h.TYPES.BYTES],screenshotActionType:[8,h.TYPES.INT32],authorName:[9,h.TYPES.STRING],version:[10,h.TYPES.INT32],mentionedJids:[11,h.FLAGS.REPEATED|h.TYPES.STRING],commands:[12,h.FLAGS.REPEATED|h.TYPES.MESSAGE,b]};b.name="MsgContentCommandProto";b.internalSpec={commandType:[1,h.TYPES.INT32],offset:[2,h.TYPES.INT32],length:[3,h.TYPES.INT32],validationToken:[4,h.TYPES.STRING]};c.name="ReportingMetaProto";c.internalSpec={frankingTag:[1,h.TYPES.BYTES],frankingVersion:[2,h.TYPES.INT32],reportingContent:[3,h.TYPES.BYTES],reportingTag:[4,h.TYPES.BYTES],frankingKey:[5,h.TYPES.BYTES]};e.name="DbQuotedMsgProto";e.internalSpec={remoteJid:[1,h.TYPES.STRING],content:[2,h.TYPES.MESSAGE,m]};f.name="VideoMsgContentProto";f.internalSpec={duration:[1,h.TYPES.INT32],width:[2,h.TYPES.INT32],height:[3,h.TYPES.INT32],mimetype:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],jpegThumbnailHeight:[6,h.TYPES.INT32],jpegThumbnailWidth:[7,h.TYPES.INT32]};i.name="ImageMsgContentProto";i.internalSpec={width:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],jpegThumbnail:[3,h.TYPES.BYTES],jpegThumbnailHeight:[4,h.TYPES.INT32],jpegThumbnailWidth:[5,h.TYPES.INT32]};j.name="AudioMsgContentProto";j.internalSpec={duration:[1,h.TYPES.INT32],mimetype:[2,h.TYPES.STRING],played:[3,h.TYPES.BOOL]};k.name="DocumentFileMsgContentProto";k.internalSpec={filename:[1,h.TYPES.STRING],mimetype:[2,h.TYPES.STRING]};l.name="QuotedDbMediaProto";l.internalSpec={mediaType:[1,h.TYPES.STRING],plaintextHash:[2,h.TYPES.STRING],size:[3,h.TYPES.INT32],ts:[4,h.TYPES.INT64],mediaEntry:[5,h.TYPES.BYTES],validatedVideoInfo:[6,h.TYPES.MESSAGE,f],validatedImageInfo:[7,h.TYPES.MESSAGE,i],validatedAudioInfo:[8,h.TYPES.MESSAGE,j],validatedDocumentFileInfo:[9,h.TYPES.MESSAGE,k]};m.name="DbQuotedMsgContentProto";m.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],author:[4,h.TYPES.STRING],msgContent:[5,h.TYPES.MESSAGE,a],obsoleteMedia:[6,h.TYPES.MESSAGE,l],msgId:[7,h.TYPES.STRING],mediaId:[8,h.TYPES.INT32],sourceId:[9,h.TYPES.STRING],xmaMessageType:[10,h.TYPES.INT32],specialTextSize:[11,h.TYPES.INT32],plaintextHash:[12,h.TYPES.STRING],expirationTs:[13,h.TYPES.INT64]};n.name="MessagesTableSchemaProto";n.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],msgId:[4,h.TYPES.STRING],author:[5,h.TYPES.STRING],ack:[6,h.TYPES.INT32],resendCount:[7,h.TYPES.INT32],msgContent:[8,h.TYPES.MESSAGE,a],altIndex:[9,h.TYPES.STRING],forwardingScore:[10,h.TYPES.INT32],quote:[11,h.TYPES.MESSAGE,e],messageExpirationTs:[12,h.TYPES.INT64],ephemeralSetting:[13,h.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,h.TYPES.STRING],isForwarded:[15,h.TYPES.BOOL],originalTs:[17,h.TYPES.INT64],sortOrderMs:[18,h.TYPES.INT64],reportingMeta:[19,h.TYPES.MESSAGE,c],messageDeleteTs:[20,h.TYPES.INT64],ephemeralCounterStarted:[21,h.TYPES.BOOL],quoteExternalId:[22,h.TYPES.STRING],unsendMsgContentDeleteTs:[23,h.TYPES.INT64],rowId:[24,h.TYPES.INT32],thread:[25,h.TYPES.INT32],mediaId:[26,h.TYPES.INT32],ephemeralMsgDisappeared:[27,h.TYPES.BOOL],threadJid:[28,h.TYPES.STRING],xmaId:[29,h.TYPES.INT32],specialTextSize:[30,h.TYPES.INT32],xmaMessageType:[31,h.TYPES.INT32],isExpiredXmaMsg:[32,h.TYPES.BOOL],ravenEphemeralType:[33,h.TYPES.INT32],ravenEphemeralMediaState:[34,h.TYPES.INT32],editCount:[35,h.TYPES.INT32],groupId:[36,h.TYPES.STRING],groupIndex:[37,h.TYPES.INT64],groupSize:[38,h.TYPES.INT64],receiverFetchId:[39,h.TYPES.STRING],source:[40,h.TYPES.STRING],quoteExpirationTs:[41,h.TYPES.INT64],applicationErrorCode:[42,h.TYPES.INT32],hdType:[43,h.TYPES.INT32],pollStanzaId:[44,h.TYPES.STRING],collapsibleId:[45,h.TYPES.STRING],isCollapsed:[46,h.TYPES.BOOL]};g.MsgContentProtoSpec=a;g.MsgContentCommandProtoSpec=b;g.ReportingMetaProtoSpec=c;g.DbQuotedMsgProtoSpec=e;g.VideoMsgContentProtoSpec=f;g.ImageMsgContentProtoSpec=i;g.AudioMsgContentProtoSpec=j;g.DocumentFileMsgContentProtoSpec=k;g.QuotedDbMediaProtoSpec=l;g.DbQuotedMsgContentProtoSpec=m;g.MessagesTableSchemaProtoSpec=n}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="EditMsgHistoryTableSchemaProto";a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,b.TYPES.INT32],editTs:[3,b.TYPES.INT64],msgContent:[4,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,b.TYPES.STRING],specialTextSize:[6,b.TYPES.INT32],threadJid:[7,b.TYPES.STRING],editExternalId:[8,b.TYPES.STRING],sendStatus:[9,b.TYPES.INT32]};g.EditMsgHistoryTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="GroupInfoSchemaProto";a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadId:[2,b.TYPES.INT32],creator:[3,b.TYPES.STRING],creationTs:[4,b.TYPES.INT64],name:[5,b.TYPES.STRING],nameOwner:[6,b.TYPES.STRING],nameTs:[7,b.TYPES.INT64],msgExpiration:[8,b.TYPES.INT32],participantVersion:[9,b.TYPES.STRING],inviter:[10,b.TYPES.STRING],memberAddMode:[11,b.TYPES.STRING]};g.GroupInfoSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="GroupInvitesTableSchemaProto";a.internalSpec={inviterJid:[1,(b=d("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,b.TYPES.STRING],inviteCode:[3,b.TYPES.STRING],inviteExpirationTs:[4,b.TYPES.INT64],caption:[5,b.TYPES.STRING]};g.GroupInvitesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={NONE:0,LQ_4K:1,HQ_4K:2};b={};c={};e={};f={};var h={},i={},j={},k={},l={};b.name="ChunkTableSchemaProto";b.internalSpec={plaintextHash:[1,(d=d("WAProtoConst")).TYPES.STRING],blobData:[2,d.TYPES.BYTES],mimetype:[3,d.TYPES.STRING],hashedPlaintextHash:[4,d.TYPES.STRING],chunkId:[5,d.TYPES.INT32]};c.name="MediaBackupSchemaProto";c.internalSpec={mediaBackupId:[1,d.TYPES.INT32],mediaId:[2,d.TYPES.INT32],objectId:[3,d.TYPES.STRING],msgId:[4,d.TYPES.STRING],fbid:[5,d.TYPES.STRING]};e.name="MediaEntriesProto";e.internalSpec={msgId:[1,d.TYPES.STRING],mediaEntryData:[2,d.TYPES.BYTES]};f.name="VideoMsgContentProto";f.internalSpec={duration:[1,d.TYPES.UINT32],width:[2,d.TYPES.UINT32],height:[3,d.TYPES.UINT32],mimetype:[4,d.TYPES.STRING],jpegThumbnail:[5,d.TYPES.BYTES],jpegThumbnailHeight:[6,d.TYPES.UINT32],jpegThumbnailWidth:[7,d.TYPES.UINT32],thumbnailPlaintextHash:[8,d.TYPES.STRING]};h.name="ImageMsgContentProto";h.internalSpec={width:[1,d.TYPES.UINT32],height:[2,d.TYPES.UINT32],jpegThumbnail:[3,d.TYPES.BYTES],jpegThumbnailHeight:[4,d.TYPES.UINT32],jpegThumbnailWidth:[5,d.TYPES.UINT32],thumbnailPlaintextHash:[6,d.TYPES.STRING],hdType:[7,d.TYPES.ENUM,a]};i.name="AudioMsgContentProto";i.internalSpec={duration:[1,d.TYPES.UINT32],mimetype:[2,d.TYPES.STRING],played:[3,d.TYPES.BOOL]};j.name="DocumentFileMsgContentProto";j.internalSpec={filename:[1,d.TYPES.STRING],mimetype:[2,d.TYPES.STRING]};k.name="ValidatedResult";k.internalSpec={validatedMimeType:[1,d.TYPES.STRING],videoStreamType:[2,d.TYPES.STRING],videoCalculatedFps:[3,d.TYPES.UINT32],videoNominalFps:[4,d.TYPES.UINT32],videoWidth:[5,d.TYPES.UINT32],videoHeight:[6,d.TYPES.UINT32],videoDuration:[7,d.TYPES.UINT32],videoAvgBitsPerSecond:[8,d.TYPES.UINT32],audioStreamType:[9,d.TYPES.STRING],audioSamplingRate:[10,d.TYPES.UINT32],audioNumberOfChannels:[11,d.TYPES.UINT32],audioAvgBitsPerSecond:[12,d.TYPES.UINT32]};l.name="MediaTableSchemaProto";l.internalSpec={mediaType:[1,d.TYPES.STRING],plaintextHash:[2,d.TYPES.STRING],size:[3,d.TYPES.UINT64],mediaEntries:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],ts:[5,d.TYPES.INT64],validatedVideoInfo:[6,d.TYPES.MESSAGE,f],validatedImageInfo:[7,d.TYPES.MESSAGE,h],validatedAudioInfo:[8,d.TYPES.MESSAGE,i],hashedPlaintextHash:[9,d.TYPES.STRING],mediaId:[10,d.TYPES.INT32],msgIds:[11,d.FLAGS.REPEATED|d.TYPES.STRING],objectId:[12,d.TYPES.STRING],fbid:[13,d.TYPES.STRING],validatedDocumentFileInfo:[14,d.TYPES.MESSAGE,j],validatedResult:[15,d.TYPES.MESSAGE,k],accessibilitySummaryText:[16,d.TYPES.STRING]};g.HD_TYPE=a;g.ChunkTableSchemaProtoSpec=b;g.MediaBackupSchemaProtoSpec=c;g.MediaEntriesProtoSpec=e;g.VideoMsgContentProtoSpec=f;g.ImageMsgContentProtoSpec=h;g.AudioMsgContentProtoSpec=i;g.DocumentFileMsgContentProtoSpec=j;g.ValidatedResultSpec=k;g.MediaTableSchemaProtoSpec=l}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="DeviceResponse";a.internalSpec={deviceId:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceResponse:[2,c.TYPES.BOOL]};b.name="MissingKeysTableSchemaProto";b.internalSpec={keyHex:[1,c.TYPES.STRING],keyId:[2,c.TYPES.BYTES],timestamp:[3,c.TYPES.INT64],deviceResponses:[4,c.FLAGS.REPEATED|c.TYPES.MESSAGE,a]};g.DeviceResponseSpec=a;g.MissingKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ParticipantsTableSchemaProto";a.internalSpec={id:[1,(b=d("WAProtoConst")).TYPES.STRING],userJid:[2,b.TYPES.STRING],deliveredWatermarkTs:[3,b.TYPES.INT64],lastReadWatermarkTs:[4,b.TYPES.INT64],type:[5,b.TYPES.STRING],addressable:[6,b.TYPES.BOOL],lastReadActionTs:[7,b.TYPES.INT64],threadId:[9,b.TYPES.INT32],threadJid:[10,b.TYPES.STRING]};g.ParticipantsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={SET:0,REMOVE:1};b={};b.name="PendingMutationsTableSchemaProto";b.internalSpec={id:[1,(c=d("WAProtoConst")).TYPES.INT32],collection:[2,c.TYPES.STRING],index:[3,c.TYPES.STRING],binarySyncAction:[4,c.TYPES.BYTES],version:[5,c.TYPES.INT32],operation:[6,c.TYPES.ENUM,a],timestamp:[7,c.TYPES.INT64],action:[8,c.TYPES.STRING]};g.SYNCD_MUTATION_SYNCD_OPERATION=a;g.PendingMutationsTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="PersonalSenderKeyStatusTableSchemaProto";a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],senderKeyId:[2,b.TYPES.INT32],rotateSenderKey:[4,b.TYPES.BOOL],senderKeyTs:[5,b.TYPES.INT64],hasSenderKey:[6,b.FLAGS.REPEATED|b.TYPES.STRING]};g.PersonalSenderKeyStatusTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPollTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={OPEN:0,FROZEN:1};b={};c={};e={};f={};b.name="PollOptionProto";b.internalSpec={optionText:[1,(d=d("WAProtoConst")).TYPES.STRING],voteAuthors:[2,d.FLAGS.REPEATED|d.TYPES.STRING]};c.name="PollOptionsProto";c.internalSpec={pollOptionHash:[1,d.TYPES.STRING],pollOption:[2,d.TYPES.MESSAGE,b]};e.name="LatestSenderTimestampsMsProto";e.internalSpec={author:[1,d.TYPES.STRING],latestSenderTimestampMs:[2,d.TYPES.INT64]};f.name="PollTableSchemaProto";f.internalSpec={chatJid:[1,d.TYPES.STRING],encKey:[2,d.TYPES.BYTES],pollAuthor:[3,d.TYPES.STRING],pollStanzaId:[4,d.TYPES.STRING],pollOptions:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],pollParticipantCount:[6,d.TYPES.UINT32],pollState:[7,d.TYPES.ENUM,a],selectableOptionsCount:[8,d.TYPES.UINT32],title:[9,d.TYPES.STRING],latestSenderTimestampsMs:[10,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e]};g.POLL_STATE=a;g.PollOptionProtoSpec=b;g.PollOptionsProtoSpec=c;g.LatestSenderTimestampsMsProtoSpec=e;g.PollTableSchemaProtoSpec=f}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ReactionsTableSchemaProto";a.internalSpec={ack:[1,(b=d("WAProtoConst")).TYPES.INT32],author:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reactionId:[4,b.TYPES.STRING],reactToExternalId:[5,b.TYPES.STRING],reactToAuthor:[6,b.TYPES.STRING],reactToMsgId:[7,b.TYPES.STRING],threadJid:[8,b.TYPES.STRING],reaction:[9,b.TYPES.STRING],groupingKey:[10,b.TYPES.STRING],ts:[11,b.TYPES.INT64],rowId:[12,b.TYPES.INT32],senderTimestampMs:[13,b.TYPES.INT64]};g.ReactionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={};a.name="DbUserStatusTsProto";a.internalSpec={deliveredTs:[1,(d=d("WAProtoConst")).TYPES.INT64],readTs:[2,d.TYPES.INT64]};b.name="StatusTsPerUserProto";b.internalSpec={userJid:[1,d.TYPES.STRING],dbUserStatusTs:[2,d.TYPES.MESSAGE,a]};c.name="IdentitiesPerDeviceProto";c.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};e.name="RetryCountPerDeviceProto";e.internalSpec={deviceJid:[1,d.TYPES.STRING],count:[2,d.TYPES.INT32]};f.name="ReceiptsTableSchemaProto";f.internalSpec={msgId:[1,d.TYPES.STRING],statusTsPerUser:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,b],permittedIdentitiesPerDevice:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],recipientDevices:[4,d.FLAGS.REPEATED|d.TYPES.STRING],retryCountsPerDevice:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],waMsgId:[6,d.TYPES.STRING]};h.name="Receipts";h.internalSpec={device:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64]};i.name="PendingReceiptsTableSchemaProto";i.internalSpec={pendingReceiptId:[1,d.TYPES.STRING],thread:[2,d.TYPES.STRING],externalId:[3,d.TYPES.STRING],author:[4,d.TYPES.STRING],deliveryReceipts:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h],readReceipts:[6,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h]};g.DbUserStatusTsProtoSpec=a;g.StatusTsPerUserProtoSpec=b;g.IdentitiesPerDeviceProtoSpec=c;g.RetryCountPerDeviceProtoSpec=e;g.ReceiptsTableSchemaProtoSpec=f;g.ReceiptsSpec=h;g.PendingReceiptsTableSchemaProtoSpec=i}),98);
__d("MAWArmadilloReceiverFetchInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ReceiverFetchInfoTableSchemaProto";a.internalSpec={mimetype:[1,(b=d("WAProtoConst")).TYPES.STRING],previewHeight:[2,b.TYPES.UINT32],previewWidth:[3,b.TYPES.UINT32],receiverFetchId:[4,b.TYPES.STRING],type:[5,b.TYPES.STRING],previewUrl:[6,b.TYPES.STRING],previewUrlExpirationTimestampMs:[7,b.TYPES.UINT64],accessibilitySummaryText:[8,b.TYPES.STRING]};g.ReceiverFetchInfoTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="SyncActionsTableSchemaProto";a.internalSpec={index:[1,(b=d("WAProtoConst")).TYPES.STRING],binarySyncData:[2,b.TYPES.BYTES],actionState:[3,b.TYPES.STRING],version:[4,b.TYPES.INT32],keyId:[5,b.TYPES.BYTES],modelId:[6,b.TYPES.STRING],modelType:[7,b.TYPES.STRING],indexMac:[8,b.TYPES.BYTES],valueMac:[9,b.TYPES.BYTES],collection:[10,b.TYPES.STRING],timestamp:[11,b.TYPES.INT64],action:[12,b.TYPES.STRING]};g.SyncActionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="SyncKeyFingerprint";a.internalSpec={currentIndex:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,c.FLAGS.REPEATED|c.TYPES.INT32],rawId:[3,c.TYPES.INT64]};b.name="SyncKeysTableSchemaProto";b.internalSpec={id:[1,c.TYPES.BYTES],keyId:[2,c.TYPES.BYTES],keyData:[3,c.TYPES.BYTES],keyEpoch:[4,c.TYPES.INT64],timestamp:[5,c.TYPES.INT64],fingerprint:[6,c.TYPES.MESSAGE,a]};g.SyncKeyFingerprintSpec=a;g.SyncKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="TasksTableSchemaProto";a.internalSpec={taskName:[1,d("WAProtoConst").TYPES.STRING],scheduledTime:[2,d("WAProtoConst").TYPES.INT64]};g.TasksTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ThreadsTableSchemaProto";a.internalSpec={jid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadOrder:[2,b.TYPES.STRING],folder:[4,b.TYPES.INT32],newestMsg:[5,b.TYPES.STRING],oldestMsg:[6,b.TYPES.STRING],lastReadMsg:[7,b.TYPES.STRING],lastReadMsgReceiptSent:[8,b.TYPES.STRING],lastReadMsgTs:[9,b.TYPES.INT64],newestMsgTs:[10,b.TYPES.INT64],muteExpireTimeMs:[11,b.TYPES.INT64],muteCallsExpireTimeMs:[12,b.TYPES.INT64],archived:[13,b.TYPES.BOOL],cannotReplyReason:[14,b.TYPES.STRING],chatId:[15,b.TYPES.INT32],optimisticThreadKey:[16,b.TYPES.STRING],isMigratedLocally:[17,b.TYPES.BOOL],snippetMsg:[18,b.TYPES.STRING],deduplicationKey:[19,b.TYPES.STRING],authoritativeThreadKey:[20,b.TYPES.STRING],snippetMsgTs:[21,b.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,b.TYPES.BOOL],unbumpFromTs:[23,b.TYPES.INT64],unbumpToTs:[24,b.TYPES.INT64]};g.ThreadsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="UnrenderedMessagesTableSchemaProto";a.internalSpec={type:[1,(b=d("WAProtoConst")).TYPES.STRING],ts:[2,b.TYPES.INT64],externalId:[3,b.TYPES.STRING],msgId:[4,b.TYPES.STRING],author:[5,b.TYPES.STRING],ack:[6,b.TYPES.INT32],resendCount:[7,b.TYPES.INT32],ephemeralSetting:[8,b.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,b.TYPES.INT64],rowId:[10,b.TYPES.INT32],thread:[11,b.TYPES.INT32],mediaId:[12,b.TYPES.INT32],msgContent:[13,b.TYPES.STRING],threadJid:[14,b.TYPES.STRING],reportingMeta:[15,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,b.TYPES.STRING],groupName:[17,b.TYPES.STRING],quote:[18,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,b.TYPES.INT32],sortOrderMs:[20,b.TYPES.INT64]};g.UnrenderedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="XMATableSchemaProto";a.internalSpec={associatedMessageId:[1,(c=d("WAProtoConst")).TYPES.STRING],author:[2,c.TYPES.STRING],ctas:[3,c.FLAGS.REPEATED|c.TYPES.MESSAGE,b],defaultCTA:[4,c.TYPES.MESSAGE,b],defaultPreviewMediaId:[5,c.TYPES.INT32],externalId:[6,c.TYPES.STRING],faviconMediaId:[7,c.TYPES.INT32],headerMediaId:[8,c.TYPES.INT32],headerTitle:[9,c.TYPES.STRING],isTombstoned:[10,c.TYPES.BOOL],maxSubtitleNumOfLines:[11,c.TYPES.INT32],maxTitleNumOfLines:[12,c.TYPES.INT32],msgId:[13,c.TYPES.STRING],overlayDescription:[14,c.TYPES.STRING],overlayIconGlyph:[15,c.TYPES.INT32],overlayTitle:[16,c.TYPES.STRING],previewMediaIds:[17,c.FLAGS.REPEATED|c.TYPES.INT32],subtitleText:[18,c.TYPES.STRING],targetExpiringAtSec:[19,c.TYPES.INT64],targetId:[20,c.TYPES.STRING],targetType:[21,c.TYPES.INT32],targetUsername:[22,c.TYPES.STRING],threadJid:[23,c.TYPES.STRING],titleText:[24,c.TYPES.STRING],xmaId:[25,c.TYPES.INT32],xmaLayoutType:[26,c.TYPES.INT32],defaultPreviewMediaPlaintextHash:[27,c.TYPES.STRING],faviconPlaintextHash:[28,c.TYPES.STRING],headerMediaPlaintextHash:[29,c.TYPES.STRING]};b.name="CTAProto";b.internalSpec={buttonType:[1,c.TYPES.INT32],title:[2,c.TYPES.STRING],actionUrl:[3,c.TYPES.STRING],nativeUrl:[4,c.TYPES.STRING],ctaType:[5,c.TYPES.STRING]};g.XMATableSchemaProtoSpec=a;g.CTAProtoSpec=b}),98);
__d("MAWAuthoritativeThreadsCache",[],(function(a,b,c,d,e,f){"use strict";a=new Set();f.AuthoritativeThreadsCache=a}),66);
__d("MAWBridgeReceiverFetchInfo",["WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e){var f=e.accessibilitySummaryText,g=e.mimetype,h=e.previewHeight,k=e.previewUrl,l=e.previewUrlExpirationTimestampMs,m=e.previewWidth,n=e.receiverFetchId;e=e.type;return{accessibilitySummaryText:f,mimetype:g,msgId:b,previewHeight:h,previewUrl:k,previewUrlExpirationTimestampMs:j(l),previewWidth:m,receiverFetchId:n,sortOrderMs:i(c,d),threadJid:a,type:e}}function b(a,b,c,d,e){var f=e.mimetype,g=e.previewHeight,h=e.previewWidth,j=e.receiverFetchId;e=e.type;return{mimetype:f,msgId:b,previewHeight:g,previewWidth:h,receiverFetchId:j,sortOrderMs:i(c,d),threadJid:a,type:e}}function i(a,b){return d("WATimeUtils").castToMillisTime(a!=null?a:b*1e3)}function j(a){if(a==null)return void 0;try{return d("WATimeUtils").castLongIntToMillisTime(a)}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast previewUrlExpirationTimestampMs to millis time: ",""])),a);return void 0}}g.createBridgeReceiverFetchInfoPayloadFromDbInfo=a;g.createBridgeReceiverFetchInfoPayloadFromUnstoredInfo=b}),98);
__d("MAWBridgeTypesCreators",["FBLogger","MAWDbMsg","MAWImageUtils","MAWMsgType","MAWUserJidWrapper","WAJids","WAMediaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{threadJid:a}}function h(a){var b,c=a.ts;switch(a.type){case d("MAWMsgType").MSG_TYPE.REVOKED:c=(b=a.originalTs)!=null?b:a.ts;break;default:c=d("MAWDbMsg").getCanonicalTsFromMsg(a)}return{msgId:a.msgId,ts:c}}function b(a,b){b=b.map(h);return{messages:b,threadJid:a}}function e(a){return{ravenMsgId:a.msgId,threadJid:a.threadJid}}function f(a,b){return a.filter(function(a){return b===a.threadJid}).map(function(a){return a.msgId})}function i(a){var b,e=a.chatJid,f=a.filteredMsgIds,g=a.hasMediaForUI,h=a.hdTypes,i=a.media,j=a.offlineAttachmentId,k=a.ravenSettings,l=a.sortOrderMs;a=a.transportKey;switch(i.mediaType){case"Image":return{duration:null,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedImageInfo)==null?void 0:b.jpegThumbnail)!=null,hdTypes:h,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailHeight,previewHeightLarge:(h=i.validatedImageInfo)==null?void 0:h.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Video":return{duration:((b=i.validatedVideoInfo)==null?void 0:b.duration)!=null?((h=i.validatedVideoInfo)==null?void 0:h.duration)*1e3:0,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnail)!=null,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedVideoInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedVideoInfo)==null?void 0:k.height,previewWidth:(b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedVideoInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Ptt":return{duration:(k=i.validatedAudioInfo)!=null&&k.duration?i.validatedAudioInfo.duration*1e3:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Gif":return{accessibilitySummaryText:(b=i.accessibilitySummaryText)!=null?b:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedImageInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedImageInfo)==null?void 0:k.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Sticker":h=d("MAWImageUtils").boundHeightWidth((k=i.validatedImageInfo)==null?void 0:k.jpegThumbnailHeight,(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);k=h.height;b=h.width;return{accessibilitySummaryText:(h=i.accessibilitySummaryText)!=null?h:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:k,previewHeightLarge:k,previewWidth:b,previewWidthLarge:b,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"DocumentFile":h={};for(k of i.mediaEntries){b=k[0];var m=k[1];m=d("WAMediaUtils").mediaEntryDataToRawData(i.plaintextHash,m);m=m.filename;m!=null&&(h[b]=m)}return{defaultFilename:(b=i.validatedDocumentFileInfo)==null?void 0:b.filename,duration:null,filenames:h,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};default:i.mediaType;throw c("FBLogger")("messenger_web").mustfixThrow("[createBridgeMedia] Unsupported media type: "+i.mediaType)}}function j(a,b,c){return{chatJid:a,deliveredWatermarkTs:c!=null?c:d("WATimeUtils").castToUnixTime(0),fbid:b,lastReadActionTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)}}function k(a){var b=a.cannotReplyReason,c=a.folder,d=a.snippetParams,e=a.snippetSenderContactId,f=a.snippetType;a=a.threadJid;return{cannotReplyReason:b,folder:c,snippetContactIDs:d==null?void 0:d.contactIDs,snippetMentionJIDs:d==null?void 0:d.mentionJIDs,snippetParams:d==null?void 0:d.strings,snippetSenderContactId:e,snippetType:f,threadJid:a}}function l(a){return{chatJid:a.groupJid,memberAddMode:a.memberAddMode,threadName:a.name}}var m={snippetContactIDs:[],snippetMentionJIDs:[],snippetParams:[],snippetSenderContactId:null,snippetType:null};function n(a){var b,c=a.bumpTimestampMs,d=a.description,e=a.isMessageAuthorMe,f=a.isUnbump,g=a.skipBumpTimestampValidation,h=a.skipServerThreadBump,i=a.snippetData;a=a.threadJid;b=i==null?m:{snippetContactIDs:i.params.contactIDs,snippetMentionJIDs:(b=i.params.mentionJIDs)!=null?b:[],snippetParams:i.params.strings,snippetSenderContactId:i.senderContactId,snippetType:i.type};return babelHelpers["extends"]({},b,{bumpTimestampMs:c,description:d,isMessageAuthorMe:e,isUnbump:f,skipBumpTimestampValidation:g!=null?g:!1,skipServerThreadBump:h!=null?h:!1,threadJid:a})}function o(a){var b=a.author,c=a.chatJid,e=a.reaction,f=a.reactToMsgId;a=a.ts;return{actorId:d("WAJids").authorToUserId(b,d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid())),chatJid:c,messageId:f,reaction:e,ts:a}}function p(a){var b=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid()),c=a.author,e=a.chatJid;a=a.reactToMsgId;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:e,messageId:a}}function q(a){return{creationTs:a.creationTs,creator:a.creator,groupJid:a.groupJid,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a){var b=a.threadJid,c=a.inviteeJid;return{caption:a.caption,inviteCode:a.inviteCode,inviteeId:c,inviteExpireTs:a.inviteExpirationTs,inviterId:d("WAJids").extractUserId(a.inviterJid),threadJid:b}}function s(a){return{threadJid:a}}function t(a,b,c){return{senderId:d("WAJids").extractUserId(b),state:c,threadJid:a}}g.createBridgeUpdateE2EEMetadataParticipants=a;g.createBridgeDeletedMessage=h;g.createBridgeDeleteMessages=b;g.createBridgeRavenAction=e;g.getMsgIdsFilteredByJid=f;g.createBridgeMedia=i;g.createBridgeReceivedReceipt=j;g.createBridgeUpdatedThread=k;g.createBridgeUpdatedGroupInfo=l;g.createBridgeBumpedThreadV2=n;g.createBridgeUpsertReaction=o;g.createBridgeDeleteReaction=p;g.createBridgeGroupInfo=q;g.createBridgeGroupInvite=r;g.createBridgeDeleteGroupInvite=s;g.createBridgeReceivedChatState=t}),98);
__d("MAWCacheServiceBase",["MAWCacheServiceDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=["id"];a=function(){function a(a){this.$1=new Map(),this.namespace=a}var c=a.prototype;c.$2=function(a){return(a=this.$1.get(a))!=null?a:null};c.updateInMemoryCache=function(a,b){this.$1.set(a,b)};c.updateInMemoryCacheBulk=function(a){var b=this;a.forEach(function(a){var c=a[0];a=a[1];b.updateInMemoryCache(c,a)})};c.getValueFromCache=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,c=this.$2(a);if(c!=null)return c;c=(yield d("MAWCacheServiceDB").getOrSetupMAWCacheDB());c=(yield c.runInTransaction([this.namespace],"readonly",function(c){return c.stores[b.namespace].getByIndex("key",[a])},"read_from_persisted_"+this.namespace));if(c==null)return null;c.id;c=babelHelpers.objectWithoutPropertiesLoose(c,h);this.updateInMemoryCache(a,c);return c});function c(b){return a.apply(this,arguments)}return c}();return a}();g["default"]=a}),98);
__d("MAWDbParticipant",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a+"_"+b}f.craftParticipantId=a}),66);
__d("MAWDbThread",["MAWHexUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+b}g.craftThreadOrder=a}),98);
__d("MAWDexie",["cr:10766"],(function(a,b,c,d,e,f,g){"use strict";f.exports=b("cr:10766")}),34);
__d("MAWDexieTable",["MAWDexie","Promise","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(h||(h=b("Promise"))).resolve(a)}function a(a){return a.reduce(function(a,b,c){return a.then(function(a){return b(c).then(function(b){a.push(b);return a})})},n([]))}function e(a){return c("MAWDexie").Promise.all(a)}function f(a){return c("MAWDexie").Promise.allSettled(a)}function j(a){return c("MAWDexie").Promise.PSD[a]}function k(a,b){c("MAWDexie").Promise.PSD[a]=b}function l(a){c("MAWDexie").Promise.PSD[a]=void 0}var m=function(){function a(a,b,d,e){d===void 0&&(d=!0);e=new(c("MAWDexie"))(a,babelHelpers["extends"]({},e,{chromeTransactionDurability:"relaxed",modifyChunkSize:c("justknobx")._("3166")}));b(e);this.name=a;this.stores=e;d&&this.open()}var d=a.prototype;d.open=function(){this.stores.open()};d.close=function(){this.stores.close()};d.transact=function(a,c,d){var e=this;return i(this.stores.transaction(a,c.map(function(a){return e.stores[a]}),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d());return a})))};return babelHelpers.createClass(a,[{key:"tables",get:function(){return this.stores.tables}}])}();function n(a){return c("MAWDexie").Promise.resolve(a)}g.DEXIE_MIN_KEY=d("MAWDexie").Dexie.minKey;g.DEXIE_MAX_KEY=d("MAWDexie").Dexie.maxKey;g.undexify=i;g.dexieSequentialAll=a;g.dexieAll=e;g.dexieAllSettled=f;g.getDexiePSDItem=j;g.setDexiePSDItem=k;g.clearDexiePSDItem=l;g.DexieTable=m;g.dexieResolve=n}),98);
__d("MAWDbSchema.dexie",["FBLogger","MAWDbMsg","MAWDbParticipant","MAWDbThread","MAWDbVersionList","MAWDexie","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a){var b=function(a){var b;b=(b=a.quote)==null?void 0:b.content;return a.quoteExternalId!=null&&(b==null?void 0:b.media)!=null};return a.messages.where("quoteExternalId").between(d("WAStanzaUtils").toStanzaId("0"),d("WAStanzaUtils").toStanzaId("["),!0,!0).filter(b).toArray()["catch"](function(){return a.messages.filter(b).toArray()}).then(function(b){var c=new Set(b.map(function(a){var b;a=(a=a.quote)==null?void 0:a.content;return a==null||(b=a.media)==null?void 0:b.plaintextHash}).filter(Boolean)),d=b.map(function(a){a=a.msgId;return a});return a.media.filter(function(a){a=a.plaintextHash;return c.has(a)}).toArray().then(function(b){var c=new Map(b.map(function(a){var b=a.mediaId;a=a.plaintextHash;return[a,b]}));return a.messages.where("msgId").anyOf(d).modify(function(a){var b;b=(b=a.quote)==null?void 0:b.content;a.quote.content.mediaId=c.get(b.media.plaintextHash);delete a.quote.content.media})})})};b=function(a){return a.groupInfo.toCollection().modify(function(a){typeof a.inviter==="number"&&delete a.inviter})};e=function(){return d("MAWDexieTable").dexieResolve()};f=function(a){return a.threads.filter(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(){return!1},user:function(){return a.oldestMsg!=null}})}).toArray().then(function(b){var c=[];b.forEach(function(a){c.push(a.oldestMsg),c.push(d("MAWDbMsg").toMsgId__UNSAFE_DO_NOT_USE(a.newestMsg))});return a.messages.where("msgId").anyOf(c.filter(Boolean)).toArray().then(function(c){var e=new Map(),f=[],g=[];c.forEach(function(a){e.set(a.msgId,a)});b.forEach(function(b){var c=e.get(b.oldestMsg),h=e.get(b.newestMsg);(c==null?void 0:c.type)==="Admin"&&(h==null?void 0:h.type)==="Admin"&&(c.msgId===h.msgId?g.push(b.chatId):f.push(b));return d("MAWDexieTable").dexieAll(f.map(function(b){return a.messages.where("thread").equals(b.chatId).toArray()})).then(function(b){b.forEach(function(a){if(a.length===0)return;var b=a[0].thread;a=a.filter(function(a){return a.type!=="Admin"});if(a.length>0)return;g.push(b)});return d("MAWDexieTable").dexieAll([a.threads.bulkDelete(g),a.messages.where("thread").anyOf(g)["delete"]()])})})})})};var j=function(a){return a.unrenderedMessages.toCollection().modify(function(a){if(a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var b=a.messageDeleteForMeTs;a.messageDeleteForMeTs=b}})},k=function(a){var b=0,e=0,f=c("MAWDexie").currentTransaction;if(f==null)throw c("FBLogger")("maw_db").mustfixThrow("transaction does not exist");f.on("complete",function(){b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),e>0&&d("MAWODSProxy").odsBumpEntityKey({amount:e,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})});return a.threads.toArray().then(function(c){var f=c.reduce(function(a,b){b!=null&&a.set(b.chatId,b);return a},new Map());return d("MAWDexieTable").dexieAll([a.messages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1}),a.unrenderedMessages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1})])})},l=function(a){return a.isDualSend.toCollection().modify(function(a){a.version==null&&(a.version=1)})},m=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(a.altIndex=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.thread))})},n=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},o=function(a){return a.threads.toCollection().modify(function(a){a.folder==null&&(a.folder=d("MAWFolderTypes").FOLDER_ID.INBOX)})},p=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},q=function(a){return a.personalSenderKeyStatuses.toCollection().modify(function(a){a.rotateSenderKey=!0,a.hasSenderKey=new Set()})},r=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&a.sortOrderMs!=null&&a.sortOrderMs>0&&(a.sortOrderMs=0)})},s=function(a){return a.messages.toCollection().modify(function(a){!(a.type===d("WAMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&a.sortOrderMs!=null&&a.sortOrderMs<1661204086&&(a.sortOrderMs=d("MAWDbMsg").getCanonicalTsFromMsg(a)*1e3)})},t=function(a){return a.threads.filter(function(a){return a.isMigratedLocally===!0&&a.newestMsg!=null}).toArray().then(function(b){var c=b.map(function(a){return a.chatId}),e=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.where(["thread","sortOrderMs"]).between([b.chatId,0],[b.chatId,Number.MAX_VALUE]).last().then(function(a){a!=null&&e.set(a.thread,a.msgId)})})).then(function(){return a.threads.where("chatId").anyOf(c)})})},u=function(){return d("MAWDexieTable").dexieResolve()},v=function(a){return a.threads.toCollection().modify(function(a){a.lastReadMsgTs!=null&&a.lastReadMsgTs<d("WATimeUtils").MAX_INT&&(a.lastReadMsgTs=d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs));if(a.newestMsgTs!=null&&a.newestMsgTs<d("WATimeUtils").MAX_INT){var b=d("MAWTimeUtils").ensureValidMillisTime(a.newestMsgTs);a.newestMsgTs=b;b!=null&&(a.threadOrder=d("MAWDbThread").craftThreadOrder(b,a.jid))}})},w=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(a.altIndex=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(a.thread))})},x=function(){return d("MAWDexieTable").dexieResolve()},y=function(){return d("MAWDexieTable").dexieResolve()},z=function(){return d("MAWDexieTable").dexieResolve()},A=function(a){return a.participants.toCollection().modify(function(a){var b;if(a==null||((b=a.userJid)==null?void 0:b.indexOf("@msgr@msgr"))===!1)return;a.id=a.id.replace("@msgr@msgr","@msgr");a.userJid=a.userJid.replace("@msgr@msgr","@msgr")}).then(c("emptyFunction"))},B=function(a){var b=a.threads.filter(function(a){return a.snippetMsg!=null&&a.snippetMsgTs==null});return b.toArray().then(function(c){var e=c.reduce(function(a,b){b!=null&&b.snippetMsg!=null&&a.set(b.jid,b.snippetMsg);return a},new Map());c=Array.from(e.values());return a.messages.where("msgId").anyOf(c).toArray().then(function(a){var c=a.reduce(function(a,b){b!=null&&b.serverTs!=null&&a.set(b.msgId,b.serverTs);return a},new Map());b.modify(function(a){var b=e.get(a.jid);if(b!=null){b=c.get(b);b!=null&&(a.snippetMsgTs=d("WATimeUtils").castUnixTimeToMillisTime(b))}})})})},C=function(a){return a.threads.toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.participants.where("threadId").equals(b.chatId).modify(function(a){a.threadJid=(a=a.threadJid)!=null?a:b.jid})}))})},D=C,E=function(a){var b=[];return a.groupInvites.toArray().then(function(c){var d=c.map(function(a){return a.invitedParticipantId});return a.participants.bulkGet(d).then(function(d){d.forEach(function(a,d){if(a==null){a=c[d];b.push(a)}});var e=d.filter(Boolean);return a.groupInvites.bulkPut(c.map(function(a){var c=e.find(function(b){return b.id===a.invitedParticipantId});if(c!=null){a.inviteeJid=c.userJid;a.threadJid=c.threadJid;return babelHelpers["extends"]({},a,{inviteeJid:c.userJid,threadJid:c.threadJid})}else{b.push(a);return a}}))})}).then(function(){return a.groupInvites.bulkDelete(b.map(function(a){return[a.invitedParticipantId,a.inviterJid]}))})},F=function(a){var b=new Map();return a.receipts.toArray().then(function(e){return d("MAWDexieTable").dexieAll(e.map(function(e){return a.messages.get({msgId:e.msgId}).then(function(f){if(f==null)return a.receipts["delete"](e.msgId).then(c("emptyFunction"));else{var g=d("WAMsg").craftWAMsgIdString({author:f.author,chat:f.threadJid,externalId:f.externalId});if(b.has(g)){var i;i=(i=b.get(g))!=null?i:1;b.set(g,i);d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""])),i);return a.receipts["delete"](e.msgId).then(c("emptyFunction"))}else{b.set(g,1);return a.receipts.where("msgId").equals(f.msgId).modify(function(a){a.waMsgId=g}).then(c("emptyFunction"))}}})}))})},G=function(){return d("MAWDexieTable").dexieResolve()},H=function(a){return a.participants.toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{id:d("MAWDbParticipant").craftParticipantId(a.threadJid,a.userJid)})});b=b.map(function(a){return a.id});return a.participants.bulkDelete(b).then(function(){a.participants.bulkPut(c)})})},I=function(a){return a.reactions.toCollection().modify(function(a){a.ts=a.ts})};a=new Map([[(i=d("MAWDbVersionList")).VERSION.V26,a],[i.VERSION.V27,b],[i.VERSION.V28,e],[i.VERSION.V29,f],[i.VERSION.V30,j],[i.VERSION.V31,k],[i.VERSION.V43,l],[i.VERSION.V44,m],[i.VERSION.V45,n],[i.VERSION.V46,o],[i.VERSION.V47,p],[i.VERSION.V53,q],[i.VERSION.V54,r],[i.VERSION.V55,s],[i.VERSION.V56,t],[i.VERSION.V57,u],[i.VERSION.V58,v],[i.VERSION.V60,w],[i.VERSION.V66,x],[i.VERSION.V68,y],[i.VERSION.V71,z],[i.VERSION.V72,A],[i.VERSION.V82,B],[i.VERSION.V85,C],[i.VERSION.V87,D],[i.VERSION.V90,E],[i.VERSION.V91,F],[i.VERSION.V101,G],[i.VERSION.V104,H],[i.VERSION.V116,I]]);g.dbUpgrades=a}),98);
__d("MAWDbSchemaReStoreDexieUtils",["FBLogger","MAWDbSchema","MAWDbSchema.dexie","sortBy"],(function(a,b,c,d,e,f,g){"use strict";var h=c("sortBy")(Array.from(new Set([].concat(Array.from(d("MAWDbSchema").dbSchema.keys()),Array.from(d("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(a){return{schema:d("MAWDbSchema").dbSchema.get(a),upgrade:d("MAWDbSchema.dexie").dbUpgrades.get(a),version:a}}),function(a){a=a.version;return a}),i=function(a,b){return Array.from(a.filter(function(a){return a.version<=b&&a.schema!=null}).reduce(function(a,b){(b=b.schema)==null||b.forEach(function(b){a.set(b.name,b)});return a},new Map()).values())},j=function(a,b){return i(a,b).reduce(function(a,b){var d=b.autoIncrement,e=b.dexieOnly_primaryKeyUnique,f=b.name,g=b.primaryKey,h=b.removed;f=f.replace(/^e2ee_/,"");if(h===!0){a[f]=null;return a}if(d&&e===!0)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(b));h=d?"++":"";d=e===!0?"&":"";e=""+(g.length>1?"[":"")+g.join("+")+(g.length>1?"]":"");g=Object.values(b.indexes).map(function(a){var b=a.columns,c=!(a.unique===!1),d=b.length>1;a=a.multiEntry_DO_NOT_USE===!0;c=c&&!a?"&":"";a=a?"*":"";c=""+c+a;return""+c+(d?"[":"")+b.join("+")+(d?"]":"")}).join(",");a[f]=[""+h+d+e,g].filter(Boolean).join(",");return a},{})};a=function(a){return j(h,a)};g.MAW_DB_VERSION_CHANGES=h;g.getDexieSchemaForVersion=j;g.getCompleteDexieSchemaForVersion=a}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWDbVersionList","MAWGetDbVersion","MAWIndexedDbMetadata","MAWODSProxy","MWFBLogger","Promise","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=d("MWFBLogger").MWLogger.tags(["db","getDexieDbVersion"]);e=d("MAWGetDbVersion").getArmadilloDbVersion();f=d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,e>0?e:Infinity));function s(a,b){var c=b.schema,d=b.upgrade;b=b.version;c!=null&&d!=null?a.version(b).stores(c).upgrade(d):c!=null?a.version(b).stores(c):d!=null?a.version(b).upgrade(d):a.version(b);return b}function t(a){return new(q||(q=b("Promise")))(function(b){if(!indexedDB){b();return}var c=indexedDB.open(a);c.onupgradeneeded=function(c){c.target.transaction.abort();c=c.target.result;r.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose([""," onupgradeneeded - closing db"])),a);c==null||c.close();b()};c.onsuccess=function(c){c=c.target.result;var e=c==null?void 0:c.version;r.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose([""," version: ",""])),a,e!=null?e:"null");c==null||c.close();e!=null?(e%10>=1&&d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_DB_UNEXPECTED_VERSION,key:"fail_"+e%10}),b(d("MAWDbVersionList").toVersion(e/10))):b()};c.onerror=function(c){var d;r.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose([""," error ",""])),a,c==null||(d=c.target)==null||(d=d.error)==null?void 0:d.message);b()};c.onblocked=function(b){b=b.target.result;var c=b==null?void 0:b.version;r.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose([""," blocked, version: ",""])),a,c!=null?c:"null");b==null||b.close()}})}function a(){var a=d("MAWCurrentUser").getID();return t(d("MAWIndexedDbMetadata").dbName(a))}function u(a,b){if(a.upgrade!=null||b.upgrade!=null)return!0;a=Object.keys((a==null?void 0:a.schema)||{});b=Object.keys((b==null?void 0:b.schema)||{});a=[].concat(a,b);b=new Set(a);return b.size!==a.length}function v(a){return a.reduce(function(a,b,c){if(c===0)return[babelHelpers["extends"]({},b,{schema:d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(b.version)})];c=a[a.length-1];b=babelHelpers["extends"]({},b,{schema:b.schema!=null?d("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([b],b.version):null});if(u(c,b)){a.push(b);return a}a.splice(a.length-1,1,babelHelpers["extends"]({},c,b,{schema:babelHelpers["extends"]({},c==null?void 0:c.schema,b==null?void 0:b.schema)}));return a},[])}function c(a,b,c,e){var f=e!=null?e:d("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:d("MAWGetDbVersion").getArmadilloDbVersion();r.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""])),c,f);f==null&&r.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"])));c!=null&&c>f&&(r.WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]))),f=c);e=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return c==null||a>c}).filter(function(a){a=a.version;return f==null||f>=a});var g=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return f==null||f>=a});if(e.length===0||e.length===g.length){r.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"])));b.addAnnotations({bool:{isUpgradeNeeded:!1}});g=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version;g=Math.min(f!=null&&f>0?f:g,g);a.version(g).stores(d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(g));return g}g=v(e);r.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""])),g.length,e[0].version,e[e.length-1].version);e=g.filter(function(a){return!!a.upgrade}).map(function(a){return a.version.toString()});var h=g.filter(function(a){return!!a.schema}).map(function(a){return a.version.toString()});e.length&&b.addAnnotations({string_array:{dataMigrationVersions:e}});h.length&&b.addAnnotations({string_array:{schemaUpgradeVersions:h}});b.addAnnotations({bool:{isUpgradeNeeded:!0}});var i=0;g.forEach(function(b){i=Math.max((b=s(a,b))!=null?b:0,i!=null?i:0)});return i}g.CURRENT_MAW_STORES=f;g.getDexieDbVersion=t;g.getDBVersion=a;g.updateDB=c}),98);
__d("MAWDexieError",[],(function(a,b,c,d,e,f){"use strict";a="ModifyError";b="BulkError";c="OpenFailedError";d="VersionChangeError";e="SchemaError";var g="UpgradeError",h="InvalidTableError",i="MissingAPIError",j="NoSuchDatabaseError",k="InvalidArgumentError",l="SubTransactionError",m="UnsupportedError",n="InternalError",o="DatabaseClosedError",p="PrematureCommitError",q="ForeignAwaitError",r="UnknownError",s="ConstraintError",t="DataError",u="TransactionInactiveError",v="ReadOnlyError",w="VersionError",x="NotFoundError",y="InvalidStateError",z="InvalidAccessError",A="AbortError",B="TimeoutError",C="QuotaExceededError",D="SyntaxError",E="DataCloneError";A={AbortError:A,BulkError:b,ConstraintError:s,DatabaseClosedError:o,DataCloneError:E,DataError:t,ForeignAwaitError:q,InternalError:n,InvalidAccessError:z,InvalidArgumentError:k,InvalidStateError:y,InvalidTableError:h,MissingAPIError:i,ModifyError:a,NoSuchDatabaseError:j,NotFoundError:x,OpenFailedError:c,PrematureCommitError:p,QuotaExceededError:C,ReadOnlyError:v,SchemaError:e,SubTransactionError:l,SyntaxError:D,TimeoutError:B,TransactionInactiveError:u,UnknownError:r,UnsupportedError:m,UpgradeError:g,VersionChangeError:d,VersionError:w};f.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError","MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null;function j(a){var b=new Set(Object.keys(d("MAWDexieError").DEXIE_ERROR));b.has(a.reason)&&h!=null&&(h.endFail(a.reason),d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"database_setup_failed"),i!=null&&(i(),i=null))}b=function(b,c){h=b;i=c;a.addEventListener("unhandledrejection",j);return function(){return a.removeEventListener("unhandledrejection",j)}};g.trackDbSetupFailure=b}),98);
__d("MAWIndexedDBDeletion",["CurrentMessengerUser","FBLogger","MAWIndexedDbMetadata","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,d){return indexedDB==null||a==null?(h||(h=b("Promise"))).resolve():new(h||(h=b("Promise")))(function(b,e){var f=indexedDB.deleteDatabase(a);f.onsuccess=function(){c("FBLogger")("maw_db").warn("%s db was deleted",d),b()};f.onblocked=function(){c("FBLogger")("maw_db").mustfix("Cannot delete %s db: blocked. Make sure DB is closed.",d)};f.onerror=function(){c("FBLogger")("maw_db").mustfix("Cannot delete %s db",d),e(f.error)}})}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("CurrentMessengerUser").getID();yield (h||(h=b("Promise"))).all([i(d("MAWIndexedDbMetadata").dbName(a),"maw_v1"),i(d("MAWIndexedDbMetadata").restoreDbName2(a),"maw_v3"),i(d("MAWIndexedDbMetadata").jobsDbName(a),"signal"),i(d("MAWIndexedDbMetadata").logDbName(a),"logDb")])});return j.apply(this,arguments)}g.deleteDB=i;g.deleteMAWPersistence=a}),98);
__d("MAWLowLevelApiTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"};c={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"};d=b("$InternalEnum")({Initializing:"initializing",Open:"open",Closed:"closed",Error:"error",Upgrading:"upgrading"});f.WRITE_GROUP_INVITE_ERROR=a;f.GET_GROUP_INVITE_ERROR=c;f.DatabaseState=d}),66);
__d("MAWDbFactory",["ClientConsistencyEventEmitter","Deferred","MAWCurrentUser","MAWDbVersion","MAWDexieTable","MAWGetDbVersion","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWReliabilityMonitor","MWFBLogger","Promise","asyncToGeneratorRuntime","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q=["backendInitPromise","middleware","onDbPopulate"],r;function a(a,e){var f=null,g=d("MWFBLogger").MWLogger.tags(["db",a,e]),s=new(c("Deferred"))(),t=!1,u=!1,v,w=!1,x=null,y=e!=="worker"?null:d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("DB_"+a+"_"+e,function(){return{extra:{isMakingDB:String(t),willBeSetup:String(u)},reason:String(x),state:function(){if(x==null)return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN;switch(x){case d("MAWLowLevelApiTypes").DatabaseState.Initializing:case d("MAWLowLevelApiTypes").DatabaseState.Upgrading:return d("MAWReliabilityMonitor").HealthReportState.PENDING;case d("MAWLowLevelApiTypes").DatabaseState.Open:return d("MAWReliabilityMonitor").HealthReportState.OK;case d("MAWLowLevelApiTypes").DatabaseState.Closed:case d("MAWLowLevelApiTypes").DatabaseState.Error:return d("MAWReliabilityMonitor").HealthReportState.ERROR}}()}});function z(){s=new(c("Deferred"))(),v==null||v(),t=!1,u=!1}function A(){return u}function B(){return s.getPromise().then(function(){return w})}function C(a,b,c){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,r,A){var B=r.backendInitPromise,C=r.middleware,D=r.onDbPopulate;r=babelHelpers.objectWithoutPropertiesLoose(r,q);var E=d("MAWCurrentUser").getID();E=d("MAWIndexedDbMetadata").dbName(E);var F=c("qpl")._(25310776,"6155");function G(a){x=a,y==null||y.updateState()}if(f!=null){g.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["DB exists"])));d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_exsists");return}var H=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056836116,"905"),{string:{db:a,name:E}});u=!0;if(t){d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_in_progress");return s.getPromise()}g.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"])));t=!0;d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_started");v=d("MAWIDbSetupQplEventListener").trackDbSetupFailure(H,function(){G(d("MAWLowLevelApiTypes").DatabaseState.Error),s.reject("DB setup failed"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_setup_failed"),z()});G(d("MAWLowLevelApiTypes").DatabaseState.Initializing);var I=(yield d("MAWDbVersion").getDexieDbVersion(E));I==null&&(w=!0);H.addAnnotations({"int":{currentVersion:I}});var J=A!=null?A:d("MAWGetDbVersion").getArmadilloDbVersion();H.addAnnotations({"int":{targetVersion:J}});if(B&&(I||0)<J){H.addPoint("separate_read_waiting_on_worker_upgrade");g.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Waiting for worker to upgrade schema..."])));try{yield B}catch(a){throw g.catching(a).mustfixThrow("Worker startup promise rejected, schema upgrade failed.")}var K=(yield d("MAWDbVersion").getDexieDbVersion(E));if(K!==J)throw g.mustfixThrow("Main thread waiting on worker schema upgrade from %s to %s, upgrade failed with version %s",I,J,K);I=K}else e==="worker"&&(d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbVersion",I!=null?I:0),d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"useSentBytesCache",c("gkx")("33008")?1:0));var L=function(b){b=d("MAWDbVersion").updateDB(b,H,I,A);!B&&e==="worker"&&d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbUpgradeNeeded",I!==b);g.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["latest pushed version: ",", current: ",", requested: ",""])),b,I,A!=null?A:"<latest>");e==="worker"&&(I!==b?d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_version_upgraded"):d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_version_upgrade_not_required"));return b};f=new(d("MAWDexieTable").DexieTable)(E,function(f){C.forEach(function(a){f.use(a(b))});var h=L(f);f.on("populate",function(b){if(!b){G(d("MAWLowLevelApiTypes").DatabaseState.Error);s.reject("Missing DB for populate event");H.endFail("on_populata-missing_txn");d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_on_populate_missing_txn");return}g.info("MAWDB populated. HasPopulateEvent: %s",Boolean(D));D==null||D(b)});f.on("blocked",function(){g.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]))),G(d("MAWLowLevelApiTypes").DatabaseState.Error),s.reject("DB Open blocked"),H.endFail("db_blocked"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_blocked"),z()});f.on("ready",function(b){g.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAW DB setup complete"])));t=!1;if(b==null){G(d("MAWLowLevelApiTypes").DatabaseState.Error);g.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["DB is null"])));s.reject("DB is null");H.endFail("db_null");d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_null");z();return}G(d("MAWLowLevelApiTypes").DatabaseState.Open);v==null||v();s.resolve();H.endSuccess({"int":{dbVersion:h}});d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_ready")});f.on("close",function(){G(d("MAWLowLevelApiTypes").DatabaseState.Closed),g.WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["DB forcibly closed"]))),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_forcibly_closed")});f.on("versionchange",function(b){g.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Versionchange detected: ("," -> "," (event version: ",", highestUsed: (","), name: ",""])),b==null?void 0:b.oldVersion,b==null?void 0:b.newVersion,String(b==null?void 0:b.version),h,b==null?void 0:b.name),G(d("MAWLowLevelApiTypes").DatabaseState.Upgrading),e!=="worker"&&c("ClientConsistencyEventEmitter").emit("softRefresh","mawdb_versionchange"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_versionchange")})},void 0,r);d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_requested");return s.getPromise()});return D.apply(this,arguments)}function E(a){if(f==null)throw g.mustfixThrow('IndexDB has not been initialized before executing "'+(a!=null?a:"unnamed")+'"');return f}function F(a){if(f!=null&&!t)return(r||(r=b("Promise"))).resolve(f);s=s||new(c("Deferred"))();return s.getPromise().then(function(){return E(a)})}function G(){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield F());a!=null&&(a.close(),f=null);z()});return H.apply(this,arguments)}function I(){f=null,z()}function J(a){c("promiseDone")(G());a=d("MAWIndexedDbMetadata").dbName(a!=null?a:d("MAWCurrentUser").getID());c("promiseDone")(d("MAWIndexedDBDeletion").deleteDB(a,"maw"));y==null||y.stopMonitoring()}return{closeDB:G,deleteDb:J,getDB:F,getDBExn:E,isNewDb:B,makeDB:C,reset_singleton_INTERNAL_ONLY:I,setupPromise:function(){return s.getPromise()},willSetupDB:A}}g.makeIDBFactory=a}),98);
__d("MAWIndexedDbUI",["ExecutionEnvironment","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDexieTable","MAWIndexedDb","MAWTransactor","Promise","cr:3527","gkx","performance"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){var a=d("MAWDbFactory").makeIDBFactory("ui_idb","main");return{closeDB:a.closeDB,deleteDb:a.deleteDb,getDB:a.getDB,makeDB:function(e,f,g){var h=[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];c("gkx")("1760")&&h.push(d("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware);b("cr:3527")!=null&&h.push(b("cr:3527"));e=a.makeDB(e,{autoOpen:c("gkx")("6817"),backendInitPromise:f.backendInitPromise,cache:"disabled",middleware:h,onDbPopulate:f.onDbPopulate},g);return e},reset_singleton_INTERNAL_ONLY:a.reset_singleton_INTERNAL_ONLY}}e=a();f=e.makeDB;var k=e.closeDB,l=e.getDB,m=e.deleteDb;e=e.reset_singleton_INTERNAL_ONLY;var n=(i||(i=c("ExecutionEnvironment"))).isInBrowser?l("MawDbInUISingleton_INTERNAL_ONLY").then(function(a){return{openReadonlyTransaction:function(b,e,f){return a.stores.transaction("r",e,function(){d("MAWDexieTable").setDexiePSDItem("transactorName",b);d("MAWDexieTable").setDexiePSDItem("transactionRequested",(j||(j=c("performance"))).now()+j.timeOrigin);return f(a.stores)})},openReadWriteTransaction:function(b,e,f){return a.stores.transaction("rw",e,function(){d("MAWDexieTable").setDexiePSDItem("transactorName",b);d("MAWDexieTable").setDexiePSDItem("transactionRequested",(j||(j=c("performance"))).now()+j.timeOrigin);return f(a.stores)})}}}):new(h||(h=b("Promise")))(function(){});g.makeMsgrTransactor=d("MAWTransactor").makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD;g.afterTransaction=d("MAWIndexedDb").afterTransaction;g.makeMAWIndexedDBFactory=a;g.makeDB=f;g.closeDB=k;g.getDB=l;g.deleteDb=m;g.reset_singleton_INTERNAL_ONLY=e;g.MawDbInUISingleton=n}),98);
__d("MAWWorkerCacheServiceRegistry",["MAWSnippetsCacheService"],(function(a,b,c,d,e,f,g){"use strict";var h={snippets:d("MAWSnippetsCacheService").getMAWSnippetsCacheService()};function a(){return h}g.getWorkerRegistry=a}),98);
__d("MAWCacheServiceQPL",["ExecutionEnvironment","MAWCurrentUser","MAWQplProxy","QPLUserFlow","performanceAbsoluteNow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Set(),k=new Set(),l=3e3,m=c("qpl")._(1056836703,"2955");function a(a,b){var e=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(e){if(k.has(a))return;o(a);d("MAWQplProxy").startQplUserFlow(m,{},{callBridgeWithTimestamp:!0,providedInstanceKey:a})}else{if(j.has(a))return;n(a);c("QPLUserFlow").start(m,{annotations:{string:{service:b}},instanceKey:a})}}function n(a){j.add(a)}function o(a){k.add(a)}function b(a,b,e){var f=q(e),g=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(g){if(!k.has(a))return;d("MAWQplProxy").sendQplPointThroughBridge(m,"worker@"+f+b,{instanceKey:a},!0)}else{if(!j.has(a))return;var n=(i||(i=c("performanceAbsoluteNow")))();e==="realtime-update"?window.setTimeout(function(){c("QPLUserFlow").addPoint(m,"ui@"+b,{instanceKey:a,timestamp:n})},l):c("QPLUserFlow").addPoint(m,"ui@"+b,{instanceKey:a})}}function e(a,b){var e=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(e){if(!k.has(a))return;d("MAWQplProxy").sendQPLAnnotationsThroughBridge(m,b,a)}else{if(!j.has(a))return;c("QPLUserFlow").addAnnotations(m,b,{instanceKey:a})}}function f(a){var b=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(b){if(!k.has(a))return;k["delete"](a);d("MAWQplProxy").sendQPLSuccessThroughBridge(m,{},a,!0)}else{if(!j.has(a))return;var e=(i||(i=c("performanceAbsoluteNow")))();window.setTimeout(function(){j["delete"](a),c("QPLUserFlow").endSuccess(m,{instanceKey:a,timestamp:e})},l)}}function p(a,b,e){e=q(e);var f=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(f){if(!k.has(a))return;d("MAWQplProxy").sendQPLFailThroughBridge(m,"worker@"+e+b,{},a,!0)}else{if(!j.has(a))return;var g=(i||(i=c("performanceAbsoluteNow")))();window.setTimeout(function(){j["delete"](a),c("QPLUserFlow").endFailure(m,"ui@"+b,{instanceKey:a,timestamp:g})},l);j["delete"](a)}}function q(a){return a?a.replace(/-/g,"_")+"_":""}function r(a){return d("MAWCurrentUser").isEmployee()||d("MAWCurrentUser").isTestUser()?a:void 0}e={addAnnotationsQPL:e,addPointQPL:b,endFailureQPL:p,endSuccessQPL:f,redactKeysForNonEmployee:r,registerInstanceKeyInUI:n,registerInstanceKeyInWorker:o,startQPL:a};g["default"]=e}),98);
__d("MAWCacheServiceUtils",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h="maw_cache_service_broadcast",i=typeof window!=="undefined"?window:self;d=function(){if(!i.BroadcastChannel){c("FBLogger")("messenger_e2ee_web").warn("BroadcastChannel is not supported in this browser");return null}return new i.BroadcastChannel(h)};e={concurrency:1,maxConcurrency:1,maxThrottleMs:500};function a(a){return"maw-cache-service-"+a}function b(a,b){var c=new Set(),d=[];a.forEach(function(a){var e=b(a);if(c.has(e)){d.push(a);return}c.add(e)});return d}g.MAW_CACHE_SERVICE_BROADCAST_CHANNEL=h;g.getMAWCacheServiceBroadcastChannel=d;g.SCHEDULER_CONFIG=e;g.getSchedulerName=a;g.findDuplicates=b}),98);
__d("MAWWorkerCacheServices",["FBLogger","MAWBridge","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWLoggerUtils","MAWWorkerCacheServiceRegistry","Promise","WorkerScheduler","asyncToGeneratorRuntime","cr:2354"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(){this.$1=d("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel();var a=d("MAWWorkerCacheServiceRegistry").getWorkerRegistry();this.registry=a;this.schedulerRegistry=Object.keys(a).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b]=d("WorkerScheduler").makeScheduler(d("MAWCacheServiceUtils").getSchedulerName(b),d("MAWCacheServiceUtils").SCHEDULER_CONFIG),a))},{})}var e=a.prototype;e.$2=function(a,b,c,e){b={cache:b,instanceKey:e,namespace:a,source:c};this.$1==null?d("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:b},namespace:d("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL}):this.$1.postMessage(b)};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){var h=d("MAWCacheServiceUtils").findDuplicates(e,function(a){var b=a[0];a[1];return b});h.length>0&&(c("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",h.map(function(a){var b=a[0];a[1];return b}).join(", "),e.map(function(a){var b=a[0];a[1];return b}).join(", "),a,f),g!=null&&c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:c("MAWCacheServiceQPL").redactKeysForNonEmployee(h.map(function(a){var b=a[0];a[1];return b}))}}));if(e.length===0){g!=null&&(c("MAWCacheServiceQPL").addPointQPL(g,"nothing_to_update_in_cache",f),c("MAWCacheServiceQPL").endSuccessQPL(g));return}g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_start",f);h=this.registry[a];h.updateInMemoryCacheBulk(e);try{var i=d("MAWCacheServiceDB").convertCacheValueToDBRawValue(e);h=(yield d("MAWCacheServiceDB").getOrSetupMAWCacheDB());yield h.runInTransaction([a],"readwrite",function(b){var c=i.map(function(a){return{item:a,selector:[a.key]}});return b.stores[a].bulkUpsert("key",c)},"update_cache_"+a);f==="realtime-update"&&(b("cr:2354")==null||b("cr:2354").notifyCacheWrite(i.map(function(a){a=a.key;return a})));g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_end",f)}catch(a){g!=null&&(c("MAWCacheServiceQPL").addAnnotationsQPL(g,{string:{error:a.message}}),c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_failed",f)),c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to update persisted cache")}g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"broadcasting_to_ui_start",f);this.$2(a,e,f,g)});function e(b,c,d,e){return a.apply(this,arguments)}return e}();e.calculateDelta=function(a){var e=this,f=Object.values(this.registry).map(function(b){var f=b.shouldDropDelta(a);return f.then(function(f){if(f)return;f=e.schedulerRegistry[b.namespace];return f.runTask({fn:function(){return b.calculateDelta(a).then(function(a){var f=a.map(function(a){var b=a[0];a[1];return b}),g=d("MAWLoggerUtils").getInstanceKey();a.length!==0&&(c("MAWCacheServiceQPL").startQPL(g,b.namespace),c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{isRealtimeUpdate:!0},"int":{instanceKey:g},string_array:{realtimeUpdatedKeys:f}}));return e.$3(b.namespace,a,"realtime-update",g)})["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).warn("Failed to calculate delta for: %s",b.namespace)})},name:"maw_calculate_delta",priority:d("WorkerScheduler").REGULAR_PRIORITY})})});(h||(h=b("Promise"))).all([].concat(f))["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to calculate delta for all services")})};e.computeCachePayloadFromScratch=function(a,b,e,f){var g=this;f!=null&&c("MAWCacheServiceQPL").registerInstanceKeyInWorker(f);c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_start",e);c("MAWCacheServiceQPL").addAnnotationsQPL(f,{string_array:{keysReceivedInWorker:c("MAWCacheServiceQPL").redactKeysForNonEmployee(b)}});var h=this.registry[a],i=this.schedulerRegistry[h.namespace];if(h==null)throw c("FBLogger")("messenger_web").mustfixThrow("No service found for namespace: "+a);return i.runTask({fn:function(){return h.computeCachePayloadFromScratch(b).then(function(b){c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_end",e);return g.$3(a,b,e,f)})["catch"](function(a){c("MAWCacheServiceQPL").endFailureQPL(f,"compute_from_scratch_failed",e),c("FBLogger")("MAWCacheService").catching(a).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_from_scratch",priority:d("WorkerScheduler").REGULAR_PRIORITY})};return a}(),j=null;a=function(){j==null&&(j=new i());return j};g.getMAWWorkerCacheServices=a}),98);
__d("MAWDbMsgOrReaction",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function b(a,b){return a==null?b.forNull():a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function c(a,b){return a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function d(a,b){return a==null?b.forNull():a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}f.switchOnMsgOrReaction=a;f.switchOnMsgOrReactionNullish=b;f.switchOnMsgOrReactionMaybeUnstored=c;f.switchOnMsgOrReactionMaybeUnstoredNullish=d}),66);
__d("MAWGetBumpTimestampMs",["I64","MAWAckLevel","MAWDbMsgOrReaction","MAWExtractMsFromExternalId","MAWTimeUtils","WALongInt","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){b=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return(h||(h=d("I64"))).add(d("MAWTimeUtils").millisTimeToTimestamp(a),h.of_int32(b!=null?b:0))}function j(a){var b=a.msg;a=a.throwIfNoServerTs;a=a?c("nullthrows")(b.serverTs):b.serverTs;return i(d("WATimeUtils").castUnixTimeToMillisTime(a!=null?a:b.ts),(h||(h=d("I64"))).of_string(b.externalId))}function k(a){return a.senderTimestampMs!=null?(h||(h=d("I64"))).of_string(d("WALongInt").longIntToDecimalString(a.senderTimestampMs)):i(d("WATimeUtils").castUnixTimeToMillisTime(a.ts),(h||(h=d("I64"))).of_string(a.externalId))}function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(a,{forMessage:function(a){return d("MAWAckLevel").isMsgAuthoritative(a.ack)&&a.sortOrderMs!=null?(h||(h=d("I64"))).of_float(a.sortOrderMs):j({msg:a,throwIfNoServerTs:!1})},forNull:function(){return(h||(h=d("I64"))).zero},forReaction:k})}g.calculateBumpTimestampMs=i;g.getBumpTimestampMs=a}),98);
__d("MAWSnippetsCacheServiceUtils",["I64","MAWDbMsgOrReaction","MAWGetBumpTimestampMs"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(a,{forMessage:function(a){return{msgAckLevel:a.ack,msgId:a.msgId,reactionId:void 0,timestamp:a.sortOrderMs!=null?a.sortOrderMs:(h||(h=d("I64"))).to_float(d("MAWGetBumpTimestampMs").getBumpTimestampMs(a))}},forNull:function(){return{msgAckLevel:void 0,msgId:void 0,reactionId:void 0,timestamp:Number.MIN_SAFE_INTEGER}},forReaction:function(a){return{msgAckLevel:void 0,msgId:void 0,reactionId:a.reactionId,timestamp:(h||(h=d("I64"))).to_float(d("MAWGetBumpTimestampMs").getBumpTimestampMs(a))}}})}g.getMsgOrReactionIdAndTimestamp=a}),98);
__d("MAWUpdateThreadListItemUtils",["MAWAckLevel","MAWDbMsg","MAWDbMsgOrReaction","MAWMsgType","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||a.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX},forReaction:function(){return!1}})}function b(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.ack===d("MAWAckLevel").ACK.clock},forReaction:function(){return!1}})}function c(a){return a.msgId!=null&&a.type===d("MAWMsgType").MSG_TYPE.XMA&&((a=a.msgContent)==null?void 0:a.content)===""}function e(a){return a.type===d("MAWMsgType").MSG_TYPE.XMA&&d("MAWXMAUtils").isRtcXMA(a==null?void 0:a.xmaMessageType)}g.isSpamMessage=a;g.isOptimisticMessage=b;g.isXMAThreadSnippet=c;g.isRTCXMAMessage=e}),98);
__d("MAWSnippetsCacheCalculateDelta",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateType","MAWSnippetsCacheServiceUtils","MAWUpdateThreadListItemUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="[SnippetsCacheService][Worker]";function a(a){var b=new Set(a.map(function(a){var b;b=(b=a.decryptedValues)!=null?b:[];a=(a=a.deletedValues)!=null?a:[];return[].concat(b,a)}).flat().map(function(a){return d("MAWUpdateThreadListItemUtils").isOptimisticMessage(a)?null:a.msgId}).filter(Boolean));return a.reduce(function(a,c){var d=c.type==="delete"?c.deletedValues:c.decryptedValues;d=l(d);d=m(b,d);if(d.length===0)return a;d.forEach(function(b){var d=b.threadJid,e=a.get(d);b=k({type:c.type,value:b},e);a.set(d,b)});return a},new Map())}function b(a){return a.some(function(a){a.chatJid;a.lastComputedCacheValue;a=a.mutateReq;return!i(a)||j(a.value)})}function i(a){return a.type==="delete"||a.type==="deleteRange"||d("MAWUpdateThreadListItemUtils").isXMAThreadSnippet(a.value)||p(a.value)||q(a.value)?!1:!0}function j(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction!=null&&d("MAWGetThreadUpdateType").canReactionAffectBump(a)}})}function k(a,b){if(b==null)return a;var c=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a.value);c=c.timestamp;var e=a.value.externalId,f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.value);f=f.timestamp;var g=b.value.externalId;if(c===f){if(a.type==="delete"||a.type==="deleteRange")return a;else if(b.type==="delete"||b.type==="deleteRange")return b;return e.localeCompare(g)>0?a:b}if(c==null)return b;return f==null?a:c>f?a:b}function l(a){return a==null||a.length===0?[]:a.filter(function(a){return n(a)})}function m(a,b){return b.reduce(function(b,c){var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(c);e=e.msgId;return e!=null&&d("MAWUpdateThreadListItemUtils").isOptimisticMessage(c)&&a.has(e)?b:[].concat(b,[c])},[])}function n(a){var b=o(a)&&!d("MAWUpdateThreadListItemUtils").isSpamMessage(a);b||r(a);return b}function o(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(b){return d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)},forReaction:function(b){return d("MAWGetThreadUpdateType").canReactionAffectBump(b)&&p(b)||d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)}})}function p(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction==null}})}function q(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return a.ephemeralMsgDisappeared===!0},forReaction:function(a){return!1}})}function r(a){a=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a);var b=a.msgId;a=a.reactionId;c("FBLogger")("MAWCacheService").info(h+" msg or reaction is not eligible for snippet update, msgId: %s, reactionId: %s",b,a)}g.parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids=a;g.isDbTransactionRequiredForSnippetUpdate=b;g.canCalculateSnippetUpdateFromDelta=i;g.isNeededToCheckMessageExistence=j}),98);
__d("MWThreadListConsts",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=56;b=900;c=10;g.threadlistItemHeight=a;g.minimumPixelsNeededForMaxDisplay=b;g.DEFAULT_MIN_LAST_ACTIVITY_TIMESTAMP=(h||d("I64")).one;g.SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT=c}),98);
__d("MAWSnippetsCacheService",["FBLogger","MAWAckLevel","MAWCacheServiceBase","MAWDbMsgOrReaction","MAWDbMsgTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWIndexedDb","MAWMessagesCompare","MAWSnippetsCacheCalculateDelta","MAWSnippetsCacheServiceUtils","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTransactionMode","MAWUpdateThreadListItemUtils","MAWVault","MWThreadListConsts","Promise","WAJids","asyncToGeneratorRuntime","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=["messages","reactions"],j="[SnippetsCacheService][Worker]";a=function(a){function e(){return a.call(this,"snippets")||this}babelHelpers.inheritsLoose(e,a);var f=e.prototype;f.$MAWSnippetsCacheService$p_1=function(a){var c=this;a=a.filter(function(a){a=a[0];return i.includes(a)});a=d("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(a.map(function(a){a[0];a=a[1];return a}));return(h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a=a[1];var d=(yield c.getValueFromCache(b));return{chatJid:b,lastComputedCacheValue:d,mutateReq:a}});return function(b){return a.apply(this,arguments)}}()))};f.calculateDelta=function(a){var c=this;return this.$MAWSnippetsCacheService$p_1(a).then(function(a){if(a.length===0)return(h||(h=b("Promise"))).resolve([]);if(d("MAWSnippetsCacheCalculateDelta").isDbTransactionRequiredForSnippetUpdate(a))return d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:calculateDelta",function(a){return function(b){return c.$MAWSnippetsCacheService$p_2(a,b)}})(a);else return c.$MAWSnippetsCacheService$p_3(a)})};f.computeCachePayloadFromScratch=function(a){var b=this;return d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:computeCachePayloadFromScratch",function(a){return function(c){return d("MAWDexieTable").dexieAll(c.map(function(c){c=d("WAJids").unsafeCoerceToChatJid(c);return b.$MAWSnippetsCacheService$p_4(a,c,"from-scratch")})).then(function(a){return a.filter(Boolean)})}})(a)};f.$MAWSnippetsCacheService$p_5=function(a,b){if(b==null)return"no-value-calculated-from-scratch";if(d("MAWUpdateThreadListItemUtils").isOptimisticMessage(a.value))return null;a=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a.value);var c=a.msgAckLevel,e=a.msgId,f=a.reactionId;a=a.timestamp;if(a==null)return"missing-timestamp";if(e!=null&&e===b.value.snippetMsgId)return null;if(f!=null&&f===b.value.snippetReactionId)return null;return e!=null&&c!==d("MAWAckLevel").ACK.received&&b.value.snippetMsgAckLevel===d("MAWAckLevel").ACK.clock?"optimistic-snippet-in-cache":a<b.timestamp?"older-than-last-snippet-value":null};f.$MAWSnippetsCacheService$p_6=function(a,b){var e;if(a.type!=="add")return!1;e=(e=c("qex")._("1213"))!=null?e:!1;return!e?!1:d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a.value,{forMessage:function(a){var c;if(a.sortOrderMs==null||!d("MAWThreadNewestMsgOrReactionUtils").filterForSnippetNewestIncomingMessages(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0))return!1;var e=b==null||(c=b.value)==null?void 0:c.snippetNewestIncomingMsgs;if(e==null||e.length<d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT)return!0;e=e[e.length-1];if(e==null||e.sortOrderMs==null)return!0;var f=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");return f({externalId:e.externalId,sortOrderMs:e.sortOrderMs},{externalId:a.externalId,sortOrderMs:a.sortOrderMs})>0},forReaction:function(a){return!1}})};f.$MAWSnippetsCacheService$p_7=function(a,b){var c={externalId:b.value.externalId,sortOrderMs:b.value.sortOrderMs};if(a==null||a.some(function(a){return a.externalId===c.externalId}))return[c];b=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");a=[].concat(a,[c]).sort(b).slice(0,d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT);return a};f.shouldDropDelta=function(a){var c=this;return this.$MAWSnippetsCacheService$p_1(a).then(function(a){return a.length===0?(h||(h=b("Promise"))).resolve(!0):(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatJid,d=a.lastComputedCacheValue;a=a.mutateReq;if(c.$MAWSnippetsCacheService$p_6(a,d))return!1;d=(yield c.$MAWSnippetsCacheService$p_5(a,d));if(d!=null){l({dropReason:d,key:b,msgOrReaction:a.value,operation:a.type});return!0}return!1});return function(b){return a.apply(this,arguments)}}())).then(function(a){if(a.every(function(a){return a===!0}))return!0;else return!1})})};f.$MAWSnippetsCacheService$p_4=function(a,b,c){var e=this;return d("MAWThreadSnippetUtils").getThreadSnippetFromScratch(a,b).then(function(a){a=e.$MAWSnippetsCacheService$p_8(b,a,c);return a==null?void 0:d("MAWDexieTable").dexieResolve([b,a])})};f.$MAWSnippetsCacheService$p_3=function(a){var b=this;return a.map(function(a){var c=b.$MAWSnippetsCacheService$p_9(a);return c==null?void 0:[a.chatJid,c]}).filter(Boolean)};f.$MAWSnippetsCacheService$p_2=function(a,b){var c=this;return d("MAWDexieTable").dexieAll(b.map(function(b){return!d("MAWSnippetsCacheCalculateDelta").canCalculateSnippetUpdateFromDelta(b.mutateReq)?c.$MAWSnippetsCacheService$p_4(a,b.chatJid,"realtime-from-scratch"):c.$MAWSnippetsCacheService$p_10(a,b.mutateReq.value).then(function(a){if(a)return void 0;a=c.$MAWSnippetsCacheService$p_9(b);return a==null?void 0:d("MAWDexieTable").dexieResolve([b.chatJid,a])})})).then(function(a){return a.filter(Boolean)})};f.$MAWSnippetsCacheService$p_9=function(a){var b;b=(b=c("qex")._("1213"))!=null?b:!1;if(b)return this.$MAWSnippetsCacheService$p_11(a);b=d("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(a.chatJid,a.mutateReq.value);b=this.$MAWSnippetsCacheService$p_8(a.chatJid,{snippet:b,snippetMsgOrReaction:a.mutateReq.value},"realtime-calculate-delta");return b};f.$MAWSnippetsCacheService$p_11=function(a){var b,c=a.chatJid,e=a.lastComputedCacheValue;a=a.mutateReq;var f=this.$MAWSnippetsCacheService$p_6(a,e),g=this.$MAWSnippetsCacheService$p_5(a,e)==null;f=f?this.$MAWSnippetsCacheService$p_7(e==null||(b=e.value)==null?void 0:b.snippetNewestIncomingMsgs,a):e==null?void 0:e.value.snippetNewestIncomingMsgs;if(!g&&e!=null)return babelHelpers["extends"]({},e,{value:babelHelpers["extends"]({},e.value,{snippetNewestIncomingMsgs:f})});g=d("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(c,a.value);e=this.$MAWSnippetsCacheService$p_8(c,{snippet:g,snippetMsgOrReaction:a.value,snippetNewestIncomingMsgsMetadata:f},"realtime-calculate-delta");return e};f.$MAWSnippetsCacheService$p_8=function(a,b,c){if(b==null){k({flow:c,key:a,threadSnippetResult:b});return void 0}var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.snippetMsgOrReaction),f=e.msgAckLevel,g=e.msgId,h=e.reactionId;e=e.timestamp;k({flow:c,key:a,msgAckLevel:f,msgId:g,reactionId:h,threadSnippetResult:b,timestamp:e});if(e==null)return void 0;c=babelHelpers["extends"]({},b.snippet.snippetParams,{strings:b.snippet.snippetParams.strings.map(function(a){return d("MAWVault").unvault(a)})});return{key:a,timestamp:e,value:{snippet:babelHelpers["extends"]({},b.snippet,{snippetParams:c}),snippetMsgAckLevel:f,snippetMsgId:g,snippetNewestIncomingMsgs:b.snippetNewestIncomingMsgsMetadata,snippetReactionId:h}}};f.$MAWSnippetsCacheService$p_10=function(a,b){if(!d("MAWSnippetsCacheCalculateDelta").isNeededToCheckMessageExistence(b))return d("MAWDexieTable").dexieResolve(!1);b=d("MAWDbMsgOrReaction").switchOnMsgOrReaction(b,{forMessage:function(a){return null},forReaction:function(a){return a.reactToMsgId}});return b==null?d("MAWDexieTable").dexieResolve(!0):d("MAWDbMsgTxns").getMsgsByMsgIds(a,[b]).then(function(a){return a.length===0})};return e}(c("MAWCacheServiceBase"));function k(a){var b=a.flow,d=a.key,e=a.msgAckLevel,f=a.msgId,g=a.reactionId,h=a.threadSnippetResult;a=a.timestamp;if(h==null){c("FBLogger")("MAWCacheService").warn(j+"["+b+"] Failed to calculate thread snippet, key: %s",d);return}if(a==null){c("FBLogger")("MAWCacheService").warn(j+"["+b+"] No timestamp found for the thread snippet, key: %s,\n      msgId: %s, reactionId: %s",d,f,g);return}c("FBLogger")("MAWCacheService").info(j+"["+b+"] Snippet successfully calculated, key: %s,\n    timestamp: %s, msgId: %s, reactionId: %s, ack level %s",d,a,f,g,e)}function l(a){var b=a.dropReason,e=a.key,f=a.msgOrReaction;a=a.operation;f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(f);var g=f.msgAckLevel,h=f.msgId,i=f.reactionId;f=f.timestamp;c("FBLogger")("MAWCacheService").info(j+" Drop update for msg or reaction, reason: %s, key: %s, msgId: %s, reactionId: %s, timestamp: %s, ackLevel: %s, operation: %s",b,e,h,i,f,g,a)}var m=new a();e=function(){return m};g.getMAWSnippetsCacheService=e}),98);
__d("MAWDataSyncQueue",["Promise","WALogger","asyncToGeneratorRuntime","getErrorSafe","qex","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("qex")._("853")||1e3;a=c("qex")._("855")||1e3;e=function(){n=!1;return s({isUnloading:!0})};var l=[],m=[],n=!1,o=[],p=function(){var a,b=l.splice(0,l.length);(a=m).push.apply(a,b)},q=function(){return m.splice(0,k)},r=function(a){var c=q();if(c.length===0)return;return(j||(j=b("Promise"))).all(o.map(function(b,e){return b(c,a)["catch"](function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""])),e,a)})})).then(function(){return r(a)})},s=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(n)return;n=!0;p();try{yield r(a)}catch(e){var b;a=c("getErrorSafe")(e);d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[MAWIndexedDbMiddleware] error handling queue batch: ",""])),(b=a==null?void 0:a.message)!=null?b:a.toString());throw e}finally{n=!1,l.length>0&&t()}});return function(b){return a.apply(this,arguments)}}(),t=c("throttle")(s,a);f=function(a,b){l.push({type:a,value:b}),t()};a=function(a){o.some(function(b){return b===a})||o.push(a)};var u=function(){o=[]},v=function(){l=[],m=[]},w=function(){return l};g.forceFlushDataSyncQueue=e;g.addSyncItem=f;g.registerDataSyncCallback=a;g.clearDataSyncCallbacks=u;g.clearDataSyncQueue_FOR_TESTING_ONLY=v;g.getDataSyncQueue_FOR_TESTING_ONLY=w}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(["contacts","groupInfo","messages","participants","threads","reactions","xma","pendingStanzas"]);function i(a,b){var c=a.table(b);return!h.has(b)?c:babelHelpers["extends"]({},c,{mutate:function(a){return c.mutate(a).then(function(c){if(a.type==="delete"){a.keys.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b})});return c}else c.results!=null?c.results.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b,values:a.values})}):c.lastResult!=null&&d("MAWDataSyncQueue").addSyncItem(a.type,{key:c.lastResult,tableName:b,values:a.values});return c})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return i(a,b)}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers");return a}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}g.getDataSyncMiddleware=a}),98);
__d("MAWIndexedDb",["EBGating","ExecutionEnvironment","I64","MAWBridge","MAWCacheServiceMiddleware","MAWDataSyncMiddleware","MAWDbFactory","MAWDbMutationMiddleware","MAWDbMutationValidator","MAWDbProtocolMsgIdMiddleware","MAWDbSchema","MAWDexie","MAWLSDataSyncMiddleware","MAWMiActOnActThreadReadyQueue","MAWTransactor","MWFBLogger","asyncToGeneratorRuntime","cr:10181","cr:10182","cr:17239","cr:3527","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(e){e===void 0&&(e="idb");var f=d("MAWDbFactory").makeIDBFactory(e,"worker");function a(a){return f.setupPromise().then(function(){return f.getDBExn(a)})}return babelHelpers["extends"]({},f,{getSignalDB:a,makeDB:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g){var h=[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];h.push(d("MAWLSDataSyncMiddleware").getMAWLSDataSyncMiddleware);c("gkx")("1760")&&h.push(d("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware);h.push(c("MAWCacheServiceMiddleware"));e.enableDataSyncMiddleware&&h.push(d("MAWDataSyncMiddleware").getDataSyncMiddleware);e.enableMutationValidator===!0&&h.push(d("MAWDbMutationValidator").getMutationValidatorMiddleware);b("cr:3527")!=null&&h.push(b("cr:3527"));c("justknobx")._("4087")&&b("cr:17239")!=null&&(yield b("cr:17239")(a));return f.makeDB(a,{autoOpen:!0,middleware:h,onDbPopulate:e.onDbPopulate},g)});function a(a,b,c){return e.apply(this,arguments)}return a}()})}var j=a(),k="idle",l=j.isNewDb,m=j.willSetupDB,n=function(a,b,c){return j.makeDB(a,b,c).then(function(){k="ready"})},o=j.closeDB,p=j.getDBExn,q=j.getSignalDB,r=j.getDB,s=function(a){return j.reset_singleton_INTERNAL_ONLY()},t=j.deleteDb;function e(){return k}function f(a){var b=k;k="migrating";return a["finally"](function(){k=b})}var u=new WeakMap(),v=new WeakMap(),w=d("MWFBLogger").MWLogger.tags(["db","afterTransaction"]);function x(a){var b=c("MAWDexie").currentTransaction;if(b==null)throw w.mustfixThrow("afterTransactionEffect called outside of dexie transaction");if(typeof a!=="function")return;var d=u.get(b)||[];d.push(a);u.set(b,d);d.length===1&&b.on("complete",function(){var a=u.get(b)||[];a.forEach(function(a){a()});u["delete"](b)})}function y(a){var e=c("MAWDexie").currentTransaction;if(e==null)throw w.mustfixThrow("afterTransaction called outside of dexie transaction","maw_db");var f=v.get(e);if(f!=null)f.push(a);else{var g=[a];v.set(e,g);e.on("complete",function(){v["delete"](e),c("gkx")("5675")&&(i||(i=c("ExecutionEnvironment"))).isInMainThread&&b("cr:10182")!==null&&b("cr:10181")!==null?b("cr:10182").handleEvents(b("cr:10181").LSDatabaseSingleton,g):d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:g})})}}function z(a){if(a.tag==="ThreadUpdated")try{var b=a.value.snippetContactIDs;b!=null&&b.some(function(a){return a==="Facebook User"})&&(w.mustfix('Something is still setting a contact id as "Facebook User"'),a.value=babelHelpers["extends"]({},a.value,{snippetContactIDs:b.map(function(a){return a==="Facebook User"?"0":a})}))}catch(a){}else if(a.tag==="VerifyThreadExists"&&c("gkx")("13646")&&!(d("EBGating").isEBSMv2Phase1Enabled()||c("gkx")("13647"))){b=a.value;if(b.clientThreadKey!=null){var e=(h||(h=d("I64"))).of_string(b==null?void 0:b.clientThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid,"MAWIndexedDb:afterTransaction:withClientThreadKey","clientThreadKey"))}if(b.authoritativeThreadKey!=null){e=(h||(h=d("I64"))).of_string(b.authoritativeThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid,"MAWIndexedDb:afterTransaction:withAuthoritativeThreadKey","authoritativeThreadKey"))}}y(a)}function A(a,b){var e=c("MAWDexie").currentTransaction;if(e==null)throw w.mustfixThrow("afterTransactionForThreadEvent called outside of dexie transaction","maw_db");e.on("complete",function(){d("MAWBridge").getBridge().fireAndForget("threadEvent",b,a)})}g.TABLES_TO_ENCRYPT=d("MAWDbSchema").TABLES_TO_ENCRYPT;g.makeMsgrTransactor=d("MAWTransactor").makeMsgrTransactor;g.makeMAWIndexedDBFactory=a;g.isNewDb=l;g.willSetupDB=m;g.makeDB=n;g.closeDB=o;g.getDBExn=p;g.getSignalDB=q;g.getDB=r;g.setDB_INTERNAL_USE_ONLY=s;g.deleteDb=t;g.getDbStatus=e;g.updateStatusDuringMigration=f;g.afterTransactionEffect=x;g.afterTransaction=z;g.afterTransactionThreadEvent=A}),98);
__d("MAWLLAMigrationUtils",["Random","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";b=c("justknobx")._("652");var h=Math.max(b,10);e=h*10;var i=new Map([["FTS",e]]);function j(a){if(c("gkx")("9340"))return 1;a=i.get(a);return a!=null?a:h}function a(a,b){b===void 0&&(b={});var e=j(a);return a==="debug"||a==="test"?[]:c("gkx")("23956")&&d("Random").coinflip(e)?[c("qpl")._(1056839327,"560"),babelHelpers["extends"]({"double":{sampleRate:1/e},string:{transactor:a}},b)]:[]}g.getTransactorQPLParam=a}),98);
__d("MAWTransactor",["FBLogger","MAWDexie","MAWDexieTable","MAWErrorObject","MAWIndexedDb","MAWIndexedDbUI","MAWLLAMigrationUtils","MAWQplProxy","MAWTransactionMode","WAExceededStorageQuota","WALogger","gkx","performance"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=["MWPTransactor"],l=c("FBLogger")("messenger_web");function m(a,b,e,f,g,i){f!=null&&c("MAWDexie").currentTransaction!=null&&f.endFail("invoked_in_nested_transaction",{string:{current_transaction_mode:c("MAWDexie").currentTransaction.mode},string_array:{current_transaction_store_names:c("MAWDexie").currentTransaction.storeNames}});c("MAWDexie").currentTransaction!=null&&d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["makeMsgrTransactor "," should not be called inside another transaction. The transaction will be forced to execute on top-level"])),g);return a.transact(b,e,i)}function n(a){a=d("MAWLLAMigrationUtils").getTransactorQPLParam(a);a=a.length===2?a:[null,void 0];var b=a[0];a=a[1];return b!=null?d("MAWQplProxy").startQplUserFlow(b,a,{sendThroughBridge:!1}):null}function a(a,b,c,e){return q(a,b,function(a){return d("MAWIndexedDb").getDB(a)},c,e)}function b(a,b,c){return q(a,b,d("MAWIndexedDbUI").getDB,c)}function e(a,b,c){return q(a,b,d("MAWIndexedDbUI").getDB,c)}var o=0,p=new Map();function q(a,b,e,f,g){var h=Object.keys(a),q=h.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,t=new Array(a),u=0;u<a;u++)t[u]=arguments[u];var v=n(b),w=null,x=function(){return self.clearInterval(w)};if(v!=null){v.addAnnotations({string:{mode:q===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"},string_array:{stores:h}});if(c("gkx")("1006")&&b==="bulkCreateThreadByJid"){var y=1e3,z=Date.now();w=self.setInterval(function(){v.addAnnotations({"int":{heartbeatLatestAliveSinceStartMs:Date.now()-z}})},y);self.setTimeout(x,d("MAWQplProxy").DEFAULT_WORKER_QPL_TIMEOUT_MS)}}var A=(j||(j=c("performance"))).now()+j.timeOrigin;return e(b).then(function(a){var e=Array.from(p.values());v==null||v.addPoint("lock_wait_start",{string_array:{maybeLockedOn:e}});var n=(j||(j=c("performance"))).now();g==null||g.onTxnRequestedCb==null||g.onTxnRequestedCb.apply(g,t);return m(a,q,h,v,b,function(){d("MAWDexieTable").setDexiePSDItem("transactionRequested",A);d("MAWDexieTable").setDexiePSDItem("transactorName",b);v==null||v.addPoint("dexie_transaction_start");o+=1;var m=o;p.set(m,b);var q=v!=null?a.stores[h[0]].get("").then(function(){v==null||v.addPoint("lock_wait_end"),v==null||v.addPoint("transaction_opened"),v==null||v.addPoint("transactor_execution_start")}):d("MAWDexieTable").dexieResolve();return q.then(function(){return f(a.stores).apply(void 0,t)}).then(function(a){if(c("gkx")("6795")&&(g==null?void 0:g.explicitlyCloseTxn)===!0){var f;(f=c("MAWDexie").currentTransaction)==null||(f=f.idbtrans)==null||f.commit==null||f.commit()}p["delete"](m);v==null||v.addPoint("transactor_execution_end");v==null||v.endSuccess();x();f=(j||(j=c("performance"))).now()-n;f>5e3&&(d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[Slow maw transaction] "," took ","ms to complete. Potentially waiting for locks on ",""])),b,f,e.join(", ")),l.mustfix("[Slow maw transaction] %s took long to complete. Potentially waiting for locks on $s",b,e.join(", ")));return a})["catch"](function(a){p["delete"](m);d("WAExceededStorageQuota").checkQuotaExceededError(a);var c=a.name==="AbortError"?a==null?void 0:a.inner:null;c=r(c);v==null||v.markError("transaction_error",null,a);if(a instanceof Error){var e=a,f=typeof (e==null?void 0:e.stack)==="string"?e.stack:typeof (e==null?void 0:e.stack);e=typeof (e==null?void 0:e.message)==="string"?e.message:typeof (e==null?void 0:e.message);v==null||v.addAnnotations({string:{errMessage:e,errStack:f,innerError:c}})}v==null||v.endFail("transaction_fail");x();e=d("MAWErrorObject").getErrorObject(a);throw s(e).mustfixThrow("[%s] Error performing %s transaction. Inner error: %s",k.join("|"),b!=null?b:"",c!=null?c:"unknown")})})})["catch"](function(a){d("WAExceededStorageQuota").checkQuotaExceededError(a);v==null||v.endFail("transaction_fail");x();a=d("MAWErrorObject").getErrorObject(a);throw s(a).mustfixThrow("[%s] Error performing %s transaction",k.join("|"),b!=null?b:"")})}}function r(a){if(typeof a==="string")return a;if(a instanceof Error)return a.name+": "+a.message;if(typeof a==="object")try{return JSON.stringify(a)}catch(a){}return null}function s(a){if(a)return l.catching(a);else return l}g.makeMsgrTransactor=a;g.makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD=b;g.makeMsgrUIWritableTransactor=e}),98);
__d("MAWThreadUpdateType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=Object.freeze({BUMP_THREAD:c,MARK_THREAD_AS_UNREAD:d,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:a,SNIPPET_ONLY:b});f.THREAD_UPDATE_TYPE=e}),66);
__d("MAWGetThreadUpdateTypeForAdminMsg",["FBLogger","MAWAdminMsgTypesGrouped","MAWLocalizationType","MAWThreadUpdateType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=(a=a.msgContent)==null?void 0:a.adminType;if(a==null){c("FBLogger")("messenger_web").mustfix("nullAdminType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}if(h(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;if(i(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;if(j(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;if(k(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;c("FBLogger")("messenger_web").mustfix("unsupportedAdminMsgType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function h(a){return d("MAWAdminMsgTypesGrouped").otherUserAddRemoveParticipant.includes(a)||d("MAWAdminMsgTypesGrouped").chatCustomizedByOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").twoUsersConnected.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").otherUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeMarkedAsUnread.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR}function i(a){return d("MAWAdminMsgTypesGrouped").currentUserAddRemoveParticipant.includes(a)||d("MAWAdminMsgTypesGrouped").chatCustomizedByCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionNotToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").currentUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeBumped.includes(a)||d("MAWAdminMsgTypesGrouped").limitSharingUpdate.includes(a)}function j(a){return a===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE||d("MAWAdminMsgTypesGrouped").ephemeralSettingChanges.includes(a)||d("MAWAdminMsgTypesGrouped").groupPermissionsChanged.includes(a)||d("MAWAdminMsgTypesGrouped").participantLeftGroup.includes(a)||d("MAWAdminMsgTypesGrouped").pinnedMessageUpdate.includes(a)}function k(a){return d("MAWAdminMsgTypesGrouped").cutoverAdminMsgs.includes(a)||d("MAWAdminMsgTypesGrouped").deviceChanges.includes(a)||d("MAWAdminMsgTypesGrouped").icdcAlerts.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToNotTriggerUpdate.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a===d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET||a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE}g.getThreadUpdateTypeForAdminMsg=a}),98);
__d("MAWGetThreadUpdateType",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateTypeForAdminMsg","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.reaction==null;return j(a,b)}function i(a){return k(a.reactToAuthor)&&!k(a.author)}function j(a,b){if(i(a)&&!b)if(a.senderTimestampMs==null)return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function k(a){return a===d("WAJids").AUTHOR_ME||a===d("MAWUserJidWrapper").getMyUserJid()}function l(a){var b=a.type,e=function(b){var c=b.me;b=b.other;return d("WAJids").isAuthorMe(a.author)?c:b};switch(b){case"Text":case"ReceiverFetch":case"Sticker":case"Unavailable":case"Video":case"Futureproof":case"DocumentFile":case"EphemeralScreenshotAction":case"Gif":case"Image":case"Ptt":case"RavenAction":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":case"BumpExistingMessage":return e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"XMA":return d("MAWThreadSnippetUtils").shouldIgnoreXMAMsgForSnippet(a)?d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"Revoked":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;case"DeleteForMe":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"EditAction":return e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE});case"GroupInvite":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Admin":if(a.type==="Admin")return d("MAWGetThreadUpdateTypeForAdminMsg").getThreadUpdateTypeForAdminMsg(a);throw c("FBLogger")("messenger_web").mustfixThrow("Non-admin msg passed in "+((e=a.type)!=null?e:"UNKNOWN"));case"SenderKeyDistribution":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"AlertICDC":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Ciphertext":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"EphemeralSettingAdmin":case"EphemeralSettingChangeFromCurrentDevice":case"EphemeralSyncResponse":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;default:b;throw c("FBLogger")("messenger_web").mustfixThrow("[MAWGetThreadUpdateType] Unexpected message type: "+((e=a.type)!=null?e:"UNKNOWN"))}}function m(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(a,{forMessage:function(a){return l(a)},forNull:function(){return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE},forReaction:function(a){return h(a)}})}function a(a){a=m(a);switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][snippet] Unhandled threadUpdateType: "+a)}}function b(a){a=m(a);switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][bump] Unhandled threadUpdateType: "+a)}}g.getThreadUpdateTypeForReaction=h;g.canReactionAffectBump=i;g.getReactionThreadUpdateType=j;g.getThreadUpdateTypeForMsg=l;g.getThreadUpdateTypeForMsgOrReaction=m;g.isThreadUpdateTypeEligibleForSnippet=a;g.isThreadUpdateTypeEligibleForBump=b}),98);
__d("MAWCacheServiceMiddleware",["FBLogger","MAWIndexedDb","MAWMpsGating","MAWWorkerCacheServices"],(function(a,b,c,d,e,f,g){"use strict";var h=["messages","reactions"],i=["messages","reactions"];function j(a,b,c){var d,e=c.trans,f=(d=(d=e._transactorMeta)==null?void 0:d.mawCacheServiceAccumulatedRequests)!=null?d:[];if(c.type==="delete"&&i.includes(b.name))return m(a,b.name,c).then(function(a){a=babelHelpers["extends"]({},c,{deletedValues:a});f.push([b.name,a]);e._transactorMeta=babelHelpers["extends"]({},e._transactorMeta,{mawCacheServiceAccumulatedRequests:f});return b.mutate(c)});d=babelHelpers["extends"]({},c,{decryptedValues:c.values?c.values:void 0});f.push([b.name,d]);e._transactorMeta=babelHelpers["extends"]({},e._transactorMeta,{mawCacheServiceAccumulatedRequests:f});return b.mutate(c)}function k(a){var b=a.trans;if(((a=b._transactorMeta)==null?void 0:a.mawCacheServiceAfterTransactionScheduled)===!0)return;d("MAWIndexedDb").afterTransactionEffect(function(){var a;a=(a=(a=b._transactorMeta)==null?void 0:a.mawCacheServiceAccumulatedRequests)!=null?a:[];if(a.length===0)return;d("MAWWorkerCacheServices").getMAWWorkerCacheServices().calculateDelta(a)});b._transactorMeta=babelHelpers["extends"]({},b._transactorMeta,{mawCacheServiceAfterTransactionScheduled:!0})}function l(a,b){var c=a.table(b);if(!h.includes(b))return c;return d("MAWMpsGating").isFullMpsEnabled()?c:babelHelpers["extends"]({},c,{mutate:function(b){k(b);return j(a,c,b)}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return l(a,b)}})}catch(b){c("FBLogger")("MAWCacheService").catching(b).mustfix("Error applying MAW Cache Service Middleware");return a}},name:"MAWCacheServiceMiddleware",stack:"dbcore"}}function m(a,b,c){var d=c.keys;c=c.trans;return a.table(b).getMany({keys:d,trans:c}).then(function(a){return a.filter(Boolean)})}g["default"]=a}),98);
__d("MAWVaultDb",["FBLogger","MAWQplProxy","MAWVault","gkx","isObject","isPlainObject","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=1/1e3,i=new WeakMap();function j(a,b){return b[a]!=null}var k=c("gkx")("23909");function a(a,b,e){if(!c("isPlainObject")(a)||!k||!j(b,e)||a==null)return a;var f=i.get(a);if(f!=null)return f;f=Math.random()<h?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25301509,"119")):null;try{e=e[b];e=l(a,e,d("MAWVault").vault);f==null||f.endSuccess();i.set(a,e);return e}catch(a){f==null||f.endFail("vault_fail");throw c("FBLogger")("messenger_web").mustfixThrow(a.message+" - Failed to vault an entity in the table: "+b)}}function b(a,b,e){if(!c("isPlainObject")(a)||!k||!j(b,e)||a==null)return a;var f=Math.random()<h?d("MAWQplProxy").startQplUserFlow(c("qpl")._(741087294,"2028")):null;try{a=l(a,e[b],d("MAWVault").unvault);f==null||f.endSuccess();return a}catch(a){f==null||f.endFail("unvault_fail");throw c("FBLogger")("messenger_web").mustfixThrow(a.message+" - Unvaulting failed for an entity in the table: "+b)}}function l(a,b,d){if(a==null)return a;b=Object.entries(b).filter(function(b){b=b[0];return a[b]!=null});return b.length===0?a:b.reduce(function(a,b){var e=b[0];b=b[1];typeof b!=="boolean"&&c("isObject")(b)?a[e]=l(a[e],b,d):b===!0&&(a[e]=d(a[e]));return a},babelHelpers["extends"]({},a))}g.vaultDbRow=a;g.unvaultDbRow=b;g.setInPath=l}),98);
__d("MAWVaultDefinitions",[],(function(a,b,c,d,e,f){"use strict";a={editMsgHistory:{msgContent:{content:!0}},messages:{msgContent:{content:!0},quote:{content:{msgContent:{content:!0}}}},unrenderedMessages:{msgContent:!0}};b={edit_message_history:{messageContent:!0},messages:{replyMessageText:!0,text:!0},threads:{snippet:!0}};f.ARMADILLO_IDB_VAULT_DEFINITIONS=a;f.PERSISTED_DB_VAULT_DEFINITIONS=b}),66);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(c("qex")._("507")===!0)return!0;else return c("isInstamadillo")()}g["default"]=a}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(a,b,c,d,e,f,g){"use strict";var h=c("gkx")("23909");function a(a,b,e){if(!h&&!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")))return a;a=babelHelpers["extends"]({},a);a=d("MAWVaultDb").unvaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS);a=d("MAWDbObjEncryption").encryptDbObj(a,b,e);return a}function b(a,b){return!h?a:d("MAWVaultDb").unvaultDbRow(babelHelpers["extends"]({},a),b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function e(a,b,c){a=d("MAWDbObjEncryption").decryptDbObj(babelHelpers["extends"]({},a),b,c);return!h?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function f(a,b){if(a==null)return void 0;return!h?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}g.mutateValue=a;g.mutateVaultedValue=b;g.getValue=e;g.getVaultedValue=f}),98);
__d("MAWDbMutationValidator",["FBLogger","MAWIndexedDb","MAWMessageHasNonNullServerTsOnReceivedAckValidator","MAWMessageHasUniqueExternalIdValidator","MAWODSProxy","MAWParticipantMatchOneOnOneThreadValidator","MAWReactionHasUniqueProtocolMsgIdValidator","Promise","Random","WAOdsEnums","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[d("MAWMessageHasUniqueExternalIdValidator").MAWMessageHasUniqueExternalIdValidator,d("MAWParticipantMatchOneOnOneThreadValidator").MAWParticipantMatchOneOnOneThreadValidator,d("MAWReactionHasUniqueProtocolMsgIdValidator").MAWReactionHasUniqueProtocolMsgIdValidator,d("MAWMessageHasNonNullServerTsOnReceivedAckValidator").MAWMessageHasNonNullServerTsOnReceivedAckValidator],j=c("justknobx")._("2610"),k=c("gkx")("5906"),l=function(a){return d("Random").coinflip(a!=null?a:j)||k};function m(a,e){var f=a.table(e),g=i.filter(function(a){return a.table===e});return g.length===0?f:babelHelpers["extends"]({},f,{mutate:function(a){return d("MAWIndexedDb").getDbStatus()!=="ready"?f.mutate(a):f.mutate(a).then(function(e){var f=g.filter(function(b){var c=b.sampleRate;b=b.type;return b.includes(a.type)&&l(c)});d("MAWIndexedDb").afterTransactionEffect(function(){var g=f.flatMap(function(a){var b=a.description,c=a.isValid;return((a=e.results)!=null?a:[]).map(function(a){return c(a).then(function(a){return babelHelpers["extends"]({validatorName:b},a)})})});c("promiseDone")((h||(h=b("Promise"))).all(g).then(function(b){b.forEach(function(b){switch(b.result){case"valid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:b.validatorName+"."+a.type+".valid"});break;case"invalid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:b.validatorName+"."+a.type+".invalid"});c("FBLogger")("maw_mutation_validator").mustfix("Validator %s failed for %s mutation, with description: %s",b.validatorName,a.type,b.description);break;case"skipped":break}})}))});return e})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return m(a,b)}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying Mutation Validator Middleware");return a}},name:"MAWMutationValidatorMiddleware",stack:"dbcore"}}g.getMutationValidatorMiddleware=a}),98);
__d("MAWDbProtocolMsgIdMiddleware",["FBLogger","MAWDBMigrationUtils","MAWJidUtils","MAWODSProxy","Random","WAOdsEnums","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("justknobx")._("3300");function i(a){return babelHelpers["extends"]({},a,{get:function(b){return a.get(b).then(function(a){l(a,"get");return a})},getMany:function(b){return a.getMany(b).then(function(a){return a==null?void 0:a.map(function(a){l(a,"getMany");return a})})},mutate:function(b){b.type==="add"?b.values.map(function(a){return j(a)}):b.type==="put"&&c("gkx")("11791")&&c("justknobx")._("3947")&&b.values.map(function(a){a.protocolMsgId==null&&(d("MAWDBMigrationUtils").mawDbMigrationVersion.version>=d("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION?(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_after_migration_complete.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)):a.rowId<d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue?(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_below_migration_cursor.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)):d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.isRunning&&a.rowId<d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue+d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.batchSize&&(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_in_current_migration_batch.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)))});return a.mutate(b)},query:function(b){return a.query(b).then(function(a){var b;a==null||(b=a.result)==null||b.map(function(a){l(a,"query")});return a})}})}function j(a){a.protocolMsgId=d("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(a)}function k(a){return(a==null?void 0:a.rowId)==null&&(a==null?void 0:a.externalId)==null}function l(a,b){try{var e=c("justknobx")._("3947");if(k(a)){b!=="get"&&d("Random").coinflip(h)&&c("FBLogger")("messenger_web").warn("Corrupted message row returned from DB, msg is null:%s, queryType: %s",a==null,b);return}(a==null?void 0:a.protocolMsgId)==null&&d("Random").coinflip(h)&&(d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(e)}),d("MAWDBMigrationUtils").mawDbMigrationVersion.version>=d("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION&&c("FBLogger")("maw_db_migration").warn("Message with null protocolMsgId after the msg dedupe migration. type: %s, rowId: %s, externalId: %s",a==null?void 0:a.type,a==null?void 0:a.rowId,a==null?void 0:a.externalId));a!=null&&a.protocolMsgId!=null&&a.protocolMsgId!==d("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(a)&&d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"inconsistent_protocol_msg_id."+(a==null?void 0:a.type)+".migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(e)})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error while checking protocol msg id")}}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return b!=="messages"?a.table(b):i(a.table(b))}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying Protocol MsgId Middleware");return a}},name:"MAWDbProtocolMsgIdMiddleware",stack:"dbcore"}}g.appendProtocolMsgId=j;g.isCorruptedMsgRow=k;g.MAWDbProtocolMsgIdMiddleware=a}),98);
__d("MAWLSDataSyncMiddleware",["FBLogger","MAWBridge","MAWLSEditMsgHistoryAddedDataSyncHandler","MAWLSMsgsDataSync","MAWLSReactionsDataSyncHandler","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(){var a=new Set();a.add(d("MAWLSReactionsDataSyncHandler").mawLSReactionsDataSyncHandler);a.add(d("MAWLSEditMsgHistoryAddedDataSyncHandler").mawLSEditHistoryDataSyncHandler);a.add(d("MAWLSMsgsDataSync").mawLSMsgsDataSyncHandler);a.forEach(function(a){h.set(a.tableName,a)})}function j(a){return babelHelpers["extends"]({},a,{mutate:function(b){var c=h.get(a.name);return c!=null?c.performAndSyncMutation(b,a):a.mutate(b)}})}function a(){i();return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return h.has(b)?j(a.table(b)):a.table(b)}})}catch(d){var b=c("getErrorSafe")(d);c("FBLogger")("maw_db").catching(b).mustfix("Error applying MAW to LS data sync middleware");return a}},name:"MAWLSDataSyncMiddleware",stack:"dbcore"}}function b(a){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[a]})}g.getMAWLSDataSyncMiddleware=a;g.syncToLS=b}),98);
__d("MAWLSEditMsgHistoryAddedDataSyncHandler",["MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.map(function(a){return babelHelpers["extends"]({},a)});d("MAWLSDataSyncMiddleware").syncToLS({tag:"EditMsgHistoryAdded",value:a})}a={performAndSyncMutation:function(a,b){switch(a.type){case"put":case"add":var c=[].concat(a.values);d("MAWIndexedDb").afterTransactionEffect(function(){return h(c)});break}return b.mutate(a)},tableName:"editMsgHistory"};g.mawLSEditHistoryDataSyncHandler=a}),98);
__d("MAWLSMsgsDataSync",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=b.keys;b=b.trans;return a.getMany({keys:c,trans:b}).then(function(a){return a.filter(Boolean)})}function i(a){a=a.reduce(function(a,b){var c=d("MAWBridgeTypesCreators").createBridgeDeletedMessage(b);a.has(b.threadJid)||a.set(b.threadJid,[]);(b=a.get(b.threadJid))==null||b.push(c);return a},new Map());a.entries().forEach(function(a){var b=a[0];a=a[1];a={messages:a,threadJid:b};d("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteMessages",value:a})})}a={performAndSyncMutation:function(a,b){switch(a.type){case"delete":return h(b,a).then(function(c){d("MAWIndexedDb").afterTransactionEffect(function(){return i(c)});return b.mutate(a)});default:return b.mutate(a)}},tableName:"messages"};g.mawLSMsgsDataSyncHandler=a}),98);
__d("MAWLSReactionsDataSyncHandler",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;d("MAWLSDataSyncMiddleware").syncToLS({tag:"UpsertReaction",value:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a})})}function i(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})}function j(a){a.forEach(function(a){a.reaction==null?i(a):h(a)})}a={performAndSyncMutation:function(a,b){switch(a.type){case"put":case"add":var c=[].concat(a.values);d("MAWIndexedDb").afterTransactionEffect(function(){return j(c)});break}return b.mutate(a)},tableName:"reactions"};g.mawLSReactionsDataSyncHandler=a}),98);
__d("MAWDbReaction",["FBLogger","I64","MAWAckLevel","MAWGetBumpTimestampMs","MAWUserJidWrapper","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=d("MAWUserJidWrapper").getMyUserJid();if(a.reactToAuthor!=="@me"&&a.reactToAuthor!==b||a.reaction==null)return null;b=a.author==="@me"||a.author==="@system"?null:a.author;return b==null?null:babelHelpers["extends"]({},a,{author:b,reaction:a.reaction,reactToAuthor:"@me"})}function a(a){a=i(a);if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot cast reaction to incomingDbReaction");return a}function b(a,b,c){var e=d("MAWUserJidWrapper").getMyUserJid();return a.find(function(a){return a.threadJid===b&&d("WAJids").authorToUserId(a.author,e)===d("WAJids").authorToUserId(c,e)})}function e(a){return a}function f(a,b,c,e,f,g,h,i,j,k,l,m,n){m===void 0&&(m=d("MAWAckLevel").ACK.clock);m={ack:m,author:k,externalId:b,groupingKey:g,reaction:f,reactionId:c,reactToAuthor:h,reactToExternalId:e,reactToMsgId:i,senderTimestampMs:n,threadJid:a,ts:j};return l!=null?babelHelpers["extends"]({},m,{rowId:l}):m}function j(a){a=d("MAWGetBumpTimestampMs").getBumpTimestampMs(a);return d("WATimeUtils").castToMillisTime((h||(h=d("I64"))).to_float(a))}g.maybeCastToIncomingDbReaction=i;g.castToIncomingDbReaction=a;g.findMatchingReaction=b;g.reactionIdToMsgId=e;g.formatReactionForDb=f;g.getReactionTimeMs=j}),98);
__d("MAWThreadNewestMsgOrReactionUtils",["FBLogger","MAWDbMsg","MAWDbMsgTxns","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWODSProxy","MAWThreadUpdateType","WALogger","WAMsg","WAOdsEnums","WATimeUtils","first","last"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return l(a,b,i)}function i(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : "+a)}}function b(a,b){return l(a,b,j)}function e(a){var b=a.db,c=a.jid;a=a.limit;return d("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(b,c,null,!0,a,function(a){return k(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0)},"before")}function j(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : %s",a)}}function k(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCacheService] Unhandled threadUpdateType to create filter function : %s",a)}}function l(a,b,c){var e=function(e){return e==null?d("MAWDexieTable").dexieResolve(null):n(a,b,c,e)};return m(a,b,c).then(function(a){return e(a).then(function(c){if(a==null&&c==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[CentralizedThreadUpdate] No Reaction or Message in "," is eligible for snippet"])),b);return null}if(c==null)return a;if(a==null)return c;var e=d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(a)),f=d("MAWDbReaction").getReactionTimeMs(c);return e>=f?a:c})})}function m(a,b,e){return d("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(a,b,null,!0,1,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0)},"before").then(c("first"))}function n(a,b,e,f){var g=d("MAWDbMsg").getSortOrderWithFallback(f),h=function(c,f){return d("MAWDbReactionsTxns").fetchReactionsFromDbWithTimestamp(a,b,d("WATimeUtils").castToMillisTime(g),f,f==null,c,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForReaction(a),!1)&&d("MAWDbReaction").getReactionTimeMs(a)>g})},i=[1,10],j=100,k=new Set(),l=function(b,e){var f;return h((f=i[b])!=null?f:j,e).then(function(e){var f=e.filter(function(a){return!k.has(q(a))});if(f.length===0){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+b});return null}return o(a,f).then(function(a){var f=a.newestReaction;a=a.nullMsgIds;if(f!=null){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+b});return f}a.forEach(function(a){return k.add(a)});return l(b+1,c("last")(e))})})};return l(0,null)}function o(a,b){return d("MAWDbMsgTxns").getUniqueMsgsByProtocolMsgIds(a,b.map(p)).then(function(a){var c=new Set(a.map(r)),d=new Set(),e=null;b.forEach(function(a){var b=q(a);c.has(b)?e=s(e,a):d.add(b)});return{newestReaction:e,nullMsgIds:d}})}function p(a){return{author:a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId}}function q(a){return d("WAMsg").craftWAMsgIdString(p(a))}function r(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}function s(a,b){if(a==null)return b;return b==null?a:d("MAWDbReaction").getReactionTimeMs(a)>d("MAWDbReaction").getReactionTimeMs(b)?a:b}g.getNewestMsgOrReactionForBump=a;g.filterForBump=i;g.getNewestMsgOrReactionForSnippet=b;g.getNewestIncomingMsgsForSnippet=e;g.filterForSnippet=j;g.filterForSnippetNewestIncomingMessages=k;g.getNewestReactionToNonNullMsg=o}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWLocalizationType","MAWMsgType","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([(f=d("MAWLocalizationType")).LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL,f.LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.POLL_UNSENT_UPDATE]);function a(a,b,c,e,f,g){return{ack:d("MAWAckLevel").ACK.sent,altIndex:f!=null?f:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:c,msgContent:a,sortOrderMs:g,threadJid:b,ts:e!=null?e:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ADMIN}}function b(a){if(h.has(a))return!0;switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED:return!0}return!1}function c(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function e(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}g.POLL_ADMIN_MSG_TYPES=h;g.buildUnstoredDbAdminMsg=a;g.isAdminMsgNormalized=b;g.isDeviceChangeAdminMsg=c;g.isParticipantChangeAdminMsg=e}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["FBLogger","MAWAdminMsgNormalized","MAWLocalizationType","MAWLocalizationUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e;e=(e=a.msgContent)==null?void 0:e.adminType;a=(a=a.msgContent)==null?void 0:a.adminMsgContent;if(e==null||a==null){c("FBLogger")("GroupPollsE2EE").mustfix("MAWThreadSnippetForAdminOrEphemeralMsg: snippetType or adminMsgContent is null");return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:b,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}a=d("MAWLocalizationUtils").isAdminMsgNormalized(e)?d("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(e,a):{contactIds:[],contents:a};var f=a.contactIds;a=a.contents;return{snippetParams:{contactIDs:[].concat(f.map(function(a){return a==="Facebook User"?"0":a})),strings:[].concat(a)},snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForBumpExistingMessageMsg",["MAWLocalizationType","WAGlobals","WAJids","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a,b,c){return{snippetParams:{contactIDs:c!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}var m=function(a){return l(a,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)};function a(a,b){var c;if(d("WAJids").isAuthorSystem(a.author)){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Bumped message can not have AUTHOR_SYSTEM"])));return m(b)}c=(c=a.quote)==null?void 0:c.content.type;if(c===d("WAMsgType").UNAVAILABLE){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Bump message has unavailable content type"])));return m(b)}c=(c=a.quote)==null?void 0:c.content.author;if(c==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Bump message has no quoted author"])));return m(b)}if(d("WAJids").isAuthorMe(a.author)||a.author===d("WAGlobals").getMyUserJid())return d("WAJids").isAuthorMe(c)||c===d("WAGlobals").getMyUserJid()?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,[d("WAJids").userIdFromJid(c)]);if(b==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Bump message sender is null"])));return m(b)}if(d("WAJids").isAuthorMe(c)||c===d("WAGlobals").getMyUserJid())return l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,[b]);return c===a.author?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,[b]):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE,[b,d("WAJids").userIdFromJid(c)])}g["default"]=a}),98);
__d("MAWThreadSnippetForCiphertextMsg",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:a,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK}}g["default"]=a}),98);
__d("MAWThreadSnippetForDocumentFileMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Document file message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForFallbackMessageMsg",["MAWLocalizationType","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return{snippetParams:{contactIDs:c!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}function a(a,b){var c=a.author;a=a.msgContent.subtype;if(d("WAJids").isAuthorMe(c))switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}else switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE);case"metaAiMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}}g["default"]=a}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForRavenMsg",["MAWLocalizationType","MAWMsg","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForMsgUtils",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;b={contactIDs:[],mentionJIDs:b!=null?b:[],strings:[]};d("WAJids").isAuthorMe(a)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:d("WAJids").isAuthorSystem(a)||c==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,b.contactIDs.push(c));return{snippetParams:b,snippetSenderContactId:c,snippetType:e}}g.getMAWThreadSnippetForStickerMsg=a}),98);
__d("MAWThreadSnippetForReceiverFetchMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForTextMsg",["MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,f={contactIDs:[],mentionJIDs:a.msgContent.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]))):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,f.contactIDs.push(b));if(a.specialTextSize===1||a.specialTextSize===2||a.specialTextSize===3){c=d("MAWVault").unvault(a.msgContent.content);f.strings.push(c==="\ud83d\udc4d"?"(Y)":a.msgContent.content)}else f.strings.push(a.msgContent.content);return{snippetParams:f,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};a.xmaMessageType==null&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"])));switch(a.xmaMessageType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:if(d("WAJids").isAuthorMe(a.author)){var f;if(a.msgContent!=null&&((f=a.msgContent)==null?void 0:f.content)!=null){f=a.msgContent.content;e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT;f!=null&&c.strings.push(f)}else e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT}else if(d("WAJids").isAuthorSystem(a.author)||b==null)d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"])));else{e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT;c.contactIDs.push(b);f=(f=a.msgContent)==null?void 0:f.content;f!=null&&c.strings.push(f)}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_MEMORIES_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_MEMORIES_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG;f=a.threadJid;var g;f!=null&&(g=d("WAJids").interpretAsUserJid(f));if(g!=null){f=d("WAJids").userIdFromJid(g);c.contactIDs.push(f)}else d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["XMA story mentions must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)?d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(w||(w=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:if(d("WAJids").isAuthorMe(a.author)&&b!=null){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(z||(z=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(A||(A=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(B||(B=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(D||(D=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(F||(F=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,c.contactIDs.push(b));break;default:d("WALogger").ERROR(G||(G=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet: ",""])),a.xmaMessageType)}return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}function H(a){a=a.threadJid!=null?d("WAJids").interpretAsUserJid(a.threadJid):null;return a!=null?d("WAJids").userIdFromJid(a):null}g["default"]=a}),98);
__d("MAWThreadSnippet",["FBLogger","MAWLocalizationType","MAWMsgType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForBumpExistingMessageMsg","MAWThreadSnippetForCiphertextMsg","MAWThreadSnippetForDocumentFileMsg","MAWThreadSnippetForFallbackMessageMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRavenMsg","MAWThreadSnippetForReceiverFetchMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return/^\d+$/.test(a)}function i(a){if(d("WAJids").isAuthorSystem(a))return;a=d("WAJids").isAuthorMe(a)?d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid()):d("WAJids").userIdFromJid(a);if(!h(a)){c("FBLogger")("messenger_web").mustfix("[MAWThreadSnippetBuildTxns] Snippet sender contact id is invalid");return}return a}function a(a){var b=a.chatJid;a=a.dbMsg;b=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return!0},user:function(a){return!1}});var e=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return c("MAWThreadSnippetForCiphertextMsg")(e);case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,e,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,e);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,e);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,e);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,e);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,e);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,e);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,e);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return c("MAWThreadSnippetForReceiverFetchMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RAVEN:return c("MAWThreadSnippetForRavenMsg")(a,e);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}function b(a,b){a=d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return!0},user:function(a){return!1}});return j(b,a)}function j(a,b){var e=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return c("MAWThreadSnippetForCiphertextMsg")(e);case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,e,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,e);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,e);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,e);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,e);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,e);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,e);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,e);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return c("MAWThreadSnippetForReceiverFetchMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RAVEN:return c("MAWThreadSnippetForRavenMsg")(a,e);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}g.getSnippetContactId=i;g.buildThreadSnippetV2=a;g.buildThreadSnippet=b}),98);
__d("WAProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.externalId===b.externalId&&a.author===b.author&&a.chat===b.chat}f.equals=a}),66);
__d("MAWThreadSnippetBuildTxns",["FBLogger","MAWDbMsg","MAWDbMsgOrReaction","MAWDbReaction","MAWDexieTable","MAWJidUtils","MAWLocalizationType","MAWThreadSnippet","MAWThreadSnippetUtils","MAWUserJidWrapper","WAJids","WAProtocolMsgId","WATimeUtils","emptyFunction","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return d("WAJids").switchOnMsgrChatJidType(c,{group:function(c){return i(a,b,!0)},user:function(c){return i(a,b,!1)}})}function a(a,b){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(b,{forMessage:function(b){return d("MAWThreadSnippet").buildThreadSnippet(a,b)},forReaction:function(a){a=d("MAWDbReaction").castToIncomingDbReaction(a);return h(a.author,a.reaction,a.threadJid)}})}function i(a,b,e){var f;d("WAJids").isAuthorMe(a)?(c("FBLogger")("messenger_web").warn("[MAWThreadSnippetBuildTxns] Reaction snippet author should not be @me"),f=d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid())):f=d("WAJids").userIdFromJid(a);a={contactIDs:[],strings:[]};e=e?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;a.contactIDs.push(f);a.strings.push(b);return{snippetParams:a,snippetSenderContactId:f,snippetType:e}}function b(a,b,e,f){var g=e.newestReaction,h=e.reactionsToClear;if(g!=null&&d("WATimeUtils").castUnixTimeToMillisTime(g.ts)>((e=b.snippetMsgTs)!=null?e:0))return d("MAWDexieTable").dexieResolve({newestReaction:g,thread:j(b,g,f)});e=c("justknobx")._("2763")?h!=null&&h.length>0:h!=null;return e&&b.snippetMsg!=null?a.reactions.get({reactionId:b.snippetMsg}).then(function(c){var e=!1;if(c==null)e=!0;else{var f=d("MAWJidUtils").maybeToProtocolMsgId(c.author,c.threadJid,c.reactToExternalId);f!=null&&(e=h.some(function(a){a=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.reactToExternalId);return a!=null&&d("WAProtocolMsgId").equals(a,f)}))}return e?k(a,b).then(function(a){return{newestReaction:null,thread:a}}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}function j(a,b,c){return babelHelpers["extends"]({},a,{snippetMsg:b.reactionId,snippetMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts)})}function k(a,b){return d("MAWThreadSnippetUtils").recalculateSnippetFromScratch_EXPENSIVE(a,b).then(function(a){if(a==null){c("FBLogger")("messenger_web").mustfix("[Occamadillo] ThreadUpdated handler called for clear snippet when centralized thread bump is enabled");return babelHelpers["extends"]({},b,{snippetMsg:void 0,snippetMsgTs:void 0})}var e=d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(a));return babelHelpers["extends"]({},b,{snippetMsg:a.msgId,snippetMsgTs:e})})}function e(a,b){return k(a,b).then(function(b){return a.threads.put(b).then(c("emptyFunction"))})}g.buildReactionThreadSnippet=h;g.buildThreadSnippetForMsgOrIncomingReaction=a;g.getReactionSnippetParams=i;g.getThreadChangesetForReactionChanges=b;g.getThreadChangesetForNewReaction=j;g.refreshThreadSnippet=e}),98);
__d("MAWEphemeralMsgUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return function(b){return!a.has(b.msgId)&&b.ephemeralMsgDisappeared!==!0}}f.filterNonExpiredMsg=a}),66);
__d("MAWThreadSnippetUtils",["MAWDbReaction","MAWDexieTable","MAWEphemeralMsgUtils","MAWJidUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippet","MAWThreadSnippetBuildTxns","MAWXMAUtils","MWThreadListConsts","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b;if(j(a))return!0;b=((b=a.msgContent)==null?void 0:b.adminType)!=null?d("MAWLocalizationUtils").isDeviceChangeAdminMsg(a.msgContent.adminType):!1;if(a.type!==d("MAWMsgType").MSG_TYPE.ADMIN)return!1;a=a.msgContent.adminType;return a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:b}function a(a,b,c){return a.messages.where("[threadJid+sortOrderMs]").between([b.jid,Number.MIN_SAFE_INTEGER],[b.jid,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(a){return(c==null||d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c)(a))&&!h(a)}).reverse().first()}var i={snippetParams:{contactIDs:[],mentionJIDs:[],strings:[]},snippetSenderContactId:null,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET};function b(a,b){return d("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForSnippet(a,b).then(function(c){return c==null?{snippet:i}:l(a,b).then(function(a){var d=k(b,c);return d==null?d:babelHelpers["extends"]({},d,{snippetNewestIncomingMsgsMetadata:a})})})}function j(a){return d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)}function k(a,b){if(b.reactionId!=null){var c=d("MAWDbReaction").maybeCastToIncomingDbReaction(b);return c==null?{snippet:i}:{snippet:d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(c.author,c.reaction,a),snippetMsgOrReaction:b}}switch(b.type){case d("MAWMsgType").MSG_TYPE.XMA:c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?{snippet:i}:{snippet:d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:b.threadJid,dbMsg:b}),snippetMsgOrReaction:b};default:return{snippet:d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:b.threadJid,dbMsg:b}),snippetMsgOrReaction:b}}}function l(a,b){var e;e=(e=c("qex")._("1213"))!=null?e:!1;return!e?d("MAWDexieTable").dexieResolve(void 0):d("MAWThreadNewestMsgOrReactionUtils").getNewestIncomingMsgsForSnippet({db:a,jid:b,limit:d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT}).then(function(a){return a.length===0?void 0:a.map(function(a){return{externalId:a.externalId,sortOrderMs:a.sortOrderMs}})})}g.isDbMsgDisabledForThreadSnippet=h;g.recalculateSnippetFromScratch_EXPENSIVE=a;g.EMPTY_SNIPPET_DATA=i;g.getThreadSnippetFromScratch=b;g.shouldIgnoreXMAMsgForSnippet=j}),98);
__d("MAWDbAppMeta",[],(function(a,b,c,d,e,f){"use strict";a={allowSecurityAlert:"allowSecurityAlert",allowSecurityAlertForSelf:"allowSecurityAlertForSelf",dbMigrationVersion:"dbMigrationVersion",deviceJid:"deviceJid",hasMigratedFromDexie:"hasMigratedFromDexie",hmacKey:"hmacKey",hotlikeSticker:"hotlikeSticker",isBackfilledForOccamadillo:"isBackfilledForOccamadillo",msgTypeVersion:"msgTypeVersion",restoreMigrationAttempts:"restoreMigrationAttempts",restoreToDexieMigrationComplete:"restoreToDexieMigrationComplete"};f.AppMetaKeysEnum=a}),66);
__d("MAWDBMigrationUtils",["MAWDbAppMeta","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a={batchSize:0,cursorValue:0,isRunning:!1};var h={version:0};b=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY},"getMigrationVersion",function(a){return function(){return a.appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion).then(function(a){a=(a=a==null?void 0:a.value.dbMigrationVersion)!=null?a:0;h.version=a;return a})}});c=6;g.mawDbDedupeMsgsMigrationStatus=a;g.mawDbMigrationVersion=h;g.getMigrationVersion=b;g.MAWDB_DEDUPE_MSGS_MIGRATION_VERSION=c}),98);
__d("MAWLoadReplyMediaTxns",["MAWBridgeReceiverFetchInfo","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMediaUtils","MAWMsgType","MAWUserJidWrapper","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;function o(a,b,e){if(c("gkx")("2419")&&e!=null){e=d("MAWMediaUtils").genHMACPlaintextHash(e);return a.media.where("hashedPlaintextHash").equals(e).first()}else return a.media.get(b)}var p=new Set([(e=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,e.MEDIA_TYPE.GIF,e.MEDIA_TYPE.PTT,e.MEDIA_TYPE.STICKER,e.MEDIA_TYPE.VIDEO,e.MEDIA_TYPE.DOCUMENT_FILE]);function q(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.STICKER:b=a.validatedImageInfo;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:b=a.validatedVideoInfo;break}a=b||{};var c=a.height,e=a.jpegThumbnailHeight,f=a.jpegThumbnailWidth;a=a.width;return{replyMediaPreviewHeight:e!=null?e:c,replyMediaPreviewWidth:f!=null?f:a}}function r(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.XMA:if(c("gkx")("9921"))return!0;else return d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").NOTE_REPLY:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RAVEN:return!1;default:return c("WAAssertUnreachable")(a.type)}}function s(a,b,c){if(b==null)return d("MAWDexieTable").dexieResolve();a=o(a,b,c).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_media_not_found");if(!p.has(a.mediaType))return d("WAResultOrError").makeError("reply_media_type_unknown");var c=q(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;b!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","load_reply_media_txns_for_reply_type_'unknown'}");return d("WAResultOrError").makeResult({replyMediaId:b,replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash})});return a.then(function(a){if(a.success!==!0){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""])),b,a.error);return}return a.value})}function t(a,b){var c=b.defaultPreviewMediaId;if(c==null)return d("MAWDexieTable").dexieResolve({replyXMAId:b.xmaId});a=o(a,c).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_xma_media_not_found - "+b.targetType);if(!p.has(a.mediaType))return d("WAResultOrError").makeError("reply_xma_media_type_unknown");var c=q(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;return d("WAResultOrError").makeResult({replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash,replyXMAId:b.xmaId})});return a.then(function(a){if(a.success!==!0){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""])),b.xmaId,a.error);return}return a.value})}function a(a,b,e){var f,g;e===void 0&&(e=!1);f=((f=b.quote)==null?void 0:f.content)||{};var h=f.author,i=f.externalId,j=f.mediaId,k=f.msgId,l=f.plaintextHash,m=f.type;f=f.xmaMessageType;if(((g=b.quote)==null?void 0:g.content)==null||!r((g=b.quote)==null?void 0:g.content))return d("MAWDexieTable").dexieResolve();g=b.threadJid;b=h===d("MAWUserJidWrapper").getMyUserJid();b=b?d("WAJids").AUTHOR_ME:h;if(c("gkx")("9921")?m===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(f))return u(a,d("MAWJidUtils").maybeToProtocolMsgId(b,g,i));return m===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?w(a,k):s(a,j,e?null:l)}function u(a,b){return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null||d("MAWXMAUtils").isXMAExpired(b.isTombstoned,b.targetExpiringAtSec))return;return t(a,b)})}function b(a,b){var e=b.author,f=b.externalId,g=b.mediaId,h=b.plaintextHash,i=b.threadJid,j=b.type,k=b.xmaMessageType;k=c("gkx")("9921")?j===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(k);j=j===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH;if(!d("MAWDbMsg").isMediaMsg(b)&&!k&&!j)return d("MAWDexieTable").dexieResolve();if(k)return u(a,d("MAWJidUtils").maybeToProtocolMsgId(e,i,f));return j?v(a,b.receiverFetchId):s(a,g,h)}function v(a,b,c){if(b==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchId for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return d("MAWDexieTable").dexieResolve()}return a.receiverFetchInfo.get({receiverFetchId:b}).then(function(a){if(a==null){d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchInfo for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return}try{var b=d("MAWDbMedia").convertNumberToMediaId(parseInt(a.receiverFetchId,10));c!=null&&d("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(c.threadJid,c.msgId,c.sortOrderMs,c.ts,a)});return{replyMediaId:b,replyMediaPreviewHeight:a.previewHeight,replyMediaPreviewWidth:a.previewWidth}}catch(a){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Unable to convert receiver fetch id to media id: ",""])),a);return}})}function w(a,b){if(b==null){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing msgId for getReplyMediaForReceiverFetch"])));return d("MAWDexieTable").dexieResolve()}return a.messages.get({msgId:b}).then(function(b){if(b==null||b.type!==d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH||b.receiverFetchId==null){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Invalid msg for getReplyMediaForReceiverFetch with type: ",""])),b==null?void 0:b.type);return}return v(a,b.receiverFetchId,b)})}g.getMedia=o;g.MSG_MEDIA_TYPE=p;g.getImageAttributes=q;g.isMediaReplyContent=r;g.getReplyMediaForMsgQuote=a;g.getReplyMediaForMsg=b}),98);
__d("MAWDbChunkTxns",["MAWDexieTable","MAWMediaUtils","MAWODSProxy","MWFBLogger","WAErrorMessage","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("MWFBLogger").MWLogger.tags(["maw_db","txn","MAWDbChunkTxns"]);b=function(a,b,c,e,f){f===void 0&&(f=0);var g=d("MAWMediaUtils").genHMACPlaintextHash(b);return m(a,b,g,c,e,f)};var m=function(a,b,c,e,f,g){g===void 0&&(g=0);return a.chunk.where("hashedPlaintextHash").equals(c).first().then(function(n){if(n){g>0&&l.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""])),c);return n}else{var o={blobData:e,hashedPlaintextHash:c,mimetype:f,plaintextHash:b};return a.chunk.add(o).then(function(a){return babelHelpers["extends"]({},o,{chunkId:a})})["catch"](function(h){var n=d("WAErrorMessage").maybeGetMessageFromError(h);if(g>0){l.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""])),c,n);l.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""])),n);throw h}else{l.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""])),c,n);d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_MEDIA_DB_DUPLICATE_CHUNK,key:"retry"});return m(a,b,c,e,f,g+1)}})}})},n=function(a,b){return a.chunk.where("hashedPlaintextHash").equals(b)},o=function(a,b){return n(a,b).count().then(function(a){return a>0})};c=function(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return o(a,b).then(function(a){return[b,a]})})).then(function(a){return new Map(a)})};e=function(a,b){return n(a,b).first()};f=function(a,b){return a.chunk.where("hashedPlaintextHash").anyOf(b).toArray().then(function(a){return new Map(a.map(function(a){return[a.hashedPlaintextHash,a]}))})};function a(a,b){return a.chunk.bulkGet(b)}var p=function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.get({hashedPlaintextHash:b})};g.getOrCreateMediaChunkWithPlaintextHash=b;g.getOrCreateMediaChunkWithHashedPlaintextHash=m;g.hasMediaChunk=o;g.hasMediaChunks=c;g.maybeGetChunkFromHash=e;g.maybeBulkGetChunksFromHash=f;g.bulkGetChunks=a;g.maybeGetChunkByPlaintextHash=p}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","MAWODSProxy","WAHashUtils","WALogger","WAOdsEnums","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.media.get({mediaId:b})}function b(a,b){return b.length===0?d("MAWDexieTable").dexieResolve(new Map()):a.media.bulkGet(b).then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.mediaId,a]}))})}function l(a,b){return a.media.where("hashedPlaintextHash").equals(b).first()}function e(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return l(a,b)}function f(a,b){b=b.map(function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)});return m(a,b)}function m(a,b){return a.media.where("hashedPlaintextHash").anyOf(b).toArray()}function n(a,b){return b==null?d("MAWDexieTable").dexieResolve():o(a,b).then(function(c){c=c==null?void 0:c.mediaId;return c!=null?a.media.get({mediaId:c}):a.media.get({objectId:b})})}function o(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.mediaBackup.get({objectId:b})}function p(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();a=a.mediaBackup.where("msgId").equals(b).toArray();return a}function q(a,b){b=b.filter(d("MAWDbMsg").isMediaMsg);if(b.length===0)return d("MAWDexieTable").dexieResolve([]);d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] msgs: ",""])),b.map(function(a){return""+a.msgId}));var e=b.reduce(function(a,b){if(b.mediaId==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: "," and msg type ",""])),b.msgId,b.type);return a}return a.set(b.mediaId,b)},new Map());b=Array.from(e.keys());return t(a,b).then(function(a){var b=[];a.forEach(function(a){if(a==null)throw c("err")("Error missing media");var f=e.get(a.mediaId);if(f==null)throw c("err")("Error missing media");var g=d("MAWMediaUtils").genHMACPlaintextHash(a.plaintextHash);g!==a.hashedPlaintextHash&&(d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] encountered mismatched hashedPlaintextHash for media. PlaintextHash: ",""])),d("WAHashUtils").sanitisePlaintextHash(a.plaintextHash)),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MEDIA_MISMATCH_HASHED_PLAINTEXT_HASH,key:"mismatch."+f.type}));b.push([f,a])});return b})}function r(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg).map(function(a){var b=a.mediaId;if(b==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""])),a.msgId);throw c("err")("mediaId is missing")}else return b});return t(a,b).then(function(a){var b=[];a.forEach(function(a){a!=null&&b.push(a)});return b})}function s(a,b){if(b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||d("MAWDbMsg").isMediaMsg(b)){var c=b.mediaId;return c==null?b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing")):a.media.get(c).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}else return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult())}function t(a,b){return a.media.bulkGet(b)}function u(a,b){var c=b.previewMediaIds!=null?t(a,b.previewMediaIds):d("MAWDexieTable").dexieResolve(),e=b.headerMediaId!=null?a.media.get(b.headerMediaId):d("MAWDexieTable").dexieResolve(),f=b.faviconMediaId!=null?a.media.get(b.faviconMediaId):d("MAWDexieTable").dexieResolve();a=b.defaultPreviewMediaId!=null?a.media.get(b.defaultPreviewMediaId):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,e,f,a]).then(function(a){var c=a[0],e=a[1],f=a[2];a=a[3];if(b.headerMediaId!=null&&e==null)return d("WAResultOrError").makeError("missing");if(b.faviconMediaId!=null&&f==null)return d("WAResultOrError").makeError("missing");if(c==null)return d("WAResultOrError").makeError("missing");var g=[];for(c of c)if(c==null)return d("WAResultOrError").makeError("missing");else g.push(c);return d("WAResultOrError").makeResult({defaultPreview:a,favicon:f,header:e,previews:g})})}function v(a,b,c){b=babelHelpers["extends"]({},b,c);return a.media.put(b)}g.maybeGetMediaFromMediaId=a;g.maybeBulkGetMediaFromMediaId=b;g.maybeGetMediaFromHashedPlaintextHash=l;g.maybeGetMediaFromPlaintextHash=e;g.maybeBulkGetMediaFromPlaintextHash=f;g.maybeBulkGetMediaFromHashedPlaintextHash=m;g.maybeGetMediaFromObjectId=n;g.maybeGetMediaBackupRowFromObjectId=o;g.maybeGetMediaBackupRowFromMsgId=p;g.getMsgMediaPairFromMsgs=q;g.getMediaFromMsgs=r;g.getAndCheckMediaFromMsg=s;g.bulkGetMedias=t;g.getMediaForXMA=u;g.updateMedia=v}),98);
__d("WAMsgMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this;this.$1=new Map();a==null||a.forEach(function(a){var c=a[0];a=a[1];b.set(c,a)})}var b=a.prototype;b.clear=function(){this.$1.clear()};b["delete"]=function(a){var b;(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null||b["delete"](a.chat)};b.get=function(a){var b;return(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null?void 0:b.get(a.chat)};b.has=function(a){var b;return(b=(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null?void 0:b.has(a.chat))!=null?b:!1};b.set=function(a,b){var c,d;c=(c=this.$1.get(a.externalId))!=null?c:new Map();this.$1.has(a.externalId)||this.$1.set(a.externalId,c);d=(d=c.get(a.author))!=null?d:new Map();c.has(a.author)||c.set(a.author,d);d.set(a.chat,b);return this};b.keys=function(){var a=[],b=this.$1;for(var c of b.keys()){var d;d=(d=b.get(c))!=null?d:new Map();for(var e of d.keys()){var f;f=(f=d.get(e))!=null?f:new Map();for(f of f.keys())a.push({externalId:c,author:e,chat:f})}}return a};b.entries=function(){var a=[],b=this.$1;for(var c of b.keys()){var d;d=(d=b.get(c))!=null?d:new Map();for(var e of d.keys()){var f;f=(f=d.get(e))!=null?f:new Map();for(var g of f.keys()){var h=f.get(g);h!=null&&a.push([{externalId:c,author:e,chat:g},h])}}}return a};b.values=function(){return this.entries().map(function(a){return a[1]})};return a}();f.MsgMap=a}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return a.reduce(function(a,b){var c=b.threadJid;if(c==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"])));return a}if(b.author==="@system"){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"])));return a}a.set({author:b.author,chat:c,externalId:b.externalId},b);return a},new(d("WAMsgMap").MsgMap)())}function b(a){return d("WAJids").isAuthorSystem(a.author)||a.threadJid==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}g.convertMsgArrayToMap=a;g.getProtocolMsgIdFromDbMsg=b}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_unrendered_msg"):k(a,f,e,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_unrendered_msg"):d("WAResultOrError").makeResult(a)})})}function b(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.unrenderedMessages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function k(a,b,c,d){return a.unrenderedMessages.where("externalId").equals(b).filter(function(a){return a.author===d&&a.threadJid===c}).first()}function l(a,b){return a+"_"+b}function c(a,b){var c=b.map(function(a){a=a.externalId;return a}),e=Array.from(new Set(b.map(function(a){return a.chat})));return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.unrenderedMessages.where("externalId").anyOf(c).toArray()]).then(function(a){var c=a[0];a=a[1];if(a.length===0||c.length===0)return[];var d=new Map();b.forEach(function(a){var b=a.author,c=a.chat;a=a.externalId;var e=d.get(a)||new Set();e.add(l(b,c));d.set(a,e)});return a.filter(function(a){var b=a.author,c=a.externalId;a=a.threadJid;c=d.get(c);return c!=null&&a!=null&&c.has(l(b,a))})})}function e(a,b,c){return m(a,[{ack:c,msgId:b}]).then(function(a){a=a[0];if(a==null){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"])));return null}return a})}function m(a,b){var c=b.map(function(a){return a.msgId}),e=new Map();b.forEach(function(a){return e.set(a.msgId,{ack:a.ack})});return a.unrenderedMessages.where("msgId").anyOf(c).toArray().then(function(b){if(b.length===0)return b;var c=[],f=[];b.forEach(function(a){var b;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"])));c.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"])));c.push(a);return}b=(b=e.get(a.msgId))==null?void 0:b.ack;if(b==null)return null;a=babelHelpers["extends"]({},a,{ack:b});b===d("MAWAckLevel").ACK.sent&&delete a.resendCount;f.push(a)});return a.unrenderedMessages.bulkPut(f).then(function(){return[].concat(f,c)})})}function f(a,b){b=b.map(function(b){return a.unrenderedMessages.get({msgId:b})});return d("MAWDexieTable").dexieAll(b)}function n(a,b){return a.unrenderedMessages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetUnrenderedMsgByProtocolMsgId=a;g.getUnrenderedMsgMapByProtocolMsgId=b;g.maybeGetUnrenderedMsgByExternalId=k;g.getUnrenderedMsgsByProtocolMsgId=c;g.updateSystemAckForUnrenderedMsg=e;g.bulkUpdateSystemAckForUnrenderedMsgs=m;g.getUnrenderedMsgsByMsgIds=f;g.getNextUnrenderedMsgIdNumberForThread=n}),98);
__d("MAWMessageSortOrderUtils",["I64","MAWDbMsg","MAWExtractMsFromExternalId","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function a(a){var b=a.revokedExternalId!=null?a.revokedExternalId:a.externalId;b==null&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["generateAuthoritativeMessageSortOrder called without ID"])));b=(l||(l=d("I64"))).of_string_opt(b);if(a.serverTs==null){var c;if(a.sortOrderMs!=null)return a.sortOrderMs;b==null&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] ExternalId is not present"])));var e=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return Math.floor((c=a.originalTs)!=null?c:d("MAWDbMsg").getCanonicalTsFromMsg(a))*1e3+(e!=null?e:0)}if(b!=null){c=d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);if(c!=null){e=a.originalTs!=null?a.originalTs:a.serverTs;return Number(e)*1e3+c}else d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Timestamp bits in externalId not valid"])))}else d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] externalId is not a valid int64"])));return d("MAWDbMsg").getSortOrderWithFallback(a)}g.generateAuthoritativeMessageSortOrder=a}),98);
__d("WAArrayGroupBy",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=new Map();for(var d=0;d<a.length;d++){var e=b(a[d]),f=c.get(e);f==null?c.set(e,[a[d]]):f.push(a[d])}return Array.from(c.entries())}f.groupBy=a}),66);
__d("MAWDbMsgTxns",["EncryptedBackupsUtils","FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMessageSortOrderUtils","MAWMsgType","MAWODSProxy","MAWTransactionMode","MAWTransactor","Random","WAArrayGroupBy","WAJids","WALogger","WAMsg","WAMsgMap","WAOdsEnums","WAResultOrError","WATimeUtils","emptyFunction","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q;function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.messages.get({msgId:b})}function b(a,b){return a.messages.where("threadJid").equals(b).count().then(function(a){return a===0})}function e(a,b,c){return a.messages.where("threadJid").equals(b).filter(c).first().then(function(a){return a!=null})}function r(a,b,c,d){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],c,d)}function s(a,b){return r(a,b,!1,!1).last()}function f(a,b){return s(a,b).then(function(a){return a==null?void 0:a.msgId})}function t(a,b){return s(a,b).then(function(a){return(a==null?void 0:a.sortOrderMs)==null?null:d("WATimeUtils").castToMillisTime(a.sortOrderMs)})}function u(a,b,c){return r(a,b,!1,!1).reverse().limit(c).toArray()}function v(a,b){return r(a,b,!1,!1).first()}function w(a,b){return v(a,b).then(function(a){return a==null?void 0:a.msgId})}function x(a,b){return a.messages.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(z)}function y(a,b){var c=new Set(b.map(function(a){var b=a.author,c=a.chat;a=a.externalId;return d("WAMsg").craftWAMsgIdString({author:b,chat:c,externalId:a})}));return a.messages.where("externalId").anyOf(b.map(function(a){a=a.externalId;return a})).filter(function(a){var b=a.author,e=a.externalId;a=a.threadJid;return c.has(d("WAMsg").craftWAMsgIdString({author:b,chat:a,externalId:e}))}).toArray().then(function(a){return d("WAArrayGroupBy").groupBy(a,function(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}).map(function(a){a[0];a=a[1];return z(a)}).filter(Boolean)})}function z(a){if(a.length>1){var b=a.map(function(a){var b;return a.type+":"+((b=a.serverTs)!=null?b:0).toString()+":"+((b=a.ts)!=null?b:0).toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"])),a.length):d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"])));(c("gkx")("5039")||d("Random").coinflip(c("justknobx")._("3594")))&&A(a)}return a[0]}function A(a){var b=a.length;if(b<=1)return;var e=b-1,f=a[e],g={editCount:0,mediaId:0,revokedStatus:0,serverTs:0,sortOrderMs:0,ts:0,type:0};a.slice(0,e).forEach(function(a){var b=[];if((a==null?void 0:a.editCount)!==(f==null?void 0:f.editCount)){var e;g.editCount++;b.push("editCount, reference: "+((e=f==null?void 0:f.editCount)!=null?e:"")+", duplicate: "+((e=a==null?void 0:a.editCount)!=null?e:"")+". ")}(a==null?void 0:a.mediaId)!==(f==null?void 0:f.mediaId)&&(g.mediaId++,b.push("mediaId, reference: "+((f==null?void 0:f.mediaId)!=null?String(f.mediaId):"")+", duplicate: "+((a==null?void 0:a.mediaId)!=null?String(a.mediaId):"")+". "));a.sortOrderMs!==f.sortOrderMs&&(g.sortOrderMs++,b.push("sortOrderMs, reference: "+String(f.sortOrderMs)+", duplicate: "+String(a.sortOrderMs)+". "));a.serverTs!==f.serverTs&&(g.serverTs++,b.push("serverTs, reference: "+String(f.serverTs)+", duplicate: "+String(a.serverTs)+". "));a.ts!==f.ts&&(g.ts++,b.push("ts, reference: "+String(f.ts)+", duplicate: "+String(a.ts)+". "));if(a.type!==f.type){(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||f.type===d("MAWMsgType").MSG_TYPE.REVOKED)&&(g.revokedStatus++,c("FBLogger")("MAWDuplicateMessageComparison").info("Revoked duplicate msg conflict, duplicate message, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s, reference msg, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s",a.msgId,a.type,a.externalId,a.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId,f.msgId,f.type,f.externalId,f.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId));g.type++;b.push("type, reference: "+((e=f.type)!=null?e:"")+", duplicate: "+((e=a.type)!=null?e:"")+". ")}e=b.join("");e.length>0?c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has conflicting field values to reference msg, %s: %s",a.msgId,f.msgId,e):c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has no conflicting field values to reference msg, %s",a.msgId,f.msgId)});d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs_with_"+a+"_field_differences"})});d("MAWODSProxy").odsBumpEntityKey({amount:b-1,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs_with_"+a+"_field_differences"})})}function B(a,b,c,d){d={author:d,chat:c,externalId:b};return x(a,d)}function C(a,b){return a.messages.where("msgId").equals(b).toArray()}function D(a,b){return G(a,b).then(function(a){return a.success?a:a})}function E(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.messages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function F(a,b){return a.messages.where("msgId").equals(b).first().then(function(a){return a==null?void 0:a.sortOrderMs})}function G(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_msg"):B(a,f,b.jid,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_msg"):d("WAResultOrError").makeResult(a)})})}function H(a,b){var c=b.author,d=b.chat,e=b.externalId;return a.threads.get({jid:d}).then(function(b){if(b==null)return;return a.messages.where("revokedExternalId").equals(e).filter(function(a){return a.author===c&&a.threadJid===b.jid&&a.type==="Revoked"}).first()})}function I(a,b,c,e){var f=a.messages.where("revokedExternalId").equals(b).filter(function(a){return a.author===e&&a.threadJid===c&&a.type===d("MAWMsgType").MSG_TYPE.REVOKED}).first();a=d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(a,b,c,e).then(function(a){if((a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return a});return d("MAWDexieTable").dexieAll([f,a]).then(function(a){var b=a[0];a=a[1];return b!=null||a!=null})}function J(a,b){var c=new Array(b.length),e=new Set();b.forEach(function(a){c.push(a.externalId),e.add(d("EncryptedBackupsUtils").convertWAMsgIdToStringId(a))});return a.messages.where("externalId").anyOf(c).filter(function(a){return e.has(d("EncryptedBackupsUtils").convertWAMsgIdToStringId({author:a.author,chat:a.threadJid,externalId:a.externalId}))}).toArray()}function K(a,b,c,e,f,g){return L(a,[{ack:c,applicationErrorCode:g,msgId:b,reportingMeta:f,serverTs:e}]).then(function(a){a=a.find(function(a){return a.msgId===b});if(a==null){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"])));return null}return a})}function L(a,b){var c=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,c).then(function(e){var f=new Map();b.forEach(function(a){f.set(a.msgId,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs});var b=e.get(a.msgId);b!=null&&f.set(b,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs})});var g=Array.from(new Set(c.concat(Array.from(e.values()))));return a.messages.where("msgId").anyOf(g).toArray().then(function(b){if(b.length===0)return b;var c=[],e=[];b.forEach(function(a){var b,g;if(a.author!==d("WAJids").AUTHOR_ME||a.ack>d("MAWAckLevel").ACK.clock){c.push(a);return}b=(b=f.get(a.msgId))==null?void 0:b.ack;g=(g=f.get(a.msgId))==null?void 0:g.serverTs;if(b==null)return null;var h=babelHelpers["extends"]({},a,{ack:b});M(h,g);a=(g=f.get(a.msgId))==null?void 0:g.reportingMeta;a!=null&&(h.reportingMeta=a);b===d("MAWAckLevel").ACK.sent&&delete h.resendCount;e.push(h)});c.length>0&&d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck: not updating ",""])),c.map(function(a){return a.msgId}).toString());return a.messages.bulkPut(e).then(function(){return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)}))}).then(function(a){e.forEach(function(b,c){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,a[c])})});return[].concat(e,c)})})})}function M(a,b){if(b==null)return;a.serverTs=b;var e=a.sortOrderMs;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED&&c("justknobx")._("3841"))return;a.sortOrderMs=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(a);d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Message was acked by server (serverTs = ","), override sortOrderMs: "," -> ",""])),b,e,a.sortOrderMs)}function N(a,b,e,f){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success||f==null)return;var g=b.value;b=[a.messages.where(["threadJid","sortOrderMs"]).above([g.jid,f]).first(),a.messages.where(["threadJid","sortOrderMs"]).below([g.jid,f]).last()];return d("MAWDexieTable").dexieAll(b).then(function(b){var f=b[0];b=b[1];return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},g,{newestMsgTs:(b==null?void 0:b.ts)==null?g.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts),oldestMsg:g.oldestMsg===e?f==null?void 0:f.msgId:g.oldestMsg})).then(c("emptyFunction"))})})}function O(a){return a.messages.where("altIndex").equals(d("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(a){var b=[];a.forEach(function(a){if(a.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""])),a.msgId,a.type);return}b.push(a)});return b})}function P(a){return a.toString()}function Q(a,b,e,f){var g=b.mediaId;if(g===e){d("WALogger").LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),b.msgId,e);return d("MAWDexieTable").dexieResolve()}g=g!=null?a.media.get(g):d("MAWDexieTable").dexieResolve();return g.then(function(g){g&&d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""])),b.type);g=f!=null?f:void 0;g=babelHelpers["extends"]({},b,{mediaId:e,plaintextHash:g});return a.messages.put(g).then(c("emptyFunction"))})}function R(a,b){var e=Array.from(b.keys());return a.messages.where("msgId").anyOf(e).toArray().then(function(e){var f=[];e.map(function(a){var e=b.get(a.msgId),g=a.mediaId;if(g!=null&&g!==e){if(e!=null)throw c("FBLogger")("messenger_web").mustfixThrow("mediaId "+P(g)+" in message "+a.msgId+" is different with the "+P(e)+" in bulkUpdateMediaId");d("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),a.msgId,e);return}g=babelHelpers["extends"]({},a,{mediaId:e,plaintextHash:a.plaintextHash});f.push(g)});return a.messages.bulkPut(f).then(c("emptyFunction"))})}function S(a,b){return T(a,[b]).then(c("emptyFunction"))}function T(a,b){return a.messages.where("msgId").anyOf(b).toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{isExpiredXmaMsg:!0})});return a.messages.bulkPut(c).then(function(){return c})})}function U(a,b,c,e){if(e!=null&&e<=0)return d("MAWDexieTable").dexieResolve([]);a=a.messages.where("altIndex").equals(d("MAWDbMsg").craftToBeReadAltIndex(b)).filter(function(a){return d("MAWDbMsg").getSortOrderWithFallback(a)<=c});e!=null&&(a=a.limit(e));return a.toArray()}function V(a,b,c){return U(a,b,c).then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({altIndex:null},a)});return a.messages.bulkPut(c).then(function(){return c})})}function W(a,b){return a.messages["delete"](b)}function X(a,b){return a.messages.bulkDelete(b)}function Y(a,b,c){var e=b.map(function(a){return a.rowId});b=c!=null?b.map(function(a){a=d("MAWJidUtils").toProtocolMsgId(a);if(!a)return;return babelHelpers["extends"]({},a,{reason:c})}).filter(Boolean):[];return d("MAWDexieTable").dexieAll([a.deletedMessages.bulkAdd(b),a.messages.bulkDelete(e)]).then(function(a){a[0];a=a[1];d("WALogger").LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"])),a)})}function Z(a,b){return a.messages.where("msgId").anyOf(b).toArray()}function aa(a){return a.messages.where("altIndex").anyOf([d("MAWDbMsg").SPAM_ALT_INDEX,d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function ba(a,b,c,e,f,g,h,i){h===void 0&&(h="before");i===void 0&&(i=null);c=c==null?null:d("MAWDbMsg").getSortOrderWithFallback(c);if(h==="before")return a.messages.where(["threadJid","sortOrderMs"]).between([b,i!=null?i:Number.MIN_SAFE_INTEGER],[b,c!=null?c:Number.MAX_SAFE_INTEGER],!0,e).reverse().filter(g).limit(f).toArray();else return a.messages.where(["threadJid","sortOrderMs"]).between([b,c!=null?c:Number.MIN_SAFE_INTEGER],[b,i!=null?i:Number.MAX_SAFE_INTEGER],e,!0).filter(g).limit(f).toArray().then(function(a){return a.sort(function(a,b){return b.ts-a.ts})})}function ca(a,b,c,d){var e=c.msgId;if(d==null){var f;return{oldestMsg:(f=a==null?void 0:a.msgId)!=null?f:e}}f=[a,b,c].filter(Boolean);return{oldestMsg:f.reduce(function(a,b){return $(a,e,d)<$(b,e,d)?a:b}).msgId}}function $(a,b,c){return a.msgId===b?c:d("MAWDbMsg").getSortOrderWithFallback(a)}function da(a,b){return a.messages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}function ea(a){return d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"checkMessagesExistenceByProtocolMsgIds",function(b){return function(){return d("MAWDexieTable").dexieAll(a.map(function(a){return b.messages.get({protocolMsgId:a.chat+"."+a.externalId})}))}})()}function fa(a,b){return a.messages.where("externalId").anyOf(b).toArray()}g.maybeGetMsg=a;g.getIsThreadEmpty=b;g.doesThreadHaveMsgsMatchCriteria=e;g.getThreadMessagesBySortOrder=r;g.getThreadNewestMessageBySortOrder=s;g.getThreadNewestMessageId=f;g.getThreadNewestMessageMs=t;g.getThreadNewestNumMessagesBySortOrder=u;g.getThreadOldestMessageBySortOrder=v;g.getThreadOldestMessageId=w;g.maybeGetMsgByProtocolMsgId=x;g.getUniqueMsgsByProtocolMsgIds=y;g.maybeGetMsgByExternalId=B;g.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=C;g.maybeGetMsgResultByProtocolMsgId=D;g.getMsgMapByProtocolMsgId=E;g.getSortOrderFromMsgId=F;g.maybeGetRevokedMsgByProtocolMsgId=H;g.checkIfMsgIsDeletedForMeOrRevoked=I;g.getMsgsByProtocolMsgId=J;g.updateSystemAck=K;g.bulkUpdateSystemAck=L;g.maybeUpdateThreadMsgsForDeleteForMe=N;g.getFutureProofMsgs=O;g.updateMediaId=Q;g.bulkUpdateMediaId=R;g.updateDbMsgXMAExpiration=S;g.bulkUpdateDbMsgXMAExpired=T;g.getMsgsNeedingRetroactiveReadReceiptsUpTo=U;g.clearRetroactiveReadReceiptStatusFromMsgsUpTo=V;g.deleteDbMsg=W;g.bulkDeleteDbMsg=X;g.deleteMessages=Y;g.getMsgsByMsgIds=Z;g.getSpamMsgs=aa;g.fetchMessagesFromDbWithSortOrderMs=ba;g.calculateOldestMsg=ca;g.getNextMsgIdNumberForThread=da;g.checkMessagesExistenceByProtocolMsgIds=ea;g.UNSAFE_getMultipleMsgsByExternalId=fa}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable","MAWTransactionMode","MAWTransactor","MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(a){return a==null?void 0:a.value.msgTypeVersion})}function b(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function e(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function f(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:b}})}function i(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(a){return a==null?void 0:a.value.hmacKey})}function j(a,b){return a.appMeta.get({key:b})}function k(a,b){d("MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor").setCachedShouldSaveSecurityAlert(b);return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:b}}).then(c("emptyFunction"))}function l(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:b}}).then(c("emptyFunction"))}function m(){return d("MAWTransactor").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY},"handleInstructions",function(a){return function(){return n(a)}})()}function n(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1})}function o(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlertForSelf)!=null?a:!0})}function p(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:b}})}function q(a){return d("MAWDexieTable").dexieAll([o(a),n(a)]).then(function(a){var b=a[0];a=a[1];return{allowSecurityAlertForContact:a,allowSecurityAlertForSelf:b}})}g.MSG_TYPE_VERSION=(h=d("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion;g.ALLOW_SECURITY_ALERT_FOR_CONTACT=h.AppMetaKeysEnum.allowSecurityAlert;g.ALLOW_SECURITY_ALERT_FOR_SELF=h.AppMetaKeysEnum.allowSecurityAlertForSelf;g.HOT_LIKE=h.AppMetaKeysEnum.hotlikeSticker;g.getMsgTypeVersion=a;g.addMsgTypeVersion=b;g.updateMsgTypeVersion=e;g.addHMACKey=f;g.getHMACKey=i;g.getAppMetaValue=j;g.updateSecurityAlertValueForContact=k;g.updateSecurityAlertValueForSelf=l;g.getSecuritySettingForContactTxn=m;g.getSecuritySettingForContact=n;g.getSecuritySettingForSelf=o;g.addHotLike=p;g.maybeBulkGetSecuritySetting=q}),98);
__d("MAWDbReactionsTxns",["FBLogger","MAWAuthor","MAWBridgeTypesCreators","MAWDbMsg","MAWDexieTable","MAWIndexedDb","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=function(a){return a};function a(a,b){return a.reactions.put(k(b))}function b(a,b){return a.reactions["delete"](b.rowId).then(function(){var a=b.author,c=b.reactionId,e=b.reactToMsgId,f=b.threadJid;if(e==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:a,chatJid:f,reactToMsgId:e})});d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted reaction with id : ","."])),c)})}function e(a,b){var c=d("MAWAuthor").getAuthorUserJid(b.author);return a.reactions.where("reactToExternalId").equals(b.externalId).filter(function(a){return(a.reactToAuthor===c||a.reactToAuthor===b.author)&&a.threadJid===b.chat}).toArray()}function l(a,b){var d=b.reduce(function(a,b){a.set(b.msgId,b);return a},new Map());return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId})).toArray().then(function(a){var b=a.filter(function(a){var b=a.reactToExternalId;a=a.reactToMsgId;return a!=null&&b===((b=d.get(a))==null?void 0:b.externalId)});b.length<a.length&&c("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return b})}function f(a,b){return a.reactions.where("reactToMsgId").equals(b.msgId).toArray().then(function(a){var d=a.filter(function(a){a=a.reactToExternalId;return a===b.externalId});d.length<a.length&&c("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return d})}function m(a,b){return l(a,[b])}function n(a,b){var c=b.author,d=b.chat;b=b.externalId;return a.reactions.where("externalId").equals(b).filter(function(a){return a.author===c&&a.threadJid===d}).first()}function o(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.author;b=b.externalId;var e=d("MAWAuthor").getAuthorUserJid(c);return a.reactions.where("reactToExternalId").equals(b).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===e}).toArray()})).then(function(b){b=b.flat();b.forEach(function(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})});if(b.length===0)return;d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."])),b.length);return a.reactions.bulkDelete(b.map(function(a){return a.rowId}))})}function p(a,b){return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId}))["delete"]().then(function(a){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"])),a)})}function q(a,b){return a.reactions.where("reactionId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.reactionId);return a+1})}function r(a,b,c,e,f,g,h){e=(e=e==null?void 0:e.ts)!=null?e:d("WATimeUtils").unixTime();return a.reactions.where(["threadJid","ts"]).between([b,(a=d("WATimeUtils").castMillisTimeToUnixTime(c))!=null?a:d("WATimeUtils").castToUnixTime(0)],[b,e],!0,f).reverse().filter(h).limit(g).toArray()}g.coerceToReaction=k;g.putReaction=a;g.deleteReaction=b;g.getReactionForEcho=e;g.getReactionsFromMessages=l;g.getReactionsForMessage=f;g.getReactionsFromMessage=m;g.maybeGetReactionByProtocolMsgId=n;g.deleteReactionsByUniqueMsgIdentifiers=o;g.deleteAllReactionsForMessages=p;g.getNextReactionIdNumberForThread=q;g.fetchReactionsFromDbWithTimestamp=r}),98);
__d("MaybeCreateOrUpdateThreadResultCache",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a){g["delete"](a)}f.cache__I_KNOW_WHAT_I_AM_DOING=g;f.deleteCachedThreadResult=a}),66);
__d("MAWDbThreadTxns",["MAWAuthoritativeThreadsCache","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MaybeCreateOrUpdateThreadResultCache","WAArrayZip","WALogger","WAResultOrError","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){return a.threads.get({deduplicationKey:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function k(a,b){return a.threads.get({jid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function l(a,b){return a.threads.where("jid").anyOf(b).toArray()}function b(a,b){return a.threads.where("jid").startsWith(b+"@").first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function m(a){d("MaybeCreateOrUpdateThreadResultCache").deleteCachedThreadResult(a),d("MAWAuthoritativeThreadsCache").AuthoritativeThreadsCache["delete"](a)}function e(a,b){return a.threads.where("jid").equals(b)["delete"]().then(function(){return m(b)})}function f(a,b){return a.participants.where("userJid").equals(b).toArray().then(function(b){b=b.map(function(a){return a.threadJid});return l(a,b)})}function n(a,b){return a.participants.where("userJid").anyOf(b).toArray().then(function(b){var c=new Map(),d=new Set();b.forEach(function(a){var b,e=a.userJid;b=(b=c.get(e))!=null?b:[];b.push(a.threadJid);c.set(e,b);d.add(a.threadJid)});return l(a,Array.from(d)).then(function(a){var b=a.reduce(function(a,b){a.set(b.jid,b);return a},new Map());return new Map(Array.from(c.entries()).map(function(a){var c=a[0];a=a[1];return[c,a.map(function(a){return b.get(a)}).filter(Boolean)]}))})})}function o(a,b,c){return(b==null?void 0:b.lastReadMsgReceiptSent)==null?d("MAWDexieTable").dexieResolve(!1):d("MAWDbMsgTxns").getSortOrderFromMsgId(a,b.lastReadMsgReceiptSent).then(function(a){return c.sortOrderMs==null||a==null?!1:c.sortOrderMs<=a})}function p(a,b){return a.threads.get({jid:b.threadJid}).then(function(c){return o(a,c,b)})}function q(a,b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){return d("MAWDexieTable").dexieAll(d("WAArrayZip").zip(b,c).map(function(b){var c=b[0];b=b[1];return o(a,b,c)}))})}function r(a,b,c){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var e=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!0,cannotReplyReason:c?"viewer_not_subscribed":a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return a.threads.bulkPut(e).then(function(){e.forEach(function(a){c&&d("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadJid:a.jid})})})})})}function s(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:null})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){a={cannotReplyReason:null,threadJid:a.jid};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(a)})})})})}function t(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!1,cannotReplyReason:a.cannotReplyReason==="viewer_not_subscribed"?a.cannotReplyReason:null,folder:d("MAWFolderTypes").FOLDER_ID.INBOX})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:a.jid})})})})})}function u(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:"viewer_not_subscribed"})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){var b={cannotReplyReason:"viewer_not_subscribed",threadJid:a.jid};d("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(b)})})})})}function v(a,b){return k(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"])));return}b=b.value;if(b.isMigratedLocally===!0){d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"])));return}b=babelHelpers["extends"]({},b,{isMigratedLocally:!0});return a.threads.put(b).then(c("emptyFunction"))})}function w(a,b){if(b.isMigratedLocally===!1){d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"])));return d("MAWDexieTable").dexieResolve(b)}var c=babelHelpers["extends"]({},b,{isMigratedLocally:!1});return a.threads.put(c).then(function(){return c})}function x(a,b){return a.threads.put(b).then(c("emptyFunction"))}function y(a,b,c,e,f){return x(a,babelHelpers["extends"]({},b,{newestMsgTs:(f==null?void 0:f.ts)==null?b.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(f.ts),oldestMsg:e==null?void 0:e.msgId}))}g.getThreadByDeduplicationKey=a;g.getThread=k;g.getThreads=l;g.getThreadPrimaryId=b;g.deleteThread=e;g.getAllThreadsForUser=f;g.getAllThreadsForUsers=n;g.needsRetroactiveReadReceiptInThread=p;g.bulkNeedsRetroactiveReadReceiptInThread=q;g.archiveThreads=r;g.subscribeToThreads=s;g.unarchiveThreads=t;g.unsubscribeFromThreads=u;g.markCutoverThreadAsMigratedLocally=v;g.markCutoverThreadAsNotMigratedLocally=w;g.updateThread=x;g.updateThreadMsgsForUndefinedOldestOrNewestMsgs=y}),98);
__d("MAWDbXMATxns",["MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.xma.bulkGet(b)}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.get({xmaId:b})}function h(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("associatedMessageId").equals(b).first()}function i(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function e(a,b){return i(a,b).then(function(b){return b==null?d("WAResultOrError").makeError("missing"):d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function f(a,b){return h(a,b).then(function(b){if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsg(a,b.msgId)})}function j(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isXMAMsg).map(function(a){return d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId)}).filter(Boolean);b=b.map(function(b){return i(a,b)});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.filter(Boolean)})}function k(a,b){return a.xma.where("associatedMessageId").anyOf(b).toArray().then(function(a){a=a.filter(function(a){return a.msgId!=null&&c("gkx")("9841")?a.targetType!=null:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.targetType)});return a.reduce(function(a,b){return b.associatedMessageId!=null&&b.msgId!=null?a.set(b.associatedMessageId,b.msgId):a},new Map())})}function l(a,b){return a.xma.where("associatedMessageId").equals(b).first()}function m(a,b){return a.xma.where("associatedMessageId").equals(b).first().then(function(b){if(b==null)return;b=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId);if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)})}function n(a,b){return l(a,b).then(function(b){return b==null?d("WAResultOrError").makeResult():d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function o(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){if(!c.success)return;c=c.value;if(b==null)return d("MAWDexieTable").dexieResolve();c={author:b.author,chat:c.jid,externalId:b.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)})}function p(a,b){return i(a,b).then(function(b){if(b==null)return d("MAWDexieTable").dexieResolve();if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?{hasMedia:!1,xma:b}:d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return{hasMedia:a,previewMedia:c,xma:b}})})})}function q(a,b){return a.xma.where("externalId").anyOf(b).toArray()}g.bulkGetXMAs=a;g.maybeGetXMAFromXMAId=b;g.maybeGetXMAFromAssociatedMsgId=h;g.maybeGetXMAFromProtocolMsgId=i;g.maybeGetXMAPayloadFromProtocolMsgId=e;g.getDbXMAMsgFromAssociatedMsgId=f;g.getXMAFromMsgs=j;g.getXMAMsgIdsFromAssociatedMsgIds=k;g.maybeGetDbXMAMsgByAssociatedMsgId=m;g.maybeGetXMAPayloadFromAssociatedMsgId=n;g.maybeGetAssociatedXMAMsg=o;g.maybeGetXMAAndDefaultPreviewMediaFromProtocolMsg=p;g.getMultipleXMAByExternalId=q}),98);
__d("MAWMessageHasNonNullServerTsOnReceivedAckValidator",["MAWAckLevel","MAWTransactionMode","MAWTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageHasNonNullServerTsOnReceivedAckValidator",function(a){return function(b){return a.messages.get(b).then(function(a){return a==null||a.ack<d("MAWAckLevel").ACK.sent?{key:b,result:"skipped"}:a.serverTs!=null?{key:b,result:"valid"}:{description:"Message with "+a.ack+" ack has empty serverTs.",key:b,result:"invalid"}})}});b={description:"MAWMessageHasNonNullServerTsOnReceivedAckValidator",isValid:a,table:"messages",type:["add","put"]};g.MAWMessageHasNonNullServerTsOnReceivedAckValidator=b}),98);
__d("MAWMessageHasUniqueExternalIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=c("justknobx")._("3288");b=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageWithUniqueExternalIdValidator",function(a){return function(b){return a.messages.get(b).then(function(c){var e=c==null?void 0:c.externalId;return c==null||e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.messages.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.author===c.author&&a.threadJid===c.threadJid}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else{a=h(b,c,a);return{description:a,key:b,result:"invalid"}}})})}});function h(a,b,c){var d,e=c.every(function(a){return a.serverTs===b.serverTs});c=c.filter(function(b){return b.rowId!==a});d="Message has duplicate externalId."+("New message type: "+((d=b.type)!=null?d:"")+". ")+("Existing message types: "+c.map(function(a){return a.type}).join(", ")+". ")+("Messages have same serverTS: "+e.toString()+". ")+("Message has null protocolMsgId: "+(b.protocolMsgId==null).toString()+". ");return d}e={description:"MAWMessageHasUniqueExternalIdValidator",isValid:b,sampleRate:a,table:"messages",type:["add","put"]};g.MAWMessageHasUniqueExternalIdValidator=e}),98);
__d("MAWParticipantMatchOneOnOneThreadValidator",["MAWIndexedDb","MAWTransactionMode","MAWUserJidWrapper","WAJids","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=c("justknobx")._("3121");b=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"isParticipantMatchingOneOnOneThreadValidator",function(a){return function(b){return a.participants.get(b).then(function(a){return a==null?{key:b,result:"skipped"}:d("WAJids").switchOnMsgrChatJidType(a.threadJid,{group:function(){return{key:b,result:"skipped"}},user:function(c){return a.userJid!==c&&a.userJid!==d("MAWUserJidWrapper").getMyUserJid()?{description:"Participants added to 1:1 thread is neither self or the other user",key:b,result:"invalid"}:{key:b,result:"valid"}}})})}});e={description:"MAWParticipantMatchOneOnOneThreadValidator",isValid:b,sampleRate:a,table:"participants",type:["add","put"]};g.MAWParticipantMatchOneOnOneThreadValidator=e}),98);
__d("MAWReactionHasUniqueProtocolMsgIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY},"isReactionWithUniqueProtocolMsgIdValidator",function(a){return function(b){return a.reactions.get(b).then(function(c){var e=c==null?void 0:c.externalId;return e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.reactions.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.threadJid===(c==null?void 0:c.threadJid)}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else{a=a.find(function(a){return a.author!==(c==null?void 0:c.author)})!=null;return{description:"Reaction has duplicate protocolMsgId, has existing with different author: "+a.toString(),key:b,result:"invalid"}}})})}});b={description:"MAWReactionHasUniqueProtocolMsgIdValidator",isValid:a,table:"reactions",type:["add","put"]};g.MAWReactionHasUniqueProtocolMsgIdValidator=b}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{create:function(b){return babelHelpers["extends"]({},b,{table:function(e){var f=b.table(e);try{return babelHelpers["extends"]({},f,{get:function(b){return f.get(b).then(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})},getMany:function(b){return f.getMany(b).then(function(b){return b.map(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})})},mutate:function(b){var c=null;switch(b.type){case"add":case"put":c=b.values.map(function(b){return d("MAWDbMiddlewareMutations").mutateValue(b,e,a)});break;case"delete":break;case"deleteRange":break}if(b.type==="delete"||b.type==="deleteRange"||c==null)return f.mutate(b);b.values=c;return f.mutate(b).then(function(a){return a})},openCursor:function(b){return f.openCursor(b).then(function(b){return b==null||b.value==null?b:h(b,e,a)})},query:function(b){return f.query(b).then(function(b){if(b.result.length===0||typeof b.result[0]!=="object")return b;var c=b.result.map(function(b){return d("MAWDbMiddlewareMutations").getValue(b,e,a)});b.result=c;return b})}})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware");return f}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function b(){return{create:function(a){return babelHelpers["extends"]({},a,{table:function(b){var e=a.table(b);try{return babelHelpers["extends"]({},e,{get:function(a){return e.get(a).then(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})},getMany:function(a){return e.getMany(a).then(function(a){return a.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})},mutate:function(a){if(a.type==="delete"||a.type==="deleteRange")return e.mutate(a);a.values=a.values.map(function(a){return d("MAWDbMiddlewareMutations").mutateVaultedValue(a,b)});return e.mutate(a)},openCursor:function(a){return e.openCursor(a).then(function(a){return a==null||a.value==null?a:i(a,b)})},query:function(a){return e.query(a).then(function(a){return a.result.length===0||typeof a.result[0]!=="object"?a:babelHelpers["extends"]({},a,{result:a.result.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})})}})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware");return e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function h(a,b,c){var e;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(f){return a.start(function(){e=d("MAWDbMiddlewareMutations").getValue(a.value,b,c);try{a.value=e}catch(a){}f()})}},value:{get:function(){return e}}})}function i(a,b){var c;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(e){return a.start(function(){c=d("MAWDbMiddlewareMutations").getVaultedValue(a.value,b);try{a.value=c}catch(a){}e()})}},value:{get:function(){return c}}})}g.getMAWDbMutationMiddleware=a;g.getMAWVaultMiddleware=b}),98);
__d("MAWDbEncryptObjContent",["MAWKeychainNaClCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(a,b,c)}g.encryptContent=a}),98);
__d("MAWXMACTAUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.actionUrl,c=a.buttonType,d=a.ctaType,e=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,ctaType:d,nativeUrl:e,title:a}}function b(a){var b=a.actionUrl,c=a.buttonType,d=a.ctaType,e=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,ctaType:d,nativeUrl:e,title:a}}f.toMAWCTAEncode=a;f.fromMAWCTAEncode=b}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({SET:0,REMOVE:1});c={};e={};f={};b={};var h={},i={},j={},k={},l={},m={},n={};c.name="SyncdVersion";c.internalSpec={version:[1,(d=d("WAProtoConst")).TYPES.UINT64]};e.name="ExitCode";e.internalSpec={code:[1,d.TYPES.UINT64],text:[2,d.TYPES.STRING]};f.name="SyncdIndex";f.internalSpec={blob:[1,d.TYPES.BYTES]};b.name="SyncdValue";b.internalSpec={blob:[1,d.TYPES.BYTES]};h.name="KeyId";h.internalSpec={id:[1,d.TYPES.BYTES]};i.name="SyncdRecord";i.internalSpec={index:[1,d.TYPES.MESSAGE,f],value:[2,d.TYPES.MESSAGE,b],keyId:[3,d.TYPES.MESSAGE,h]};j.name="ExternalBlobReference";j.internalSpec={mediaKey:[1,d.TYPES.BYTES],directPath:[2,d.TYPES.STRING],handle:[3,d.TYPES.STRING],fileSizeBytes:[4,d.TYPES.UINT64],fileSha256:[5,d.TYPES.BYTES],fileEncSha256:[6,d.TYPES.BYTES]};k.name="SyncdSnapshot";k.internalSpec={version:[1,d.TYPES.MESSAGE,c],records:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],mac:[3,d.TYPES.BYTES],keyId:[4,d.TYPES.MESSAGE,h]};l.name="SyncdMutations";l.internalSpec={mutations:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};m.name="SyncdMutation";m.internalSpec={operation:[1,d.TYPES.ENUM,a],record:[2,d.TYPES.MESSAGE,i]};n.name="SyncdPatch";n.internalSpec={version:[1,d.TYPES.MESSAGE,c],mutations:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m],externalMutations:[3,d.TYPES.MESSAGE,j],snapshotMac:[4,d.TYPES.BYTES],patchMac:[5,d.TYPES.BYTES],keyId:[6,d.TYPES.MESSAGE,h],exitCode:[7,d.TYPES.MESSAGE,e],deviceIndex:[8,d.TYPES.UINT32],clientDebugData:[9,d.TYPES.BYTES]};g.SyncdMutation$SyncdOperation=a;g.SyncdVersionSpec=c;g.ExitCodeSpec=e;g.SyncdIndexSpec=f;g.SyncdValueSpec=b;g.KeyIdSpec=h;g.SyncdRecordSpec=i;g.ExternalBlobReferenceSpec=j;g.SyncdSnapshotSpec=k;g.SyncdMutationsSpec=l;g.SyncdMutationSpec=m;g.SyncdPatchSpec=n}),98);
__d("MAWDbObjDecode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWODSProxy","MAWXMACTAUtil","WAOdsEnums","WAServerSync.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h={appData:function(a){return A(a)},appMeta:function(a){return B(a)},chunk:function(a){return C(a)},collectionVersions:function(a){return L(a)},deletedMessages:function(a){return n(a)},deviceChangeAlerts:function(a){return i(a)},dualSendMedia:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},dyiBatch:function(a){return G(a)},ebMessageRestoreTasks:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebMsgRanges:function(a){return H(a)},ebRestoreQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebUploadQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},editMsgHistory:function(a){return O(a)},encryptionMetaV3:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ephemeralSettings:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},existingUsers:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsBackloggedMessages:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsEncryptionMeta:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsIndexV3:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeBacklog:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeThreadBacklog:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},groupInfo:function(a){return q(a)},groupInvites:function(a){return x(a)},historySyncQRCodeData:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},historySyncQRCodeSecretKey:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},igMessageAuxiliaryInfo:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},isDualSend:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},media:function(a){return E(a)},mediaBackup:function(a){return D(a)},mediaKeys:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},messages:function(a){return m(a)},missingKeys:function(a){return J(a)},participants:function(a){return w(a)},pendingMessageStanzaQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},pendingMutations:function(a){return K(a)},pendingReceipts:function(a){return u(a)},pendingStanzas:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},personalSenderKeyStatuses:function(a){return z(a)},poll:function(a){return Q(a)},reactions:function(a){return F(a)},receipts:function(a){return t(a)},receiverFetchInfo:function(a){return P(a)},sentBytesCache:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},staleQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},syncActions:function(a){return I(a)},syncKeys:function(a){return M(a)},tasks:function(a){return y(a)},threads:function(a){return v(a)},unrenderedMessages:function(a){return o(a)},xma:function(a){return N(a)}};function a(a,b){if(Object.prototype.hasOwnProperty.call(h,b))b=h[b](a);else throw c("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return b}function i(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a);return{action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts}}function j(a){a=a.quote;var b;if(a!=null){if(a.content==null)throw c("FBLogger")("messenger_web").mustfixThrow("QuotedMsgContent missing upon decoding");var d=a.content,e=d.author,f=d.expirationTs,g=d.externalId,h=d.mediaId,i=d.msgContent,j=d.msgId,k=d.plaintextHash,l=d.sourceId,m=d.specialTextSize,n=d.ts,o=d.type;d=d.xmaMessageType;b={content:babelHelpers["extends"]({},a.content,{author:e,expirationTs:f,externalId:g,mediaId:h,msgContent:i,msgId:j,plaintextHash:k,sourceId:l,specialTextSize:m,ts:n,type:o,xmaMessageType:d}),remoteJid:a.remoteJid}}return b}function k(a){if(a==null)return a;else return new Uint8Array(a)}function l(a){if(a==null||a.length===0)return new Set();else return new Set(a)}function m(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,a);var b=a.msgContent;if(a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("MsgContent missing upon decoding futureproof message");b.subtype=b.subtype}var e=j(a),f=p(a.reportingMeta);return babelHelpers["extends"]({},a,{msgContent:b,quote:e,reportingMeta:f})}function n(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a);return babelHelpers["extends"]({},a)}function o(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,a);var b=j(a),c=p(a.reportingMeta);return babelHelpers["extends"]({},a,{quote:b,reportingMeta:c})}function p(a){if(a==null)return;return{frankingKey:a.frankingKey!=null?new Uint8Array(a.frankingKey):a.frankingKey,frankingTag:a.frankingTag!=null?new Uint8Array(a.frankingTag):a.frankingTag,frankingVersion:a.frankingVersion,reportingContent:a.reportingContent,reportingTag:a.reportingTag!=null?new Uint8Array(a.reportingTag):a.reportingTag}}function q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a);return{creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a){if(a.length===0)return null;else return new Map(a.map(function(a){var b=a.deviceJid;if(b==null||a.serializedPubKey==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceJid or serializedPubKey are missing ");var d=new Uint8Array(a.serializedPubKey);a=k(a.baseKey);a={baseKey:a,pubKey:d};return[b,a]}))}function s(a){if(a==null)return null;else return new Map(a.map(function(a){if(a.deviceJid==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceJID is missing ");return[a.deviceJid,(a=a.count)!=null?a:0]}))}function t(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,a);var b=a.recipientDevices;b=l(b);return{permittedIdentitiesPerDevice:r(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:s(a.retryCountsPerDevice)}}function u(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a)}function v(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a);return{archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,muteCallsExpireTimeMs:a.muteCallsExpireTimeMs,muteExpireTimeMs:a.muteExpireTimeMs,newestMsg:a.newestMsg,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs}}function w(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a)}function x(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a)}function y(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a)}function z(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,a);var b=a.hasSenderKey;b=l(b);return{hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs}}function A(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,a);return{ack:a.ack,contents:a.contents,permittedIdentitiesPerDevice:r(a.permittedIdentitiesPerDevice),recipientDevices:new Set(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts}}function B(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a)}function C(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a)}function D(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a)}function E(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,a);var b,e=a.mediaEntries;e==null?b=new Map():b=new Map(e.map(function(a){if(a.msgId==null||a.mediaEntryData==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected msgId or mediaEntryData are missing ");return[a.msgId,new Uint8Array(a.mediaEntryData)]}));return{accessibilitySummaryText:a.accessibilitySummaryText,mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedResult:a.validatedResult,validatedVideoInfo:a.validatedVideoInfo}}function F(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a);a.ts!=null&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MIGRATE_REACTION_TS_AS_INDEX,key:"reaction_ts_encrypted"});return babelHelpers["extends"]({ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs},a.ts!=null?{ts:a.ts}:{})}function G(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a);return{isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId}}function H(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a);return{creationTime:a.creationTime,maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs}}function I(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,a);return{binarySyncData:a.binarySyncData,keyId:a.keyId,timestamp:a.timestamp,valueMac:a.valueMac,version:a.version}}function J(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,a);var b;a.deviceResponses==null?b=new Map():b=new Map(a.deviceResponses.map(function(a){if(a.deviceId==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceId is missing");else return[a.deviceId,a.deviceResponse]}));return{deviceResponses:b,keyId:a.keyId,timestamp:a.timestamp}}function K(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,a);var b;switch(a.operation){case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw c("FBLogger")("messenger_web").mustfixThrow("operation missing when decoding PendingMutation")}return{binarySyncAction:a.binarySyncAction,operation:b,timestamp:a.timestamp,version:a.version}}function L(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,a);return{finiteFailureStartTime:a.finiteFailureStartTime,isCollectionInMacMismatchFatal:a.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:a.isCollectionLthashInconsistent,ltHash:a.ltHash,state:a.state,version:a.version}}function M(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,a);return{fingerprint:a.fingerprint,keyData:a.keyData,timestamp:a.timestamp}}function N(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,a);return{author:a.author,ctas:a.ctas.map(function(a){return d("MAWXMACTAUtil").fromMAWCTAEncode(a)}),defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").fromMAWCTAEncode(a.defaultCTA),defaultPreviewMediaPlaintextHash:a.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:a.faviconPlaintextHash,headerMediaPlaintextHash:a.headerMediaPlaintextHash,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType}}function O(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a);return{author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize}}function P(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,a);return{accessibilitySummaryText:a.accessibilitySummaryText,mimetype:a.mimetype,previewHeight:a.previewHeight,previewUrl:a.previewUrl,previewUrlExpirationTimestampMs:a.previewUrlExpirationTimestampMs,previewWidth:a.previewWidth,type:a.type}}function Q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,a);var b=new Map(a.pollOptions.map(function(a){var b=a.pollOptionHash;if(b==null||a.pollOption==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected pollOptionHash or pollOption is missing");return[b,{optionText:a.pollOption.optionText,voteAuthors:new Set(a.pollOption.voteAuthors)}]}).filter(Boolean)),e=new Map(a.latestSenderTimestampsMs.map(function(a){if(a.author==null||a.latestSenderTimestampMs==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected author or latestSenderTimestampMs are missing");return[a.author,a.latestSenderTimestampMs]}));return{encKey:a.encKey,latestSenderTimestampsMs:e,pollAuthor:a.pollAuthor,pollOptions:b,pollParticipantCount:a.pollParticipantCount,pollState:a.pollState,selectableOptionsCount:a.selectableOptionsCount,title:a.title}}g.decodeDbObj=a}),98);
__d("WASyncdKeyTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return a}function d(a){return a}f.toSyncKeyId=a;f.fromSyncKeyId=b;f.toSyncKeyData=c;f.fromSyncKeyData=d}),66);
__d("MAWDbObjEncode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h=["ack","altIndex","collapsibleId","externalId","messageDeleteTs","messageExpirationTs","msgId","pollStanzaId","protocolMsgId","quoteExpirationTs","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"],i=["author","chat","externalId","rowId"],j={appData:w,appMeta:x,chunk:y,deletedMessages:k,deviceChangeAlerts:a,dualSendMedia:b,dyiBatch:C,ebMessageRestoreTasks:b,ebMsgRanges:D,ebRestoreQueue:b,ebUploadQueue:b,editMsgHistory:F,encryptionMetaV3:b,ephemeralSettings:b,existingUsers:b,ftsBackloggedMessages:b,ftsEncryptionMeta:b,ftsIndexV3:b,ftsPurgeBacklog:b,ftsPurgeThreadBacklog:b,groupInfo:m,groupInvites:t,historySyncQRCodeData:b,historySyncQRCodeSecretKey:b,igMessageAuxiliaryInfo:b,isDualSend:b,media:A,mediaBackup:z,mediaKeys:b,messages:f,participants:s,pendingMessageStanzaQueue:b,pendingReceipts:q,pendingStanzas:b,personalSenderKeyStatuses:v,poll:H,reactions:B,receipts:p,receiverFetchInfo:G,sentBytesCache:b,staleQueue:b,tasks:u,threads:r,unrenderedMessages:l,xma:E};function a(a){a={action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a).readByteArrayView()}}function b(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for encryption")}function e(a,b){if(Object.prototype.hasOwnProperty.call(j,b))b=j[b](a);else throw c("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return b}function f(a){a.ack;a.altIndex;a.collapsibleId;a.externalId;a.messageDeleteTs;a.messageExpirationTs;a.msgId;a.pollStanzaId;a.protocolMsgId;a.quoteExpirationTs;a.quoteExternalId;a.revokedExternalId;a.rowId;a.serverTs;a.sortOrderMs;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,h);a=a;var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,expirationTs:a.quote.content.expirationTs,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,plaintextHash:a.quote.content.plaintextHash,sourceId:a.quote.content.sourceId,specialTextSize:a.quote.content.specialTextSize,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c=a.msgContent;a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(c={protobuf:a.msgContent.protobuf,subtype:a.msgContent.subtype});var e=a.ravenEphemeralType,f=a.ravenEphemeralMediaState;e=e!=null?e:null;f=f!=null?f:null;c={applicationErrorCode:a.applicationErrorCode,author:a.author,editCount:a.editCount,ephemeralCounterStarted:a.ephemeralCounterStarted,ephemeralMsgDisappeared:a.ephemeralMsgDisappeared,ephemeralSetting:a.ephemeralSetting,forwardingScore:a.forwardingScore,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,hdType:a.hdType,isCollapsed:a.isCollapsed,isExpiredXmaMsg:a.isExpiredXmaMsg,isForwarded:a.isForwarded,mediaId:a.mediaId,msgContent:c,originalTs:a.originalTs,quote:b,ravenEphemeralMediaState:f,ravenEphemeralType:e,receiverFetchId:a.receiverFetchId,reportingMeta:a.reportingMeta,resendCount:a.resendCount,source:a.source,specialTextSize:a.specialTextSize,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,c).readByteArrayView()}}function k(a){a.author;a.chat;a.externalId;a.rowId;a=babelHelpers.objectWithoutPropertiesLoose(a,i);a={reason:String(a.reason)};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a).readByteArrayView()}}function l(a){var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,expirationTs:a.quote.content.expirationTs,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,plaintextHash:a.quote.content.plaintextHash,sourceId:a.quote.content.sourceId,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c={ack:a.ack,author:a.author,ephemeralSetting:a.ephemeralSetting,groupName:a.groupName,invitedParticipantUserJid:a.invitedParticipantUserJid,mediaId:a.mediaId,msgContent:a.msgContent,quote:b,reportingMeta:a.reportingMeta,resendCount:a.resendCount,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,c).readByteArrayView()}}function m(a){a={creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a).readByteArrayView()}}function n(a){if(a==null)return a;else return Array.from(a,function(a){var b=a[0];a=a[1];return{baseKey:a.baseKey,deviceJid:b,serializedPubKey:a.pubKey}})}function o(a){if(a==null)return null;else return Array.from(a,function(a){var b=a[0];a=a[1];return{count:a,deviceJid:b}})}function p(a){var b=Array.from(a.recipientDevices);b={permittedIdentitiesPerDevice:n(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:o(a.retryCountsPerDevice)};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,b).readByteArrayView()}}function q(a){a={author:a.author,deliveryReceipts:a.deliveryReceipts,externalId:a.externalId,readReceipts:a.readReceipts,thread:a.thread};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a).readByteArrayView()}}function r(a){a={archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a).readByteArrayView()}}function s(a){a={addressable:a.addressable,deliveredWatermarkTs:a.deliveredWatermarkTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadWatermarkTs,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a).readByteArrayView()}}function t(a){a={caption:a.caption,inviteCode:a.inviteCode,inviteExpirationTs:a.inviteExpirationTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a).readByteArrayView()}}function u(a){a={scheduledTime:a.scheduledTime};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a).readByteArrayView()}}function v(a){var b=Array.from(a.hasSenderKey);b={hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,b).readByteArrayView()}}function w(a){var b;switch(a.contents.type){case"meta_sync":var e=[];for(var f of a.contents.actions)f.chatAction?e.push({chatAction:f.chatAction}):f.messageAction&&e.push({messageAction:f.messageAction});b={actions:e,type:"meta_sync"};break;case"backups_secrets":b={encryptedBackupsSecrets:a.contents.encryptedBackupsSecrets,type:"backups_secrets"};break;case"sync_key_share":b={syncKeyShare:{keys:a.contents.syncKeyShare.keys,orphanKeys:(f=a.contents.syncKeyShare)==null||(f=f.orphanKeys)==null?void 0:f.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break;case"sync_key_request":b={syncKeyRequest:{keyIds:a.contents.syncKeyRequest.keyIds.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break;default:a.contents.type;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown appdata type: "+a.contents.type)}e={ack:a.ack,contents:b,permittedIdentitiesPerDevice:n(a.permittedIdentitiesPerDevice),recipientDevices:Array.from(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts};return{encodedFields:e,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,e).readByteArrayView()}}function x(a){a={value:a.value};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a).readByteArrayView()}}function y(a){a={blobData:a.blobData,mimetype:a.mimetype,plaintextHash:a.plaintextHash};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a).readByteArrayView()}}function z(a){a={fbid:a.fbid};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a).readByteArrayView()}}function A(a){var b=Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return{mediaEntryData:a,msgId:b}});b={accessibilitySummaryText:a.accessibilitySummaryText,mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedResult:a.validatedResult,validatedVideoInfo:a.validatedVideoInfo};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,b).readByteArrayView()}}function B(a){a={ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a).readByteArrayView()}}function C(a){a={isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a).readByteArrayView()}}function D(a){a={creationTime:a.creationTime,maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a).readByteArrayView()}}function E(a){var b=a.ctas==null?[]:a.ctas.map(function(a){return d("MAWXMACTAUtil").toMAWCTAEncode(a)});b={author:a.author,ctas:b,defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").toMAWCTAEncode(a.defaultCTA),defaultPreviewMediaPlaintextHash:a.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:a.faviconPlaintextHash,headerMediaPlaintextHash:a.headerMediaPlaintextHash,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,b).readByteArrayView()}}function F(a){a={author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a).readByteArrayView()}}function G(a){a={accessibilitySummaryText:a.accessibilitySummaryText,mimetype:a.mimetype,previewHeight:a.previewHeight,previewUrl:a.previewUrl,previewUrlExpirationTimestampMs:a.previewUrlExpirationTimestampMs,previewWidth:a.previewWidth,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,a).readByteArrayView()}}function H(a){var b=Array.from(a.pollOptions,function(a){var b=a[0];a=a[1];return{pollOption:{optionText:a.optionText,voteAuthors:Array.from(a.voteAuthors)},pollOptionHash:b}}),c=Array.from(a.latestSenderTimestampsMs,function(a){var b=a[0];a=a[1];return{author:b,latestSenderTimestampMs:a}});c={encKey:a.encKey,latestSenderTimestampsMs:c,pollAuthor:a.pollAuthor,pollOptions:b,pollParticipantCount:a.pollParticipantCount,pollState:a.pollState,selectableOptionsCount:a.selectableOptionsCount,title:a.title};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,c).readByteArrayView()}}g.encodeDbObj=e;g.encodeDbPollForEncryption=H}),98);
__d("MAWEARGenNewKeychainCryptoKey",["FBLogger","MAWCryptoConsts","MAWKeychainCrypto","MAWWebInitDataHelpers","MessengerWebInitData","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a,b=d("MAWWebInitDataHelpers").getLastAccountKeyFormatVersion(),e=(yield (a=d("MAWKeychainCrypto")).getAccountKeys(b))[0],f=a.genBrowserEncryptionKeyString(),g=a.genDatabaseEncryptionSeed();e=(yield a.encryptDataToStringBuffer(e,g));g=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+d("MAWCryptoConsts").ENC_KEY_TTL);return{accountKeyString:yield a.generateHashString(d("MAWWebInitDataHelpers").getAccountKeysString(b)[0]),appIdOrigin:c("MessengerWebInitData").appId,expiration:g,formatVersion:b,key:f,seed:e,userKeyBaseString:yield a.generateHashString(c("MessengerWebInitData").userKeyBase)}}catch(a){throw c("FBLogger")("messenger_web").catching(a).mustfixThrow("Failed to generateNewKey")}});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MAWEARKeychainDecryptionError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,b)||this;c.name="MAWEARKeychainDecryptionError";c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f["default"]=a}),66);
__d("MAWWorkerSetupArgs",[],(function(a,b,c,d,e,f){"use strict";var g=null;function a(a){g=a}function b(){return g}function c(){g=null}f.setWorkerSetupArgs=a;f.getWorkerSetupArgs=b;f.resetWorkerSetupArgs=c}),66);
__d("MAWGenKeychainCryptoKeyWithVersion",["ExecutionEnvironment","FBLogger","MAWCurrentUser","MAWEARKeychainDecryptionError","MAWKeychainCrypto","MAWWebInitDataHelpers","MAWWorkerSetupArgs","MessengerWebInitData","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e,f,g){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j,k,l){g===void 0&&(g=1);try{var m=(yield d("MAWKeychainCrypto").getAccountKeys(g));a=(yield (i||(i=b("Promise"))).all([d("MAWKeychainCrypto").importBrowserEncryptionKey(a),i.all(m.map(function(a){return d("MAWKeychainCrypto").decryptDataToArrayBuffer(a,e)["catch"](function(){return null})}))]));var n=a[0];m=a[1];a=(yield i.all(m.filter(Boolean).map(function(a){return d("MAWKeychainCrypto").genDatabaseEncryptionKey(n,a)["catch"](function(){return null})})));m=a.filter(Boolean);if(m.length===0)throw new(c("MAWEARKeychainDecryptionError"))("Failed to generate keys from seed");return{keys:m,version:f}}catch(b){a=null;m=null;f=d("MAWWorkerSetupArgs").getWorkerSetupArgs();(h||(h=c("ExecutionEnvironment"))).isInWorker&&f!=null&&(a=f.userKeyBase===c("MessengerWebInitData").userKeyBase,m=f.fbId===d("MAWCurrentUser").getID());f=d("MAWWebInitDataHelpers").getAccountKeysString(g);var o=f&&f[0]!=null?yield d("MAWKeychainCrypto").generateHashString(f[0]):null;c("FBLogger")("messenger_web").catching(b).mustfix("Failed to genKeyWithVersion: accountKeyBackfilled = %s; accountKeyExists = %s; acccountKeyMatches = %s; userKeyBaseBackilled = %s; userKeyBaseExists = %s; userKeyBaseMatches = %s; appIdOrigin = %s; appIdInitData = %s; userIdMatches = %s; isInWorker = %s; userKeyBase_match_between_threads = %s; userId_match_between_threads = %s; formatVersion = %s;",j!=null,f!=null,j===o,k!=null,c("MessengerWebInitData").userKeyBase!=null,k===(yield d("MAWKeychainCrypto").generateHashString(c("MessengerWebInitData").userKeyBase)),l,c("MessengerWebInitData").appId,d("MAWCurrentUser").getID()===String(c("MessengerWebInitData").userId),(h||(h=c("ExecutionEnvironment"))).isInWorker,a,m,g);throw b}});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MWEARKeychainV3Errors",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,b)||this;c.name="EARKeychainNotFoundError";c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.EARKeychainNotFoundError=a}),66);
__d("MWTabCommunicationChannel",["MAWLocalStorage"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof window!=="undefined"?window:self;function i(a){var b=d("MAWLocalStorage").getStorage(),c=function(c){d("MAWLocalStorage").setItemGuarded(b,a,JSON.stringify(c))},e=function(c){window.removeEventListener("storage",c),d("MAWLocalStorage").removeItemGuarded(b,a)},f=function(a){window.addEventListener("storage",a)},g=function(b){return b!=null&&b.key===a&&typeof b.newValue==="string"?JSON.parse(b.newValue):null};return{getMessage:g,onRequestReceived:function(a){var b=function(b){b=g(b);b!=null&&a(b)};f(b);return{release:function(){e(b)}}},sendMessage:c,stopWaitingForReply:e,waitForReply:f}}function j(a){var b=new h.BroadcastChannel(a),c=new Set();b.addEventListener("message",function(a){c.forEach(function(b){b(a)})});var d=function(a){c.add(a)},e=function(a){c["delete"](a)};a=function(a){b.postMessage(JSON.stringify(a))};var f=function(a){return a!=null&&typeof a.data==="string"?JSON.parse(a.data):null};return{getMessage:f,onRequestReceived:function(a){var b=function(b){b=f(b);b!=null&&a(b)};d(b);return{release:function(){e(b)}}},sendMessage:a,stopWaitingForReply:e,waitForReply:d}}function a(a){return h.BroadcastChannel!=null?j(a):i(a)}g.getChannel=a}),98);
__d("MWTabCommunication",["MWTabCommunicationChannel","Promise","clearTimeout","pageID","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a,b){var c=this;this.$2=null;this.$5=function(a){a=c.$4.getMessage(a);a!=null&&a.a==="sb"&&a.t!==c.tabID()&&a.r===c.tabID()&&a.k!=null&&(c.$2&&c.$2(a.k),c.$4.stopWaitingForReply(c.$5),c.$2=null)};this.$1=a;this.$3=b!=null?b:500;this.$4=d("MWTabCommunicationChannel").getChannel(a)}var e=a.prototype;e.tabID=function(){return c("pageID")};e.$6=function(){var a={a:"r",t:this.tabID()};this.$4.sendMessage(a)};e.listenToRequest=function(a){return this.listenToRequestAsync(function(){return(h||(h=b("Promise"))).resolve(a())})};e.listenToRequestAsync=function(a){var b=this,d=function(d){d.a==="r"&&d.t!==b.tabID()&&c("promiseDone")(a().then(function(a){a={a:"sb",k:a,r:d.t,t:b.tabID()};b.$4.sendMessage(a)}))};return this.$4.onRequestReceived(d)};e.$7=function(){var a=this;return new(h||(h=b("Promise")))(function(b){a.$2=b,a.$4.waitForReply(a.$5),a.$6()})};e.request=function(a,d){var e=this,f,g=function(){f!=null&&c("clearTimeout")(f)};return(h||(h=b("Promise"))).race([this.$7().then(function(b){e.$4.stopWaitingForReply(e.$5);return a(b)}),new h(function(a){f=c("setTimeout")(function(){a(d()),e.$4.stopWaitingForReply(e.$5)},e.$3)})]).then(function(a){g();return a})};return a}();g.MWTabCommunication=a}),98);
__d("MWEARKeychainV3",["$InternalEnum","Deferred","ExecutionEnvironment","FBLogger","LSPlatformLsInitLog","MAWCryptoConsts","MAWCurrentUser","MAWEARGenNewKeychainCryptoKey","MAWGenKeychainCryptoKeyWithVersion","MAWQplProxy","MAWReliabilityMonitor","MWEARKeychainV3Errors","MWTabCommunication","Promise","QPLUserFlow","Random","ReStoreTabNotifier","WAArrayBufferUtils","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe","gkx","memoizeOneWithArgs","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(){return{accountKey:null,databaseEncryptionKeys:new Map(),dbReady:new(c("Deferred"))(),latestVersion:d("MAWCryptoConsts").VERSION}},k={global_ear:j(),maw_ear:j()},l=null,m=function(){var a=Object.keys(k).reduce(function(a,b){a[b]="none";return a},{});return{get:function(b){return a[b]},is:function(b,c){return a[b]===c},set:function(b,c){a[b]=c;(b=l)==null||b.updateState()}}}();function a(a){k[a]=j(),m.set(a,"none")}function e(a,b){m.set(a,b)}function n(a){var b=d("Random").uint32();while(a.some(function(a){return a.randomisedVersion===b}))b=d("Random").uint32();return b}var o={global_ear:function(){return null},maw_ear:function(){return null}},p=function(a){return o[a]()},q=function(a,b){o[a]=function(){return b}},r=function(a,b){q(a,b),x(a).dbReady.resolve()},s={global_ear:"browserEncryptionMetaV2",maw_ear:"encryptionMetaV3"},t=c("memoizeOneWithArgs")(function(a,b){return new(d("MWTabCommunication").MWTabCommunication)("ear_keys_"+b+"_"+a)});function f(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;e===void 0&&(e=N);c("gkx")("9396")&&c("FBLogger")("messenger_web").info("Initialise EAR keychain: %s",a);l=K(a);if(m.is(a,"success")&&x(a).databaseEncryptionKeys.size!==0)return d("WAResultOrError").makeResult(w(a));var g=d("MAWCurrentUser").getID(),h=c("ReStoreTabNotifier")("channel-ear-keychain-v3-"+g);h.onEventReceive("notifyEarKeychainV2",G);var j=(i||(i=c("ExecutionEnvironment"))).isInWorker?"Worker":"UI";e(a+"_ear_init_start",{string:(f={},f["initFlow_"+a+"_"+j]=b,f)});try{b=(yield L(h,a,void 0,e));e(a+"_ear_import_end");for(f of b)x(a).databaseEncryptionKeys.set(f.result.version,{dbEntry:f.entry,keys:f.result.keys});F(a);t(a,g).listenToRequest(function(){return JSON.stringify(Array.from(x(a).databaseEncryptionKeys.entries()).map(function(a){var b=a[0];a=a[1];var c=a.dbEntry;a=a.keys;return[b,{dbEntry:c,keys:a.map(function(a){return d("WAArrayBufferUtils").arrayBufferToString(a)})}]}))});e(a+"_ear_init_end",{string_array:(h={},h[a+"_randomisedVersionKeys"+j]=v(a).map(function(a){a[0];a=a[1].dbEntry;return String(a.randomisedVersion)}),h)});m.set(a,"success");return d("WAResultOrError").makeResult(w(a))}catch(b){m.set(a,"failure");e(a+"_ear_init_error");c("gkx")("9396")&&c("FBLogger")("messenger_web").catching(c("getErrorSafe")(b)).mustfix("Failed to setup EAR Keychain V3. Namespace: %s",a);return d("WAResultOrError").DEPRECATED_makeError("keychain-setup-failure",b)}});return u.apply(this,arguments)}function v(a){return Array.from(x(a).databaseEncryptionKeys.entries())}function w(a){return x(a).latestVersion}function x(a){return k[a]}function y(a,b){var e=b!=null?b:w(a);b=x(a).databaseEncryptionKeys.get(e);if(b==null){c("promiseDone")(C(a).then(function(a){var b=a.map(function(a){return a.version}).includes(e);c("FBLogger")("messenger_web").info("EAR Keychain DB match found: %s. Version = %s. NumberVersions = %s",b,e,a.length)}));var f=w(a),g=Array.from(x(a).databaseEncryptionKeys.keys());c("FBLogger")("messenger_web").mustfix("EAR Key v%s was null. Latest version: %s has key: %s, keychain length: %s, currentLatestVersion: %s, init status %s, in worker %s",e,f,x(a).databaseEncryptionKeys.get(f)==null,x(a).databaseEncryptionKeys.size,Math.max.apply(Math,g),m.get(a),(i||(i=c("ExecutionEnvironment"))).isInWorker);throw new(d("MWEARKeychainV3Errors").EARKeychainNotFoundError)("EAR Key "+e+" was null.")}return{dbEntry:b.dbEntry,keys:b.keys,randomisedVersion:b.dbEntry.randomisedVersion,version:e}}function z(a){return c("MAWGenKeychainCryptoKeyWithVersion")(a.key,a.seed,a.version,a.formatVersion,a.accountKeyString,a.userKeyBaseString,a.appIdOrigin)}var A=b("$InternalEnum")({UNKNOWN:-1,NO_KEY:0,EBSM_EARV2_UPGRADE:1,RANDOMISED_VERSION_UPGRADE:2,EXPIRED_KEY:3,FORCE_KEY_ROTATION:4});function B(a){if(a.length===0)return{reason:A.NO_KEY,result:!0};a=a[a.length-1];return!d("WATimeUtils").isInFuture(a.expiration)?{reason:A.EXPIRED_KEY,result:!0}:{result:!1}}function C(a){var c=E(a,"readonly");return new(h||(h=b("Promise")))(function(b,d){c.onabort=function(){return d(c.error)};c.onerror=function(){return d(c.error)};var e=c.objectStore(s[a]).getAll();e.onsuccess=function(){return b(e.result)};e.onerror=function(){return d(e.error)}}).then(D)}function D(a){var b=a.find(function(a){return a.version==null});b!=null&&c("FBLogger")("messenger_web").mustfix("EAR Keychain Rotation null version: fields nonnull: %s %s %s %s %s %s",b.id==null,b.key==null,b.seed==null,b.formatVersion==null,b.accountKeyString==null,b.userKeyBaseString==null);b=a.filter(function(a){return a.version!=null});return b.sort(function(a,b){return a.version-b.version})}function E(a,b){var d=p(a);if(d==null)throw c("FBLogger")("messenger_web").mustfixThrow("Encryption IndexDB should've been initialized. Namespace: %s",a);return d.transaction(s[a],b,{durability:"strict"})}var F=function(a){var b=Array.from(x(a).databaseEncryptionKeys.keys());b.length>0?x(a).latestVersion=Math.max.apply(Math,b):c("FBLogger")("messenger_web").mustfix("EAR latest version does not exist")},G=function(a){var d=a.namespace,e=a.version;c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{c("FBLogger")("messenger_web").info("Received key rotation notification. Namespace: %s",d);yield x(d).dbReady.getPromise();var a=(yield C(d)).find(function(a){return a.version===e});if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Notified new Ear Key but missing in DB");var b=(yield z(a));x(d).databaseEncryptionKeys.set(b.version,{dbEntry:a,keys:b.keys});F(d);c("FBLogger")("messenger_web").info("Rotated key successfully. Namespace: %s",d)}catch(a){return c("FBLogger")("messenger_web").catching(a).mustfix("Failed to handleNewVersion. In worker %s. Namespace: %s.",(i||(i=c("ExecutionEnvironment"))).isInWorker,d)}})())};function H(a){return m.get(a)!=="none"}function I(a){return m.get(a)}function J(a){if(m.is(a,"success")){x(a).databaseEncryptionKeys.size===0&&c("FBLogger")("messenger_web").mustfix("Keychain initialised but no keys present");return!0}return!1}function K(a){return d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("EARv3",function(){return{extra:{isKeychainInitialised:J(a).toString(),latestVersion:w(a).toString()},reason:m.get(a),state:function(){switch(m.get(a)){case"none":return d("MAWReliabilityMonitor").HealthReportState.PENDING;case"success":return d("MAWReliabilityMonitor").HealthReportState.OK;case"failure":return d("MAWReliabilityMonitor").HealthReportState.ERROR;default:return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN}}()}})}function L(a,b,c,d){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d,e,f){var g=(yield c("MAWEARGenNewKeychainCryptoKey")());f(d+"_ear_raw_key_generated");var j=(yield new(h||(h=b("Promise")))(function(b,h){var j=E(d,"readwrite");j.onerror=function(){return h(j.error)};j.onabort=function(){return h(j.error)};var k=j.objectStore(s[d]).getAll();k.onerror=function(){return h(k.error)};k.onsuccess=function(){var l;f(d+"_ear_keys_fetched");var m=D(k.result),o=B(m),p=o.reason;o=o.result;if((e==null?void 0:e.forceKeyRotation)!==!0&&!o)return b(m);o=(e==null?void 0:e.forceKeyRotation)===!0?A.FORCE_KEY_ROTATION:p!=null?p:A.UNKNOWN;p=m.map(function(a){return a.version});l=(l=p[p.length-1])!=null?l:0;c("FBLogger")("messenger_web").info("Key rotation. EAR versions: %s. Latest version: %s. Namespace: %s, Worker: %s",p.toString(),l,d,(i||(i=c("ExecutionEnvironment"))).isInWorker);var q=babelHelpers["extends"]({},g,{randomisedVersion:n(m),source:o,version:l+1});f(d+"_ear_adding_new_key");j.oncomplete=function(){m.push(babelHelpers["extends"]({},q,{id:q.version})),a.postMessage("notifyEarKeychainV2",{namespace:d,version:q.version}),f(d+"_ear_gen_key_end"),b(m)};var r=j.objectStore(s[d]).add(q);r.onerror=function(){return h(c("FBLogger")("messenger_web").catching(r.error).mustfixThrow("Failed to rotate EAR key"))}}}));f(d+"_ear_import_start");j=(yield h.allSettled(j.map(function(a){return z(a).then(function(b){return{entry:a,result:b}})})));var k=j[j.length-1];if(k.status==="rejected"){var l;l=(l=e==null?void 0:e.corruptedEARRetryCount)!=null?l:0;if(l>=1)throw k.reason;return L(a,d,{corruptedEARRetryCount:l+1,forceKeyRotation:!0},f)}return j.map(function(a){if(a.status==="fulfilled")return a.value}).filter(Boolean)});return M.apply(this,arguments)}var N=function(a,b){d("LSPlatformLsInitLog").addPoint(a,b),O(a,b)},O=function(a,b){var e=c("qpl")._(25310776,"6155");(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(e,"backend_"+a,{annotations:b}):(c("QPLUserFlow").addPoint(e,"ui_"+a),b!=null&&c("QPLUserFlow").addAnnotations(e,b))},P=function(a,b){return t(a,b).request(function(b){b=JSON.parse(b);b.forEach(function(b){var c=b[0];b=b[1];var e=b.keys.map(d("WAArrayBufferUtils").stringToArrayBuffer);x(a).databaseEncryptionKeys.set(c,{dbEntry:b.dbEntry,keys:e})});F(a);m.set(a,"success");return!0},function(){return!1})};g.InitStatus=m;g.resetKeychain__TEST_ONLY_DO_NOT_USE=a;g.setInitStatus__TEST_ONLY_DO_NOT_USE=e;g.generateNewRandomisedVersionNumber=n;g.setNamespaceSourceDbWithoutMarkingDbReady=q;g.setNamespaceSourceDbAndMarkAsReady=r;g.getEncryptionKeysTabCommunication=t;g.init=f;g.getLatestVersion=w;g.getKeychain=x;g.getDbEncryptionKey=y;g.isKeychainSettled=H;g.getKeychainInitStatus=I;g.isKeychainInitialised=J;g.logMawInitPoint=O;g.importKeysFromOtherTab=P}),98);
__d("MAWDbObjEncryption",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCryptoConsts","MAWDbEncryptObjContent","MAWDbObjDecode","MAWDbObjEncode","MAWDexieTable","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWQplProxy","MAWUnrecoverableDbErrors","MWEARKeychainV3","MWEARKeychainV3Errors","ODS","WABase64","WATimeUtils","getErrorSafe","gkx","isEncryptionAtRestEnabled","justknobx","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="_encryptedContent",k=new Set(["threads","messages","participants"]);function a(a,b,e){if(!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")===!0)||!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b))return a;var f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25300256,"115"),{bool:{isWorker:(i||(i=c("ExecutionEnvironment"))).isInWorker,useMawEar:d("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:c("pageID"),tableName:b}});try{var g=babelHelpers["extends"]({},a);e=e(d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear");var h=e.keys;h=h[0];var l=e.version;e=e.randomisedVersion;d("MWEARKeychainV3").isKeychainSettled("maw_ear")===!1&&c("FBLogger")("messenger_web").mustfix("[EAR] Encrypting %s data with global ear. Transactor: %s",b,d("MAWDexieTable").getDexiePSDItem("transactorName"));f.addAnnotations({"int":{keyVersion:l,randomisedVersion:e}});var m=d("MAWKeychainUtil").makeAAD(l,d("MAWCryptoConsts").CIPHER_ID),n=d("MAWDbObjEncode").encodeDbObj(a,b),o=n.encodedFields;n=n.proto;Object.keys(o).forEach(function(b){Object.prototype.hasOwnProperty.call(a,b)&&delete g[b]});o=d("MAWDbEncryptObjContent").encryptContent(h,n,m);g[j]=o;k.has(b)&&(g.updatedAt_S456130=Date.now(),g.randomisedVersion_S456130=e,g.encryptedWith_S456130=d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",g.keyVersion_S456130=l);f==null||f.endSuccess();return g}catch(a){f==null||f.endFail("ear_encrypt_fail");throw c("FBLogger")("messenger_web").catching(a).mustfixThrow("[%s] %s - Encrypted dexie was unable to encrypt an entity for table %s",a.name,a.message,b)}}function b(a,b,e){if(!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b)||!Object.prototype.hasOwnProperty.call(a,j))return a;var f=(i||(i=c("ExecutionEnvironment"))).isInMainThread&&c("justknobx")._("3378")?null:d("MAWQplProxy").startQplUserFlow(c("qpl")._(25313004,"118"));f==null||f.addAnnotations({bool:{isWorker:(i||(i=c("ExecutionEnvironment"))).isInWorker,useMawEar:d("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:c("pageID"),tableName:b}});var g;try{var n=a[j],o=babelHelpers["extends"]({},a);(h||(h=d("ODS"))).bumpEntityKey(3185,"maw_db_ear_decryption","encrypted_content_type."+b+"."+(n instanceof ArrayBuffer?"ArrayBuffer":"string"));n=n instanceof ArrayBuffer?n:d("WABase64").decodeB64(n);var p=d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(n),q=p.aadLengthInBytes;p=p.keyVersion;e=e(d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",p);g=e;var r=e.dbEntry,s=e.keys;e=e.randomisedVersion;f==null||f.addAnnotations({"int":{contentVersion:a==null?void 0:a.keyVersion_S456130,keyVersion:p,randomisedVersion:e},string:{encryptedWith:a==null?void 0:a.encryptedWith_S456130,randomisedVersionEncryption:a==null?void 0:a.randomisedVersion_S456130}});var t={},u,v;for(e of s)try{u=d("MAWKeychainNaClCrypto").decryptArrayBuffer(e,n,p,r.formatVersion,q);break}catch(a){v=a}if(u==null)throw c("getErrorSafe")(v);var w=d("MAWDbObjDecode").decodeDbObj(u,b);Object.keys(w).forEach(function(a){t[a]=w[a]});delete o[j];s=babelHelpers["extends"]({},o,t);f==null||f.endSuccess();return s}catch(h){if(k.has(b)){f==null||f.addAnnotations({"int":{updatedAt:(q=a==null?void 0:a.updatedAt_S456130)!=null?q:-1}})}c("justknobx")._("3208")&&(i||(i=c("ExecutionEnvironment"))).isInWorker&&(h instanceof d("MAWKeychainNaClCrypto").EARDecryptionError||h instanceof d("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&(f==null||f.addAnnotations({bool:{unrecoverableDbError:!0}}),d("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(d("MAWUnrecoverableDbErrors").EarRuntimeError)()}));f==null||f.markError("ear_decrypt_exception",null,h);f==null||f.endFail("ear_decrypt_fail");throw c("FBLogger")("messenger_web").catching(h).mustfixThrow("[%s] %s - (v2) Encrypted dexie was unable to decrypt an entity for table %s. UpdatedAt: %s. KeyStatus: %s. Signature matches: %s. Key source: %s. Using MAW EAR: %s. Worker: %s. Encrypted With: %s. PageID: %s. Source: %s",h.name,h.message,b,l(a==null?void 0:a.updatedAt_S456130),m(a,g),(a==null?void 0:a.randomisedVersion_S456130)!=null&&((r=g)==null?void 0:r.randomisedVersion)!=null?a.randomisedVersion_S456130===g.randomisedVersion:null,(e=(n=g)==null?void 0:n.dbEntry.source)!=null?e:"-1",d("MWEARKeychainV3").isKeychainSettled("maw_ear"),(i||(i=c("ExecutionEnvironment"))).isInWorker,a==null?void 0:a.encryptedWith_S456130,c("pageID"),d("MAWDexieTable").getDexiePSDItem("transactorName"))}}function l(a){if(a==null)return"unknown";a=Date.now()-a;a=Math.floor(a/(1e3*60*60*24));if(a<1)return"0-1 days";else if(a<7)return"1-7 days";else if(a<14)return"7-14 days";else if(a<30)return"14-30 days";else return"30+ days"}function m(a,b){if((a==null?void 0:a.updatedAt_S456130)==null||b==null)return null;a=d("WATimeUtils").castToUnixTime(a.updatedAt_S456130/1e3);b=b.dbEntry.expiration-d("MAWCryptoConsts").ENC_KEY_TTL;if(a===b)return"same";else if(a>b)return"key_older";else return"key_newer"}g.ENCRYPTED_COLUMN_NAME=j;g.encryptDbObj=a;g.decryptDbObj=b}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return i(a).then(function(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",a)})}function a(a,b){a=new TextEncoder().encode(a);b=new Uint8Array(b);a=c("tweetnacl-auth")(a,b);return d("WABase64").encodeB64UrlSafe(a)}function b(){return h().then(function(a){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(b){return function(){return d("MAWDbMsgTypeVersionTxns").getHMACKey(b).then(function(c){return c!=null?c:d("MAWDbMsgTypeVersionTxns").addHMACKey(b,a).then(function(){return a})})}})()})}function i(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}g.genHMACKey=h;g.hmacTweetNaCl=a;g.generateAndInsertHMACKey=b}),98);
__d("MAWMediaUtils",["FBLogger","MAWDbMedia","MAWDexieTable","MAWHMACKey","MAWImageUtils","MAWMsgType","WABlobToArrayBuffer","WAGlobals","WAHashUtils","WAMsgType","WATimeUtils","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b="media");switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return b==="xma-media"?"xma-image":"image";case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case d("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case d("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case d("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw c("FBLogger")("messenger_web").mustfixThrow("get a wrong media file with type "+a)}}function h(a){try{return d("WABlobToArrayBuffer").blobToArrayBuffer(a).then(i)}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow("Got "+a+" when convert the blob to Uint8Array")}}function i(a){return self.crypto.subtle.digest("SHA-256",a).then(function(a){return new Uint8Array(a)})}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));a=d("WAHashUtils").toPlaintextHash(a);var b=k(a);return[a,b]});return j.apply(this,arguments)}function k(a){var b=d("WAGlobals").getHMACKey();return d("WAHashUtils").toHashedPlaintextHash(d("MAWHMACKey").hmacTweetNaCl(a,b))}function f(a){if(a==null)return null;var b="preview-"+d("WATimeUtils").unixTime().toString()+".jpeg";return l(a,b,"image/jpeg")}function l(a,b,c){return new File([new Blob([new Uint8Array(a)],{type:c})],b,{type:c})}function m(a,b,c){var e=function(){return c!=null?d("MAWDexieTable").dexieResolve(c.filter(function(a){return a.type!==d("WAMsgType").REVOKED&&b.msgIds.includes(a.msgId)})):a.messages.where("msgId").anyOf(b.msgIds).filter(function(a){return a.type!==d("WAMsgType").REVOKED}).toArray()};return e().then(function(a){return o(b,a)})}function n(a){return a.reduce(function(a,b){var c=b.hdType;c!=null&&(a[b.msgId]=c);return a},{})}function o(a,b){b=b.filter(function(b){return b.type!==d("WAMsgType").REVOKED&&a.msgIds.includes(b.msgId)});var e=b.map(function(a){return a.msgId});e=babelHelpers["extends"]({},a,{msgIds:e});var f=b.reduce(function(a,b){a[b.msgId]=d("WATimeUtils").castToMillisTime(b.sortOrderMs!=null?b.sortOrderMs:b.ts*1e3);return a},{});e=babelHelpers["extends"]({},e,{messagesSortOrderMs:f});if(b.every(function(a){return a.type===d("WAMsgType").STICKER})&&c("justknobx")._("2932")){f=d("MAWImageUtils").boundHeightWidth(e.previewHeight,e.previewWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);var g=f.height;f=f.width;e=babelHelpers["extends"]({},e,{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,previewHeight:g,previewHeightLarge:g,previewWidth:f,previewWidthLarge:f})}g=new Set(b.map(function(a){return a.type}));g.forEach(function(b){if(b===d("MAWMsgType").MSG_TYPE.RAVEN)return;a.mediaType!==p(b)&&c("FBLogger")("messenger_web").mustfix("Message and media type mismatch: message with type %s is associated with media with type %s",b,a.mediaType)});return e}function p(a){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return d("MAWDbMedia").MEDIA_TYPE.IMAGE;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("MAWDbMedia").MEDIA_TYPE.VIDEO;case d("MAWMsgType").MSG_TYPE.PTT:return d("MAWDbMedia").MEDIA_TYPE.PTT;case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWDbMedia").MEDIA_TYPE.GIF;case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWDbMedia").MEDIA_TYPE.STICKER;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE}}g.getServerMediaTypeFromMediaType=a;g.hashBlob=h;g.hashArrayBuffer=i;g.genBlobHashes=e;g.genHMACPlaintextHash=k;g.convertJpegThumbnailArrayBufferToFile=f;g.getBridgeMediaAnnotatedForDisplay=m;g.createHdTypesForBridgeMedia=n;g.annotateBridgeMediaForDisplay=o;g.getMediaTypeFromMsgType=p}),98);
__d("MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor",["MAWDbMsgTypeVersionTxns","MAWMpsGating","MAWProtobufDeserializers","WAGlobals","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(a){h=a}c={name:"MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor",processAsync:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("MAWMpsGating").isMpsWaAdminMsgsEnabled()&&!d("MAWMpsGating").isFullMpsEnabled())return{errors:new Map(),payload:a};b.metric.addPoint("maybe_drop_security_alerts_start");var c=[];for(a of a){var e,f=a.directive,g=a.insertionSource,i=a.message,j=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(i.payload);e=(e=j.payload().proto)==null||(e=e.event)==null?void 0:e.deviceChange;if(e==null){c.push({directive:f,insertionSource:g,message:i});continue}if(((e=j.proto.metadata)==null?void 0:e.senderId)===d("WAGlobals").getMyUserJid())continue;h===null&&(h=(yield d("MAWDbMsgTypeVersionTxns").getSecuritySettingForContactTxn()));h===!0&&c.push({directive:f,insertionSource:g,message:i})}b.metric.addPoint("maybe_drop_security_alerts_end");return{errors:new Map(),payload:c}});function c(b,c){return a.apply(this,arguments)}return c}()};g.setCachedShouldSaveSecurityAlert=a;g.MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor=c}),98);
__d("MAWDexieCastToPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){return(g||(g=b("Promise"))).resolve(a)}function c(a){return a}f.dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING=a;f.promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING=c}),66);
__d("MAWEBCombinedSwitch",["MAWEBEnabledStateManager","MAWEBLSInWorkerSwitch","MAWEBSwitch"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("MAWEBEnabledStateManager").MAWEBEnabledStateManager)();function i(){h.set(c("MAWEBSwitch").isEnabled()&&c("MAWEBLSInWorkerSwitch").isEnabled())}c("MAWEBSwitch").onSet(function(){i()});c("MAWEBLSInWorkerSwitch").onSet(function(){i()});i();g.MAWEBCombinedSwitch=h}),98);
__d("MAWLegacyDownloadManager",[],(function(a,b,c,d,e,f){"use strict";var g=1e4;a=function(){function a(){this.$1=[],this.$2=new Map()}var b=a.prototype;b.setToDownloadManager=function(a,b){this.$3(),this.$2.set(a,b),this.$1.push(a)};b.getFromDownloadManager=function(a){return this.$2.get(a)};b.removeFromMediaDownloadManager=function(a){this.$2["delete"](a);var b=this.$1.filter(function(b){return b!==a});this.setDownloadManagerQueue(b)};b.setDownloadManagerQueue=function(a){this.$1=a};b.$3=function(){if(this.$1.length>=g){var a=this.$1.shift();this.$2["delete"](a)}};return a}();f.LegacyDownloadManager=a}),66);
__d("MAWLegacyMediaDownloadManager",["MAWLegacyDownloadManager"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("MAWLegacyDownloadManager").LegacyDownloadManager)(),i=new(d("MAWLegacyDownloadManager").LegacyDownloadManager)();function a(a,b){h.setToDownloadManager(a,b)}function b(a){return h.getFromDownloadManager(a)}function c(a){h.removeFromMediaDownloadManager(a)}function e(a,b){i.setToDownloadManager(a,b)}function f(a){return i.getFromDownloadManager(a)}function j(a){i.removeFromMediaDownloadManager(a)}g.setToMediaDownloadManager=a;g.getFromMediaDownloadManager=b;g.removeFromMediaDownloadManager=c;g.setToMediaPlaintextDownloadManager=e;g.getFromMediaPlaintextDownloadManager=f;g.removeFromMediaPlaintextDownloadManager=j}),98);
__d("MAWMediaAfterTxns",["MAWBridgeTypesCreators","MAWDbMedia","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWMediaUtils","MAWRavenUtils","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,j){if(c("gkx")("9695"))return h(a,b,e,f,g,j);i(a,b,e,f,g,j);return d("MAWDexieTable").dexieResolve()}function h(a,b,c,e,f,g){return e.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(h){var i=a.threadJid,k=d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(h,i);h=d("MAWMediaUtils").createHdTypesForBridgeMedia(h);i=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:k,hasMediaForUI:c,hdTypes:h,media:b,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(a.ravenEphemeralType,a.ravenEphemeralMediaState),sortOrderMs:a.sortOrderMs,transportKey:g}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:k,hasMediaForUI:c,hdTypes:h,media:b,sortOrderMs:a.sortOrderMs,transportKey:g});return j(e,babelHelpers["extends"]({},i,{skipShouldUpdateHasMore:f}))})}function i(a,b,e,f,g,h){c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(f.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(c){var i=a.threadJid,j=d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(c,i);c=d("MAWMediaUtils").createHdTypesForBridgeMedia(c);i=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:j,hasMediaForUI:e,hdTypes:c,media:b,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(a.ravenEphemeralType,a.ravenEphemeralMediaState),sortOrderMs:a.sortOrderMs,transportKey:h}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:j,hasMediaForUI:e,hdTypes:c,media:b,sortOrderMs:a.sortOrderMs,transportKey:h});l(f,babelHelpers["extends"]({},i,{skipShouldUpdateHasMore:g}))})))}function j(a,b,e){if(c("gkx")("9695"))return k(a,b,e);l(a,b,e);return d("MAWDexieTable").dexieResolve()}function k(a,b,c){if(!m(b)){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b});return d("MAWDexieTable").dexieResolve()}return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,b,c).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})})}function l(a,b,e){if(!m(b))return d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b});c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,b,e).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})})))}function m(a){if(a.ephemeralMediaState!=null||a.ephemeralMediaViewMode!=null)return!1;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.VIDEO:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return!0;default:return!1}}g.handleNewMediaAfterTxn=a;g.handleNewMediaAfterTxnWithBridgeMedia=j}),98);
__d("MAWMediaDownloadStatusForUI",["MAWBridge","MAWLoggerUtils","MAWMediaDownloadStatus","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MWFBLogger").MWMediaLogger.tags([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);function a(a){var b=a.details,c=a.hash,d=a.status,e=a.type;a=a.validationResult;j({details:b,hash:c,status:d,type:e,validationResult:a})}function j(a){var b=a.details,c=a.hash,e=a.status,f=a.type;a=a.validationResult;d("MAWBridge").getBridge().fireAndForget("event","updateMediaStatus",{details:b,key:c,status:e,type:f,validationResult:a})}function b(a){switch(a){case"disconnected":case"backoff":case"body-network-error":case"no-host":case"download-throttled":case"max-attempts-exceeded":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":return c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE;case"request-error":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"decryption-error":case"enc-hash-mismatch":case"hash-mismatch":case"ciphertext-hash-mismatch":case"signature-expired":return c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE;default:a;i.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["getStatusTypeFromWAAPIDownloadMediaError: Unknown error type ",""])),String(a));return c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE}}g.sendMediaDownloadStatusToUI=a;g.getStatusFromWAAPIDownloadMediaError=b}),98);
__d("MpsFutureProofKey",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({WCEPlaintextPayloadFutureProofPlaceholder:0,WCEPlaintextPayloadFutureProofNoPlaceholder:1,WCEPlaintextPayloadFutureProofIgnore:2});f.WCEPlaintextPayloadFutureProof=a}),66);
__d("WAAPI",["cr:21048"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:21048")}),98);
__d("WAAbPropsHelpers",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=86400,m=600,n=604800;function a(a){return a==null?l:Math.max(m,Math.min(n,a))}function o(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c],e=d[0];d[1];d=d[2];if(typeof e!=="number")return;b.push({configName:c,configCode:e,configDefault:d})});return b}function b(a,b){a=a[b][0];return typeof a==="number"?a:null}function p(a,b){switch(typeof b){case"boolean":return a==="1";case"number":return parseFloat(a);case"string":return a;default:d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["parseValue: unsure how to read ",""])),a);return null}}function c(a,b){var c=new Map();b.forEach(function(a){var b=a.configCode,d=a.configValue;a=a.configExpoKey;c.set(b,{configValue:d,configExpoKey:a})});var d={},e={};o(a).forEach(function(a){var b=a.configName,f=a.configCode;a=a.configDefault;var g=c.get(f);if(g==null)return;var h=g.configValue;g=g.configExpoKey;h=p(h,a);h!=null&&(d[b]=h);e[f]=g!=null?g:null});return{values:d,expoKeys:e}}function e(a,b,c){var e=babelHelpers["extends"]({},b,a),f={};Object.keys(e).forEach(function(a){if(c[a]==null){d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdatePropValues: deleting config ",""])),a);return}f[a]=e[a]});return f}function f(a,b,c){var e=babelHelpers["extends"]({},b,a),f={};a=o(c).map(function(a){return a.configCode});var g=new Set(a),h=new Set();Object.keys(e).forEach(function(a){a=parseInt(a,10);var c=b?b[a]:null;!g.has(a)?(d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateExpoKeys: deleting config_expo_key ",""])),a),c!=null&&c.trim()&&h.add(c)):(e[a]!==c&&(d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateExpoKeys: config_expo_key "," changed"])),a),c!=null&&c.trim()&&h.add(c)),f[a]=e[a])});return{propExpoKeys:f,expoKeysToDelete:h}}function q(a,b){if(b==null)return;var c=b;a.forEach(function(a){c["delete"](a)});if(c.size===0)return;return{internalExpoKeys:c,expoKeyStr:Array.from(c).join(",")}}g.maybeUpdateRefresh=a;g.asAbList=o;g.asAbCode=b;g.parseAbProps=c;g.maybeUpdatePropValues=e;g.maybeUpdateExpoKeys=f;g.maybeUpdateInternalExpoKeys=q}),98);
__d("WAAbProps",["WAAbPropsHelpers","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){if(h)return h;else throw c("err")("abProps::"+a+" called before startAbProps")}function a(a,b){h==null&&(h={config:b,db:a})}function b(){return i("getHash").db.getHash()}function e(){return i("getRefreshSecs").db.getRefreshSecs().then(function(a){return d("WAAbPropsHelpers").maybeUpdateRefresh(a)})}function f(){return i("getConfig").config}function j(){return i("getAbProps").db.getAbProps()}function k(a){return i("getAbProps").db.setAbProps(a)}g.startAbProps=a;g.getHash=b;g.getRefreshSecs=e;g.getConfig=f;g.getAbProps=j;g.setAbProps=k}),98);
__d("WAAppData",[],(function(a,b,c,d,e,f){"use strict";a=1;b=2;f.EPOCH_STATUS_OPEN=a;f.EPOCH_STATUS_CLOSE=b}),66);
__d("WAArmadilloICDC.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="ICDCIdentityList";a.internalSpec={seq:[1,(c=d("WAProtoConst")).TYPES.INT32],timestamp:[2,c.TYPES.INT64],devices:[3,c.FLAGS.REPEATED|c.TYPES.BYTES],signingDeviceIndex:[4,c.TYPES.INT32]};b.name="SignedICDCIdentityList";b.internalSpec={details:[1,c.TYPES.BYTES],signature:[2,c.TYPES.BYTES]};g.ICDCIdentityListSpec=a;g.SignedICDCIdentityListSpec=b}),98);
__d("WAArrayChunk",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c,d){c===void 0&&(c=!1);var e=0,f=[];while(e<a.length){var g=[],h=0;while(e<a.length){var i=a[e],j=d?d(i):1;if(!c&&h===0||h+j<=b)h+=j,g.push(i),e++;else{c&&j>b&&e++;break}}g.length>0&&f.push(g)}return f}f.chunk=a}),66);
__d("WACryptoPkcs7",["WACryptoDependencies","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=new Uint8Array(1);do d("WACryptoDependencies").getCrypto().getRandomValues(b);while(b[0]===0);h(a,b[0])}function b(a){var b=new Uint8Array(1);d("WACryptoDependencies").getCrypto().getRandomValues(b);h(a,(b[0]&15)+1)}function h(a,b){for(var c=0;c<b;c++)a.writeUint8(b)}function e(a){if(a.length===0)throw c("err")("unpadPkcs7 given empty bytes");var b=a[a.length-1];if(b>a.length)throw c("err")("unpadPkcs7 given "+a.length+" bytes, but pad is "+b);return new Uint8Array(a.buffer,a.byteOffset,a.length-b)}g.writeRandomPad=a;g.writeRandomPadMax16=b;g.writePad=h;g.unpadPkcs7=e}),98);
__d("WAMsgTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NOOP:0,UPSERT:1,DELETE:2,UPSERT_AND_DELETE:3};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={},o={};b.name="MessageTransport";b.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,c],protocol:[2,h.TYPES.MESSAGE,e]};c.name="MessageTransport$Payload";c.internalSpec={applicationPayload:[1,h.TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],futureProof:[3,h.TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR]};e.name="MessageTransport$Protocol";e.internalSpec={integral:[1,h.TYPES.MESSAGE,m],ancillary:[2,h.TYPES.MESSAGE,f]};f.name="MessageTransport$Protocol$Ancillary";f.internalSpec={skdm:[2,h.TYPES.MESSAGE,l],deviceListMetadata:[3,h.TYPES.MESSAGE,o],icdc:[4,h.TYPES.MESSAGE,j],backupDirective:[5,h.TYPES.MESSAGE,i]};i.name="MessageTransport$Protocol$Ancillary$BackupDirective";i.internalSpec={messageId:[1,h.TYPES.STRING],actionType:[2,h.TYPES.ENUM,a],supplementalKey:[3,h.TYPES.STRING]};j.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices";j.internalSpec={senderIdentity:[1,h.TYPES.MESSAGE,k],recipientIdentities:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,k],recipientUserJids:[3,h.FLAGS.REPEATED|h.TYPES.STRING]};k.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescription";k.internalSpec={seq:[1,h.TYPES.INT32],signingDevice:[2,h.TYPES.BYTES],unknownDevices:[3,h.FLAGS.REPEATED|h.TYPES.BYTES],unknownDeviceIds:[4,h.FLAGS.REPEATED|h.TYPES.INT32]};l.name="MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessage";l.internalSpec={groupId:[1,h.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,h.TYPES.BYTES]};m.name="MessageTransport$Protocol$Integral";m.internalSpec={padding:[1,h.TYPES.BYTES],dsm:[2,h.TYPES.MESSAGE,n]};n.name="MessageTransport$Protocol$Integral$DeviceSentMessage";n.internalSpec={destinationJid:[1,h.TYPES.STRING],phash:[2,h.TYPES.STRING]};o.name="DeviceListMetadata";o.internalSpec={senderKeyHash:[1,h.TYPES.BYTES],senderTimestamp:[2,h.TYPES.UINT64],recipientKeyHash:[8,h.TYPES.BYTES],recipientTimestamp:[9,h.TYPES.UINT64]};g.MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE=a;g.MessageTransportSpec=b;g.MessageTransport$PayloadSpec=c;g.MessageTransport$ProtocolSpec=e;g.MessageTransport$Protocol$AncillarySpec=f;g.MessageTransport$Protocol$Ancillary$BackupDirectiveSpec=i;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevicesSpec=j;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescriptionSpec=k;g.MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessageSpec=l;g.MessageTransport$Protocol$IntegralSpec=m;g.MessageTransport$Protocol$Integral$DeviceSentMessageSpec=n;g.DeviceListMetadataSpec=o}),98);
__d("WAAsMessageTransport",["WABinary","WACryptoPkcs7","WAJids","WAMsgTransport.pb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a.type){case"text":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.externalId,supplementalKey:null};case"media":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.externalId,supplementalKey:null};case"reaction":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.originalMsgExternalId,supplementalKey:"reaction:"+d("WAJids").extractChatId__DANGEROUS(a.chatJid)};case"edit":return{actionType:d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:a.originalMsgExternalId,supplementalKey:"edit:"+d("WAJids").extractChatId__DANGEROUS(a.chatJid)+":"+(a.timestamp*1e3).toString()}}}function b(a,b,c,e,f,g){g===void 0&&(g=2);var h;b!=null&&(h={destinationJid:b});var i;a!=null&&(i={applicationPayload:{payload:a,version:g}});b=new(d("WABinary").Binary)();d("WACryptoPkcs7").writeRandomPadMax16(b);return{payload:i,protocol:{integral:{padding:b.readBuffer(),dsm:h},ancillary:{skdm:c==null?void 0:c,icdc:e==null?void 0:e,backupDirective:f==null?void 0:{actionType:f.actionType,messageId:f.messageId,supplementalKey:f.supplementalKey}}}}}g.backupDirectiveActionType=d("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE;g.constructBackupDirective=a;g.asMessageTransport=b}),98);
__d("WABuildMpsPayload",["MpsFutureProofKey","MpsTypes","WAArmadilloBackupMessage.pb","WAArmadilloMiTransportAdminMessage.pb","WAArmadilloTransportEvent.pb","WAGlobals","WAJids","WALogger","WATimeUtils","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b){var c=d("WAJids").extractUserId(b.senderJid),e=d("MpsTypes").toThreadId(b.threadId),f;b.hideDecryptionFailure!=null&&(f=b.hideDecryptionFailure?d("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofNoPlaceholder:d("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofPlaceholder);var g=b.millisServerTs!=null?b.millisServerTs:b.serverTs*1e3+d("WAGlobals").getDependencies().extractMsFromStanzaId(b.externalId);a=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,babelHelpers["extends"]({},a,{metadata:{frankingMetadata:{frankingTag:b.frankingTag,reportingTag:b.reportingTag},messageId:b.externalId,payloadVersion:2,senderId:c,futureProofBehavior:f,timestampMs:g}})).readBuffer();return{messageId:d("MpsTypes").toMessageId(b.externalId),payload:a,senderId:c,threadId:e,timestampMs:g}}function a(a,b,c){try{var e={};switch(c.type){case"message":e={encryptedTransportMessage:c.applicationPayload};break;case"ciphertext":e={encryptedTransportEvent:{payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:d("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;case"unavailable":e={encryptedTransportEvent:{payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:d("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;default:c.type}return k(e,{senderJid:d("WAJids").extractUserJid(b.from),externalId:a.stanzaId,serverTs:a.serverTs,frankingTag:a.frankingTag,reportingTag:a.reportingTag,hideDecryptionFailure:a.hideDecryptionFailure,threadId:b.chat})}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["buildMpsMessagePayload: ",""])),a);return null}}function b(a,b,c){if(c.payload==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: No appdata payload"])));return null}try{return k({encryptedTransportMessage:c.payload},{senderJid:d("WAJids").extractUserJid(a.from),externalId:a.stanzaId,serverTs:b,threadId:d("WAJids").extractUserJid(a.from)})}catch(a){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: ",""])),a);return null}}function c(a,b,c,e,f){c={payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupMembershipAddModeChanged:{mode:c}}).readBuffer(),version:3};return k({miTransportAdminMessage:c},{serverTs:e!=null?e:d("WATimeUtils").unixTime(),externalId:f,hideDecryptionFailure:!1,senderJid:b,threadId:a})}function e(a,b,c,e,f,g){c={payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupAdminChanged:{targetUserId:c.map(d("WAJids").extractUserId),action:e}}).readBuffer(),version:3};return k({miTransportAdminMessage:c},{serverTs:f!=null?f:d("WATimeUtils").unixTime(),externalId:g,hideDecryptionFailure:!1,senderJid:b,threadId:a})}function f(a,b,c,e,f,g){c={payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupParticipantChanged:{targetUserId:c.map(d("WAJids").extractUserId),action:e}}).readBuffer(),version:3};return k({miTransportAdminMessage:c},{serverTs:f!=null?f:d("WATimeUtils").unixTime(),externalId:g,hideDecryptionFailure:!1,senderJid:b,threadId:a})}function l(a,b,c,e,f){c={payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupNameChanged:{groupName:c}}).readBuffer(),version:3};return k({miTransportAdminMessage:c},{serverTs:e!=null?e:d("WATimeUtils").unixTime(),externalId:f,hideDecryptionFailure:!1,senderJid:b,threadId:a})}function m(a,b,c){var e={payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{icdcAlert:{type:d("WAArmadilloTransportEvent.pb").TransportEvent$Event$IcdcAlert$Type.DETECTED}}}).readBuffer(),version:3};return k({encryptedTransportEvent:e},{serverTs:b!=null?b:d("WATimeUtils").unixTime(),externalId:c,hideDecryptionFailure:!1,senderJid:a,threadId:a})}function n(a,b,c,e,f,g){e={payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{deviceChange:{type:e,devicePlatform:f,deviceModel:g}}}).readBuffer(),version:3};return k({encryptedTransportEvent:e},{serverTs:b!=null?b:d("WATimeUtils").unixTime(),externalId:c,hideDecryptionFailure:!1,senderJid:a,threadId:a})}g.buildMpsMessage=k;g.buildMpsMessageFromIncomingMessage=a;g.buildMpsAppdataPayload=b;g.buildMpsGroupMemberAddType=c;g.buildMpsGroupAdminChangedMsg=e;g.buildMpsGroupParticipantsChanged=f;g.buildMpsGroupNameChangedMsg=l;g.buildMpsIcdcAdminMessage=m;g.buildMpsDeviceChangeAdminMessage=n}),98);
__d("WAConvertRegistrationIdMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAParsableXmlNode").convertBytesToUint(a.registrationElementValue,4)}g.registrationIdMixin=a}),98);
__d("WAConvertSignedPreKeyMixin",["WAParsableXmlNode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.skeyIdKeyIDMixin.elementValue,3),pubkey:a.skeyValueKeyDataMixin.elementValue,signature:a.skeySignatureElementValue}}g.convertSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInPreKeysIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInPreKeysIQErrorNoValidJIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNoValidJIDMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetch",["WAResultOrError","WASmaxInPreKeysIQErrorBadRequestMixin","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNoValidJIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInPreKeysIQErrorNoValidJIDMixin").parseIQErrorNoValidJIDMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorNoValidJID",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorNoValidJID","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetch=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetch","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetch").parseRequestErrorsFetch(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetch:b.value}))}g.parseFetchKeyBundlesResponseRequestError=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInPreKeysIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInPreKeysServerErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackServerMixin","WASmaxInPreKeysIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorServiceUnavailable","IQErrorFallbackServer"],[b,c])}g.parseServerErrors=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchKeyBundlesResponseServerError=a}),98);
__d("WASmaxInPreKeysEnums",["WAJids"],(function(a,b,c,d,e,f,g){b={validators:[(a=d("WAJids")).validateDeviceJid,a.validateDeviceJid],typeName:"DeviceJid|DeviceJid"};c={validators:[a.validateDeviceJid,a.validateDeviceJid,a.validateInteropDeviceJid,a.validateInteropDeviceJid],typeName:"DeviceJid|DeviceJid|InteropDeviceJid|InteropDeviceJid"};e={validators:[a.validateDeviceJid,a.validateDomainJid],typeName:"DeviceJid|DomainJid"};f={validators:[a.validateUserJid,a.validateUserJid],typeName:"UserJid|UserJid"};g.DEVICEJID_DEVICEJID=b;g.DEVICEJID_DEVICEJID_INTEROPDEVICEJID_INTEROPDEVICEJID=c;g.DEVICEJID_DOMAINJID=e;g.USERJID_USERJID=f}),98);
__d("WASmaxInPreKeysIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInPreKeysResponsePaddingMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"padding");if(!b.success)return b;a=d("WASmaxParseUtils").contentBytesRange(b.value,0,524288);return!a.success?a:d("WAResultOrError").makeResult({paddingElementValue:a.value})}g.parseResponsePaddingMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"code",500,599);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorFallbackMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,b.value,"code",500);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorMixin=a}),98);
__d("WASmaxInPreKeysDeviceIdentityMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"device-identity");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytes(a.value);return!a.success?a:d("WAResultOrError").makeResult({deviceIdentityElementValue:a.value})}g.parseDeviceIdentityMixin=a}),98);
__d("WASmaxInPreKeysKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInPreKeysIdentityKeyMixin",["WASmaxInPreKeysKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInPreKeysKeyTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"type");if(!a.success)return a;a=d("WASmaxParseUtils").contentLiteralBytes(a.value,new Uint8Array([5]));return!a.success?a:d("WAResultOrError").makeResult({typeElementValue:a.value})}g.parseKeyTypeMixin=a}),98);
__d("WASmaxInPreKeysKeyIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,3,3);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseKeyIDMixin=a}),98);
__d("WASmaxInPreKeysPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"key");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:d("WAResultOrError").makeResult({keyIdKeyIDMixin:b.value,keyValueKeyDataMixin:a.value})}g.parsePreKeyMixin=a}),98);
__d("WASmaxInPreKeysRegistrationIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"registration");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,4,4);return!a.success?a:d("WAResultOrError").makeResult({registrationElementValue:a.value})}g.parseRegistrationIDMixin=a}),98);
__d("WASmaxInPreKeysSignedPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"skey");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!c.success)return c;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"signature");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,64,64);if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;c=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(c.value);return!c.success?c:d("WAResultOrError").makeResult({skeySignatureElementValue:a.value,skeyIdKeyIDMixin:b.value,skeyValueKeyDataMixin:c.value})}g.parseSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin",["WAResultOrError","WASmaxInPreKeysDeviceIdentityMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysPreKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"is_cloud_api","true");if(!c.success)return c;var e=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a),g=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!g.success)return g;var h=d("WASmaxInPreKeysPreKeyMixin").parsePreKeyMixin(a),i=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!i.success)return i;a=d("WASmaxInPreKeysDeviceIdentityMixin").parseDeviceIdentityMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({t:b.value,isCloudApi:c.value},e.value,{keyTypeMixin:f.success?f.value:null},g.value,{preKeyMixin:h.success?h.value:null},i.value,{deviceIdentityMixin:a.success?a.value:null}))}g.parseFetchKeyBundlesUserSuccessMixin=a}),98);
__d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup",["WAResultOrError","WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin","WASmaxInPreKeysFetchKeyBundlesUserErrorMixin","WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin").parseFetchKeyBundlesUserSuccessMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserSuccess",value:b.value});var c=d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin").parseFetchKeyBundlesUserErrorMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserError",value:c.value});var e=d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin").parseFetchKeyBundlesUserErrorFallbackMixin(a);return e.success?d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserErrorFallback",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserSuccess","UserError","UserErrorFallback"],[b,c,e])}g.parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess",["WAResultOrError","WASmaxInPreKeysEnums","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysResponsePaddingMixin","WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseJid").attrJidEnum(a,"jid",d("WASmaxInPreKeysEnums").DEVICEJID_DEVICEJID);if(!b.success)return b;a=d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup").parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!c.success)return c;b=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInPreKeysResponsePaddingMixin").parseResponsePaddingMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,1e5,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{responsePaddingMixin:a.success?a.value:null,listUser:c.value}))}g.parseFetchKeyBundlesResponseSuccessListUser=h;g.parseFetchKeyBundlesResponseSuccess=a}),98);
__d("WASmaxAttrs",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return d("WAWap").DROP_ATTR;else return a(b)}function b(a,b){if(b)return a;else return d("WAWap").DROP_ATTR}g.OPTIONAL=a;g.OPTIONAL_LITERAL=b}),98);
__d("WASmaxChildren",["WADeepEquals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return null;else return a(b)}function b(a,b){if(b==null)return null;else if(b)return a()}function c(a,b){if(b)for(var c=1;c<b.length;c++)if(!d("WADeepEquals").deepEqual(b[c],b[0]))throw new Error("expected all homogeneous children to be equal, but they were not");c=h(a,b,0,Infinity);return c}function e(a,b){return i(a,b,0,Infinity)}function h(a,b,c,d){if(b==null){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}var e=b.length;if(e<c)throw new Error("expected at least "+c+" children, but found "+e);else if(e>d)throw new Error("expected at most "+d+" children, but found "+e);return b.map(function(b){return a(b)})}function i(a,b,c,d){if(b===0){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}if(b<c)throw new Error("expected at least "+c+" children, but found "+b);else if(b>d)throw new Error("expected at most "+d+" children, but found "+b);c=[];for(d=0;d<b;d++)c.push(a());return c}g.OPTIONAL_CHILD=a;g.HAS_OPTIONAL_CHILD=b;g.HOMOGENEOUS_CHILD=c;g.HOMOGENEOUS_CHILD_COUNT=e;g.REPEATED_CHILD=h;g.REPEATED_CHILD_COUNT=i}),98);
__d("WASmaxOutPreKeysClientRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientRequestMixin=a}),98);
__d("WASmaxOutPreKeysFetchKeyBundlesRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid;a=a.hasUserReasonIdentity;b=d("WASmaxJsx").smax("user",{jid:d("WAWap").JID(b),reason:d("WASmaxAttrs").OPTIONAL_LITERAL("identity",a)});return b}function a(a){a=a.userArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("key",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,1e5))));return a}g.makeFetchKeyBundlesRequestKeyUser=h;g.makeFetchKeyBundlesRequest=a}),98);
__d("WASmaxParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,"SmaxParsingFailure: "+b)||this;c.name="SmaxParsingFailure";c.reason=b;return c}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.toString=function(){return"SmaxParsingFailure: "+this.reason};return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxParsingFailure=a}),66);
__d("WASmaxRpcUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=Object.keys(b).map(function(a){var c=a==="Request"?"<request>":'<response name="'+a+'">';return"Tried "+c+", but failed with "+b[a].error+"."}).join(" ");return'Failed to parse incoming stanza of <rpc name="'+a+'">. '+c}f.errorMessageRpcParsing=a}),66);
__d("WASmaxPreKeysFetchKeyBundlesRPC",["WAComms","WASmaxInPreKeysFetchKeyBundlesResponseRequestError","WASmaxInPreKeysFetchKeyBundlesResponseServerError","WASmaxInPreKeysFetchKeyBundlesResponseSuccess","WASmaxOutPreKeysFetchKeyBundlesRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutPreKeysFetchKeyBundlesRequest").makeFetchKeyBundlesRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess").parseFetchKeyBundlesResponseSuccess(b,a);if(c.success)return{name:"FetchKeyBundlesResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError").parseFetchKeyBundlesResponseRequestError(b,a);if(e.success)return{name:"FetchKeyBundlesResponseRequestError",value:e.value};b=d("WASmaxInPreKeysFetchKeyBundlesResponseServerError").parseFetchKeyBundlesResponseServerError(b,a);if(b.success)return{name:"FetchKeyBundlesResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchKeyBundles",{Success:c,RequestError:e,ServerError:b}))});return h.apply(this,arguments)}g.sendFetchKeyBundlesRPC=a}),98);
__d("WAFetchPreKeyBundlesProtocol",["WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchKeyBundlesRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("WATagsLogger").TAGS(["fetchPreKeyBundlesProtocol"]);function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){l.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start fetching prekey of ","..."])),a.join(", "));a=(yield d("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:a.map(function(a){return{userJid:a,hasUserReasonIdentity:!1}})}));switch(a.name){case"FetchKeyBundlesResponseSuccess":l.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["fetched prekey successfully"])));var b=new Map();a.value.listUser.map(function(a){var c=a.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;c.name==="FetchKeyBundlesUserSuccess"&&b.set(a.jid,n(c.value))});return d("WAResultOrError").makeResult(b);case"FetchKeyBundlesResponseServerError":var c=a.value.errorServerErrors.name;l.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["ServerError: ",""])),c);return d("WAResultOrError").makeError({type:"server-error",payload:c});case"FetchKeyBundlesResponseRequestError":c=a.value.errorRequestErrorsFetch.name;l.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["RequestError: ",""])),c);return d("WAResultOrError").makeError({type:"request-error",payload:c})}});return m.apply(this,arguments)}function n(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WASignalKeys").serializeIdentity(a.elementValue),e=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),f=a.preKeyMixin?o(a.preKeyMixin):null;a=d("WATimeUtils").castToUnixTime(a.t||0);return{keys:{regId:b,identity:c,oneTimeKey:f,signedKey:{id:e.id,signature:e.signature,publicKey:d("WASignalKeys").serializeIdentity(e.pubkey)}},timestamp:a}}function o(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.keyIdKeyIDMixin.elementValue,3),publicKey:d("WASignalKeys").serializeIdentity(a.keyValueKeyDataMixin.elementValue)}}g.fetchPreKeyBundlesProtocol=a}),98);
__d("WABulkRequestKeys",["WAFetchPreKeyBundlesProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAFetchPreKeyBundlesProtocol").fetchPreKeyBundlesProtocol(a));return!a.success?d("WAResultOrError").makeError("errRequestKeysParsingFailed"):d("WAResultOrError").makeResult(a.value)});return h.apply(this,arguments)}g.bulkRequestKeys=a}),98);
__d("WALock",["Promise","WAResolvable","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return{lock:function(c,e){var f=new(d("WAResolvable").Resolvable)(),g=c.map(function(a){return[a,new(d("WAResolvable").Resolvable)()]});(i||(i=b("Promise"))).all(g.map(function(b){var c=b[0],d=b[1];return a.enqueue(c,function(){d.resolve();return f.promise})}))["catch"](function(){d("WATagsLogger").TAGS(["WALock"]).ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Lock failed for ",""])),c)});return i.all(g.map(function(a){a[0];a=a[1];return a.promise})).then(function(){return e()})["finally"](function(){f.resolve()})},wait:function(b){return a.wait(b)}}}g.makeLock=a}),98);
__d("WAPromiseQueue",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(a){a===void 0&&(a=-1),this.$1=(g||(g=b("Promise"))).resolve(),this.$3=0,this.$2=a}var c=a.prototype;c.wait=function(){return this.$1};c.enqueueHandlers=function(a,b,c){var d=this;this.$3++;b=this.$1.then(function(){return a}).then(b,c);c=b.then();this.$1=h(b,this.$2)["finally"](function(){d.$3--});return c};c.enqueue=function(a){var b=this;this.$3++;a=this.$1.then(a);var c=a.then();this.$1=h(a,this.$2)["finally"](function(){b.$3--});return c};c.size=function(){return this.$3};return a}();c=function(){function a(a){a===void 0&&(a=-1),this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitIfPending=function(a){return this.$1.get(a)};c.wait=function(a){return this.$1.get(a)||(g||(g=b("Promise"))).resolve()};c.enqueueHandlers=function(a,b,c,d){c=this.wait(a).then(function(){return b}).then(c,d);return this.$3(a,c)};c.enqueue=function(a,b){b=this.wait(a).then(b);return this.$3(a,b)};c.$3=function(a,b){var c=this,d=b.then(),e,f=function(){c.$1.get(a)===e&&c.$1["delete"](a)};e=h(b,this.$2).then(f,f);this.$1.set(a,e);return d};return a}();function h(a,c){if(c>=0)return new(g||(g=b("Promise")))(function(b){var d=function(){return void b()};a.then(d,d);setTimeout(d,c)});else return a.then(i,i)}function i(){}f.PromiseQueue=a;f.PromiseQueueMap=c}),66);
__d("WALockMap",["WALock","WAPromiseQueue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a===void 0&&(a=-1);a=new(d("WAPromiseQueue").PromiseQueueMap)(a);return d("WALock").makeLock(a)}g.makeLockMap=a}),98);
__d("WACryptoLibraryConfig",[],(function(a,b,c,d,e,f){"use strict";var g={signalFutureMessagesMax:2e3,S508658PreventOldSessionLookupAndPromote:!1,S508658AutoAcknowledgeStaleSessions:!1};function a(){return g}function b(a){g=a}f.getCryptoLibraryConfig=a;f.setCryptoLibraryConfig=b}),66);
__d("WASignalSessions",["WABinary","WACryptoLibraryConfig","WASignalKeys","WASignalOther","err"],(function(a,b,c,d,e,f,g){"use strict";var h=3;function a(a){if(!d("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658AutoAcknowledgeStaleSessions)return a;return a.initialExchangeInfo==null?a:o(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,null,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function b(a,b){return i(a,0,b,[])}function i(a,b,c,d){return{ratchetPubKey:a,nextMsgIndex:b,chainKey:c,unusedMsgKeys:d}}function e(a,b){return j(a,0,b)}function j(a,b,c){return{ratchetKey:a,nextMsgIndex:b,chainKey:c}}function k(a,b,c){return{remoteOneTimeId:a,remoteSignedId:b,localOneTimePubKey:c}}function f(a,b){return o(a.local,a.remote,a.rootKey,a.recvChains,a.sendChain,a.initialExchangeInfo,a.prevSendChainHighestIndex,b,a.aliceBaseKey)}function l(a,b,c){return o(a.local,a.remote,a.rootKey,b,c,a.initialExchangeInfo,a.prevSendChainHighestIndex,a.prevSessions,a.aliceBaseKey)}function m(a,b,c,d){c===void 0&&(c=a.sendChain);return o(a.local,a.remote,d,b,c,null,Math.max(a.sendChain.nextMsgIndex-1,0),a.prevSessions,a.aliceBaseKey)}function n(a,b,c,d,e,f,g){return o(a,b,c,d,e,f,0,[],g)}function o(a,b,c,d,e,f,g,h,i){return{local:a,remote:b,rootKey:c,sendChain:e,recvChains:d,initialExchangeInfo:f,prevSendChainHighestIndex:g,prevSessions:h,aliceBaseKey:i}}function p(a,b){b=new(d("WABinary").Binary)(b);var c=d("WASignalOther").readBytes(b,32),e=d("WASignalOther").readBytes(b,32);b=d("WASignalOther").readBytes(b,16);return q(a,c,e,b)}function q(a,b,c,d){return{index:a,cipherKey:b,macKey:c,iv:d}}function r(a){return{senderRatchetKey:a.ratchetPubKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey},messageKeys:a.unusedMsgKeys}}function s(a){var b=a.ratchetKey;return{senderRatchetKey:b.serializedPubKey,senderRatchetKeyPrivate:b.privateKey,chainKey:{index:a.nextMsgIndex,key:a.chainKey}}}function t(a){var b=a.local,c=a.remote,d=a.initialExchangeInfo,e=void 0;if(d){var f=d.remoteOneTimeId;e={preKeyId:f!=null?f:void 0,signedPreKeyId:d.remoteSignedId,baseKey:d.localOneTimePubKey}}return{currentSession:{sessionVersion:h,localIdentityPublic:b.pubKey,remoteIdentityPublic:c.pubKey,rootKey:a.rootKey,previousCounter:a.prevSendChainHighestIndex,senderChain:s(a.sendChain),receiverChains:a.recvChains.map(r),pendingPreKey:e,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey},previousSessions:a.prevSessions}}function u(a){var b=a.local,c=a.remote,e=a.sendChain,f=a.initialExchangeInfo,g=void 0;if(f){var i=f.remoteOneTimeId;g={preKeyId:i!=null?i:void 0,signedPreKeyId:f.remoteSignedId,baseKey:d("WASignalOther").toBuffer(f.localOneTimePubKey)}}return{sessionVersion:h,localIdentityPublic:d("WASignalOther").toBuffer(b.pubKey),remoteIdentityPublic:d("WASignalOther").toBuffer(c.pubKey),rootKey:d("WASignalOther").toBuffer(a.rootKey),previousCounter:a.prevSendChainHighestIndex,senderChain:{senderRatchetKey:d("WASignalOther").toBuffer(e.ratchetKey.serializedPubKey),senderRatchetKeyPrivate:d("WASignalOther").toBuffer(e.ratchetKey.privateKey),chainKey:{index:e.nextMsgIndex,key:d("WASignalOther").toBuffer(e.chainKey)},messageKeys:[]},receiverChains:a.recvChains.map(function(a){return{senderRatchetKey:d("WASignalOther").toBuffer(a.ratchetPubKey),chainKey:{index:a.nextMsgIndex,key:d("WASignalOther").toBuffer(a.chainKey)},messageKeys:a.unusedMsgKeys.map(function(a){return{index:a.index,cipherKey:d("WASignalOther").toBuffer(a.cipherKey),macKey:d("WASignalOther").toBuffer(a.macKey),iv:d("WASignalOther").toBuffer(a.iv)}})}}),pendingPreKey:g,remoteRegistrationId:c.regId,localRegistrationId:b.regId,aliceBaseKey:a.aliceBaseKey==null?void 0:d("WASignalOther").toBuffer(a.aliceBaseKey)}}function v(a){var b=B(a.currentSession,"currentSession");return x(b,a.previousSessions)}function w(a){return x(a,[])}function x(a,b){var e=B(a.sessionVersion,"sessionVersion");if(e!==h)throw c("err")("Signal: bad session version "+e);e=B(a.senderChain,"senderChain");var f=B(e.chainKey,"senderChain.chainKey");e=j(d("WASignalKeys").makeSerializedKeyPairFrom(A(e.senderRatchetKeyPrivate,32,"senderRatchetKeyPrivate"),z(e.senderRatchetKey,"senderRatchetKey")),B(f.index,"senderChain.chainKey.index"),A(f.key,32,"senderChain.chainKey.key"));f=B(a.receiverChains,"receiverChains").map(function(a){var b=B(a.chainKey,"receiverChains[].chainKey");return i(z(a.senderRatchetKey,"receiverChains[].senderRatchetKey"),B(b.index,"receiverChains[].chainKey.index"),A(b.key,32,"receiverChains[].chainKey.key"),y(a.messageKeys))});var g={regId:d("WASignalOther").castRegistrationId(B(a.localRegistrationId,"localRegistrationId")),pubKey:z(a.localIdentityPublic,"localIdentityPublic")},l={regId:d("WASignalOther").castRegistrationId(B(a.remoteRegistrationId,"remoteRegistrationId")),pubKey:z(a.remoteIdentityPublic,"remoteIdentityPublic")},m=a.pendingPreKey,n=null;if(m){var p=m.preKeyId;n=k(p!=null?d("WASignalKeys").castToPreKeyId(p):null,d("WASignalKeys").castToSignedPreKeyId(B(m.signedPreKeyId,"pendingPreKey.signedPreKeyId")),z(m.baseKey,"pendingPreKey.baseKey"))}p=a.aliceBaseKey==null?null:z(a.aliceBaseKey,"aliceBaseKey");return o(g,l,A(a.rootKey,32,"rootKey"),f,e,n,a.previousCounter||0,b,p)}function y(a){return a.map(function(a){return{index:B(a.index,"messageKeys[].index"),cipherKey:A(a.cipherKey,32,"messageKeys[].cipherKey"),macKey:A(a.macKey,32,"messageKeys[].macKey"),iv:A(a.iv,16,"messageKeys[].iv")}})}function z(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(B(a,b)))}function A(a,b,c){return d("WASignalOther").toBytes(B(a,c),b)}function B(a,b){if(a==null)throw c("err")("Signal: protobuf is missing "+b);return a}g.FORMAT_VERSION=h;g.maybeClearPendingPreKey=a;g.makeFreshRecvChain=b;g.makeRecvChain=i;g.makeFreshSendChain=e;g.makeSendChain=j;g.makeInitialExchangeInfo=k;g.setPrevSessions=f;g.updateChains=l;g.ratchetSession=m;g.makeFreshSession=n;g.makeSession=o;g.splitMsgKey=p;g.serializeSession=t;g.detachSession=u;g.parseSessionFromRecord=v;g.parseSession=w;g._parseSession=x;g.bytesOrThrow=A;g.definedOrThrow=B}),98);
__d("WASignalWhisperTextProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={};a.internalSpec={ratchetKey:[1,(d=d("WAProtoConst")).TYPES.BYTES],counter:[2,d.TYPES.UINT32],previousCounter:[3,d.TYPES.UINT32],ciphertext:[4,d.TYPES.BYTES]};b.internalSpec={registrationId:[5,d.TYPES.UINT32],preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[6,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],identityKey:[3,d.TYPES.BYTES],message:[4,d.TYPES.BYTES]};c.internalSpec={id:[1,d.TYPES.UINT32],baseKey:[2,d.TYPES.BYTES],ratchetKey:[3,d.TYPES.BYTES],identityKey:[4,d.TYPES.BYTES],baseKeySignature:[5,d.TYPES.BYTES]};e.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],ciphertext:[3,d.TYPES.BYTES]};f.internalSpec={id:[1,d.TYPES.UINT32],iteration:[2,d.TYPES.UINT32],chainKey:[3,d.TYPES.BYTES],signingKey:[4,d.TYPES.BYTES]};h.internalSpec={generation:[1,d.TYPES.UINT32],signature:[2,d.TYPES.BYTES]};g.SignalMessageSpec=a;g.PreKeySignalMessageSpec=b;g.KeyExchangeMessageSpec=c;g.SenderKeyMessageSpec=e;g.SenderKeyDistributionMessageSpec=f;g.DeviceConsistencyCodeMessageSpec=h}),98);
__d("WASignalGroupSession",["WASignalKeys","WASignalSessions"],(function(a,b,c,d,e,f,g){"use strict";var h=5,i=3;function j(a){var b=d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey"),c=d("WASignalSessions").definedOrThrow(a.senderMessageKeys,"senderMessageKeys"),e=d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey");return{senderSigningKeyPublic:r(b["public"],"public"),senderSigningKeyPrivate:b["private"]?d("WASignalSessions").bytesOrThrow(b["private"],32,"private"):void 0,senderKeyId:d("WASignalSessions").definedOrThrow(a.senderKeyId,"senderKeyId"),unusedMsgKeys:c.map(function(a){return k(d("WASignalSessions").definedOrThrow(a.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(a.seed,50,"seed"))}),senderKeyChainKey:l(d("WASignalSessions").definedOrThrow(e.iteration,"iteration"),d("WASignalSessions").bytesOrThrow(e.seed,32,"seed"))}}function a(a,b,c,d,e){return{senderSigningKeyPublic:a,senderSigningKeyPrivate:b,senderKeyChainKey:c,senderKeyId:d,unusedMsgKeys:e==null?[]:e}}function b(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b.senderKeyId});return{senderKeyStates:a.senderKeyStates.map(function(a,d){return d===c?b:a})}}function c(a,b){a=a.senderKeyStates.slice(a.senderKeyStates.length>h-1?1:0);a.push(b);return{senderKeyStates:a}}function e(a){return{senderKeyStates:[a]}}function k(a,b){return{iteration:a,seed:b}}function l(a,b){return{nextMsgIndex:a,chainKey:b}}function f(a){a=d("WASignalSessions").definedOrThrow(a.senderKeyStates,"senderKeyStates");return m(a)}function m(a){return n(a)}function n(a){a=a.map(function(a){return j(a)});return{senderKeyStates:a}}function o(a,b){var c=a.senderKeyStates.findIndex(function(a){return a.senderKeyId===b});return c===-1?void 0:a.senderKeyStates[c]}function p(a){return{senderKeyStates:a.senderKeyStates.map(function(a){return q(a)})}}function q(a){return{senderKeyId:a.senderKeyId,senderChainKey:{iteration:a.senderKeyChainKey.nextMsgIndex,seed:a.senderKeyChainKey.chainKey},senderSigningKey:{"public":a.senderSigningKeyPublic,"private":a.senderSigningKeyPrivate},senderMessageKeys:a.unusedMsgKeys.map(function(a){var b=a.iteration;a=a.seed;return{iteration:b,seed:a}})}}function r(a,b){return d("WASignalKeys").castToSerializedPubKey(new Uint8Array(d("WASignalSessions").definedOrThrow(a,b)))}function s(a){return a}g.FORMAT_VERSION=i;g.makeSenderKeyState=a;g.updateSessionWithUpdatedSenderKeyState=b;g.updateSessionWithNewSenderKeyState=c;g.makeNewSenderKeySession=e;g.makeSenderKeyMsgKey=k;g.makeSenderKeyChainKey=l;g.parseSessionFromRecord=f;g._parseSession=m;g.makeSenderKeySessionFromRecord=n;g.findSenderKeyState=o;g.serializeSession=p;g.serializeSenderKeyState=q;g.convertFromRawToSenderKeyState=s}),98);
__d("WASignalWhitepaper",["Promise","WABinary","WACryptoDependencies","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Uint8Array(32);i.fill(255);var j=new Uint8Array([1]),k=new Uint8Array([2]);function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e,f=a.regId;a=a.staticKeyPair;var g=b.identity,h=b.signedKey.publicKey,j=c.privateKey,k=a.privateKey;e=(e=b.oneTimeKey)==null?void 0:e.publicKey;k=d("WABinary").Binary.build(i,v(k,h),v(j,g),v(j,h),e&&v(j,e)).readByteArrayView();h=(yield t(k,"WhisperText"));j=h[0];e=h[1];k=b.ratchetKey;h=d("WASignalSessions").makeFreshRecvChain(k,e);e=d("WASignalKeys").makeSerializedKeyPair();j=(yield r(j,e,k));k=d("WASignalSessions").makeInitialExchangeInfo(b.oneTimeKey==null?null:b.oneTimeKey.id,b.signedKey.id,d("WASignalKeys").serializePubKey(c));return d("WASignalSessions").makeFreshSession({regId:f,pubKey:d("WASignalKeys").serializePubKey(a)},{regId:b.regId,pubKey:g},j.rootKey,[h],d("WASignalSessions").makeFreshSendChain(e,j.chainKey),k,d("WASignalKeys").serializePubKey(c))});return l.apply(this,arguments)}function c(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g=a.regId;a=a.staticKeyPair;var h=a.privateKey,j=e.signed.privateKey,k=c,l=b.pubKey;f=(f=e.oneTime)==null?void 0:f.privateKey;l=d("WABinary").Binary.build(i,w(l,j),w(k,h),w(k,j),f&&w(k,f)).readByteArrayView();h=(yield t(l,"WhisperText"));j=h[0];k=h[1];f=e.ratchet;l=d("WASignalSessions").makeFreshSendChain(f,k);return d("WASignalSessions").makeSession({regId:g,pubKey:d("WASignalKeys").serializePubKey(a)},b,j,[],l,null,0,[],c)});return m.apply(this,arguments)}function e(a){a=d("WASignalGroupSession").makeSenderKeyState(d("WASignalKeys").serializePubKey(a),a.privateKey,d("WASignalGroupSession").makeSenderKeyChainKey(0,d("WASignalKeys").makeRawSenderKey()),d("WASignalOther").makeSenderKeyId(),[]);return(h||(h=b("Promise"))).resolve(d("WASignalGroupSession").makeNewSenderKeySession(a))}function f(a,c,e,f,g){e=d("WASignalGroupSession").makeSenderKeyState(e,void 0,d("WASignalGroupSession").makeSenderKeyChainKey(c,f),a,[]);c=null;g?c=d("WASignalGroupSession").updateSessionWithNewSenderKeyState(g,e):c=d("WASignalGroupSession").makeNewSenderKeySession(e);return(h||(h=b("Promise"))).resolve(c)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));c=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};var f=c(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperMessageKeys",80)}).then(function(b){return d("WASignalSessions").splitMsgKey(a,b)});c=c(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return(h||(h=b("Promise"))).all([c,f])});return o.apply(this,arguments)}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WASignalOther").makeCryptoKey(c,"hmac-sha256"));c=function(a){return d("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},e,a)};var f=c(j).then(function(a){return d("WASignalOther").hkdf(new Uint8Array(a),null,"WhisperGroup",50)}).then(function(b){return d("WASignalGroupSession").makeSenderKeyMsgKey(a,b)});c=c(k).then(function(a){return d("WASignalOther").toBytes(a,32)});return(h||(h=b("Promise"))).all([c,f])});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=b.privateKey;c=c;b=d("WASignalKeys").ecdh(b,c);c=(yield t(new Uint8Array(b),"WhisperRatchet",a));b=c[0];a=c[1];return{rootKey:b,chainKey:a}});return s.apply(this,arguments)}function t(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=null);a=(yield d("WASignalOther").hkdf(a,c,b,64));return[d("WASignalOther").sliceBytes(a,0,32),d("WASignalOther").sliceBytes(a,32,32)]});return u.apply(this,arguments)}function v(a,b){return new Uint8Array(d("WASignalKeys").ecdh(a,b))}function w(a,b){return v(b,a)}g.initiateSessionOutgoing=a;g.initiateSessionIncoming=c;g.initiateSenderKeySessionOutgoing=e;g.initiateSenderKeySessionIncoming=f;g.deriveMsgKey=n;g.deriveSenderKeyMsgKey=p;g.calculateRatchet=r}),98);
__d("WASignalCipher",["Promise","WABinary","WACryptoDependencies","WACryptoLibraryConfig","WACryptoUtils","WALogger","WAResultOrError","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=40,m=8,n=2e3;function a(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.sendChain,e=(yield d("WASignalWhitepaper").deriveMsgKey(c.nextMsgIndex,c.chainKey)),f=e[0];e=e[1];var g=(yield B(e)),h=g.cipherKey;g=g.macKey;h=(yield d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:e.iv},h,b));b=new(d("WABinary").Binary)();b.writeByteArray(a.local.pubKey);b.writeByteArray(a.remote.pubKey);var i=b.size();b.writeUint8(y(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,{ratchetKey:c.ratchetKey.serializedPubKey,counter:e.index,previousCounter:a.prevSendChainHighestIndex,ciphertext:h},b);h=b.readByteArrayView();b=(yield A(g,h));g=h.subarray(i);h=d("WABinary").Binary.build(g,new Uint8Array(b,0,m)).readByteArrayView();i=a.initialExchangeInfo;if(i!=null){g=new(d("WABinary").Binary)();g.writeUint8(y(d("WASignalSessions").FORMAT_VERSION,d("WASignalSessions").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,{registrationId:a.local.regId,preKeyId:(b=i.remoteOneTimeId)!=null?b:void 0,signedPreKeyId:i.remoteSignedId,baseKey:i.localOneTimePubKey,identityKey:a.local.pubKey,message:h},g);b="pkmsg";i=g.readByteArrayView()}else b="msg",i=h;g=d("WASignalSessions").makeSendChain(c.ratchetKey,e.index+1,f);h=d("WASignalSessions").updateChains(a,a.recvChains,g);return[h,{type:b,ciphertext:i}]});return o.apply(this,arguments)}function c(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a==null)return d("WAResultOrError").makeError("errSignalNoSession");var c=(yield t(a,b));if(c.success){var e=c.value,f=e[0];e=e[1];return d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:f,plaintext:e})}else{f=a.prevSessions;e=c;for(c=0;!e.success&&c<f.length;c++){var g=d("WASignalSessions").maybeClearPendingPreKey(d("WASignalSessions").parseSession(f[c])),h=(yield t(g,b));if(h.success){h=h.value;var i=h[0];h=h[1];i=d("WASignalSessions").setPrevSessions(i,[d("WASignalSessions").detachSession(a)].concat(f.slice(0,c),f.slice(c+1)));var j=!a||!d("WACryptoUtils").serializedPubKeysEqual(i.remote.pubKey,a.remote.pubKey)?i.remote.pubKey:null;e=d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:j,baseSession:g,usedPreKey:null},updatedSession:i,plaintext:h})}}return e}});return p.apply(this,arguments)}function e(a,b){if(a==null)return d("WAResultOrError").makeResult(null);a=a;if(C(a,b))return d("WAResultOrError").makeResult(a);var c=a.prevSessions;for(var e=0;e<c.length;e++){var f=d("WASignalSessions").parseSession(c[e]);if(C(f,b))return d("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658PreventOldSessionLookupAndPromote===!0?d("WAResultOrError").makeError("errSignalInvalidMsg"):d("WAResultOrError").makeResult(d("WASignalSessions").setPrevSessions(f,[d("WASignalSessions").detachSession(a)].concat(c.slice(0,e),c.slice(e+1))))}return d("WAResultOrError").makeResult(null)}function f(a,b,c,d){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=e.localSignedPreKey;if(f==null)return d("WAResultOrError").makeError("errSignalInvalidSignedPreKey");f=d("WASignalSignatures").deserializeSignedPreKey(f);if(f==null)return d("WAResultOrError").makeError("errSignalSignedPreKeyDeserialization");if(f.id!==c.localSignedPreKeyId)return d("WAResultOrError").makeError("errSignalSignedPreKeyIdMismatch");var g=null;if(c.localOneTimeKeyId!=null){e=e.localOneTimeKey;if(e==null)return d("WAResultOrError").makeError("errSignalInvalidOneTimeKey");g=d("WASignalKeys").deserializePreKey(e);if(g==null)return d("WAResultOrError").makeError("errSignalOneTimeKeyDeserialization");if(g.id!==c.localOneTimeKeyId)return d("WAResultOrError").makeError("errSignalOneTimeKeyMismatch")}a=(yield d("WASignalWhitepaper").initiateSessionIncoming(a,c.remote,c.sessionBaseKey,{signed:f.keyPair,oneTime:(e=g)==null?void 0:e.keyPair,ratchet:d("WASignalKeys").toSerializedKeyPair(f.keyPair)}));g=a.remote.pubKey;e=!b||!d("WACryptoUtils").serializedPubKeysEqual(g,b.remote.pubKey)?g:null;b&&!e&&(a=d("WASignalSessions").setPrevSessions(a,[d("WASignalSessions").detachSession(b)].concat(b.prevSessions.slice(0,l-1))));f=(yield t(a,c));if(!f.success)return f;g=f.value;b=g[0];c=g[1];return d("WAResultOrError").makeResult({newIdentity:e,baseSession:a,updatedSession:b,plaintext:c})});return q.apply(this,arguments)}function r(a){var b,c,e=null;try{var f=x(a,d("WASignalSessions").FORMAT_VERSION,m);if(!f.success)return f;f=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SignalMessageSpec,f.value);var g=f.ratchetKey;e=f.counter;c=f.ciphertext;if(g==null||e==null||c==null)return d("WAResultOrError").makeError("errSignalDeserializeInvalidProtoFormat");b=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(g))}catch(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["deserializeMsg error ",""])),a);return d("WAResultOrError").makeError("errSignalDeserializeRatchetKeyBadFormat")}f={ratchetPubKey:b,counter:e,ciphertext:new Uint8Array(c),versionContentMac:a};return d("WAResultOrError").makeResult(f)}function s(a){a=x(a,d("WASignalSessions").FORMAT_VERSION,0);if(!a.success)return a;var b,c,e,f,g;try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,a.value);var h=a.registrationId,j=a.preKeyId,k=a.signedPreKeyId,l=a.baseKey,m=a.identityKey;a=a.message;if(h==null||k==null||l==null||m==null||a==null)return d("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat");f=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(l));b={regId:d("WASignalOther").castRegistrationId(h),pubKey:d("WASignalKeys").castToSerializedPubKey(new Uint8Array(m))};e=j!=null?d("WASignalKeys").castToPreKeyId(j):null;c=d("WASignalKeys").castToSignedPreKeyId(k);g=new Uint8Array(a)}catch(a){d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["deserializePkMsg error ",""])),a);return d("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}l=r(g);return!l.success?l:d("WAResultOrError").makeResult(babelHelpers["extends"]({},l.value,{remote:b,sessionBaseKey:f,localSignedPreKeyId:c,localOneTimeKeyId:e}))}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.ratchetPubKey,e=b.counter,f=b.ciphertext;b=b.versionContentMac;var g=a.recvChains,h=a.recvChains.findIndex(function(a){return d("WACryptoUtils").serializedPubKeysEqual(a.ratchetPubKey,c)});if(h===-1){var i=(yield d("WASignalWhitepaper").calculateRatchet(a.rootKey,a.sendChain.ratchetKey,c)),k=d("WASignalSessions").makeFreshRecvChain(c,i.chainKey);k=(yield v(k,e));if(!k.success)return k;k=k.value;var l=d("WASignalKeys").makeSerializedKeyPair();i=(yield d("WASignalWhitepaper").calculateRatchet(i.rootKey,l,c));var n=g.slice(-4);n.push(k.updatedChain);k=k.msgKey;n=d("WASignalSessions").ratchetSession(a,n,d("WASignalSessions").makeFreshSendChain(l,i.chainKey),i.rootKey)}else{l=(yield v(g[h],e));if(!l.success)return l;i=l.value;e=g.slice();e[h]=i.updatedChain;k=i.msgKey;n=d("WASignalSessions").updateChains(a,e,a.sendChain)}l=(yield B(k));g=l.cipherKey;i=l.macKey;e=d("WABinary").Binary.build(a.remote.pubKey,a.local.pubKey,b.subarray(0,-m)).readByteArrayView();l=(yield A(i,e));a=b.subarray(-m);i=!d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(l,0,m),a);e=null;try{e=(yield d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:k.iv},g,f))}catch(a){d("WALogger").DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["decryptMsgFromSession error ",""])),a)}if(i&&e==null)return h===-1?d("WAResultOrError").makeError("errInvalidMacInvalidCipherKeyNewChain"):d("WAResultOrError").makeError("errInvalidMacInvalidCipherKey");if(i)return d("WAResultOrError").makeError("errInvalidMacWithDecryptedPlaintext");return e==null?d("WAResultOrError").makeError("errUnknownInvalidCipherKey"):d("WAResultOrError").makeResult([n,e])});return u.apply(this,arguments)}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b-a.nextMsgIndex,e=d("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(c>e)return d("WAResultOrError").makeError("errSignalTooManyMessagesInFuture");e=a.unusedMsgKeys;if(c<0){var f=e.findIndex(function(a){return a.index===b});return f===-1?d("WAResultOrError").makeError("errDuplicateMsg"):d("WAResultOrError").makeResult({msgKey:e[f],updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,a.nextMsgIndex,a.chainKey,z(e,f))})}f=a.nextMsgIndex;var g=(yield d("WASignalWhitepaper").deriveMsgKey(f,a.chainKey)),h=g[0];g=g[1];var i=null;if(c>0){c=c+e.length-n;c>0?(i=e.slice(c),c-=e.length):i=e.slice();for(f=f+1;f<=b;f++){c>0?c--:i.push(g);var j=(yield d("WASignalWhitepaper").deriveMsgKey(f,h));h=j[0];g=j[1]}}return d("WAResultOrError").makeResult({msgKey:g,updatedChain:d("WASignalSessions").makeRecvChain(a.ratchetPubKey,b+1,h,i||e)})});return w.apply(this,arguments)}function x(a,b,c){if(a.length<1)return d("WAResultOrError").makeError("errSignalEmptyVersionContentSuffix");var e=a[0]>>>4;if(e!==b)return e<b?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");e=a.length-c;return e<1?d("WAResultOrError").makeError("errSignalContentExceededExpectedLength"):d("WAResultOrError").makeResult(a.subarray(1,e))}function y(a,b){return(a<<4|b)&255}function z(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}function A(a,b){return d("WACryptoDependencies").getCrypto().subtle.sign(d("WASignalOther").HMAC_SHA256,a,b)}function B(a){return(k||(k=b("Promise"))).all([d("WASignalOther").makeCryptoKey(a.cipherKey,"aes-cbc"),d("WASignalOther").makeCryptoKey(a.macKey,"hmac-sha256")]).then(function(a){var b=a[0];a=a[1];return{cipherKey:b,macKey:a}})}function C(a,b){a=a.aliceBaseKey;return!a?!1:d("WACryptoUtils").serializedPubKeysEqual(a,b)}g.MAX_UNUSED_KEYS=n;g.encryptMsg=a;g.decryptMsg=c;g.findMatchingSession=e;g.decryptPkMsgWithNewSession=f;g.deserializeMsg=r;g.deserializePkMsg=s;g.decryptMsgFromSession=t;g.readContent=x;g.versionByte=y}),98);
__d("WASignalGroupCipher",["WABinary","WACryptoDependencies","WACryptoLibraryConfig","WALogger","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=64;function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=n(a);if(!a.success)return a;a=a.value;var c=a.senderKeyId,e=a.iteration,f=a.signingKeyPublic;a=a.chainKey;c=(yield d("WASignalWhitepaper").initiateSenderKeySessionIncoming(c,e,f,a,b));return d("WAResultOrError").makeResult(c)});return k.apply(this,arguments)}function c(a){a=d("WASignalGroupSession").serializeSenderKeyState(a);var b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,{id:a.senderKeyId,iteration:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").iteration,chainKey:d("WASignalSessions").definedOrThrow(a.senderChainKey,"senderChainKey").seed,signingKey:d("WASignalSessions").definedOrThrow(a.senderSigningKey,"senderSigningKey")["public"]},b);return b.readByteArrayView()}function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!a.senderKeyStates||a.senderKeyStates.length===0)return d("WAResultOrError").makeError("errSignalNoSession");var c=a.senderKeyStates[a.senderKeyStates.length-1],e=(yield d("WASignalWhitepaper").deriveSenderKeyMsgKey(c.senderKeyChainKey.nextMsgIndex,c.senderKeyChainKey.chainKey)),f=e[0];e=e[1];var g=(yield p(e.seed)),h=g[0];g=g[1];g=(yield d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:g},h,b));h=new(d("WABinary").Binary)();d("encodeProtobuf").encodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,{id:c.senderKeyId,iteration:e.iteration,ciphertext:g},h);b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));b.writeBinary(h);g=d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalSessions").definedOrThrow(c.senderSigningKeyPrivate,"senderSigningKeyPrivate"),c.senderSigningKeyPublic);g=d("WASignalSignatures").signSenderKeyMessage(g,b.readByteArrayView());b=new(d("WABinary").Binary)();b.writeUint8(d("WASignalCipher").versionByte(d("WASignalGroupSession").FORMAT_VERSION,d("WASignalGroupSession").FORMAT_VERSION));b.writeBinary(h);b.writeByteArray(g);h=d("WASignalGroupSession").makeSenderKeyChainKey(e.iteration+1,f);g=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,d("WASignalGroupSession").makeSenderKeyState(c.senderSigningKeyPublic,c.senderSigningKeyPrivate,h,c.senderKeyId,c.unusedMsgKeys));return d("WAResultOrError").makeResult([g,b.readByteArrayView()])});return l.apply(this,arguments)}function f(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.senderKeyMessageId,e=b.iteration,f=b.ciphertext;b=b.versionContentMac;c=d("WASignalGroupSession").findSenderKeyState(a,c);if(c==null)return d("WAResultOrError").makeError("errSignalNoSession");var g=c.senderSigningKeyPublic;b=r(b,g);if(!b)return d("WAResultOrError").makeError("errSignalInvalidKey");g=(yield s(c,e));if(!g.success)return g;b=g.value;c=b.msgKey;e=d("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(a,b.updatedSenderKeyState);g=(yield p(c.seed));a=g[0];b=g[1];c=(yield d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:b},a,f));return d("WAResultOrError").makeResult([e,c])});return m.apply(this,arguments)}function n(a){var b,c,e,f;try{a=d("WASignalCipher").readContent(a,d("WASignalGroupSession").FORMAT_VERSION,0);if(!a.success)return a;a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,a.value);b=a.id;c=a.iteration;var g=d("WASignalSessions").bytesOrThrow(a.signingKey,33,"signingKey");e=d("WASignalKeys").castToSerializedPubKey(g);f=d("WASignalSessions").bytesOrThrow(a.chainKey,32,"chainKey");if(b==null||c==null)return d("WAResultOrError").makeError("errSignalGrpInvalidProtoFormat")}catch(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["deserializeSenderKeyDistributionMsg error ",""])),a);return d("WAResultOrError").makeError("errSignalGrpInvalidKeyFormat")}return d("WAResultOrError").makeResult({senderKeyId:b,iteration:c,signingKeyPublic:e,chainKey:f})}function o(a){if(a.length<1)return d("WAResultOrError").makeError("errSignalGrpVersionContentEmpty");var b=a[0]>>>4;if(b!==d("WASignalGroupSession").FORMAT_VERSION)return b<d("WASignalGroupSession").FORMAT_VERSION?d("WAResultOrError").makeError("errSignalLegacyMsg"):d("WAResultOrError").makeError("errSignalInvalidVersion");if(a.length<1+j)return d("WAResultOrError").makeError("errSignalGrpInvalidVersionContentLength");var c,e,f;try{b=a.subarray(1,-j);b=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,b);c=b.id;e=b.iteration;f=b.ciphertext;if(c==null||e==null||f==null)return d("WAResultOrError").makeError("errSignalGrpSenderKeyInvalidProtoFormat")}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Exception caught during SenderKeyMessageSpec Proto: ",""])),a);return d("WAResultOrError").makeError("errSignalGrpSenderKeyProtoError")}return d("WAResultOrError").makeResult({senderKeyMessageId:c,iteration:e,ciphertext:new Uint8Array(f),versionContentMac:a})}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=new(d("WABinary").Binary)(a);var b=d("WASignalOther").readBytes(a,16);a=d("WASignalOther").readBytes(a,32);return[yield d("WASignalOther").makeCryptoKey(a,"aes-cbc"),b]});return q.apply(this,arguments)}function r(a,b){var c=a.subarray(a.length-j);a=a.subarray(0,a.length-j);return d("WASignalSignatures").verifyMsgSignalVariant(b,a,d("WASignalOther").toBytes(d("WASignalOther").toBuffer(c),64))}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a,e=b-c.senderKeyChainKey.nextMsgIndex,f=d("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(e>f)return d("WAResultOrError").makeError("errSignalGrpTooManyMessagesInFuture");f=a.unusedMsgKeys||[];if(e<0){var g=f.findIndex(function(a){return a.iteration===b});return g===-1?d("WAResultOrError").makeError("errDuplicateMsg"):d("WAResultOrError").makeResult({msgKey:f[g],updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(c.senderSigningKeyPublic,c.senderSigningKeyPrivate,c.senderKeyChainKey,c.senderKeyId,u(f,g))})}g=c.senderKeyChainKey.nextMsgIndex;var h=(yield d("WASignalWhitepaper").deriveSenderKeyMsgKey(g,c.senderKeyChainKey.chainKey)),i=h[0];h=h[1];var j=null;if(e>0){e=e+f.length-d("WASignalCipher").MAX_UNUSED_KEYS;e>0?(j=f.slice(e),e-=f.length):j=f.slice();for(g=g+1;g<=b;g++){e>0?e--:j.push(h);var k=(yield d("WASignalWhitepaper").deriveSenderKeyMsgKey(g,i));i=k[0];h=k[1]}}return d("WAResultOrError").makeResult({msgKey:h,updatedSenderKeyState:d("WASignalGroupSession").makeSenderKeyState(c.senderSigningKeyPublic,c.senderSigningKeyPrivate,d("WASignalGroupSession").makeSenderKeyChainKey(b+1,i),a.senderKeyId,j||f)})});return t.apply(this,arguments)}function u(a,b){var c=[];for(var d=0;d<a.length;d++)d!==b&&c.push(a[d]);return c}g.processSenderKeyDistributionMsg=a;g.createSenderKeyDistributionProto=c;g.encryptSenderKeyMsgWithSession=e;g.decryptSenderKeyMsgFromSession=f;g.deserializeSenderKeyMsg=o}),98);
__d("WACryptoLibrary",["WACryptoUtils","WAJids","WALockMap","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSignatures","WASignalWhitepaper","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WALockMap").makeLockMap(60*1e3),k=[],l=300;function m(a){k.push(a),k.length>=l&&k.shift()}function a(a){a(k),k=[]}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){m("createOutgoingSession");b=y(b);var c=b.signedKey;c=(yield d("WASignalSignatures").verifyMsgSignalVariant(b.identity,c.publicKey,c.signature));d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["getSessionForRecipient pkmsg signature verification result: ",""])),c);if(!c){m("createOutgoingSession: errSignalInvalidKey");return d("WAResultOrError").makeError("errSignalInvalidKey")}c=(yield d("WASignalWhitepaper").initiateSessionOutgoing(a,b,d("WASignalKeys").makeKeyPair()));return d("WAResultOrError").makeResult(c)});return o.apply(this,arguments)}function c(a,b,c,d,e){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){a=a.handleNewSession;m("establishOutgoingSession");b=(yield n(b,d));if(!b.success)return b;d=b.value;return a(c,d,d.remote.pubKey,null,e)});return p.apply(this,arguments)}function e(a,c,e,f){var g=a.loadSession,h=a.handleNewSession;m("encryptContent");return j.lock([d("WAJids").extractUserJid(c)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=null;do{var b=(yield g(c,"cryptoLibraryEncryptContent"));if(b==null){m("encryptContent: errSignalInvalidKey");return d("WAResultOrError").makeError("errSignalInvalidKey")}if(f!=null&&!d("WACryptoUtils").uint8ArraysEqual(f,b.remote.pubKey)){m("encryptContent: identity-mismatch");return d("WAResultOrError").makeError("identity-mismatch")}b=(yield d("WASignalCipher").encryptMsg(b,e));var i=b[0];b=b[1];var j=(yield h(c,i,i.remote.pubKey));j.success?a=d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{baseKey:i.aliceBaseKey})):j.error}while(a==null);return a}))}function f(a,c,e,f,g){var h=a.loadSession,i=a.handleNewSession,k=a.loadSignedPreKey,l=a.loadOneTimePreKey;m("decryptContent");return j.lock([d("WAJids").extractUserJid(e)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=!1,b=(yield h(e,"decryptContent"));if(f.type==="pkmsg"){var j=d("WASignalCipher").deserializePkMsg(f.ciphertext);if(!j.success){m("decryptContent: errCryptoDeserialization");return d("WAResultOrError").makeError("errCryptoDeserialization")}j=j.value;j=(yield q({loadSignedPreKey:k,loadOneTimePreKey:l},c,j,b));if(!j.success)return j;j=j.value}else{f.type;var n=d("WASignalCipher").deserializeMsg(f.ciphertext);if(!n.success){m("decryptContent: errCryptoDeserialization");return d("WAResultOrError").makeError("errCryptoDeserialization")}n=n.value;b=(yield d("WASignalCipher").decryptMsg(b,n));if(!b.success)return b;j=b.value}n=j;b=n.newSessionInfo;b&&(b.newIdentity!=null||b.usedPreKey!=null)&&(yield i(e,b.baseSession,b.newIdentity,b.usedPreKey));if(!a){n=b==null?void 0:b.baseSession.remote.pubKey;yield g(new Uint8Array(j.plaintext),n);a=!0}yield i(e,j.updatedSession,j.updatedSession.remote.pubKey);return d("WAResultOrError").makeResult()}))}function q(a,b,c,d){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a.loadSignedPreKey;a=a.loadOneTimePreKey;m("decryptPkMsg");var g=d("WASignalCipher").findMatchingSession(e,c.sessionBaseKey);if(!g.success)return g;g=g.value;if(g){g=(yield d("WASignalCipher").decryptMsgFromSession(g,c));if(!g.success)return g;g=g.value;var h=g[0];g=g[1];return d("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:h,plaintext:g})}else{h=c.localOneTimeKeyId;g=(yield f(c.localSignedPreKeyId));f=h==null?null:yield a(h);a=(yield d("WASignalCipher").decryptPkMsgWithNewSession(b,e,c,{localSignedPreKey:g,localOneTimeKey:f}));if(!a.success)return a;b=a.value;e=b.newIdentity;c=b.baseSession;g=b.updatedSession;f=b.plaintext;return d("WAResultOrError").makeResult({newSessionInfo:{newIdentity:e,baseSession:c,usedPreKey:h},updatedSession:g,plaintext:f})}});return r.apply(this,arguments)}function s(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;m("encryptGroupContent");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){do{var b=(yield h(e,f));if(!b.success)return d("WAResultOrError").makeError(b.error);b=b.value;var c=(yield d("WASignalGroupCipher").encryptSenderKeyMsgWithSession(b,g));if(c.success){c=c.value;var i=c[0];c=c[1];yield a(e,f,i);i=b.senderKeyStates[b.senderKeyStates.length-1];b=d("WAResultOrError").makeResult({ciphertext:{ciphertext:c,type:"skmsg"},senderKeyId:i.senderKeyId,senderKeyDistributionProto:d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(i))})}else{m("encryptGroupContent: sender-key-no-session");return d("WAResultOrError").makeError("sender-key-no-session")}}while(b==null);return b}))}function t(c,e,f,g,i){var k=c.loadSenderKeySession,a=c.saveSenderKeySession;m("decryptGroupContent");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=!1,c=(yield k(e,f));if(!c.success){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[WACryptoLibrary] Unable to load sender key session for group during decryptGroupContent: ",", author: ",""])),e,f);return d("WAResultOrError").makeError(c.error)}var j=d("WASignalGroupCipher").deserializeSenderKeyMsg(g);if(!j.success){m("decryptGroupContent: errCryptoDeserialization");return d("WAResultOrError").makeError("errCryptoDeserialization")}c=c.value;c=(yield d("WASignalGroupCipher").decryptSenderKeyMsgFromSession(c,j.value));if(!c.success)return c;j=c.value;c=j[0];j=j[1];b||(yield i(new Uint8Array(j)),b=!0);yield a(e,f,c);return d("WAResultOrError").makeResult()}))}function u(c,e,f,g){var h=c.loadSenderKeySession,a=c.saveSenderKeySession;m("saveSenderKeySession");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=null;if(h){var c=(yield h(e,f));b=c.success?c.value:null}c=(yield d("WASignalGroupCipher").processSenderKeyDistributionMsg(g,b));if(!c.success)return c;b=c.value;yield a(e,f,b);return d("WAResultOrError").makeResult()}))}function v(c,e,f,g){var a=c.saveSenderKeySession;m("rotateGroupSenderKey");return j.lock([e,d("WAJids").extractUserJid(f)],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WASignalWhitepaper").initiateSenderKeySessionOutgoing(g)),c=b.senderKeyStates[0].senderKeyId;yield a(e,f,b);return{senderKeyId:c}}))}function w(a,b,c){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.loadSenderKeySession;a=a.saveSenderKeySession;m("createSenderKeyDistributionMsg");var f=(yield e(b,c)),g=f.error;if(!f.success&&g==="errLoadSenderKeySession"){g=(yield d("WASignalKeys").makeKeyPair());yield v({saveSenderKeySession:a},b,c,g);f=(yield e(b,c))}if(f.success){a=f.value.senderKeyStates.slice(-1);if(a.length>0)return d("WAResultOrError").makeResult(d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(a[0])))}m("createSenderKeyDistributionMsg: errGetSenderKeyProto");return d("WAResultOrError").makeError("errGetSenderKeyProto")});return x.apply(this,arguments)}function y(a){var b=a.regId,c=a.identity,e=a.signedKey;a=a.oneTimeKey;m("sanitizeInitialSessionInfo");var f=d("WASignalKeys").castToSerializedPubKey(e.publicKey);return{regId:d("WASignalOther").castRegistrationId(b),identity:d("WASignalKeys").castToSerializedPubKey(c),signedKey:{id:d("WASignalKeys").castToSignedPreKeyId(e.id),publicKey:f,signature:d("WASignalOther").ensureSize(e.signature,64)},oneTimeKey:a&&{id:d("WASignalKeys").castToPreKeyId(a.id),publicKey:d("WASignalKeys").castToSerializedPubKey(a.publicKey)},ratchetKey:f}}g.publishLogs=a;g.createOutgoingSession=n;g.establishOutgoingSession=c;g.encryptContent=e;g.decryptContent=f;g.encryptGroupContent=s;g.decryptGroupContent=t;g.saveSenderKeySession=u;g.rotateGroupSenderKey=v;g.createSenderKeyDistributionMsg=w}),98);
__d("WACryptoManager",["Promise","WABridge","WACryptoLibrary","WACryptoUtils","WAGlobals","WAJids","WALogger","WALoggerTag","WANullthrows","WAOdsEnums","WAPromiseQueue","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WASignalSessions","WASignalSignatures","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u=d("WATagsLogger").TAGS([c("WALoggerTag").CryptoManager]),v={type:"default"};function a(a){return{flush:function(){return a.storage.savePendingToDatabase().then(function(){})}}}function e(a){return{regInfo:a.regInfo,network:a.network,storage:a.storage}}function w(a,b,c,d,e){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){e=(yield e(b,f));if(e!=null&&c.type!=="requestNewSession"){f=e;if(c.type==="default")return d("WAResultOrError").makeResult(f);else if(f.aliceBaseKey!=null&&c.session.baseKey!=null){c.type;if(!d("WACryptoUtils").uint8ArraysEqual(c.session.baseKey,f.aliceBaseKey))return d("WAResultOrError").makeResult(f)}}if(c.type==="useSession")e=c.session.keys;else{c.type;f=(yield a.network.requestKeys(b));if(!f.success)return f;e=f.value.keys;c.type==="compareTSAndUseSession"&&c.session.timestamp>=f.value.timestamp&&(e=c.session.keys)}b=(yield d("WACryptoLibrary").createOutgoingSession(a.regInfo,e));return!b.success?b:d("WAResultOrError").makeResult(b.value)});return x.apply(this,arguments)}function f(a,b,c,e){return d("WACryptoLibrary").establishOutgoingSession({handleNewSession:a.storage.handleNewSession},a.regInfo,b,c,e)}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").DEV(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Establish outgoing sessions"])));var c=(yield a.storage.loadSessions(b));b=b.filter(function(a){return!c.has(a)});if(b.length===0){d("WALogger").DEV(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[sessions] No need to establish outgoing sessions"])));return c}d("WALogger").DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Missing sessions: ",". Requesting keys"])),b.length);b=(yield a.network.bulkRequestKeys(b));if(!b.success){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[sessions] fail during key requesting"])));return c}if(d("WAGlobals").getConfig().useLongSessionDrop())for(var e of c.entries()){var f=e[0],g=e[1];g.sendChain.nextMsgIndex>=d("WAGlobals").getConfig().sessionDropIfTooOld()&&(d("WALogger").DEV(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Removing session "," due to ratchet key"])),f),c["delete"](f),d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WA_LONG_SESSION_DROP,key:"decryption"}))}g=b.value;d("WALogger").DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Received keys ",""])),g.size);var h=new(d("WAPromiseQueue").PromiseQueue)();g.forEach(function(e,b){h.enqueue(function(){return d("WACryptoLibrary").createOutgoingSession(a.regInfo,e.keys).then(function(a){a.success===!1?d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Failed to create a session"]))):c.set(b,a.value)})})});yield h.wait();return c});return z.apply(this,arguments)}function A(a,b){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=Array.from(e.keys());d("WALogger").LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] sendWrittenMsg bulkEncryptContent"])));f=(yield y(a,f));var g=new Map();d("WALogger").DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] start encryption"])));return(t||(t=b("Promise"))).all(Array.from(f.entries()).map(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=b[0];b=b[1];b=(yield d("WASignalCipher").encryptMsg(b,c("WANullthrows")((b=e.get(f))==null?void 0:b.plaintext)));var h=b[0];b=b[1];g.set(f,babelHelpers["extends"]({},b,{baseKey:null}));return a.storage.handleNewSession(f,h,h.remote.pubKey)});return function(a){return f.apply(this,arguments)}}())).then(function(){return d("WAResultOrError").makeResult(g)})});return B.apply(this,arguments)}function C(a,b,c,e,f){return d("WACryptoLibrary").encryptContent({loadSession:function(b){return w(a,b,e,a.storage.loadSession,"cryptoManagerEncryptContent").then(function(a){if(a.success===!0)return a.value;else return null})},handleNewSession:a.storage.handleNewSession},b,c,f)}function D(a,b,c,e){return d("WACryptoLibrary").decryptContent({loadSession:a.storage.loadSession,handleNewSession:a.storage.handleNewSession,loadSignedPreKey:a.storage.loadSignedPreKey,loadOneTimePreKey:a.storage.loadOneTimePreKey},a.regInfo,b,c,e)}function E(a,b){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.storage.loadSession(b,"getParticipantInfo"));return a==null?void 0:a.remote});return F.apply(this,arguments)}function G(a){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=(yield a.storage.getLastPreKeyGenerationId());b=((b=e==null?void 0:e.lastPreKeyId)!=null?b:0)+1;b=d("WASignalKeys").makePreKeys(b,1)[0];a=(yield a.storage.saveOneTimePreKey({keyId:b.plainObject.id,encoded:b.record}));if(a.success)return b.plainObject;throw c("err")("Cannot save one time prekey: "+a.error+", LastPreKeyId: "+((b=e==null?void 0:e.lastPreKeyId)!=null?b:0))});return H.apply(this,arguments)}function I(a,b){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=d("WAGlobals").getConfig().maxPrekeysToUpload());var c=(yield a.storage.getLastPreKeyGenerationId());c=d("WASignalKeys").makePreKeys(((c=c==null?void 0:c.lastPreKeyId)!=null?c:0)+1,b);return a.storage.savePreKeysGeneration(c.map(function(a){var b=a.plainObject;a=a.record;return{keyId:b.id,encoded:a}}))});return J.apply(this,arguments)}function K(a){return a.storage.loadLatestSignedPreKey().then(function(b){if(b.success===!1){var e,f,g;u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey ",""])),b==null||(e=b.payload)==null?void 0:e.toString());throw c("err")("Failed to generate signed prekey: "+((f=b==null||(g=b.payload)==null?void 0:g.message)!=null?f:""))}f=b.value;f=d("WASignalSignatures").deserializeSignedPreKey(f);if(f==null){u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey: ",""])),b);throw c("err")("failed to deserialize signed prekey")}return L(a,f.id+1)})}function L(a,b){var e=d("WASignalSignatures").makeSignedPreKey(b,d("WATimeUtils").unixTimeMs(),a.regInfo.staticKeyPair);b=d("WASignalSignatures").serializeSignedPreKeyForPrivateStorage(e);return a.storage.saveSignedPreKeyIfNew(e.id,b).then(function(a){if(a.type==="success")return d("WAResultOrError").makeResult(e);else{a.type;return d("WAResultOrError").makeResult(a.key)}}).then(function(a){if(!a.success){var b,d;u.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey with id: ",""])),a);throw c("err")("Unexpected error when generateSignedPreKeyWithId: "+((b=a==null||(d=a.payload)==null?void 0:d.message)!=null?b:a.error))}return a.value})}function M(a,b,c,e){return d("WACryptoLibrary").encryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function N(a,b,c,e,f){return d("WACryptoLibrary").decryptGroupContent({loadSenderKeySession:a.storage.loadSenderKeySession,saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e,f)}function O(a,b,c,e){return d("WACryptoLibrary").saveSenderKeySession({saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e)}function P(a,b,c){return Q.apply(this,arguments)}function Q(){Q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield G(a));return d("WACryptoLibrary").rotateGroupSenderKey({saveSenderKeySession:a.storage.saveSenderKeySession},b,c,e.keyPair)});return Q.apply(this,arguments)}function R(a){return(t||(t=b("Promise"))).resolve().then(function(){return{regId:d("WASignalOther").makeRegistrationId(a),staticKeyPair:d("WASignalKeys").makeKeyPair(),authKeyPair:d("WASignalKeys").makeKeyPair()}})}function S(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,d("WASignalSessions").serializeSession(a))}function T(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").RecordStructureSpec,a,d("WASignalSessions").parseSessionFromRecord)}function U(a){return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,d("WASignalGroupSession").serializeSession(a))}function V(a){return d("WASignalOther").decodeSignalProto(d("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,a,d("WASignalGroupSession").parseSessionFromRecord)}function W(a){return a}function X(a,b){return a+"|"+b}function Y(a){a=a.split("|");if(a.length!==2)throw c("err")("Incorrect ComplexSenderKey");return{groupId:d("WAJids").unsafeCoerceToGroupJid(a[0]),deviceId:d("WAJids").unsafeCoerceToDeviceJid(a[1])}}g.DEFAULT_SESSION_REQUEST=v;g.cryptoManagerFlushable=a;g.initCryptoManager=e;g.getSessionForRecipient=w;g.establishOutgoingSession=f;g.ensureSessionsExists=y;g.bulkEncryptContent=A;g.encryptContent=C;g.decryptContent=D;g.getParticipantInfo=E;g.generateOneTimePreKey=G;g.generatePreKeys=I;g.generateSignedPreKey=K;g.generateSignedPreKeyWithId=L;g.encryptGroupContent=M;g.decryptGroupContent=N;g.saveSenderKeySession=O;g.rotateGroupSenderKey=P;g.generateRegistrationInfo=R;g.encodeSession=S;g.decodeSession=T;g.encodeSenderKeySession=U;g.decodeSenderKeySession=V;g.castToPreKeyGenerationId=W;g.encodeSenderKey=X;g.decodeSenderKey=Y}),98);
__d("WABulkSaveSignalDataApi",["Promise","WACryptoManager","WADbSignal","WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.dhashUpdate,e=a.icdcUpdate,f=a.identityRemove,g=a.identityUpdate,j=a.preKeyRemove,l=a.senderKeySessionUpdate,m=a.sessionRemove,n=a.sessionUpdate,o=a.lastSyncTsUpdate,p=n.map(function(a){var b=a.id;a=a.updated;return{id:b,session:d("WACryptoManager").encodeSession(a)}}),q=[];l.forEach(function(a){var b=a.author,c=a.groupId;a=a.updated;var e=d("WAJids").extractUserJid(b);b=d("WAJids").extractDeviceId(b);var f=d("WADbSignal").buildSenderKeySessionId(c,e,b);q.push({deviceId:b,groupJid:c,id:f,record:d("WACryptoManager").encodeSenderKeySession(a),userJid:e})});yield d("WASignalDB").getDb().runInTransaction(["contacts","identity","prekey","senderKeySessions","session"],"readwrite",function(a){var d=a.stores,l=d.session,n=d.identity,r=d.senderKeySessions;d=d.prekey;return(h||(h=b("Promise"))).all([l.bulkDelete(m),n.bulkDelete(f),l.bulkPut(p),r.bulkPut(q),k(a.stores,g),i(a.stores,e,g,c,o),d.bulkDelete(j.map(function(a){a=a.id;return a}))])},d("WASignalDB").signalOp("bulkSaveSignalData"))});return function(b){return a.apply(this,arguments)}}();function i(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g=new Set();for(c of c)g.add(d("WAJids").extractUserJid(c.id));c=Array.from(g);for(var h of b)g.add(h.id);h=(yield a.contacts.bulkGet(Array.from(g)));g=new Map();for(h of h){if(h==null)continue;g.set(h.contactJid,h)}for(h of c){c=g.get(h);c==null?(c={contactJid:h,dhash:null},g.set(h,c)):c.dhash=null}for(c of b){h=g.get(c.id);h==null?(h={contactJid:c.id,dhash:null,icdcInfo:c.icdc},g.set(c.id,h)):h.icdcInfo=c.icdc}for(b of e){h=g.get(b.id);h==null?(h={contactJid:b.id,dhash:b.dhash},g.set(b.id,h)):h.dhash=b.dhash}for(c of f){e=g.get(c.id);e==null?(e={contactJid:c.id,dhash:null,lastSyncTs:c.lastSyncTs},g.set(c.id,e)):e.lastSyncTs=c.lastSyncTs}return a.contacts.bulkPut(Array.from(g.values()))});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.length===0)return;b=b.map(function(a){var b=a.id;a=a.identity;return{deviceJid:b,identity:a,userJid:d("WAJids").extractUserJid(b)}});yield a.identity.bulkPut(b)});return l.apply(this,arguments)}g.bulkSaveSignalData=a}),98);
__d("WAIdentityUtils",["WABinary","WACryptoDependencies","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.length===33&&a[0]===5;return b?a.slice(1):a}function i(a,b){for(var c=0;c<a.length&&c<b.length;++c)if(a[c]!==b[c])return a[c]-b[c];return a.length-b.length}function a(a){a=a.map(function(a){return h(a)});var b=new(d("WABinary").Binary)();a.sort(i).forEach(function(a){return b.writeByteArray(a)});a=d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",b.readByteArrayView());return a.then(function(a){a=new Uint8Array(a);return d("WASignalOther").sliceBytes(a,0,10)})}g.removeKeyTypeIfNeeded=h;g.computeIdentitiesHash=a}),98);
__d("WAICDCUtils",["WAArmadilloICDC.pb","WABase64","WABinary","WACryptoDependencies","WACryptoEd25519","WACryptoUtils","WAIdentityUtils","WALogger","WASignalKeys","WASignalOther","WASignalSignatures","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function a(a,b,c,e){if(a!==e.details.seq){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched sequence between XML node and byte structure"])));return null}if(c!==e.details.timestamp){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched timestamp between XML node and byte structure"])));return null}if(e.details.signingDeviceIndex==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched missed signingDeviceIndex"])));return null}var f=e.details.signingDeviceIndex;return{dirty:b,sequence:a,timestamp:c,signingDeviceIndex:f,devices:e.details.devices.map(function(a){return new Uint8Array(a)})}}function b(a){return a.signingDeviceIndex<0||a.signingDeviceIndex>=a.devices.length}function e(a){a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,a);var b=a.signature;a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,a.details);return{signature:b,details:a}}function f(a){return a.map(function(a){return d("WASignalKeys").serializeIdentity(new Uint8Array(d("WABase64").decodeB64UrlSafe(a)))})}function m(a,b,e,f,g){var h=d("WAIdentityUtils").removeKeyTypeIfNeeded(a.publicKey);e=e.map(function(a){return d("WAIdentityUtils").removeKeyTypeIfNeeded(a)});var i=e.findIndex(function(a){return d("WACryptoUtils").uint8ArraysEqual(a,h)});if(i===-1){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["signingDeviceIndex not found. This should never happen. ",". caller: ",""])),f,g);throw c("err")("signingDeviceIndex not found")}f=b==null?1:b+1;g=d("WATimeUtils").unixTime();g<0&&d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["ICDC timestamp is negative. time: ",", closkSkew: ",""])),Date.now(),d("WATimeUtils").getClockSkew());b={seq:f,timestamp:g,devices:e,signingDeviceIndex:i};f=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").ICDCIdentityListSpec,b).readBuffer();g=n(a,d("WABinary").Binary.build(f).readByteArrayView());e={details:f,signature:g};i=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,e).readBuffer();return{icdcInfo:b,encodedSignedICDC:i}}function n(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);var e=new Uint8Array(64);d("WACryptoEd25519").hashSha512(e,b,b.length);e=d("WASignalSignatures").makeSignature(a,b,c);return d("WABinary").Binary.build(e).readBuffer()}var o=4*d("WATimeUtils").HOUR_SECONDS;function p(a){return a==null?!0:!d("WATimeUtils").happenedWithin(a,o)}g.validateAndPrepareICDCFromNotification=a;g.isICDCIndexInvalid=b;g.decodeICDCInfo=e;g.base64DeviceIdentitiesToSerializedPubKeys=f;g.computeICDCInfoForUpload=m;g.isLastSyncTsExpired=p}),98);
__d("WAComputeAndUploadICDCInfo",["WABase64","WADeprecatedSendIq","WADeprecatedWapParser","WAGetDevices","WAGlobals","WAICDCUtils","WAIdentityUtils","WALogger","WAPromiseBackoffs","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=new(c("WADeprecatedWapParser"))("parseUploadICDCInfoResponse",function(a){a.assertTag("iq"),a.assertFromServer(),a.assertAttr("type","result")}),m=0;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=c.reason;var e=c.caller;c=c.sequence;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["computeAndUploadICDCInfo called ",""])),c);var f;try{f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.cryptoManager;var b=(yield a.storage.loadIdentities(d("WAGlobals").getMyUserJid()));a=a.regInfo;return{regInfo:a,identities:Array.from(b.values())}});return function(b){return a.apply(this,arguments)}}(),{operationType:"icdc_load_identities",flush:!1,afterInit:!0}))}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Loading identities fails with error: ",""])),a.toString())}if(f==null)return;var g=f,n=g.regInfo;g=g.identities;n=d("WAICDCUtils").computeICDCInfoForUpload(n.staticKeyPair,c,g,a,e);var o=n.icdcInfo;c=n.encodedSignedICDC;a=(yield d("WAIdentityUtils").computeIdentitiesHash(g));e=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"fbid:devices"},d("WAWap").wap("icdc",{ihash:d("WAWap").CUSTOM_STRING(d("WABase64").encodeB64(a)),seq:d("WAWap").INT(o.seq),ts:d("WAWap").INT(o.timestamp)},c));n=(yield d("WADeprecatedSendIq").deprecatedSendIq(e,l));n.success?(m=0,yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.saveICDC(d("WAGlobals").getMyUserJid(),{sequence:o.seq,timestamp:o.timestamp,devices:o.devices,signingDeviceIndex:o.signingDeviceIndex,dirty:!1})},{operationType:"save_icdc",flush:!0,afterInit:!0})):(m+=1,n.errorCode===406||n.errorCode===500?setTimeout(function(){d("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"compute-Upload-icdc",users:new Set().add(d("WAGlobals").getMyUserJid())})["catch"](function(a){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed getting devices ",""])),a.toString())})},d("WAPromiseBackoffs").getDelay(m,{jitter:.1,max:3e4,algo:{type:"fibonacci",first:1e3,second:1e3}})):d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Cannot update ICDC for user, because of "," server response"])),n.errorCode))});return function(b,c){return a.apply(this,arguments)}}();g.computeAndUploadICDCInfo=a}),98);
__d("WAGetDevices",["WADevicesState","WALogger","WAPushSafeTypes","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAPushSafeTypes").unsafeNotNullable(b);b=a.users;var c=a.reason;a=a.ignoreDhash;a=a===void 0?!1:a;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["fetchAndSaveDevices: ",""])),c);a&&d("WADevicesState").getDevicesState().reset(Array.from(b));yield d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(b),"getDevices job: "+c,a)});return i.apply(this,arguments)}g.getDevices=a}),98);
__d("WAFetchAndSaveDevices",["Promise","WAComputeAndUploadICDCInfo","WAGlobals","WAICDCUtils","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var c=[];yield d("WAGlobals").getWaOneQueue().enqueue(function(e){var f=e.cryptoManager;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Update user devices signal and DB"])));return(j||(j=b("Promise"))).all(a.map(function(a){var b;c.push({contactJid:a.jid,dhash:a.dhash,lastSyncTs:a.lastSyncTs,icdcInfo:(b=a.icdcInfo)!=null?b:void 0});return f.storage.updateUserDevicesInfo([a])}))},{operationType:"get_devices",flush:!0,afterInit:!0});var e=d("WAGlobals").getMyUserJid(),f=a.find(function(a){return a.jid===e});if(f!=null){f=f.icdcInfo;if(f==null||d("WAICDCUtils").isICDCIndexInvalid(f)||f!=null&&f.dirty){var g;f==null?g="empty":f.dirty?g="dirty":g="invalidIndex";d("WAComputeAndUploadICDCInfo").computeAndUploadICDCInfo(null,{reason:g,caller:"get_devices",sequence:f==null?void 0:f.sequence})["catch"](function(a){d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["computeAndSaveICDC: ",""])),a)})}}});return k.apply(this,arguments)}g.updateUsersDevicesSignalAndDB=a}),98);
__d("WAHandleFbDeviceChangeNotificationProtocol",["WAICDCUtils","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.dhash}function b(a){var b;b=((b=a.iCDCDirtyMixin)==null?void 0:b.dirty)==="true";var c=d("WATimeUtils").castToUnixTime(a.ts),e=a.seq;a=d("WAICDCUtils").decodeICDCInfo(a.elementValue);e=d("WAICDCUtils").validateAndPrepareICDCFromNotification(e,b,c,a);return e==null?d("WAResultOrError").makeError("icdc-validation-failure"):d("WAResultOrError").makeResult(e)}g.parseDhash=a;g.parseICDCFromServer=b}),98);
__d("WALoadContactsApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(b){return b.stores.contacts.bulkGet(a).then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.contactJid,{contactJid:a.contactJid,dhash:a.dhash,icdcFails:a.icdcFails,icdcInfo:a.icdcInfo,lastSyncTs:a.lastSyncTs}]}))})},d("WASignalDB").signalOp("loadContacts"))};g.loadContacts=a}),98);
__d("WARPCAbortController",["Promise"],(function(a,b,c,d,e,f){"use strict";var g,h="rpc-timeout";function a(a,c){var d,e=new(g||(g=b("Promise")))(function(a,b){d=setTimeout(function(){b(h)},c)});return g.race([a,e])["finally"](function(){clearTimeout(d)})}f.RPC_TIMEOUT=h;f.rpcAbortController=a}),66);
__d("WASmaxInDevicesIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInDevicesNonRetryableIQErrorMixin",["WASmaxInDevicesIQErrorBadRequestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);return!b.success?b:b}g.parseNonRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorMixin","WASmaxInDevicesIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInDevicesIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable"],[b,c])}g.parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInDevicesRetryableIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"backoff",0,86400);if(!b.success)return b;a=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({backoff:b.value,iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:a.value})}g.parseRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableIQErrorMixin").parseNonRetryableIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableIQError"],[b,c])}g.parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchResponseError=a}),98);
__d("WASmaxInDevicesIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInDevicesFetchNonRetryableUserErrorMixin",["WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return!b.success?b:b}g.parseFetchNonRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchRetryableUserErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:b.value})}g.parseFetchRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup",["WAResultOrError","WASmaxInDevicesFetchNonRetryableUserErrorMixin","WASmaxInDevicesFetchRetryableUserErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchRetryableUserErrorMixin").parseFetchRetryableUserErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchRetryableUserError",value:b.value});var c=d("WASmaxInDevicesFetchNonRetryableUserErrorMixin").parseFetchNonRetryableUserErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchNonRetryableUserError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableUserError","NonRetryableUserError"],[b,c])}g.parseFetchOrFetchNonRetryableUserErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseFailureMixin",["WAResultOrError","WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseJid").attrUserJid(a,"jid");if(!a.success)return a;b=d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup").parseFetchOrFetchNonRetryableUserErrorMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult({jid:a.value,errorFetchOrFetchNonRetryableUserErrorMixinGroup:b.value})}g.parseFetchUserResponseFailureMixin=a}),98);
__d("WASmaxInDevicesDeviceModelInfoMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a){var b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(a,"model",i);return!a.success?a:d("WAResultOrError").makeResult({platform:b.value,model:a.value})}g.parseDeviceModelInfoPlatform=h;g.parseDeviceModelInfoModel=i;g.parseDeviceModelInfoMixin=a}),98);
__d("WASmaxInDevicesDhashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"dhash");return!a.success?a:d("WAResultOrError").makeResult({dhash:a.value})}g.parseDhashMixin=a}),98);
__d("WASmaxInDevicesKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInDevicesIdentityKeyMixin",["WASmaxInDevicesKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInDevicesKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInDevicesDeviceListMixin",["WAResultOrError","WASmaxInDevicesDeviceModelInfoMixin","WASmaxInDevicesDhashMixin","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!b.success)return b;var c=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;a=d("WASmaxInDevicesDeviceModelInfoMixin").parseDeviceModelInfoMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({id:b.value},c.value,{deviceModelInfoMixin:a.success?a.value:null}))}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDhashMixin").parseDhashMixin(a);a=d("WASmaxParseUtils").mapChildrenWithTag(a,"device",0,25,h);return!a.success?a:d("WAResultOrError").makeResult({dhashMixin:b.success?b.value:null,device:a.value})}g.parseDeviceListDevice=h;g.parseDeviceListMixin=a}),98);
__d("WASmaxInDevicesICDCDirtyMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"dirty","true");return!b.success?b:d("WAResultOrError").makeResult({dirty:b.value})}g.parseICDCDirtyMixin=a}),98);
__d("WASmaxInDevicesICDCSeqMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrIntRange(a,"seq",0,2147483647);return!a.success?a:d("WAResultOrError").makeResult({seq:a.value})}g.parseICDCSeqMixin=a}),98);
__d("WASmaxInDevicesICDCSignedListMixin",["WAResultOrError","WASmaxInDevicesICDCSeqMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"ts",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").contentBytesRange(a,1,40072);if(!c.success)return c;a=d("WASmaxInDevicesICDCSeqMixin").parseICDCSeqMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({ts:b.value,elementValue:c.value},a.value))}g.parseICDCSignedListMixin=a}),98);
__d("WASmaxInDevicesICDCFromServerMixin",["WAResultOrError","WASmaxInDevicesICDCDirtyMixin","WASmaxInDevicesICDCSignedListMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCSignedListMixin").parseICDCSignedListMixin(a);if(!b.success)return b;a=d("WASmaxInDevicesICDCDirtyMixin").parseICDCDirtyMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{iCDCDirtyMixin:a.success?a.value:null}))}g.parseICDCFromServerMixin=a}),98);
__d("WASmaxInDevicesFetchUserResponseSuccessMixin",["WAResultOrError","WASmaxInDevicesDeviceListMixin","WASmaxInDevicesICDCFromServerMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDeviceListMixin").parseDeviceListMixin(a);return!b.success?b:b}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCFromServerMixin").parseICDCFromServerMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"devices",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"icdc",i);if(!c.success)return c;a=d("WASmaxParseJid").attrUserJid(a,"jid");return!a.success?a:d("WAResultOrError").makeResult({jid:a.value,devices:b.value,icdc:c.value})}g.parseFetchUserResponseSuccessDevices=h;g.parseFetchUserResponseSuccessIcdc=i;g.parseFetchUserResponseSuccessMixin=a}),98);
__d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup",["WAResultOrError","WASmaxInDevicesFetchUserResponseFailureMixin","WASmaxInDevicesFetchUserResponseSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchUserResponseFailureMixin").parseFetchUserResponseFailureMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchUserResponseFailure",value:b.value});var c=d("WASmaxInDevicesFetchUserResponseSuccessMixin").parseFetchUserResponseSuccessMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchUserResponseSuccess",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserResponseFailure","UserResponseSuccess"],[b,c])}g.parseUserResponseFetchFailureOrFetchSuccessMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseMixin",["WAResultOrError","WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup").parseUserResponseFetchFailureOrFetchSuccessMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({userResponseFetchFailureOrFetchSuccessMixinGroup:b.value})}g.parseFetchUserResponseMixin=a}),98);
__d("WASmaxInDevicesIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInDevicesFetchResponseSuccess",["WAResultOrError","WASmaxInDevicesFetchUserResponseMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesFetchUserResponseMixin").parseFetchUserResponseMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"users");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{usersUser:b.value}))}g.parseFetchResponseSuccessUsersUser=h;g.parseFetchResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutDevicesDhashMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyDhash;a=d("WASmaxJsx").smax("smax$any",{dhash:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDhashMixin=a}),98);
__d("WASmaxOutDevicesICDCSeqMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anySeq;a=d("WASmaxJsx").smax("smax$any",{seq:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeICDCSeqMixin=a}),98);
__d("WASmaxOutDevicesFetchRequest",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutDevicesBaseIQGetRequestMixin","WASmaxOutDevicesDhashMixin","WASmaxOutDevicesICDCSeqMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid,c=a.dhashMixinArgs;a=a.iCDCSeqMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesICDCSeqMixin").mergeICDCSeqMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesDhashMixin").mergeDhashMixin,d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(b)}),c),a);return b}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeFetchRequestUsersUser=h;g.makeFetchRequest=a}),98);
__d("WASmaxDevicesFetchRPC",["WAComms","WASmaxInDevicesFetchResponseError","WASmaxInDevicesFetchResponseSuccess","WASmaxOutDevicesFetchRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutDevicesFetchRequest").makeFetchRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInDevicesFetchResponseSuccess").parseFetchResponseSuccess(b,a);if(c.success)return{name:"FetchResponseSuccess",value:c.value};b=d("WASmaxInDevicesFetchResponseError").parseFetchResponseError(b,a);if(b.success)return{name:"FetchResponseError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Fetch",{Success:c,Error:b}))});return h.apply(this,arguments)}g.sendFetchRPC=a}),98);
__d("WAFetchFbDevicesProtocolV2",["Promise","WAArrayChunk","WAHandleFbDeviceChangeNotificationProtocol","WAJids","WALoadContactsApi","WARPCAbortController","WASignalKeys","WASmaxDevicesFetchRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=25,l=1e4,m=d("WATagsLogger").TAGS(["wa-devices-protocol"]);function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(a.length===0)return new Map();var e=(yield o(a,c));c=d("WAArrayChunk").chunk(a.map(function(a){var b=e.get(a);b=b!=null?{anyDhash:b}:null;return{userJid:a,dhashMixinArgs:b}}),k);var f=new Map();yield (j||(j=b("Promise"))).allSettled(c.map(function(a){return q(f,a)}));return f});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b)return new Map();b=(yield d("WALoadContactsApi").loadContacts(a));var c=new Map();b.forEach(function(a){a&&a.dhash!=null&&c.set(a.contactJid,a.dhash)});return c});return p.apply(this,arguments)}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=new Set(b.map(function(a){return a.userJid}));b=(yield d("WARPCAbortController").rpcAbortController(d("WASmaxDevicesFetchRPC").sendFetchRPC({userArgs:b}),l));if(b.name==="FetchResponseError")throw c("err")("Failed to fetch user devices");b.value.usersUser.map(function(b){b=b.userResponseFetchFailureOrFetchSuccessMixinGroup;if(b.name==="FetchUserResponseFailure")return;b=b.value;var c=b.jid,f=b.devices;b=b.icdc;e["delete"](c);a.set(c,{newState:s(c,f,b,d("WATimeUtils").unixTime()),stateIsUpToDate:!1})});e.forEach(function(b){a.set(b,{stateIsUpToDate:!0})})}catch(a){if(a===d("WARPCAbortController").RPC_TIMEOUT){m.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Timeout for fetchAndSaveDevices"])));return}m.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",""])),a)}});return r.apply(this,arguments)}function s(a,b,c,e){e===void 0&&(e=null);var f=[],g=null;if(b){f=b.device.map(function(a){var b;return{id:d("WAJids").interpretAsDeviceId(a.id),identity:d("WASignalKeys").serializeIdentity(a.elementValue),platform:(b=a.deviceModelInfoMixin)==null||(b=b.platform)==null?void 0:b.elementValue,model:(b=a.deviceModelInfoMixin)==null||(b=b.model)==null?void 0:b.elementValue}});g=(b=b.dhashMixin)==null?void 0:b.dhash}b=null;if(c){c=d("WAHandleFbDeviceChangeNotificationProtocol").parseICDCFromServer(c);b=c.success?c.value:null}return{jid:a,devices:f,lastSyncTs:d("WATimeUtils").unixTime(),dhash:g,icdcInfo:b,notificationTs:e}}g.fetchFbDevicesProtocol=a}),98);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({APP_STATE_SYNC_DAILY:"app_state_sync_daily",CREATE_GROUP:"create_group",DECRYPT_MESSAGE_FINAL:"decrypt_message_final",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",EBDB_INIT:"ebdb_init",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",ICDC_ERROR:"icdc_error",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",MEDIA_VALIDATE:"media_validate",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ONE_QUEUE:"one_queue",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RECEIVE_MESSAGE:"receive_message",REMOVE_PARTICIPANTS:"remove_participants",SEND_MESSAGE:"send_message",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer",SYNCD:"syncd",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_KEY_ROTATION:"syncd_key_rotation",WA_DISCONNECT:"wa_disconnect",WA_FAIL_STANZA_QUEUE_ITEM:"stanza_queue_item_failure",WA_JOB_MANAGER:"wa_job_manager",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger","WAPREList"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;c=6e4;e=18e4;f=10*60*1e3;var k=0;function a(){var c=[];function e(a){c.push(a)}function b(){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]))),c.length=0}function a(a){c.length===0&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events "," ",""])),a.name,a.stage),c.forEach(function(b){b(a)})}return{subscribe:e,notify:a,clear:b}}a=a();var l=a.notify,m=a.clear;a=a.subscribe;var n;"FinalizationRegistry"in self&&"WeakRef"in self&&(n=new FinalizationRegistry(function(a){var b=a.event;a=a.eventFlow;if(a.isActive())try{d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[PRE][","] EventFlow still active during garbage collection"])),b)}catch(a){}}));var o=new Set([d("WAPREList").PRE_METRIC.SEND_MESSAGE,d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD]);function b(a,b,c,d){c==null&&k++;var e=c!=null?c:k,f="open";c==null?l({name:a,stage:"START",instanceKey:e,annotations:b,timeoutInMs:d}):l({name:a,stage:"RESUME",instanceKey:e,annotations:b});var g;function h(){if(g!=null){var a=g.deref();if(a!=null){var b;(b=n)==null||b.unregister(a)}}}d={addPoint:function(c,b){l({name:a,stage:"POINT",reason:c,instanceKey:e,annotations:b})},addAnnotations:function(b){l({name:a,stage:"ANNOTATE",instanceKey:e,annotations:b})},endSuccess:function(b){l({name:a,stage:"SUCCESS",instanceKey:e,annotations:b}),f="closed",h()},endCancel:function(b){l({name:a,stage:"CANCEL",instanceKey:e,annotations:b}),h()},endFail:function(c,b){l({name:a,stage:"FAIL",reason:c,instanceKey:e,annotations:b}),f="closed",h()},getFlowDetails:function(){return{name:a,instanceKey:e}},isActive:function(){return f==="open"}};n&&!o.has(a)&&c==null&&(n.register(d,{event:a,eventFlow:{endCancel:d.endCancel,isActive:d.isActive}}),g=new WeakRef(d));return d}g.QPL_DEFAULT_TIMEOUT_IN_MS=c;g.QPL_RECEIVE_MESSAGE_TIMEOUT_IN_MS=e;g.QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS=f;g.clear=m;g.subscribe=a;g.startMetric=b}),98);
__d("WADevicesState",["Promise","WAFetchAndSaveDevices","WAFetchFbDevicesProtocolV2","WAPREList","WAPREMetrics","WAResolvable","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=3e4,n=1e3*60*60,o=d("WATagsLogger").TAGS(["WADevicesState"]);c=function(){function a(){this.$1=new Map()}var c=a.prototype;c.$2=function(a){var b=this;setTimeout(function(){a.forEach(function(a){var c=a[0];a=a[1];a.resolveWasCalled()||(a.resolve(d("WAResultOrError").makeError()),b.$1.get(c)===a&&b.$1["delete"](c))})},m);setTimeout(function(){a.forEach(function(a){var c=a[0];a=a[1];b.$1.get(c)===a&&b.$1["delete"](c)})},n)};c.waitForUserDevices=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=this;e===void 0&&(e=!1);var g=[],m=[];e===!0&&a.forEach(function(a){f.$1["delete"](a)});a.forEach(function(a){var b=f.$1.get(a);if(b==null){var c=new(d("WAResolvable").Resolvable)();g.push([a,c]);f.$1.set(a,c)}else m.push([a,b.promise])});this.$2(g);o.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["getDevices called for users ",", reason: ",""])),Array.from(a),c);var n=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.GET_DEVICES,{string:{reason:c}});n.addPoint("fetch_start");var p=(yield d("WAFetchFbDevicesProtocolV2").fetchFbDevicesProtocol(g.map(function(a){a=a[0];return a}),e)["catch"](function(a){n.addPoint("fetch_fail");o.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["fetchFBDevicesProtocol failed: ",""])),a);return new Map()}));n.addPoint("fetch_end");var q=!0;o.DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["getDevices -> update devices signal"])));n.addPoint("signal_update_start");yield d("WAFetchAndSaveDevices").updateUsersDevicesSignalAndDB(Array.from(p.values()).map(function(a){return a.newState}).filter(Boolean))["catch"](function(a){q=!1,o.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["updateDevicesSignalAndDB failed: ",""])),a)});n.addPoint("signal_update_end");g.forEach(function(a){var b=a[0];a=a[1];if(!q){a.resolve(d("WAResultOrError").makeError());f.$1["delete"](b);return}p.has(b)?a.resolve(d("WAResultOrError").makeResult()):(a.resolve(d("WAResultOrError").makeError()),f.$1["delete"](b))});n.endSuccess();yield (l||(l=b("Promise"))).allSettled(m.map(function(a){a[0];a=a[1];return a}))});function c(b,c,d){return a.apply(this,arguments)}return c}();c.reset=function(a){var b=this;a.forEach(function(a){return b.$1["delete"](a)})};return a}();var p=new c();function a(){return p}g.DeviceStateClassV2=c;g.getDevicesState=a}),98);
__d("WAComputeICDC",["Promise","WAGetDevices","WAICDCUtils","WAIdentityUtils","WAJids","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("WATagsLogger").TAGS(["WAComputeICDC"]);function a(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=new Set(),n=[].concat(a);a=a.find(function(a){return a.user===c});if(a==null){a=(yield f.cryptoManager.storage.loadIdentities(c));a=a.get(e);if(a==null){m.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Sender does not have identity"])));return}n.push({user:c,devicesInfo:[{identity:a,jid:e}]})}a=void 0;var o=[],p=[];yield (l||(l=b("Promise"))).all(n.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var h=(yield (l||(l=b("Promise"))).all([f.cryptoManager.storage.loadICDC(e.user),f.cryptoManager.storage.loadLastSyncTs(e.user)])),j=h[0];h=h[1];d("WAICDCUtils").isLastSyncTsExpired(h)&&g.add(e.user);h=new Set();if(j==null)g.add(e.user);else if(d("WAICDCUtils").isICDCIndexInvalid(j))g.add(e.user),m.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["ICDC has invalid index"]))),j=null;else for(var k of j.devices)h.add(k.toString());k=[];var n=[];for(var q of e.devicesInfo){var r=d("WAJids").extractDeviceId(q.jid),s=d("WAIdentityUtils").removeKeyTypeIfNeeded(q.identity);h.has(s.toString())||(k.push(r),n.push(s.buffer))}r={unknownDevices:n,unknownDeviceIds:k};j!=null&&(r.seq=j.sequence,r.signingDevice=j.devices[j.signingDeviceIndex].buffer);e.user===c?a=r:(o.push(r),p.push(e.user))});return function(a){return e.apply(this,arguments)}}()));g.size>0&&(m.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Triggering getDevices for users with missing or incorrect icdc info."]))),d("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"missing-icdc-info",users:g})["catch"](function(a){m.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices for users with missing icdc info: ",""])),a)}));return{senderIdentity:a,recipientIdentities:o,recipientUserJids:p}});return n.apply(this,arguments)}g.computeICDC=a}),98);
__d("WAMultiDevice.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={};a.name="MultiDevice";a.internalSpec={payload:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,c],metadata:[2,d.TYPES.MESSAGE,b]};b.name="MultiDevice$Metadata";b.internalSpec={};c.name="MultiDevice$Payload";c.internalSpec={applicationData:[1,d.TYPES.MESSAGE,e],signal:[2,d.TYPES.MESSAGE,m],__oneofs__:{payload:["applicationData","signal"]}};e.name="MultiDevice$ApplicationData";e.internalSpec={appStateSyncKeyShare:[1,d.TYPES.MESSAGE,h],appStateSyncKeyRequest:[2,d.TYPES.MESSAGE,f],__oneofs__:{applicationData:["appStateSyncKeyShare","appStateSyncKeyRequest"]}};f.name="MultiDevice$ApplicationData$AppStateSyncKeyRequestMessage";f.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,l]};h.name="MultiDevice$ApplicationData$AppStateSyncKeyShareMessage";h.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};i.name="MultiDevice$ApplicationData$AppStateSyncKey";i.internalSpec={keyId:[1,d.TYPES.MESSAGE,l],keyData:[2,d.TYPES.MESSAGE,j]};j.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData";j.internalSpec={keyData:[1,d.TYPES.BYTES],fingerprint:[2,d.TYPES.MESSAGE,k],timestamp:[3,d.TYPES.INT64]};k.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprint";k.internalSpec={rawId:[1,d.TYPES.UINT32],currentIndex:[2,d.TYPES.UINT32],deviceIndexes:[3,d.FLAGS.REPEATED|d.FLAGS.PACKED|d.TYPES.UINT32]};l.name="MultiDevice$ApplicationData$AppStateSyncKeyId";l.internalSpec={keyId:[1,d.TYPES.BYTES]};m.name="MultiDevice$Signal";m.internalSpec={};g.MultiDeviceSpec=a;g.MultiDevice$MetadataSpec=b;g.MultiDevice$PayloadSpec=c;g.MultiDevice$ApplicationDataSpec=e;g.MultiDevice$ApplicationData$AppStateSyncKeyRequestMessageSpec=f;g.MultiDevice$ApplicationData$AppStateSyncKeyShareMessageSpec=h;g.MultiDevice$ApplicationData$AppStateSyncKeySpec=i;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyDataSpec=j;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprintSpec=k;g.MultiDevice$ApplicationData$AppStateSyncKeyIdSpec=l;g.MultiDevice$SignalSpec=m}),98);
__d("WAParseAppStateSyncKeyRequest",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];for(a of a.keyIds)a.keyId!=null&&b.push(d("WASyncdKeyTypes").toSyncKeyId(a.keyId));return{keyIds:b}}g.parseAppStateSyncKeyRequest=a}),98);
__d("WASyncdKeyManagementUtils",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint16(0)}function h(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint32(2)}function b(a){return h(a)+1}g.getKeyDeviceId=a;g.getKeyEpoch=h;g.generateNewKeyEpoch=b}),98);
__d("WAParseAppStateSyncKeyShare",["WALogger","WALongInt","WASyncdKeyManagementUtils","WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=[],c=[];for(a of a.keys){var d=i(a);d!=null&&(d.type==="orphan"?c.push(d.keyId):(d.type,b.push(d.keyData)))}return{keys:b,orphanKeys:c}}function i(a){var b,c,e,f,g,i;if(((b=a.keyId)==null?void 0:b.keyId)==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Key missing keyId"])));return null}b=d("WASyncdKeyTypes").toSyncKeyId(a.keyId.keyId);c=(c=a.keyData)==null?void 0:c.keyData;e=d("WALongInt").maybeNumberOrThrowIfTooLarge((e=a.keyData)==null?void 0:e.timestamp);f=(f=a.keyData)==null||(f=f.fingerprint)==null?void 0:f.currentIndex;g=(g=a.keyData)==null||(g=g.fingerprint)==null?void 0:g.deviceIndexes;i=(i=a.keyData)==null||(i=i.fingerprint)==null?void 0:i.rawId;return a.keyData==null||c==null||e==null||f==null||g==null||i==null?{keyId:b,type:"orphan"}:{keyData:{fingerprint:{currentIndex:f,deviceIndexes:g,rawId:i},keyData:d("WASyncdKeyTypes").toSyncKeyData(c),keyEpoch:d("WASyncdKeyManagementUtils").getKeyEpoch(b),keyId:b,timestamp:e},type:"key"}}g.parseAppStateSyncKeyShare=a}),98);
__d("WAConvertAppData",["WAAppData","WAArmadilloApplication.pb","WAJids","WALogger","WAMultiDevice.pb","WAParseAppStateSyncKeyRequest","WAParseAppStateSyncKeyShare","WAStanzaUtils","WASyncdKeyTypes","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u;function v(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="group")return a.groupJid;else{a.jidType;throw c("err")("Incorrect jid type: "+a.jidType)}}function w(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="msgrDevice")return d("WAJids").extractUserJid(a.deviceJid);else{a.jidType;throw c("err")("Incorrect jid type: "+a.jidType)}}function x(a){return a!=null?typeof a==="number"&&a>d("WATimeUtils").MAX_INT?d("WATimeUtils").castMilliSecondsToUnixTime(a):d("WATimeUtils").castLongIntToUnixTime(a):void 0}function y(a){return a==null?void 0:{lastMessageTimestamp:x(a.lastMessageTimestamp),lastSystemMessageTimestamp:x(a.lastSystemMessageTimestamp),messages:a.messages==null?[]:a.messages.map(function(a){return{key:a.key==null?void 0:{fromMe:a.key.fromMe,id:a.key.id},ts:x(a.timestamp)}})}}function z(a,b){var c=a.chatId;if(c==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing chatId in chat action: ",""])),a);return null}if(a.chatArchive!=null){var e=a.chatArchive;e=y(e.messageRange);return{chatJid:v(c),messageRange:e,ts:b,type:"chat_archive"}}else if(a.chatDelete!=null){e=a.chatDelete;e=y(e.messageRange);return{chatJid:v(c),messageRange:e,ts:b,type:"chat_delete"}}else if(a.chatRead!=null){e=a.chatRead;var f=y(e.messageRange);return{chatJid:v(c),messageRange:f,read:e.read,ts:b,type:"chat_read"}}else{d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),a);return null}}function A(a){var b=a.key,c=b==null?void 0:b.remoteJid,e=b==null?void 0:b.id,f=b==null?void 0:b.fromMe;if(b==null||c==null||f==null||e==null){d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Missing messageKey in message action: ",""])),a);return null}var g=v(c),h=d("WAJids").interpretAsGroupJid(g)!=null;if(h&&!f){if((b==null?void 0:b.participant)==null){d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["No participant in messageKey in message action when it is group chat and message is not fromMe: ",""])),a);return null}h=w(b.participant)}else f?h=d("WAJids").AUTHOR_ME:h=w(c);b={author:h,chat:g,externalId:d("WAStanzaUtils").toStanzaId(e)};if(a.messageDelete!=null)return{protocolMsgId:b,type:"delete_for_me"};else{d("WALogger").WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),a);return null}}function B(a){var b=[];for(a of a){var c=x(a.actionTimestamp);if(a.chatAction!=null){c=z(a.chatAction,c);c!=null&&b.push({chatAction:c})}else if(a.messageAction!=null){c=A(a.messageAction);c!=null&&b.push({messageAction:c})}else d("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),a)}return b}function C(a){var b=a.anonId,c=a.id,e=a.rootKey;a=a.status;if(a==null||c==null||b==null||e==null){d("WALogger").WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecretsEpoch"])));return null}var f;if(a===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN)f=d("WAAppData").EPOCH_STATUS_OPEN;else if(a===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE)f=d("WAAppData").EPOCH_STATUS_CLOSE;else{d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["status in EncryptedBackupsSecretsEpoch has invalid value"])));return null}return{anonId:b,id:c,rootKey:e,status:f}}function D(a){var b=a.backupId,c=a.epoch,e=a.mailboxRootKey,f=a.obliviousValidationToken,g=a.serverDataId;a=a.tempOcmfClientState;if(b==null||g==null||a==null||e==null||f==null){d("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecrets"])));return null}return{backupId:b,epoch:c.map(C).reduce(function(a,b){if(b!=null)return a.concat([b]);else return a},[]),mailboxRootKey:e,obliviousValidationToken:f,serverDataId:g,tempOcmfClientState:a}}function E(a){var b;if(((b=a.applicationData)==null||(b=b.metadataSync)==null?void 0:b.actions)!=null){return{actions:B((b=a.applicationData)==null||(b=b.metadataSync)==null?void 0:b.actions),type:"meta_sync"}}else if(((b=a.signal)==null?void 0:b.encryptedBackupsSecrets)!=null){b=D(a.signal.encryptedBackupsSecrets);return b==null?null:{encryptedBackupsSecrets:b,type:"backups_secrets"}}else{d("WALogger").WARN(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a);return null}}function F(a){var b;if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare)!=null){return{syncKeyShare:d("WAParseAppStateSyncKeyShare").parseAppStateSyncKeyShare((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare),type:"sync_key_share"}}else if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest)!=null){return{syncKeyRequest:d("WAParseAppStateSyncKeyRequest").parseAppStateSyncKeyRequest((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest),type:"sync_key_request"}}else{d("WALogger").WARN(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a);return null}}function a(a){if(a.subprotocolType==="armadillo"){var b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,a.payload);if(b.payload==null)throw c("err")("Appdata contains unparseable armadillo data.");return E(b.payload)}else if(a.subprotocolType==="multiDevice"){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMultiDevice.pb").MultiDeviceSpec,a.payload);if(b.payload==null)throw c("err")("Appdata contains unparseable armadillo data.");return F(b.payload)}else throw c("err")("Appdata contains unexpected message application: "+a.subprotocolType)}function G(a){return a==null?void 0:{lastMessageTimestamp:a.lastMessageTimestamp,lastSystemMessageTimestamp:a.lastSystemMessageTimestamp,messages:a.messages.map(function(a){return{key:a.key==null?void 0:{fromMe:a.key.fromMe,id:a.key.id},timestamp:a.ts}})}}function H(a){switch(a.type){case"meta_sync":return{payload:{applicationData:P(a)}};case"backups_secrets":return{payload:{signal:{encryptedBackupsSecrets:N(a.encryptedBackupsSecrets)}}};default:a.type;d("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a.type);return{}}}function I(a){return{keyId:d("WASyncdKeyTypes").fromSyncKeyId(a)}}function J(a){return{keyData:{fingerprint:{currentIndex:a.fingerprint.currentIndex,deviceIndexes:a.fingerprint.deviceIndexes,rawId:a.fingerprint.rawId},keyData:d("WASyncdKeyTypes").fromSyncKeyData(a.keyData),timestamp:a.timestamp},keyId:I(a.keyId)}}function K(a){var b=a.keys.map(J);a=a.orphanKeys==null?[]:a.orphanKeys.map(function(a){return{keyId:I(a)}});b.push.apply(b,a);return{keys:b}}function L(a){return{keyIds:a.keyIds.map(I)}}function M(a){switch(a.type){case"sync_key_share":return{payload:{applicationData:{appStateSyncKeyShare:K(a.syncKeyShare)}}};case"sync_key_request":return{payload:{applicationData:{appStateSyncKeyRequest:L(a.syncKeyRequest)}}};default:a.type;d("WALogger").WARN(t||(t=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a.type);return{}}}function b(a){var b;switch(a.type){case"meta_sync":case"backups_secrets":var c=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,H(a));b={armadillo:{payload:c.readByteArrayView(),version:1}};break;case"sync_key_share":case"sync_key_request":c=d("encodeProtobuf").encodeProtobuf(d("WAMultiDevice.pb").MultiDeviceSpec,M(a));b={multiDevice:{payload:c.readByteArrayView(),version:1}};break;default:a.type,d("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),a.type),b={}}return{payload:{subProtocol:b}}}function N(a){return{backupId:a.backupId,epoch:a.epoch.map(O),mailboxRootKey:a.mailboxRootKey,obliviousValidationToken:a.obliviousValidationToken,serverDataId:a.serverDataId,tempOcmfClientState:a.tempOcmfClientState}}function O(a){var b;a.status===d("WAAppData").EPOCH_STATUS_OPEN?b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN:a.status===d("WAAppData").EPOCH_STATUS_CLOSE&&(b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE);return{anonId:a.anonId,id:a.id,rootKey:a.rootKey,status:b}}function P(a){return{metadataSync:{actions:a.actions.map(function(a){if(a.chatAction)return{actionTimestamp:a.chatAction.ts,chatAction:Q(a.chatAction)};else return{messageAction:R(a.messageAction)}})}}}function Q(a){var b=G(a.messageRange),c=a.chatJid;switch(a.type){case"chat_archive":return{chatArchive:{archived:a.archived,messageRange:b},chatId:c};case"chat_delete":return{chatDelete:{messageRange:b},chatId:c};default:a.type;return{chatId:c,chatRead:{messageRange:b,read:a.read}}}}function R(a){if(a.type==="delete_for_me"){var b=a.protocolMsgId.chat,e=d("WAJids").interpretAsGroupJid(b)!=null;return{key:{fromMe:d("WAJids").isAuthorMe(a.protocolMsgId.author),id:a.protocolMsgId.externalId,participant:!d("WAJids").isAuthorMe(a.protocolMsgId.author)&&e?a.protocolMsgId.author:void 0,remoteJid:b},messageDelete:{}}}else throw c("err")("No other available type")}function e(a){if(a.type!=="meta_sync")return[];a=a.actions.map(function(a){var b=a.chatAction;a=a.messageAction;return(a=a==null?void 0:a.protocolMsgId.chat)!=null?a:b==null?void 0:b.chatJid}).filter(Boolean);return Array.from(new Set(a))}g.parseArmadilloAppData=E;g.parseMultiDeviceAppData=F;g.parseAppData=a;g.convertArmadilloAppData=H;g.convertMultiDeviceAppData=M;g.convertAppData=b;g.getChatJidForAppData=e}),98);
__d("WADbPersonalSenderKeyStatusTxns",["WASignalDB","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=["groupJid","senderKeyTs"],i=["groupJid","senderKeyTs"],j={hasSenderKey:new Set(),rotateSenderKey:!0,senderKeyId:null,senderKeyTs:d("WATimeUtils").castToUnixTime(0)};a=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(b){return b.stores.personalSenderKeyStatuses.bulkPut(a.map(function(a){return babelHelpers["extends"]({},j,{groupJid:a})}))},d("WASignalDB").signalOp("bulkPutNewPersonalSenderKeyStatus"))};c=function(a,c,e){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.personalSenderKeyStatuses.get(a));yield b.stores.personalSenderKeyStatuses.bulkPut([babelHelpers["extends"]({},d||j,{groupJid:a,rotateSenderKey:!1,senderKeyId:c,senderKeyTs:e})])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("markSenderKeyAsRotated"))};e=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.stores.personalSenderKeyStatuses.get(a));if(c!=null){c.groupJid;var d=c.senderKeyTs;c=babelHelpers.objectWithoutPropertiesLoose(c,h);return babelHelpers["extends"]({},c,{ts:d})}c=babelHelpers["extends"]({},j,{groupJid:a});yield b.stores.personalSenderKeyStatuses.bulkPut([c]);c.groupJid;d=c.senderKeyTs;b=babelHelpers.objectWithoutPropertiesLoose(c,i);return babelHelpers["extends"]({},b,{ts:d})});return function(a){return c.apply(this,arguments)}}(),"Signal - getSenderKeyStatus")};f=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.stores.personalSenderKeyStatuses.bulkGet(a));yield b.stores.personalSenderKeyStatuses.bulkPut(c.filter(function(a){return a!=null}).map(function(a){return babelHelpers["extends"]({},a,{rotateSenderKey:!0})}))});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("bulkSetRotateSenderKeyToTrue"))};var k=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(b){return b.stores.personalSenderKeyStatuses.bulkDelete(a)},d("WASignalDB").signalOp("deletePersonalSenderKeyStatus"))};g.bulkPutNewPersonalSenderKeyStatus=a;g.markSenderKeyAsRotated=c;g.getSenderKeyStatus=e;g.bulkSetRotateSenderKeyToTrue=f;g.deletePersonalSenderKeyStatus=k}),98);
__d("WACreateGroup",["WADbPersonalSenderKeyStatusTxns","WAGlobals","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAGlobals").getDependencies().createGroups(a),yield d("WADbPersonalSenderKeyStatusTxns").bulkPutNewPersonalSenderKeyStatus(a.map(function(a){return a.groupToCreate.jid}))});return function(b){return a.apply(this,arguments)}}();g.createGroups=a}),98);
__d("WAGetPrekeyIdsInRange",["WASignalKeys"],(function(a,b,c,d,e,f,g){"use strict";var h=16777215;function i(a){return a}function a(a,b){var c=[];a=i(a);var e=i(b);if(a<=e)for(var f=a;f<=b;f++)c.push(d("WASignalKeys").castToPreKeyId(f));else{for(b=a;b<h;b++)c.push(d("WASignalKeys").castToPreKeyId(b));for(f=1;f<=e;f++)c.push(d("WASignalKeys").castToPreKeyId(f))}return c}g.PRE_KEY_MAX_ID=h;g.getPrekeyIdsInRange=a}),98);
__d("WADeletePreKeyGenerationsApi",["Promise","WAGetPrekeyIdsInRange","WALogger","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a){return d("WASignalDB").getDb().runInTransaction(["prekey","prekeyGeneration"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=(yield c.stores.prekeyGeneration.bulkGet(a)),f=[];for(e of e){if(e==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Attempting to delete non-existent prekey generation"])));continue}for(var g of d("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(e.startingId,e.endingId))f.push(g)}yield (i||(i=b("Promise"))).all([c.stores.prekeyGeneration.bulkDelete(a),c.stores.prekey.bulkDelete(f)])});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("deletePreKeyGenerations"))};g.deletePreKeyGenerations=a}),98);
__d("WAGetLastPreKeyGenerationIdApi",["Promise","WADbSignal","WASignalDB","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(a){return(h||(h=b("Promise"))).all([a.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyId).then(function(a){return a==null?void 0:a.value.lastPrekeyId}),a.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(a){return a==null?void 0:a.value.lastPrekeyGenerationId})])},d("WASignalDB").signalOp("getLastPreKeyGenerationId"))),e=a[0];a=a[1];if(e==null&&a!=null||e!=null&&a==null)throw c("err")("Last prekey id and Last prekey generation id should both be non-null");return e!=null&&a!=null?{lastGenerationId:a,lastPreKeyId:e}:null});return function(){return a.apply(this,arguments)}}();g.getLastPreKeyGenerationId=a}),98);
__d("WAGetPreKeyGenerationsTimestampsApi",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WASignalDB").getDb().runInTransaction(["prekeyGeneration"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a.stores.prekeyGeneration.readAll());return a.map(function(a){return{id:a.generationId,timestamp:a.createdTs}})});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getPreKeyGenerationsTimestamps"))};g.getPreKeyGenerationsTimestamps=a}),98);
__d("WALoadICDCApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(b){return b.stores.contacts.bulkGet([a]).then(function(a){a=a.filter(Boolean).length>0?a[0]:null;return(a=a==null?void 0:a.icdcInfo)!=null?a:null})},d("WASignalDB").signalOp("loadICDC"))};g.loadICDC=a}),98);
__d("WALoadIdentitiesApi",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield b.stores.identity.readIndex("userJid",[a]));return new Map(b.filter(Boolean).map(function(a){return[a.deviceJid,a.identity]}))});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadIdentities"))};c=function(a){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var d=(yield (h||(h=b("Promise"))).all(a.map(function(a){return c.stores.identity.readIndex("userJid",[a])}))),e=new Map();for(d of d)for(var f of d){if(f==null)continue;var g=e.get(f.userJid);g==null&&(g=new Map());g.set(f.deviceJid,f.identity);e.set(f.userJid,g)}return e});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("bulkLoadIdentities"))};g.loadIdentities=a;g.bulkLoadIdentities=c}),98);
__d("WALoadLastSyncTsApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(b){return b.stores.contacts.bulkGet([a]).then(function(a){a=a.filter(Boolean).length>0?a[0]:null;return(a=a==null?void 0:a.lastSyncTs)!=null?a:null})},d("WASignalDB").signalOp("loadLastSyncTs"))};g.loadLastSyncTs=a}),98);
__d("WADbMetaTxns",["WADbSignal","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.meta.bulkGet([d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,d("WADbSignal").MetaKeysEnum.identityKeyPair]).then(function(a){var b=a[0];a=a[1];b=b==null?void 0:b.value.lastSignedPrekeyId;a=a==null?void 0:a.value.identityKeyPair;return{identityPair:a,keyId:b}})}c=function(a){return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield b.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.cat,value:{cat:a}}]);return a});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveCAT"))};g.maybeGetLastSignedPrekeyIdAndIdentity=a;g.saveCAT=c}),98);
__d("WADbSignedPrekeyTxns",["WADbMetaTxns","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WADbMetaTxns").maybeGetLastSignedPrekeyIdAndIdentity(a)),c=b.identityPair;b=b.keyId;if(b==null)if(c==null)return d("WAResultOrError").makeError("missing-last-signed-prekey-id-and-registration");else return d("WAResultOrError").makeError("missing-last-signed-prekey-id");c=(yield a.signedPrekey.get(b));return c==null?d("WAResultOrError").makeError("missing-last-signed-prekey"):d("WAResultOrError").makeResult(c.encoded)});return h.apply(this,arguments)}g.getLatestSignedPreKey=a}),98);
__d("WALoadLatestSignedPreKeyApi",["WADbSignedPrekeyTxns","WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readonly",function(a){return d("WADbSignedPrekeyTxns").getLatestSignedPreKey(a.stores)},d("WASignalDB").signalOp("loadLatestSignedPreKey"))};g.loadLatestSignedPreKey=a}),98);
__d("WALoadOneTimePreKeyApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["prekey"],"readonly",function(b){return b.stores.prekey.get(a).then(function(a){return a==null?void 0:a.encoded})},d("WASignalDB").signalOp("loadOneTimePreKey"))};g.loadOneTimePreKey=a}),98);
__d("WADbPrekeyTxns",["WAGetPrekeyIdsInRange","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield a.prekeyGeneration.get(b));if(b==null)throw c("err")("Expected a prekey generation row");b=d("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(b.startingId,b.endingId);a=(yield a.prekey.bulkGet(b));return a.filter(Boolean).map(function(a){return a.encoded})});return h.apply(this,arguments)}g.getPrekeysForGeneration=a}),98);
__d("WALoadPreKeysApi",["WADbPrekeyTxns","WADbSignal","WADbSignedPrekeyTxns","WALoggerTag","WASignalDB","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekey]);a=function(a){return d("WASignalDB").getDb().runInTransaction(["identity","meta","prekey","prekeyGeneration","signedPrekey"],"readonly",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(yield d("WADbSignedPrekeyTxns").getLatestSignedPreKey(b.stores));if(!e.success){var f;k.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to get latest signed prekey"])));throw(f=e.error)!=null?f:c("err")("Failed to get latest signed prekey")}var g=d("WASignalSignatures").deserializeSignedPreKey(e.value);if(g==null){k.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey"])));throw c("err")("Failed to deserialize signed prekey")}f=a!=null?a:yield b.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(a){return a==null?void 0:a.value.lastPrekeyGenerationId});if(f==null){k.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["No last prekey generation id"])));throw c("err")("No last prekey generation id")}return d("WADbPrekeyTxns").getPrekeysForGeneration(b.stores,f).then(function(a){return{preKeys:a,signedPreKey:g}})});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadPreKeys"))};g.loadPreKeys=a}),98);
__d("WALoadSenderKeySessionApi",["WACryptoManager","WADbSignal","WAJids","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c){var e=d("WAJids").extractUserJid(c);c=d("WAJids").extractDeviceId(c);var f=d("WADbSignal").buildSenderKeySessionId(a,e,c);return d("WASignalDB").getDb().runInTransaction(["senderKeySessions"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a.stores.senderKeySessions.get(f));if(a==null)return d("WAResultOrError").makeError("errLoadSenderKeySession");a=d("WACryptoManager").decodeSenderKeySession(a.record);return d("WAResultOrError").makeResult(a)});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadSenderKeySession"))};g.loadSenderKeySession=a}),98);
__d("WALoadSignedPreKeyApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(b){return b.stores.signedPrekey.get(a).then(function(a){return a==null?void 0:a.encoded})},d("WASignalDB").signalOp("loadSignedPreKey"))};g.loadSignedPreKey=a}),98);
__d("WASaveOneTimePreKeyApi",["Promise","WADbSignal","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return d("WASignalDB").getDb().runInTransaction(["meta","prekey"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=(yield c.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyId));e=e==null?void 0:e.value.lastPrekeyId;if(e==null)return d("WAResultOrError").makeError("missing_last_prekey");yield (h||(h=b("Promise"))).all([c.stores.prekey.bulkPut([babelHelpers["extends"]({},a,{isDeleted:!1})]),c.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:a.keyId}}])]);return d("WAResultOrError").makeResult()});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveOneTimePreKey"))};g.saveOneTimePreKey=a}),98);
__d("WASavePreKeysGenerationApi",["Promise","WACryptoManager","WADbSignal","WAResultOrError","WASignalDB","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)throw c("err")("Keys provided to savePreKeysGeneration cannot be empty");var e=(yield d("WASignalDB").getDb().runInTransaction(["meta","prekey","prekeyGeneration"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=(yield c.stores.meta.get(d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId));e=d("WACryptoManager").castToPreKeyGenerationId(((e=e==null?void 0:e.value.lastPrekeyGenerationId)!=null?e:0)+1);var f=a[0].keyId,g=a[a.length-1].keyId,i=a.map(function(a){return babelHelpers["extends"]({},a,{isDeleted:!1})});yield (h||(h=b("Promise"))).all([c.stores.prekey.bulkPut(i),c.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:g}},{key:d("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId,value:{lastPrekeyGenerationId:e}}]),c.stores.prekeyGeneration.bulkPut([{createdTs:d("WATimeUtils").unixTime(),endingId:g,generationId:e,startingId:f}])]);return d("WAResultOrError").makeResult(e)});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("savePreKeysGeneration")));return e});return function(b){return a.apply(this,arguments)}}();g.savePreKeysGeneration=a}),98);
__d("WASaveSignedPreKeyIfNewApi",["Promise","WADbSignal","WASignalDB","WASignalSignatures","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c){return d("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var f=(yield e.stores.signedPrekey.get(a));if(f!=null){f=d("WASignalSignatures").deserializeSignedPreKey(f.encoded);if(f!=null)return{key:f,type:"duplicate"}}yield (h||(h=b("Promise"))).all([e.stores.signedPrekey.bulkPut([{encoded:c,keyId:a}]),e.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:a}}])]);return{type:"success"}});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveSignedPreKeyIfNew"))};g.saveSignedPreKeyIfNew=a}),98);
__d("WASessionApi",["WACryptoManager","WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().store("session").get(a).then(function(a){return a==null?null:d("WACryptoManager").decodeSession(a.session)})};b=function(a){return d("WASignalDB").getDb().store("session").bulkGet(a).then(h)};function h(a){var b=new Map();for(a of a){if(a==null)continue;var c=d("WACryptoManager").decodeSession(a.session);b.set(a.id,c)}return b}g.loadSession=a;g.bulkLoadSession=b}),98);
__d("WACryptoDbCallbacks",["WABulkSaveSignalDataApi","WADeletePreKeyGenerationsApi","WAGetLastPreKeyGenerationIdApi","WAGetPreKeyGenerationsTimestampsApi","WALoadICDCApi","WALoadIdentitiesApi","WALoadLastSyncTsApi","WALoadLatestSignedPreKeyApi","WALoadOneTimePreKeyApi","WALoadPreKeysApi","WALoadSenderKeySessionApi","WALoadSignedPreKeyApi","WASaveOneTimePreKeyApi","WASavePreKeysGenerationApi","WASaveSignedPreKeyIfNewApi","WASessionApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return{bulkLoadIdentities:d("WALoadIdentitiesApi").bulkLoadIdentities,bulkSaveSignalData:d("WABulkSaveSignalDataApi").bulkSaveSignalData,deletePreKeyGenerations:d("WADeletePreKeyGenerationsApi").deletePreKeyGenerations,getLastPreKeyGenerationId:d("WAGetLastPreKeyGenerationIdApi").getLastPreKeyGenerationId,getPreKeyGenerationsTimestamps:d("WAGetPreKeyGenerationsTimestampsApi").getPreKeyGenerationsTimestamps,loadICDC:d("WALoadICDCApi").loadICDC,loadIdentities:d("WALoadIdentitiesApi").loadIdentities,loadLastSyncTs:d("WALoadLastSyncTsApi").loadLastSyncTs,loadLatestSignedPreKey:d("WALoadLatestSignedPreKeyApi").loadLatestSignedPreKey,loadOneTimePreKey:d("WALoadOneTimePreKeyApi").loadOneTimePreKey,loadPreKeys:d("WALoadPreKeysApi").loadPreKeys,loadSenderKeySession:d("WALoadSenderKeySessionApi").loadSenderKeySession,loadSession:d("WASessionApi").loadSession,loadSessions:d("WASessionApi").bulkLoadSession,loadSignedPreKey:d("WALoadSignedPreKeyApi").loadSignedPreKey,saveOneTimePreKey:d("WASaveOneTimePreKeyApi").saveOneTimePreKey,savePreKeysGeneration:d("WASavePreKeysGenerationApi").savePreKeysGeneration,saveSignedPreKeyIfNew:d("WASaveSignedPreKeyIfNewApi").saveSignedPreKeyIfNew}};g.getCryptoDbCallbacks=a}),98);
__d("memoizeWithArgsLFUCache",["LFUCache"],(function(a,b,c,d,e,f,g){function a(a,b,d,e){var f;function g(){f||(f=new(c("LFUCache"))(d));return f}function h(){f=null}e&&e(h);e=function(){var c=g(),d=b.apply(void 0,arguments);c.has(d)||c.set(d,a.apply(void 0,arguments));var e=c.get(d);return e};return e}g["default"]=a}),98);
__d("WAMPSFlushable",["MpsTypes","WebMps","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=[],this.$2=new Map(),this.$3=new Set()}var e=a.prototype;e.enqueue=function(a,b,c){if(a==null)return;this.$1.push(a);this.$2.set(a.messageId,b);this.$3.add(c)};e.flush=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){if(this.$1.length===0)return;a=this.$1;b=Array.from(this.$3).join(", ");f=this.$2;this.$1=[];this.$2=new Map();this.$3=new Set();try{var h=(yield d("WebMps").mps().saveNewMessages(a.map(function(a){return{directive:null,message:a,insertionSource:d("MpsTypes").InsertionSource.Receive}}),{source:b}));f.forEach(function(a,b){a(h.get(b))})}catch(a){var i=c("getErrorSafe")(a);e==null||e.addPoint("mps_persistance_fail");f.forEach(function(a){a(i)})}});function e(b,c,d,e,f){return a.apply(this,arguments)}return e}();return a}();e=new a();g.MPSFlushable=a;g.mpsFlushable=e}),98);
__d("WASignalEntityStoreV2",["$InternalEnum","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["NOT_PERSISTED","PERSIST_IN_PROGRESS","PERSISTED"]);a=function(){function a(){this.$1=new Map()}var c=a.prototype;c.TEST_ONLY_LOAD_FROM_MEMORY=function(a){return this.$2(a)};c.$2=function(a){a=this.$1.get(a);return a!=null?{entity:a.entity,deleted:a.deleted}:null};c.load=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=this.$2(a);if(c!=null&&c.deleted)return null;if(c!=null&&c.entity!=null)return c.entity;c=(yield b(a));this.$3(a,c);return c});function c(b,c){return a.apply(this,arguments)}return c}();c.bulkLoad=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=[],d=new Map();for(a of a){var e=this.$2(a);if(e==null){c.push(a);continue}if(e.deleted)continue;e.entity!=null?d.set(a,e.entity):c.push(a)}e=(yield b(c));for(a of e.entries()){b=a[0];c=a[1];d.set(b,c);this.$3(b,c)}return d});function c(b,c){return a.apply(this,arguments)}return c}();c.$3=function(a,b){this.$1.set(a,{entity:b,status:g.PERSISTED,deleted:!1})};c.store=function(a,b){this.$1.set(a,{entity:b,status:g.NOT_PERSISTED,deleted:!1})};c.remove=function(a){this.$1.set(a,{entity:null,status:g.NOT_PERSISTED,deleted:!0})};c.pureSnapshot=function(){var a=[],b=Array.from(this.$1.entries()).filter(function(a){a[0];a=a[1];return a.status===g.NOT_PERSISTED}).filter(function(b){var c=b[0];b=b[1];b.deleted&&a.push({id:c});return!b.deleted}).filter(function(a){a[0];a=a[1];return a.entity!=null}).map(function(a){var b=a[0];a=a[1];return{id:b,cachedEntity:a.entity}});return{update:b,remove:a}};c.snapshot=function(){var a=this,b=this.pureSnapshot();b.remove.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});b.update.forEach(function(b){b=b.id;b=a.$1.get(b);b&&(b.status=g.PERSIST_IN_PROGRESS)});return b};c.markSnapshotAsCommitted=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.PERSISTED)})};c.markSnapshotAsFailed=function(){this.$1.forEach(function(a){a.status===g.PERSIST_IN_PROGRESS&&(a.status=g.NOT_PERSISTED)})};c.clear=function(){this.$1=new Map()};return a}();f.PersistStatus=g;f.SignalEntityStore=a}),66);
__d("WASignalIdentityStore",["Promise","WAJids","WALogger","WASignalEntityStoreV2","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){function a(){this.$1=new Map(),this.$2=new(d("WASignalEntityStoreV2").SignalEntityStore)()}var c=a.prototype;c.bulkLoadIdentities=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=this,d=function*(){var a=e[0],d=e[1];yield c.loadIdentitiesByUser(a,function(){return(i||(i=b("Promise"))).resolve(d)})};for(var e of a)yield* d();return a});function c(b){return a.apply(this,arguments)}return c}();c.loadIdentitiesByUser=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=this.$1.get(a);if(e==null){var f=this.$3(a,yield c(a));c=Array.from(f.keys());this.$1.set(a,new Set(c));return this.$2.bulkLoad(c,function(){return(i||(i=b("Promise"))).resolve(f)})}else return this.$2.bulkLoad(Array.from(e),function(a){a.length>0&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[WASignalIdentityStore] This should never happen."])));return(i||(i=b("Promise"))).resolve(new Map())})});function c(b,c){return a.apply(this,arguments)}return c}();c.$3=function(a,b){b=new Map(b);var c=this.$2.pureSnapshot(),e=c.remove;c=c.update;for(e of e){var f=e.id;b["delete"](f)}for(f of c){e=f.id;c=f.cachedEntity;c!=null&&d("WAJids").extractUserJid(e)===a&&b.set(e,c)}return b};c.store=function(a,b){this.$2.store(a,b);b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b.add(a)};c.remove=function(a){this.$2.remove(a);var b=d("WAJids").extractUserJid(a);b=this.$1.get(b);b!=null&&b["delete"](a)};c.clear=function(){this.$2.clear(),this.$1=new Map()};c.load=function(a,b){return this.$2.load(a,b)};c.bulkLoad=function(a,b){return this.$2.bulkLoad(a,b)};c.snapshot=function(){return this.$2.snapshot()};c.pureSnapshot=function(){return this.pureSnapshot()};c.markSnapshotAsCommitted=function(){this.$2.markSnapshotAsCommitted()};c.markSnapshotAsFailed=function(){this.$2.markSnapshotAsFailed()};return a}();g.SignalIdentityStore=a}),98);
__d("WAInMemorySignalStore",["MAWMpsGating","Promise","WAArmadilloTransportEvent.pb","WABuildMpsPayload","WACryptoManager","WACryptoUtils","WAGlobals","WAIdentityUtils","WAJids","WAMPSFlushable","WAProtocolQueue","WAResultOrError","WASignalEntityStoreV2","WASignalIdentityStore","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u=d("WATagsLogger").TAGS(["CryptoManager","InMemorySignalStore"]);a=function(){function a(a,c){var e=this;this.loadSession=function(a,b){return e.$1.load(a,function(a){return e.$9.loadSession(a,b)})};this.loadSessions=function(a){return e.$1.bulkLoad(a,function(a){return e.$9.loadSessions(a).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})}).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1]]}))})};this.loadSignedPreKey=function(a){return e.$7.load(a,function(){return e.$9.loadSignedPreKey(a)})};this.bulkLoadIdentities=function(a){var c=new Map();return(t||(t=b("Promise"))).all(a.map(function(a){return e.loadIdentities(a).then(function(b){c.set(a,b)})})).then(function(){return c})};this.loadIdentities=function(a){return e.$5.loadIdentitiesByUser(a,function(){return e.$9.loadIdentities(a)})};this.saveIdentity=function(a,c){return(t||(t=b("Promise"))).resolve(e.storeIdentity(a,c))};this.loadOneTimePreKey=function(a){return e.$6.load(a,function(){return e.$9.loadOneTimePreKey(a)})};this.saveSenderKeySession=function(a,c,d){e.storeSenderKeySession(a,c,d);return(t||(t=b("Promise"))).resolve()};this.saveSignedPreKeyIfNew=function(a,b){return e.$9.saveSignedPreKeyIfNew(a,b)};this.loadSenderKeySession=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var f=(yield e.$8.load(d("WACryptoManager").encodeSenderKey(a,c),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield e.$9.loadSenderKeySession(a,c));return b.success?b.value:null})));return f==null?d("WAResultOrError").makeError("errLoadSenderKeySession"):d("WAResultOrError").makeResult(f)});return function(b,c){return a.apply(this,arguments)}}();this.handleNewSession=function(a,c,f,g,h){e.storeSession(a,c);f!=null&&e.storeIdentity(a,f);g!=null&&e.removeOneTimePreKey(g);return(t||(t=b("Promise"))).resolve(d("WAResultOrError").makeResult())};this.saveICDC=function(a,c){e.$3.store(a,c);return(t||(t=b("Promise"))).resolve()};this.loadICDC=function(a){return e.$3.load(a,function(){return e.$9.loadICDC(a)})};this.saveLastSyncTs=function(a,c){e.$4.store(a,c);return(t||(t=b("Promise"))).resolve()};this.loadLastSyncTs=function(a){return e.$4.load(a,function(){return e.$9.loadLastSyncTs(a)})};this.saveDhash=function(a,c){e.$2.store(a,c);return(t||(t=b("Promise"))).resolve()};this.getLastPreKeyGenerationId=function(){return e.$9.getLastPreKeyGenerationId()};this.savePreKeysGeneration=function(a){return e.$9.savePreKeysGeneration(a)};this.getPreKeyGenerationsTimestamps=function(){return e.$9.getPreKeyGenerationsTimestamps()};this.deletePreKeyGenerations=function(a){return e.$9.deletePreKeyGenerations(a)};this.saveOneTimePreKey=function(a){return e.$9.saveOneTimePreKey(a)};this.loadPreKeys=function(a){return e.$9.loadPreKeys(a)};this.loadLatestSignedPreKey=function(){return e.$9.loadLatestSignedPreKey()};this.$9=a;this.$10=c;this.$5=new(d("WASignalIdentityStore").SignalIdentityStore)();this.$1=new((a=d("WASignalEntityStoreV2")).SignalEntityStore)();this.$2=new a.SignalEntityStore();this.$3=new a.SignalEntityStore();this.$4=new a.SignalEntityStore();this.$6=new a.SignalEntityStore();this.$7=new a.SignalEntityStore();this.$8=new a.SignalEntityStore()}var c=a.prototype;c.storeSession=function(a,b){this.$1.store(a,b)};c.storeIdentity=function(a,b){if(!b)return;this.$5.store(a,b)};c.removeOneTimePreKey=function(a){this.$6.remove(a)};c.storeSenderKeySession=function(a,b,c){this.$8.store(d("WACryptoManager").encodeSenderKey(a,b),c)};c.updateUserDevicesInfo=function(a){var c=this;return(t||(t=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield c.loadIdentities(a.jid)),f=a.devices,g=a.jid,o=a.notificationTs,p=a.dhash,q=a.icdcInfo,r=a.lastSyncTs;u.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Update user devices: userJid: ","; new identities: ","; previous identities: ","}"])),g,f.map(function(b){b=b.id;return d("WAJids").toDeviceJid(a.jid,b)}).join(","),Array.from(e.keys()).join(","));var s=new Set(e.keys()),v=[],w=[];for(var x of f){var y=x.id,z=x.identity,A=x.model,B=x.platform;y=d("WAJids").toDeviceJid(a.jid,y);var C=e.get(y);if(d("WAGlobals").getMyDeviceJid()===y){var D=d("WACryptoUtils").uint8ArraysEqual(d("WAIdentityUtils").removeKeyTypeIfNeeded(c.$10.staticKeyPair.publicKey),d("WAIdentityUtils").removeKeyTypeIfNeeded(z));D||u.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Receiving an identity for my device but it is different from original one"])))}s["delete"](y);if(C==null)w.push({instruction:"identityAdded",jid:d("WAJids").extractUserJid(y),type:"instruction",device:y,identity:z,model:A,platform:B,notificationTs:o,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow});else if(!d("WACryptoUtils").uint8ArraysEqual(C,z)){if(d("WAJids").extractUserJid(y)!==g){u.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove session the other one"])));continue}v.push(y);u.DEV(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Removing session dur to identity mismatch: ",""])),y);w.push({instruction:"identityChanged",jid:d("WAJids").extractUserJid(y),type:"instruction",device:y,identity:z,model:A,platform:B,notificationTs:o,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow})}}D=[];for(C of s){if(d("WAJids").extractUserJid(C)!==g){u.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove identity the other one "])));continue}D.push(C);d("WAGlobals").getMyDeviceJid()===C&&u.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Removing my device identity. This should not happen"])));u.DEV(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Removing old identity: ",""])),C);w.push({instruction:"identityRemoved",jid:d("WAJids").extractUserJid(C),type:"instruction",device:C,notificationTs:o,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow})}return(t||(t=b("Promise"))).all([p!=null?c.saveDhash(g,p):(t||(t=b("Promise"))).resolve(),r!=null?c.saveLastSyncTs(g,r):(t||(t=b("Promise"))).resolve(),q!=null?c.saveICDC(g,q):(t||(t=b("Promise"))).resolve()].concat(Array.from(D).map(function(a){return c.deleteIdentity(a)}),[D.concat(v).map(function(a){return c.$11(a)})],f.map(function(b){var a=b.id;b=b.identity;return c.saveIdentity(d("WAJids").toDeviceJid(g,a),b)}))).then(function(){return w})});return function(b){return a.apply(this,arguments)}}())).then(function(a){a=a.flat();a.forEach(function(a){var b;switch(a.instruction){case"identityAdded":b=d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED;break;case"identityChanged":b=d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED;break;case"identityRemoved":b=d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED;break;default:return}if(d("MAWMpsGating").isFullMpsEnabled()||d("MAWMpsGating").isMpsWaAdminMsgsEnabled()){var c,e=d("WAGlobals").getDependencies().generateExternalId();d("WAMPSFlushable").mpsFlushable.enqueue(d("WABuildMpsPayload").buildMpsDeviceChangeAdminMessage(a.jid,(c=a.notificationTs)!=null?c:d("WATimeUtils").unixTime(),e,b,a.platform,a.model),function(a){if(a!=null){u.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Failed to save device change admin message: ",""])),a);return}},"handle_device_change")}d("MAWMpsGating").isFullMpsEnabled()||d("WAProtocolQueue").pqFlushable.enqueue(a)});d("MAWMpsGating").isFullMpsEnabled()&&d("WAGlobals").getDependencies().recordDeviceChangeHistory(a.map(function(a){var b;if(a.device==null)return null;var c=a.device;switch(a.instruction){case"identityAdded":return{jid:a.jid,deviceChangeType:d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED,platform:a.platform,model:a.model,device:c,identity:a.identity,ts:(b=a.notificationTs)!=null?b:d("WATimeUtils").unixTime()};case"identityChanged":return{jid:a.jid,deviceChangeType:d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED,platform:a.platform,model:a.model,device:c,identity:a.identity,ts:(b=a.notificationTs)!=null?b:d("WATimeUtils").unixTime()};case"identityRemoved":return{jid:a.jid,deviceChangeType:d("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED,device:c,ts:(b=a.notificationTs)!=null?b:d("WATimeUtils").unixTime()};default:return null}}).filter(Boolean))["catch"](function(a){u.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to record device change history: ",""])),a)})}).then(function(){})};c.savePendingToDatabase=function(){var a=this,c=this.$12();if(c==null)return(t||(t=b("Promise"))).resolve();u.DEV(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Snapshot: ",""])),c);u.LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: start"])));return this.$9.bulkSaveSignalData(c).then(function(){u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: end"]))),a.$13()},function(c){a.$14();return(t||(t=b("Promise"))).reject(c)})};c.clear=function(){this.$1.clear(),this.$5.clear(),this.$6.clear(),this.$7.clear(),this.$8.clear(),this.$2.clear(),this.$3.clear()};c.deleteIdentity=function(a){this.$5.remove(a);return(t||(t=b("Promise"))).resolve()};c.$11=function(a){this.$1.remove(a);return(t||(t=b("Promise"))).resolve()};c.$13=function(){this.$1.markSnapshotAsCommitted(),this.$2.markSnapshotAsCommitted(),this.$3.markSnapshotAsCommitted(),this.$4.markSnapshotAsCommitted(),this.$5.markSnapshotAsCommitted(),this.$6.markSnapshotAsCommitted(),this.$7.markSnapshotAsCommitted(),this.$8.markSnapshotAsCommitted()};c.$14=function(){this.$1.markSnapshotAsFailed(),this.$2.markSnapshotAsFailed(),this.$3.markSnapshotAsFailed(),this.$4.markSnapshotAsFailed(),this.$5.markSnapshotAsFailed(),this.$6.markSnapshotAsFailed(),this.$7.markSnapshotAsFailed(),this.$8.markSnapshotAsFailed()};c.$12=function(){var a=this.$1.snapshot(),b=[],c=a.remove.map(function(a){return a.id});a.update.forEach(function(c){var a=c.id;c=c.cachedEntity;if(c==null)return;b.push({id:a,updated:c})});var e=[];this.$8.snapshot().update.forEach(function(a){var b=d("WACryptoManager").decodeSenderKey(a.id),c=b.groupId;b=b.deviceId;a.cachedEntity!=null&&c&&b&&e.push({groupId:c,author:b,updated:a.cachedEntity})});a=this.$5.snapshot();var f=a.remove.map(function(a){return a.id}),g=[];a.update.forEach(function(b){var a=b.id;b=b.cachedEntity;if(b==null)return;g.push({id:a,identity:b})});a=this.$6.snapshot().remove;var h=this.$2.snapshot(),i=[];for(h of h.update){var j=h.cachedEntity,k=h.id;j!=null&&i.push({id:k,dhash:j})}k=this.$4.snapshot();j=[];for(h of k.update){k=h.cachedEntity;var l=h.id;k!=null&&j.push({id:l,lastSyncTs:k})}l=this.$3.snapshot();k=[];for(h of l.update){l=h.cachedEntity;var m=h.id;l!=null&&k.push({id:m,icdc:l})}return b.length===0&&c.length===0&&g.length===0&&e.length===0&&a.length===0&&k.length===0&&i.length===0&&j.length===0&&f.length===0?null:{dhashUpdate:i,icdcUpdate:k,identityRemove:f,identityUpdate:g,preKeyRemove:a,senderKeySessionUpdate:e,sessionRemove:c,sessionUpdate:b,lastSyncTsUpdate:j}};c.warmCache=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;a=a.map(d("WAJids").interpretAsUserJid).filter(Boolean);a=(yield this.$9.bulkLoadIdentities(a).then(function(a){return b.$5.bulkLoadIdentities(a)}));a=Array.from(a.values()).reduce(function(a,b){return a.concat(Array.from(b.keys()))},[]);yield this.loadSessions(a)});function c(b){return a.apply(this,arguments)}return c}();return a}();g.InMemorySignalStoreImpl=a}),98);
__d("WARequestKeysBatcher",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h={delayMs:50,maxSize:100};function a(a,b){b=b===void 0?h:b;var c=b.delayMs,e=b.maxSize,f=null;function g(b){f&&f.args===b&&(f=null);return a(b)}return function(a){if(f!=null)f.args.push(a);else{var b=[a],h=new(d("WAResolvable").Resolvable)();a=h.promise.then(g);var i=function(){return void h.resolve(b)},j=setTimeout(i,c);f={args:b,batchPromise:a,run:i,timer:j}}a=f;i=a.args;j=a.batchPromise;var k=i.length-1;if(i.length>=e){clearTimeout((a=f)==null?void 0:a.timer);f.run();f=null}return j.then(function(a){return a[k]})}}g.makeSimpleBatcher=a}),98);
__d("WARequestKeys",["WABulkRequestKeys","WAPromiseManagement","WARequestKeysBatcher","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("WARequestKeysBatcher").makeSimpleBatcher(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WABulkRequestKeys").bulkRequestKeys(a));return b.success===!1?a.map(function(){return b}):a.map(function(a){a=b.value.get(a);return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeError("errRequestKeysNoKeys")})});return function(b){return a.apply(this,arguments)}}());c=d("WAPromiseManagement").cacheWhilePending(function(a){return a},a);g.requestKeys=c}),98);
__d("WACryptoManagerUtils",["Promise","WABulkRequestKeys","WACryptoDbCallbacks","WACryptoManager","WAGlobals","WAHandleFailureUtils","WAInMemorySignalStore","WALogger","WALoggerTag","WAPREList","WAPREMetrics","WARequestKeys","WAResultOrError","WASignalKeys","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekey]);function a(a){var b=new(d("WAInMemorySignalStore").InMemorySignalStoreImpl)(d("WACryptoDbCallbacks").getCryptoDbCallbacks(),a),c=r();return{manager:d("WACryptoManager").initCryptoManager({regInfo:a,storage:b,network:c}),storage:b}}function r(){return{requestKeys:d("WARequestKeys").requestKeys,bulkRequestKeys:d("WABulkRequestKeys").bulkRequestKeys}}function e(a,c,e,f){var g=null;return d("WACryptoManager").decryptContent(f.cryptoManager,c,{ciphertext:e,type:a},function(a,c){g={plaintext:a,remoteIdentity:c};return(p||(p=b("Promise"))).resolve()}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(g);else return a})["catch"](function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),a);throw a})}function f(a,c,e,f){var g=null;return d("WACryptoManager").decryptGroupContent(f.cryptoManager,a,c,e,function(a){g={plaintext:a};return(p||(p=b("Promise"))).resolve()}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(g);else return a})["catch"](function(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),a);throw a})}function s(a,b){return d("WACryptoManager").getParticipantInfo(b,a)}function t(a){return a.storage.getPreKeyGenerationsTimestamps()}function u(a,b){return b.storage.deletePreKeyGenerations(a)}function v(a,b,c,e){return d("WACryptoManager").saveSenderKeySession(e.cryptoManager,a,b,c)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield a.storage.loadLatestSignedPreKey());if(e.success===!1){q.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing signed prekey: ",", triggering reregistration"])),e.error);yield d("WAHandleFailureUtils").reregisterPhone();throw c("err")("No signed prekey: "+e.error)}e=d("WASignalSignatures").deserializeSignedPreKey(e.value);if(e==null){q.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Cannot deserialize signed prekey"])));throw c("err")("Cannot deserialize signed prekey")}var f=(yield d("WACryptoManager").generateOneTimePreKey(a));if(f==null){d("WATagsLogger").TAGS([c("WALoggerTag").OneTimePrekey]).ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate one time prekey"])));throw c("err")("Cannot generate one time prekey")}a=a.regInfo;var g=a.regId;a=a.staticKeyPair;return(p||(p=b("Promise"))).resolve({regId:g,keyType:d("WASignalKeys").KEY_TYPE,publicKey:a.publicKey,signedPreKey:e,preKey:f})});return x.apply(this,arguments)}function y(a,b,c){var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"group",jid:a},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").encryptGroupContent(c.cryptoManager,a,d("WAGlobals").getMyDeviceJid(),b).then(function(a){a.success?e.endSuccess():(d("WATagsLogger").TAGS(["EncryptGroupContent"]).ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to encrypt group content: ",""])),a.error),e.endFail(a.error));return a})["catch"](function(a){d("WATagsLogger").TAGS(["EncryptGroupContent"]).ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Runtime excpetion when encrypting group content: ",""])),a);e.endFail("runtime-exception");return d("WAResultOrError").makeError("runtime-exception")})}function z(a,b,c,e,f,g){var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:c},string_array:{node_types:e,message_types:f,media_types:g},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success)h.endSuccess();else{var b=a.error;switch(b){case"missing":case"mismatch":case"runtime-exception":break;default:break}h.endFail(b)}return a})}function A(a,b,c,e,f,g){var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:g},bool:{useLongSessionDrop:d("WAGlobals").getConfig().useLongSessionDrop()}},void 0);return d("WACryptoManager").encryptContent(c.cryptoManager,a,b,e||d("WACryptoManager").DEFAULT_SESSION_REQUEST,f).then(function(a){if(a.success)h.endSuccess();else{var b=a.error;switch(b){case"identity-mismatch":case"errSignalInvalidKey":break;default:break}h.endFail(b)}return a})}function B(a,b){return d("WACryptoManager").bulkEncryptContent(b.cryptoManager,a).then(function(a){if(a.success===!1){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] Fail encrypt messages"])));return new Map()}return a.value})}function C(a,b){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=(yield d("WACryptoManager").ensureSessionsExists(c.cryptoManager,a));yield (p||(p=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return c.cryptoManager.storage.handleNewSession(b,a,a.remote.pubKey)}))});return D.apply(this,arguments)}g.createCryptoManager=a;g.decryptMsg=e;g.decryptGroupMsg=f;g.getParticipantInfo=s;g.getPreKeyGenerationsTimestamps=t;g.deletePreKeyGenerations=u;g.saveSenderKeySession=v;g.getSignalInfoForRetry=w;g.encryptGroupContentWithMetrics=y;g.bulkEncryptMsgWithMetrics=z;g.encryptMsgWithMetrics=A;g.bulkEncrypt=B;g.bulkPreEstablishOutgoingSession=C}),98);
__d("WADbRegistrationApi",["Promise","WADbSignal","WAJids","WALogger","WASignalDB","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a,c){return d("WASignalDB").getDb().runInTransaction(["contacts"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.contacts.get(a));if(d!=null)return b.stores.contacts.bulkPut([babelHelpers["extends"]({},d,{icdcInfo:c})]);else return b.stores.contacts.bulkPut([{contactJid:a,dhash:null,icdcInfo:c}])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveICDC"))};function a(a){return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(b){return b.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.deviceId,value:{deviceId:a}}])},d("WASignalDB").signalOp("saveDeviceId"))}function e(a,c){return d("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield (i||(i=b("Promise"))).all([e.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.deviceUUID,value:{deviceUUID:c.deviceUUID}},{key:d("WADbSignal").MetaKeysEnum.fbid,value:{fbid:a}},{key:d("WADbSignal").MetaKeysEnum.regId,value:{regId:c.signalRegInfo.regId}},{key:d("WADbSignal").MetaKeysEnum.identityKeyPair,value:{identityKeyPair:c.signalRegInfo.identityKeyPair}},{key:d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:c.signalRegInfo.signedPreKey.keyId}},{key:d("WADbSignal").MetaKeysEnum.registrationVersion,value:{registrationVersion:c.registrationVersion}},{key:d("WADbSignal").MetaKeysEnum.authKeyPair,value:{authKeyPair:c.signalRegInfo.authKeyPair}},{key:d("WADbSignal").MetaKeysEnum.deviceRegUnixTime,value:{deviceRegUnixTime:c.registrationUnixTime}}]),e.stores.signedPrekey.bulkPut([c.signalRegInfo.signedPreKey])])});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("saveRegistrationMeta"))}var k=function(a,b){var c=b.sessionId;return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(a){return a.stores.meta.bulkPut([{key:d("WADbSignal").MetaKeysEnum.lastSessionDeviceWasLinkedTo,value:{lastSessionDeviceWasLinkedTo:c}}])},d("WASignalDB").signalOp("saveLastSessionDeviceWasLinkedTo"))};function f(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a.stores.meta.bulkGet([(a=d("WADbSignal")).MetaKeysEnum.fbid,a.MetaKeysEnum.deviceId,a.MetaKeysEnum.cat,a.MetaKeysEnum.regId,a.MetaKeysEnum.identityKeyPair,a.MetaKeysEnum.authKeyPair]));var b=a[0],e=a[1],f=a[2],g=a[3],i=a[4];a=a[5];d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["worker: got db data"])));b=b==null?void 0:b.value.fbid;e=e==null?void 0:e.value.deviceId;f=f==null?void 0:f.value.cat;g=g==null?void 0:g.value.regId;i=i==null?void 0:i.value.identityKeyPair;a=a==null?void 0:a.value.authKeyPair;if(b==null)throw c("err")("fbid not set");if(e==null)throw c("err")("deviceId not set");if(f==null)throw c("err")("fbCat not set");if(g==null||i==null)throw c("err")("regInfo not set");return{deviceJid:d("WAJids").toDeviceJid(d("WAJids").toMsgrUserJid(b),e),fbCat:f.encrypted_serialized_cat,regInfo:{authKeyPair:a,regId:g,staticKeyPair:i},userJid:d("WAJids").toMsgrUserJid(b)}});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("loadAllRegistrationMeta"))}g.saveICDC=j;g.saveDeviceId=a;g.saveRegistrationMeta=e;g.saveLastSessionDeviceWasLinkedTo=k;g.loadAllRegistrationMetaInTransaction=f}),98);
__d("WADbTransactor",["MAWDexie","MAWIndexedDb","MAWTransactionMode","WAExceededStorageQuota","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=Object.keys(a),f=e.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,g=new Array(a),i=0;i<a;i++)g[i]=arguments[i];return d("MAWIndexedDb").getSignalDB(b).then(function(a){return h(f,e,function(){return c(a.stores).apply(void 0,g)})}).then(function(a){return a})["catch"](function(a){throw k(a,b)})}}function h(a,b,e){if(c("MAWDexie").currentTransaction!=null)throw c("err")("protocolDB transactor %s cannot be called within another transaction");return d("MAWIndexedDb").getSignalDB().then(function(c){return c.transact(a,b,e)})}function i(a){if(a instanceof Error)return a;else if(typeof a==="string")return c("err")(a);else return null}function e(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a+"_"+e,g=(yield d("MAWIndexedDb").getDB(f));return g.transact(b,[a],function(){return c(g.stores[a])}).then(function(a){return a})["catch"](function(a){throw k(a,f)})});return j.apply(this,arguments)}function k(a,b){var e;d("WAExceededStorageQuota").checkQuotaExceededError(a);a=i(a);if(!a)return c("err")("[unknown error] Error performing %s transaction "+b);a.message="["+((e=a==null?void 0:a.toString())!=null?e:"unknown error")+"] Error performing %s transaction "+b;return a}g.makeSignalTransactor=a;g.persistedQueueTransactor=e}),98);
__d("WAMapUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return new Map(Array.from(a.entries()).map(function(a){return[a[0],b(a[1],a[0])]}))}f.mapValues=a}),66);
__d("WAProtocolMediaType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"image":case"sticker":case"gif":case"video":case"ptt":case"audio":case"document":case"product":return a;case"xma-image":return"document";default:return null}}f.castToProtocolMediaType=a}),66);
__d("WAEncNode",["WAAsMessageTransport","WACryptoManagerUtils","WAGlobals","WALogger","WAMapUtils","WAMsgTransport.pb","WANullthrows","WAProtocolMediaType","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,f){var g=new Set(),i=new Set(),m=new Set(),n=d("WAMapUtils").mapValues(a,function(a,b){var c=a.params;a=a.icdc;var d;g.add(c.type);switch(c.type){case"message":d=j({messageBytes:c.messageBytes,to:b,icdc:a,chat:c.chat,backupDirective:c.backupDirective,applicationPayloadVersion:c.applicationPayloadVersion});i.add(c.messageType.type);c.messageType.mediaType!=null&&m.add(c.messageType.mediaType);break;case"appdata":d=k({messageBytes:c.messageBytes});break;default:c.type,d=l({skdm:c.skdm,icdc:a})}return{plaintext:d}});return d("WACryptoManagerUtils").bulkEncryptMsgWithMetrics(n,b,e,Array.from(g),Array.from(i),Array.from(m)).then(function(b){if(!b.success){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),b.error);return null}return d("WAMapUtils").mapValues(b.value,function(b,e){var g,h=b.type,i=b.ciphertext;b=b.baseKey;g=c("WANullthrows")((g=a.get(e))==null?void 0:g.params);var j=g.type==="message"&&g.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(g.messageType.mediaType):null;return{encType:"device",to:e,v:((e=g.messageBytes)==null?void 0:e.version)==="v2"?"2":"3",type:h,mediaType:j,count:f,ciphertext:i,baseKey:b}})})}function b(a,b,c,e,f,g,h,m){var n;switch(b.type){case"message":n=j({messageBytes:b.messageBytes,to:a,icdc:h,chat:b.chat,backupDirective:m,applicationPayloadVersion:b.applicationPayloadVersion});break;case"appdata":n=k({messageBytes:b.messageBytes});break;default:b.type,n=l({skdm:b.skdm,icdc:h})}m=d("WACryptoManagerUtils").encryptMsgWithMetrics(a,n,c,f,g,b==null?void 0:b.chat);return m.then(function(c){var f;if(!c.success){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),c.error);return null}var g=b.type==="message"&&b.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(b.messageType.mediaType):null,h=c.value,j=h.type;h=h.ciphertext;return{encType:"device",to:a,v:((f=b.messageBytes)==null?void 0:f.version)==="v2"?"2":"3",type:j,mediaType:g,count:e,ciphertext:h,baseKey:c.value.baseKey}})}function j(a){var b=a.messageBytes,c=a.to,e=a.icdc,f=a.chat,g=a.backupDirective;a=a.applicationPayloadVersion;if(b.version==="v3"){var h=null;d("WAGlobals").isPeerDevice(c)&&(h=f);f=d("WAAsMessageTransport").asMessageTransport(b.bytes,h,null,e,g,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,f).readByteArrayView()}else if(d("WAGlobals").isPeerDevice(c))return b.bytesForPeer;else return b.bytes}function k(a){a=a.messageBytes;if(a.version==="v3"){a=d("WAAsMessageTransport").asMessageTransport(a.bytes);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,a).readByteArrayView()}else throw c("err")("Plaintext v2 not supported yet")}function l(a){var b=a.skdm;a=a.icdc;b=d("WAAsMessageTransport").asMessageTransport(null,null,b,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArrayView()}g.getEncNodes=a;g.getEncNode=b}),98);
__d("WAPhash",["Promise","WABase64","WABinary","WACryptoDependencies","WALogger","WASortedLists"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- Start"])));a=d("WASortedLists").sortAndDedupe(a);var c=new(d("WABinary").Binary)();for(var e=0;e<a.length;e++)c.writeString(a[e]);return(j||(j=b("Promise"))).resolve(d("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",c.readByteArrayView()).then(function(a){d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- end"])));a=new Uint8Array(a,0,6);return"2:"+d("WABase64").encodeB64(a)}))}g.calculatePHash=a}),98);
__d("WAEncUserMsg",["Promise","WAComputeICDC","WAEncNode","WAGlobals","WAJids","WAPhash","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s=d("WATagsLogger").TAGS(["WAEncUserMsg"]);function a(a,b,c,d){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){s.LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- START"])));a.length===0&&s.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no recipient"])));s.LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- ICDC"])));var h=a.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});w(a)&&s.LOG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- OTHER_RECIPENT_DEVICE_EMPTY"])));var i;e.type==="message"&&!c("gkx")("3176")&&(i=(yield x(a,f,g)));return(r||(r=b("Promise"))).all([u(h,e,f,i,g),d("WAPhash").calculatePHash(h.concat(d("WAGlobals").getMyDeviceJid()))]).then(function(a){var b=a[0];a=a[1];s.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- DONE"])));return{participants:b,phash:a}})});return t.apply(this,arguments)}function e(a,b,c){return u(a,b,c)}function u(a,b,c,d,e){return v(a,b,c,d,e).then(function(a){if(a.length===0){s.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- EMPTY NODE"])));e==null||e.addPoint("getParticipantNodes_empty_node");return}return a})}function f(a,b,c,e,f,g){return d("WAEncNode").getEncNode(a,b,c,e,f,g)}function v(a,b,c,e,f){var g=!1;s.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt -- getParticipantNodes -- START"])));(b.type!=="message"||d("WAJids").interpretAsGroupJid(b.chat)!=null)&&(g=!0);a=d("WAEncNode").getEncNodes(new Map(a.map(function(a){return[a,{params:b,icdc:e}]})),c).then(function(a){if(a==null){s.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt - getParticipantNodes -- EMPTY DEVICE JIDS"])));f==null||f.addPoint("getParticipantNodes_empty_device_jids");return[]}b.type==="message"&&(g=g||Array.from(a.keys()).some(function(a){return d("WAJids").extractUserJid(a)===b.chat}));return Array.from(a==null?void 0:a.values())});return a.then(function(a){if(g)return a;else{s.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- receiverEncypted -- FALSE"])));f==null||f.addPoint("getParticipantNodes_receiverEncypted_false");return[]}}).then(function(a){return a.filter(Boolean)})}function w(a){return a.filter(function(a){return a.user!==d("WAGlobals").getMyUserJid()}).flatMap(function(a){return a.devicesInfo}).length===0}function x(a,b,c){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;try{c==null||c.addPoint("icdc_start"),e=(yield d("WAComputeICDC").computeICDC(a,d("WAGlobals").getMyUserJid(),d("WAGlobals").getMyDeviceJid(),b)),c==null||c.addPoint("icdc_end",{bool:{isICDCEmpty:e==null}})}catch(a){c==null||c.addPoint("icdc-error"),s.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- ICDC calc error: ",""])),a)}return e});return y.apply(this,arguments)}g.encryptUserMsg=a;g.encryptGroupFanoutMsg=e;g.encryptDeviceJidMessage=f}),98);
__d("WAGetUserDevices",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield b.storage.bulkLoadIdentities(a));return Array.from(b).flatMap(function(a){a=a[1];return Array.from(a.keys())})});return g.apply(this,arguments)}f.getUserDevices=a}),66);
__d("WAEncGroupMsg",["WAAsMessageTransport","WABridge","WACryptoManager","WACryptoManagerUtils","WADbPersonalSenderKeyStatusTxns","WAEncUserMsg","WAGetUserDevices","WAGlobals","WAHex","WAMsgTransport.pb","WAOdsEnums","WAPhash","WAPromiseQueue","WAProtocolMediaType","WAResultOrError","WASortedLists","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("WATagsLogger").TAGS(["WAEncGroupMsg"]),p=30*d("WATimeUtils").DAY_SECONDS,q=new(d("WAPromiseQueue").PromiseQueue)();function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.senderKeyId;if(e==null||a.rotateSenderKey||!d("WATimeUtils").happenedWithin(a.ts,p))return d("WAResultOrError").makeError("sender-key-invalid");c=(yield c.cryptoManager.storage.loadSenderKeySession(b,d("WAGlobals").getMyDeviceJid()));if(c.success===!1||c.value.senderKeyStates.length===0)return d("WAResultOrError").makeError("sender-key-missing");b=c.value.senderKeyStates.at(-1);if(b==null)return d("WAResultOrError").makeError("sender-key-missing");return b.senderKeyId!==a.senderKeyId?d("WAResultOrError").makeError("sender-key-id-mismatch"):d("WAResultOrError").makeResult({senderKeyId:e})});return s.apply(this,arguments)}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WACryptoManager").rotateGroupSenderKey(b.cryptoManager,a,d("WAGlobals").getMyDeviceJid()));yield d("WADbPersonalSenderKeyStatusTxns").markSenderKeyAsRotated(a,b.senderKeyId,d("WATimeUtils").unixTime());return{senderKeyId:b.senderKeyId}});return u.apply(this,arguments)}function v(a,c,e,f){return q.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WADbPersonalSenderKeyStatusTxns").getSenderKeyStatus(a)),g=(yield r(b,a,e)),i=(yield d("WAGetUserDevices").getUserDevices(c,e.cryptoManager)),j=new Set(i);if(g.success===!1){o.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Rotating sender key for group "," because ",""])),a,g.error);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_SKS_INVALID,key:g.error});f.addPoint("sender_key_rotation_start");var k=(yield t(a,e));f.addPoint("sender_key_rotation_end");return{senderKeyId:k.senderKeyId,needsSenderKey:j,groupParticipants:new Set(i)}}else{((k=b.hasSenderKey)!=null?k:[]).forEach(function(a){return j["delete"](a)});f.addPoint("no_sk_rotation",{"int":{noRotationNeedsSK:j.size}});return{senderKeyId:g.value.senderKeyId,needsSenderKey:j,groupParticipants:new Set(i)}}}))}function a(a,b,c,d,e,f,g){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){h.addPoint("enc_group_start");var p=(yield v(a,b.map(function(a){return a.user}),f,h)),q=p.senderKeyId,r=p.needsSenderKey;p=p.groupParticipants;o.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Finish rotate participant info"])));h.addPoint("rotated_participant_info");var s=null,t,u;b=b.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});p["delete"](d("WAGlobals").getMyDeviceJid());var w=!d("WASortedLists").areEqual(d("WASortedLists").asSortedSet(p),d("WASortedLists").sortAndDedupe(b)),y=e.type==="text"&&e.isRevoked,z=e.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(e.mediaType):null;if(w||y){w=(yield d("WAEncUserMsg").encryptGroupFanoutMsg(b,{type:"message",messageBytes:c,messageType:e,chat:a,backupDirective:g},f));w&&!(e.type==="text"&&e.isInvisible===!0)&&(t=w,u={encType:"group",to:a,v:c.version==="v3"?"3":"2",type:"skmsg",mediaType:z,ciphertext:null});o.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Finish group fanout msg"])));h.addPoint("finish_group_fanout_msg")}else{if(c.version==="v3"){y=d("WAAsMessageTransport").asMessageTransport(c.bytes);g=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,y).readByteArrayView()}else g=c.bytes;w=(yield d("WACryptoManagerUtils").encryptGroupContentWithMetrics(a,g,f));o.LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Finish encrypt group content"])));h.addPoint("finish_encrypt_group_content");if(w.success){o.LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Encrypt success"])));y=w.value;q!==y.senderKeyId&&p.forEach(function(a){return r.add(a)});if(r.size>0){g={groupId:a,axolotlSenderKeyDistributionMessage:d("WAHex").bytesToBuffer(y.senderKeyDistributionProto)};o.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["start key distribution"])));w=b.filter(function(a){return r.has(a)});q=(yield x(w,g,f));o.LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["end key distribution"])));h.addPoint("finish_skdm_enc_node");q.length>0&&(t=q,s={group:a,senderKeyId:y.senderKeyId,knowsSenderKey:new Set(w)})}u={encType:"group",to:a,v:c.version==="v2"?"2":"3",type:y.ciphertext.type,mediaType:z,ciphertext:y.ciphertext.ciphertext};e.type==="text"&&e.isInvisible===!0&&(u={encType:"group",to:a,v:c.version==="v2"?"2":"3",type:"skmsg",mediaType:null,ciphertext:null})}}p=(yield d("WAPhash").calculatePHash(b.concat(d("WAGlobals").getMyDeviceJid())));h.addPoint("phash_finish");return{phash:p,participants:t,encNode:u,senderKeyDistributionInfo:s}});return w.apply(this,arguments)}function x(a,b,c){b=d("WAAsMessageTransport").asMessageTransport(null,null,b,null);var e=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArrayView();return d("WACryptoManagerUtils").bulkEncrypt(new Map(a.map(function(a){return[a,{plaintext:e}]})),c).then(function(a){var b=[];a.forEach(function(a,c){b.push({encType:"device",to:c,v:"3",type:a.type,ciphertext:a.ciphertext,mediaType:null,count:null,baseKey:null})});return b})}g.encryptGroupMsg=a}),98);
__d("WAGetKeysForUpload",["WALoggerTag","WAResultOrError","WASignalKeys","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("WATagsLogger").TAGS([c("WALoggerTag").PrekeyGenerateAndUpload,c("WALoggerTag").SignedPrekey]);function a(a,b){return a.storage.loadPreKeys(b).then(function(b){var c=b.preKeys;b=b.signedPreKey;var e=[];c.forEach(function(a){a=d("WASignalKeys").deserializePreKey(a);a==null?i.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize prekey received from the db"]))):e.push(a)});return d("WAResultOrError").makeResult({regInfo:a.regInfo,keyType:d("WASignalKeys").KEY_TYPE,preKeys:e,signedPreKey:b})})}g.getKeysForUpload=a}),98);
__d("WAMakeSignedPreKeyMixin",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)},c={anyElementValue:a.keyPair.publicKey};a=a.signature;return{keyIDMixinArgs:b,keyDataMixinArgs:c,signatureElementValue:a}}g.makeSignedPreKeyMixin=a}),98);
__d("WARandomJitter",[],(function(a,b,c,d,e,f){"use strict";function a(){return Math.round(Math.random()*500-250)}f.getRandomJitter=a}),66);
__d("WARetryUtils",["WARandomJitter"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a)return{algo:{backoff:{first:1,second:1,type:"fibonacci"},toMs:function(a){return(1+a)*1e3+d("WARandomJitter").getRandomJitter()},type:"adjust"},relativeDelay:!0,max:6e5};else return{algo:{type:"adjust",backoff:{type:"fibonacci",first:1,second:1},toMs:function(a){return(9+a)*1e3}},max:62e4}}g.fibonacciBackoff=a}),98);
__d("WASmaxInPreKeysSetVnameFailureBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureBadRequestMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureFallbackMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureInternalServerErrorMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"violation");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!a.success)return a;var c=d("WASmaxParseUtils").attrString(b.value,"reason");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"max");if(!e.success)return e;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"length");return!b.success?b:d("WAResultOrError").makeResult({text:a.value,violationReason:c.value,violationMax:e.value,violationLength:b.value})}g.parseSetVnameFailureNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysVnameFailures",["WAResultOrError","WASmaxInPreKeysSetVnameFailureBadRequestMixin","WASmaxInPreKeysSetVnameFailureFallbackMixin","WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin","WASmaxInPreKeysSetVnameFailureNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin").parseSetVnameFailureNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysSetVnameFailureBadRequestMixin").parseSetVnameFailureBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureBadRequest",value:c.value});var e=d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin").parseSetVnameFailureInternalServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureInternalServerError",value:e.value});var f=d("WASmaxInPreKeysSetVnameFailureFallbackMixin").parseSetVnameFailureFallbackMixin(a);return f.success?d("WAResultOrError").makeResult({name:"SetVnameFailureFallback",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["VnameFailureNotAcceptable","VnameFailureBadRequest","VnameFailureInternalServerError","VnameFailureFallback"],[b,c,e,f])}g.parseVnameFailures=a}),98);
__d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysVnameFailures","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"error");if(!e.success)return e;var f=d("WASmaxParseUtils").attrString(c.value,"text");if(!f.success)return f;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,c.value,"code",207);if(!c.success)return c;var g=d("WASmaxParseUtils").attrIntRange(e.value,"code",400,599);if(!g.success)return g;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysVnameFailures").parseVnameFailures(e.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:f.value,errorCode:c.value,errorErrorCode:g.value},a.value,{errorErrorVnameFailures:b.value}))}g.parseSetResponsePreKeySuccessVnameFailure=a}),98);
__d("WASmaxInPreKeysIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"field");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"reason");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,reason:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"field",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,field:b.value})}g.parseIQErrorNotAcceptableField=h;g.parseIQErrorNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysRequestErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorFallbackClient"],[b,c])}g.parseRequestErrors=a}),98);
__d("WASmaxInPreKeysSetResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseSetResponseRequestError=a}),98);
__d("WASmaxInPreKeysSetResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseSetResponseServerError=a}),98);
__d("WASmaxInPreKeysSetResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetResponseSuccess=a}),98);
__d("WASmaxOutPreKeysKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutPreKeysKeyTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("type",null,new Uint8Array([5])));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyTypeMixin=a}),98);
__d("WASmaxOutPreKeysKeyIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.idElementValue;a=d("WASmaxJsx").smax("id",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyIDMixin=a}),98);
__d("WASmaxOutPreKeysPreKeyListMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.keyIDMixinArgs;a=a.keyDataMixinArgs;b=d("WASmaxJsx").smax("key",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(d("WASmaxJsx").smax("id",null),b),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("value",null),a));return b}function i(a){a=a.keyArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("list",null,d("WASmaxChildren").REPEATED_CHILD(h,a,0,2e4)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makePreKeyListListKey=h;g.mergePreKeyListMixin=a}),98);
__d("WASmaxOutPreKeysRegistrationIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.registrationElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("registration",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRegistrationIDMixin=a}),98);
__d("WASmaxOutPreKeysRequestPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.paddingElementValue;a=d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("padding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestPaddingMixin=a}),98);
__d("WASmaxOutPreKeysSignedPreKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.keyIDMixinArgs,e=a.keyDataMixinArgs;a=a.signatureElementValue;c=(b=d("WASmaxJsx")).smax("smax$any",null,b.smax("skey",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(b.smax("id",null),c),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(b.smax("value",null),e),b.smax("signature",null,a)));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSignedPreKeyMixin=a}),98);
__d("WASmaxOutPreKeysVerifiedNameMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.verifiedNameElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("verified_name",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyMixin","WASmaxOutPreKeysKeyTypeMixin","WASmaxOutPreKeysPreKeyListMixin","WASmaxOutPreKeysRegistrationIDMixin","WASmaxOutPreKeysRequestPaddingMixin","WASmaxOutPreKeysSignedPreKeyMixin","WASmaxOutPreKeysVerifiedNameMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.verifiedNameMixinArgs,c=a.requestPaddingMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutPreKeysRequestPaddingMixin").mergeRequestPaddingMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutPreKeysVerifiedNameMixin").mergeVerifiedNameMixin,d("WASmaxOutPreKeysKeyTypeMixin").mergeKeyTypeMixin(d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxOutPreKeysPreKeyListMixin").mergePreKeyListMixin(d("WASmaxOutPreKeysIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxOutPreKeysRegistrationIDMixin").mergeRegistrationIDMixin(d("WASmaxJsx").smax("iq",null),a),a),a),a)),b),c);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyBundleMixin=a}),98);
__d("WASmaxOutPreKeysSetRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysIdentityKeyBundleMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutPreKeysIdentityKeyBundleMixin").mergeIdentityKeyBundleMixin(d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"})),a);return a}g.makeSetRequest=a}),98);
__d("WASmaxPreKeysSetRPC",["WAComms","WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure","WASmaxInPreKeysSetResponseRequestError","WASmaxInPreKeysSetResponseServerError","WASmaxInPreKeysSetResponseSuccess","WASmaxOutPreKeysSetRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutPreKeysSetRequest").makeSetRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInPreKeysSetResponseSuccess").parseSetResponseSuccess(b,a);if(c.success)return{name:"SetResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure").parseSetResponsePreKeySuccessVnameFailure(b,a);if(e.success)return{name:"SetResponsePreKeySuccessVnameFailure",value:e.value};var f=d("WASmaxInPreKeysSetResponseRequestError").parseSetResponseRequestError(b,a);if(f.success)return{name:"SetResponseRequestError",value:f.value};b=d("WASmaxInPreKeysSetResponseServerError").parseSetResponseServerError(b,a);if(b.success)return{name:"SetResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Set",{Success:c,PreKeySuccessVnameFailure:e,RequestError:f,ServerError:b}))});return h.apply(this,arguments)}g.sendSetRPC=a}),98);
__d("WAGenerateAndUploadPreKeysProtocol",["WACryptoManager","WAGetKeysForUpload","WAGlobals","WAMakeSignedPreKeyMixin","WAPromiseRetryLoop","WAResultOrError","WARetryUtils","WASmaxPreKeysSetRPC","WATagsLogger","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("WATagsLogger").TAGS(["generateAndUploadPreKeysProtocol"]);function a(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.cryptoManager;var b=(yield d("WACryptoManager").generatePreKeys(a));if(!b.success)return b;m.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["About to upload pre keys"]))).devConsole("generation "+b.value);return d("WAGetKeysForUpload").getKeysForUpload(a,b.value)});return function(b){return a.apply(this,arguments)}}(),{operationType:"generate_prekeys",flush:!0,afterInit:!0}));a=a.value;var c=a.regInfo,e=a.preKeys;a=a.signedPreKey;var f=babelHelpers["extends"]({registrationElementValue:d("WAWap").BIG_ENDIAN_CONTENT(c.regId),anyElementValue:c.staticKeyPair.publicKey,keyArgs:e.map(o)},d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a));c=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"uploadKeys",timer:d("WARetryUtils").fibonacciBackoff(!1),code:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){m.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Attempt to upload keys"])));var b=(yield d("WASmaxPreKeysSetRPC").sendSetRPC(f));switch(b.name){case"SetResponseSuccess":m.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Keys are successfully uploaded"])));a(d("WAResultOrError").makeResult({preKeys:e}));return;case"SetResponseRequestError":m.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Got Malformed upload keys IQ on upload pre keys attempt"])));a(d("WAResultOrError").makeError("request-error"));return;default:b.name,m.WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Got unexpected error: ",", will retry after backoff"])),b.name)}});function c(b){return a.apply(this,arguments)}return c}()});c.start();return c.promise()});return n.apply(this,arguments)}function o(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)};a={anyElementValue:a.keyPair.publicKey};return{keyIDMixinArgs:b,keyDataMixinArgs:a}}g.generateAndUploadPreKeysProtocol=a}),98);
__d("WAGenerateAndUploadPreKeys",["WABridge","WAGenerateAndUploadPreKeysProtocol","WALoggerTag","WAOdsEnums","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS([c("WALoggerTag").PrekeyGenerateAndUpload,c("WALoggerTag").SignedPrekey]);function a(a,b){a=b.reason;j.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["About to generate and upload pre keys with reason: ",""])),a);return d("WAGenerateAndUploadPreKeysProtocol").generateAndUploadPreKeysProtocol().then(function(a){if(a.success){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"success",amount:a.value.preKeys.length},!0);return}var b=a.error;if(b==="request-error"){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"malformed"},!0);throw c("err")("Malformed upload keys IQ")}b;j.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate and upload prekeys with error ",": ","}"])),b,(b=a.payload)==null?void 0:b.message)})}g.generateAndUploadPreKeys=a}),98);
__d("WAGetMetaApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(a){return a.stores.meta.bulkGet(["certificateChain","deviceId","identityKeyPair","abProps","edgeInfo","clockSkew","authKeyPair"]).then(function(a){var b,c,d,e,f,g,h,i=a[0],j=a[1],k=a[2],l=a[3],m=a[4],n=a[5];a=a[6];return{abProps:l==null||(b=l.value)==null?void 0:b.abProps,authKeyPair:a==null||(c=a.value)==null?void 0:c.authKeyPair,certificateChain:i==null||(d=i.value)==null?void 0:d.certificateChain,clockSkew:n==null||(e=n.value)==null?void 0:e.clockSkew,deviceId:j==null||(f=j.value)==null?void 0:f.deviceId,edgeInfo:m==null||(g=m.value)==null?void 0:g.edgeInfo,identityKeyPair:k==null||(h=k.value)==null?void 0:h.identityKeyPair}})},d("WASignalDB").signalOp("getMeta"))};g.getMeta=a}),98);
__d("WAGetCurrentUserDeviceInfoApi",["WAGetMetaApi","WASignalKeys"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WAGetMetaApi").getMeta().then(function(a){var b=a==null?void 0:a.deviceId;a=a==null?void 0:a.identityKeyPair;if(b==null||a==null)return null;a=d("WASignalKeys").serializePubKey(a);return{deviceId:b,identityKey:a}})};b=function(){return d("WAGetMetaApi").getMeta().then(function(a){return(a==null?void 0:a.deviceId)==null?null:{deviceId:a==null?void 0:a.deviceId}})};g.getCurrentUserDeviceInfo=a;g.getCurrentUserDeviceId=b}),98);
__d("WAGetDeviceIdentityMixin",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a!=null?{deviceIdentityElementValue:a}:null}f.getDeviceIdentityMixin=a}),66);
__d("WAGetPlatformFromStanzaId",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){try{var b=(1<<5)-1;b=BigInt(b<<17);var c=BigInt(0),e=BigInt(1<<17);b=BigInt(a)&b;if(b===c)return"web";return b===e?"mobile":"unknown"}catch(b){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse stanza id "," for platform: ",""])),a,b);return"error"}}g.getPlatformFromStanzaId=a}),98);
__d("WAGroupInviteUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.toInviteCode=a}),66);
__d("WAGroupParserUtils",["WAGroupInviteUtils","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i={superadmin:"superadmin",admin:"admin",participant:"participant",nonparticipant:"nonparticipant"};function j(a){if(!a.hasAttr("error"))throw c("err")("Expected participant node to have error attr");var b=a.attrInt("error"),e=a.attrUserJid("jid");switch(b){case 401:return{errorCode:b,text:"not-authorized",user:e};case 403:a=a.child("add_request");return{errorCode:b,text:"request-code",code:d("WAGroupInviteUtils").toInviteCode(a.attrString("code")),expiration:a.attrTime("expiration"),user:e};case 404:return{errorCode:b,text:"not-found",user:e};case 406:return{errorCode:b,text:"enterprise-not-allowed",user:e};case 408:return{errorCode:b,text:"temporarily-blocked",user:e};case 409:return{errorCode:b,text:"conflict",user:e};case 500:return{errorCode:b,text:"resource-constraint",user:e};default:d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["received unknown participant error code: ",""])),b);return{errorCode:-1,text:"unknown",user:e}}}function k(a,b){a.assertTag("participant");var c="participant";switch(b){case"add":case"demote":c="participant";break;case"promote":c="admin";break;case"remove":c="nonparticipant";break}b=a.attrUserJid("jid");if(a.hasAttr("error")){var e=j(a);return d("WAResultOrError").makeError(e)}else{e=a.attrEnumOrDefault("type",i,c);c=a.maybeAttrString("addressable")!=="false";return d("WAResultOrError").makeResult({user:b,type:e,addressable:c})}}function a(a){a.assertTag("group");var b,c=a.attrString("id");c.includes("@")?b=a.attrGroupJid("id"):b=d("WAJids").toGroupJid(c);return{jid:b,creator:a.maybeAttrUserJid("creator")||void 0,creationTs:a.attrTime("creation"),subject:{content:a.maybeAttrString("subject")||void 0,user:a.maybeAttrUserJid("s_o")||void 0,ts:a.hasAttr("s_t")?a.attrTime("s_t"):void 0},description:m(a)||void 0,participantVersion:a.maybeAttrString("p_v_id")||void 0,participants:a.mapChildrenWithTag("participant",function(a){return k(a)}),memberAddMode:l(a)||void 0}}function l(a){if(a.hasChild("member_add_mode")){a=a.child("member_add_mode");if(a.hasContent()){a=a.contentString();if(a==="admin_add"||a==="all_member_add")return a}}return null}function m(a){if(a.hasChild("description")){a=a.child("description");if(a.hasChild("body")){var b=a.child("body");if(b.hasContent())return{id:a.attrString("id"),ts:a.attrTime("t"),content:b.contentString(),user:b.maybeAttrUserJid("participant")||void 0}}}return null}g.PARTICIPANT_TYPES=i;g.parseProtocolGroupParticipantNode=k;g.parseGroupNode=a}),98);
__d("WAIsMediaExpiredError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){switch(a){case"signature-expired":return!0;case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"no-host":case"backoff":case"body-network-error":case"disconnected":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return!1;default:a;return!0}};f.isMediaExpiredError=a}),66);
__d("WALoadReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READONLY},"loadReceipt",function(a){return function(b){var c=d("WAMsg").craftWAMsgIdString(b);return a.receipts.get({waMsgId:c}).then(function(a){var c;return a==null?d("WAResultOrError").makeError("missing-receipt"):d("WAResultOrError").makeResult({id:b,permittedIdentitiesPerDevice:(c=a.permittedIdentitiesPerDevice)!=null?c:new Map(),recipientDevices:a.recipientDevices})})}});g.loadReceipt=a}),98);
__d("WAMarkSenderKeyAsSentApi",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c,e){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.personalSenderKeyStatuses.get(a));if(d==null)return;if(d.senderKeyId!==c)return;e.forEach(function(a){d.hasSenderKey.add(a)});yield b.stores.personalSenderKeyStatuses.bulkPut([d])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("markSenderKeyAsSent"))};g.markSenderKeyAsSent=a}),98);
__d("WASmaxInDevicesNotifyResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseNotifyResponseError=a}),98);
__d("WASmaxInDevicesNotifyResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseNotifyResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutDevicesNotifyRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.userJid;a=d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(a)});return a}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeNotifyRequestUsersUser=h;g.makeNotifyRequest=a}),98);
__d("WASmaxDevicesNotifyRPC",["WAComms","WASmaxInDevicesNotifyResponseError","WASmaxInDevicesNotifyResponseSuccess","WASmaxOutDevicesNotifyRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutDevicesNotifyRequest").makeNotifyRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInDevicesNotifyResponseSuccess").parseNotifyResponseSuccess(b,a);if(c.success)return{name:"NotifyResponseSuccess",value:c.value};b=d("WASmaxInDevicesNotifyResponseError").parseNotifyResponseError(b,a);if(b.success)return{name:"NotifyResponseError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Notify",{Success:c,Error:b}))});return h.apply(this,arguments)}g.sendNotifyRPC=a}),98);
__d("WANotifyDeviceChange",["Promise","WAGlobals","WALogger","WAPersistedJobManager","WASmaxDevicesNotifyRPC","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){a=c.users;if(a.size===0)return(i||(i=b("Promise"))).resolve();c=d("WAGlobals").getConfig().maxUsersForNotifyDeviceChange();var e=Array.from(a);a.size>c&&(d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["The maximum number of users that can be notified is ",""])),c),e=e.slice(0,c));return j(e)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxDevicesNotifyRPC").sendNotifyRPC({userArgs:a.map(function(a){return{userJid:a}})}));if(a.name==="NotifyResponseSuccess")return;a.name;a=a.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;if(a.name==="RetryableIQError"){var b=a.value.backoff;if(b!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:b},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}throw c("err")("Failed with an unexpected error code "+a.value.code)});return k.apply(this,arguments)}g.notifyDeviceChange=a}),98);
__d("WAParseFranking",["WAFranking","WAFrankingTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;if(a==null)return null;b=(b=a.maybeChild("franking_tag"))==null?void 0:b.contentBytes();a=(a=a.maybeChild("reporting_tag"))==null?void 0:a.contentBytes();return{frankingKey:null,frankingTag:b!=null?d("WAFrankingTypes").castToFrankingTag(b):null,reportingTag:a!=null?d("WAFrankingTypes").castToReportingTag(a):null,frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null}}g.parseFrankingNode=a}),98);
__d("WAWaterFlow",["$InternalEnum","WAMapWithDefault","WAPREMetrics","WATagsLogger","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=d("WATagsLogger").TAGS(["WAWaterflow"]),s=b("$InternalEnum").Mirrored(["INIT","ON_GOING","COMPLETED"]),t=function(){function a(a,b,c){this.$1=s.INIT,this.$7=[],this.$9=new(d("WAMapWithDefault").MapWithDefault)(function(){return[]}),this.$5=r.TAGS([a]),this.$8=b,this.$3={},this.$4=new Set(),this.$10=!c,this.$6=d("WATimeUtils").performanceAbsoluteNow()}var b=a.prototype;b.$11=function(){var a=this,b={"int":{},bool:{},string:{},string_array:{}};this.$4.forEach(function(c){var d=a.$3[c];Array.isArray(d)&&(b.string_array[c]=d);typeof d==="boolean"&&(b.bool[c]=d);typeof d==="number"&&(b["int"][c]=d);typeof d==="string"&&(b.string[c]=d)});return b};b.$12=function(a){if(a==null)return;for(var b in a){var c=a[b];c!==this.$3[b]&&(this.$4.add(b),this.$3[b]=c)}};b.$13=function(a,b){this.$6=d("WATimeUtils").performanceAbsoluteNow();this.$12(a);a=this.$11();this.$4.clear();this.$10&&this.$5.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose([" -> Start.",""])),u(this.$3));this.$1=s.ON_GOING;if(this.$8==null)return this;this.$2=d("WAPREMetrics").startMetric(this.$8,a,b);return this};b.startMetric=function(a){return this.$13(a)};b.reStartMetric=function(a,b){return this.$13(b,a)};b.startPoint=function(a,b){var e;if(typeof a!=="string"){this.$5.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"])));throw c("err")("Step should be a enum type")}this.$12(b);b=this.$11();(e=this.$2)==null||e.addPoint(a+"_start",b);this.$4.clear();e={step:a,from:d("WATimeUtils").performanceAbsoluteNow()};this.$7.push(e);this.$9.get(a).push(e);this.$10&&this.$5.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose([""," -> Start.","",""])),a,v(this.$7,this.$6),u(this.$3))};b.endPoint=function(a,b){var e,f=d("WATimeUtils").performanceAbsoluteNow(),g=this.$9.get(a).pop();g==null?this.$5.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["No start point was found for step: ","."])),a):g.to=f;if(typeof a!=="string"){this.$5.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"])));throw c("err")("Step should be a enum type")}this.$12(b);b=this.$11();(e=this.$2)==null||e.addPoint(a+"_end",b);this.$4.clear();this.$10&&this.$5.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose([""," -> Done.;\nTime taken: ",";\nTime from start: ",";","","\n"])),a,w(g!=null?f-g.from:0),w(f-this.$6),v(this.$7,this.$6),u(this.$3))};b.isOnGoing=function(){return this.$1===s.ON_GOING};b.isCompleted=function(){return this.$1===s.COMPLETED};b.annotate=function(a){this.$12(a)};b.reAnnotate=function(a){this.$12(a(this.$3))};b.getAnnotations=function(){return this.$3};b.annotateImmediately=function(a){var b;this.$12(a);a=this.$11();(b=this.$2)==null||b.addAnnotations(a);this.$4.clear()};b.addPoint=function(a,b){var d;if(typeof a!=="string"){this.$5.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Step should be a enum type"])));throw c("err")("Step should be a enum type")}this.$12(b);b=this.$11();(d=this.$2)==null||d.addPoint(a,b);this.$4.clear()};b.getStartTime=function(){return this.$6};b.log=function(){this.$10&&this.$5.LOG(o||(o=babelHelpers.taggedTemplateLiteralLoose([" -> in progress.\nTime passed: "," sec;","","\n"])),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3))};b.endSuccess=function(a){var b;this.$12(a);a=this.$11();(b=this.$2)==null||b.endSuccess(a);this.$4.clear();this.$10&&this.$5.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose([" -> Done. Success: true\nTime taken: "," sec;","","\n"])),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3));this.$1=s.COMPLETED};b.endFail=function(a,b){var c;this.$12(b);b=this.$11();(c=this.$2)==null||c.endFail(a,b);this.$4.clear();this.$10&&this.$5.LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose([" -> Done. Success: false\nTime taken: "," sec;","","\n"])),(d("WATimeUtils").performanceAbsoluteNow()-this.$6)/1e3,v(this.$7,this.$6),u(this.$3));this.$1=s.COMPLETED};return a}();function a(a){if(a==null)return{};var b={bool:{},"int":{},string:{},string_array:{}};for(var c in a)Array.isArray(a[c])&&(b.string_array[c]=a[c]),typeof a[c]==="number"&&(b["int"][c]=a[c]),typeof a[c]==="boolean"&&(b.bool[c]=a[c]),typeof a[c]==="string"&&(b.string[c]=a[c]);return b}function u(a){a=Object.entries(a).map(function(a){var b=a[0];a=a[1];return b+": "+String(a)});return a.length>0?"\n"+a.join("\n"):""}function v(a,b){a=a.map(function(a){var c=a.step,e=a.from;a=a.to;return typeof c==="string"?c+" => Started after: "+w(e-b)+"; "+(a!=null?"Completed after: "+w(a-e):"In progress: "+w(d("WATimeUtils").performanceAbsoluteNow()-e)):""}).filter(Boolean);return a.length>0?"\n"+a.join("\n"):""}function w(a){return a/1e3+"s"}function e(a,b,c){return new t(a,b,c!=null?c:!1)}g.WAWaterflow=t;g.convertToPREAnnotation=a;g.makeWaterflow=e}),98);
__d("WAQueryGroup",["$InternalEnum","WADeprecatedSendIq","WADeprecatedWapParser","WAGroupParserUtils","WAPREList","WAPREMetrics","WAResultOrError","WAWap","WAWaterFlow","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new(c("WADeprecatedWapParser"))("queryAllGroupsResponse",function(a){a.assertTag("iq");return{groups:a.child("groups").mapChildren(d("WAGroupParserUtils").parseGroupNode)}});function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUPS);a=(a=d("WAWap")).wap("iq",{id:a.generateId(),to:a.G_US,type:"get",xmlns:"w:g2"},a.wap("participating",null,a.wap("participants",null),a.wap("description",null)));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,h));if(!a.success){b.endFail("query_groups_fail");return d("WAResultOrError").makeError(a)}b.endSuccess();return d("WAResultOrError").makeResult(a.result)});return i.apply(this,arguments)}var j=new(c("WADeprecatedWapParser"))("queryAllGroupsResponse",function(a){a.assertTag("iq");return{group:d("WAGroupParserUtils").parseGroupNode(a.child("group"))}}),k=b("$InternalEnum").Mirrored(["IQ_REQUEST"]);function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b!=null?b:"unknown",e=d("WAWaterFlow").makeWaterflow("query-group",d("WAPREList").PRE_METRIC.QUERY_GROUP).startMetric();e.addPoint(k.IQ_REQUEST,{key:c});a=(yield d("WADeprecatedSendIq").deprecatedSendIq(d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").GROUP_JID(a),type:"get",xmlns:"w:g2"},d("WAWap").wap("query",{request:b!=null?d("WAWap").CUSTOM_STRING(b):d("WAWap").DROP_ATTR})),j));if(!a.success){e.endFail("Fail-"+c+"-"+a.errorCode);return d("WAResultOrError").makeError(a)}e.endSuccess();return d("WAResultOrError").makeResult(a.result.group)});return l.apply(this,arguments)}g.queryAllGroups=a;g.parseQueryGroupResponse=j;g.queryGroup=e}),98);
__d("WAQueryGroups",["Promise","WACreateGroup","WAGetDevices","WAPushSafeTypes","WAQueryGroup","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){f===void 0&&(f=!1);a=d("WAPushSafeTypes").unsafeNotNullable(e);e={groups:[]};if(a.type==="all"){var g=(yield d("WAQueryGroup").queryAllGroups());if(g.success===!1){var i;throw c("err")("Failed to parse queryAllGroup response with error "+JSON.stringify((i=g.error)!=null?i:null))}e=g.value}else{a.type;i=(yield (h||(h=b("Promise"))).all(a.groups.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAQueryGroup").queryGroup(a));if(a.success===!1){var b;throw c("err")("Failed to parse queryGroup response with error "+JSON.stringify((b=a.error)!=null?b:null))}return a.value});return function(b){return a.apply(this,arguments)}}())));e={groups:i}}yield d("WACreateGroup").createGroups(e.groups.map(function(a){return{groupStatus:"queried",groupToCreate:a,serverTs:d("WATimeUtils").unixTime(),extras:void 0,folder:void 0,key:void 0}}));var j=new Set();e.groups.forEach(function(a){return a.participants.forEach(function(a){a.success?j.add(a.value.user):j.add(a.error.user)})});yield d("WAGetDevices").getDevices(null,{users:j,reason:"query-groups",ignoreDhash:f})});return i.apply(this,arguments)}g.queryGroups=a}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetchDigest",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorItemNotFound","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetchDigest=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetchDigest","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetchDigest").parseRequestErrorsFetchDigest(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetchDigest:b.value}))}g.parseFetchDigestResponseRequestError=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchDigestResponseServerError=a}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"hash");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,20,20);return!a.success?a:d("WAResultOrError").makeResult({hashElementValue:a.value})}g.parseKeysHashMixin=a}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(a);return!b.success?b:b}function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!a.success)return a;a=d("WASmaxParseUtils").mapChildrenWithTag(a.value,"id",0,2e4,h);return!a.success?a:d("WAResultOrError").makeResult({listId:a.value})}g.parsePreKeyIDListListId=h;g.parsePreKeyIDListMixin=a}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!b.success)return b;var c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;var e=d("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!f.success)return f;var g=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a);a=d("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,c.value,e.value,f.value,{keyTypeMixin:g.success?g.value:null},a.value))}g.parseIdentityDigestBundleMixin=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"digest");if(!c.success)return c;var e=d("WASmaxParseReference").optionalAttrStringFromReference(b,["digest","identity_type"]);if(!e.success)return e;e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"identity_type",e.value);if(!e.success)return e;c=d("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({hasDigestIdentityType:e.value!=null,digestIdentityDigestBundleMixin:c.value},a.value))}g.parseFetchDigestResponseSuccess=a}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("digest",null)));return a}g.makeFetchDigestRequest=a}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest();a=(yield d("WAComms").sendSmaxStanza(b,a));var c=d("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(a,b);if(c.success)return{name:"FetchDigestResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(a,b);if(e.success)return{name:"FetchDigestResponseRequestError",value:e.value};a=d("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(a,b);if(a.success)return{name:"FetchDigestResponseServerError",value:a.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:c,RequestError:e,ServerError:a}))});return h.apply(this,arguments)}g.sendFetchDigestRPC=a}),98);
__d("WARequestPreKeyDigestProtocol",["WABinary","WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WACryptoDependencies","WACryptoUtils","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchDigestRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS(["requestPreKeyDigestProtocol"]);function a(a){return d("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({withoutRetry:!1}).then(function(b){switch(b.name){case"FetchDigestResponseServerError":var c=b.value.errorServerErrors.name;j.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),b.name,c);return d("WAResultOrError").makeError({type:"server-error",payload:c});case"FetchDigestResponseRequestError":c=b.value.errorRequestErrorsFetchDigest.name;j.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),b.name,c);return d("WAResultOrError").makeError({type:"request-error",payload:c});default:b.name;c=k(b.value.digestIdentityDigestBundleMixin);return l(c,a).then(function(a){return a==="ok"?d("WAResultOrError").makeResult():d("WAResultOrError").makeError({type:"compare-error",payload:a})})}})}function k(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),e=a.listId.map(function(a){return d("WASignalKeys").castToPreKeyId(d("WAParsableXmlNode").convertBytesToUint(a.elementValue,3))});a=a.hashElementValue;return{regId:b,skeyId:c.id,preKeyIds:e,hash:a}}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.regId!==b.regInfo.regId)return"RegIdMismatch";if(a.skeyId!==b.signedPreKey.id)return"SignedPreKeyIdMismatch";var c=new Map();b.preKeys.forEach(function(a){return c.set(a.id,a)});var e=a.preKeyIds.some(function(a){return!c.has(a)});if(e)return"UnknownPreKey";e=a.preKeyIds.map(function(a){return c.get(a)}).filter(Boolean);b=(yield n(b,e));return!d("WACryptoUtils").uint8ArraysEqual(b,a.hash)?"HashMismatch":"ok"});return m.apply(this,arguments)}function n(a,b){var c=new(d("WABinary").Binary)();c.writeByteArray(a.regInfo.staticKeyPair.publicKey);c.writeByteArray(a.signedPreKey.keyPair.publicKey);c.writeByteArray(a.signedPreKey.signature);b.forEach(function(a){c.writeByteArray(a.keyPair.publicKey)});return d("WACryptoDependencies").getCrypto().subtle.digest("SHA-1",c.readByteArrayView()).then(function(a){return new Uint8Array(a)})}g.requestPreKeyDigestProtocol=a}),98);
__d("WARequestPreKeyDigest",["WABridge","WAGenerateAndUploadPreKeys","WAGetKeysForUpload","WAGlobals","WALogger","WAOdsEnums","WARequestPreKeyDigestProtocol","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a(function(a){a=a.cryptoManager;return d("WAGetKeysForUpload").getKeysForUpload(a)}));a=(yield d("WARequestPreKeyDigestProtocol").requestPreKeyDigestProtocol(a.value));if(a.success===!1){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"});if(a.error.type==="compare-error"){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""])),a.error.payload);d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"prekey digest comparison failed"})["catch"](function(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),a)});return}throw c("err")("Error while requesting key digest: "+a.error.type+" "+a.error.payload)}a.success;d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"})});return k.apply(this,arguments)}function a(a){return j(function(a){return d("WAGlobals").getWaOneQueue().enqueue(a,{operationType:"request_prekey_digest",flush:!1})})}g.requestPreKeyDigestFn=j;g.requestPreKeyDigest=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseRotateSignedResponseRequestError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseRotateSignedResponseServerError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRotateSignedResponseSuccess=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(c.value,"text");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(c.value,"code",400,499);if(!f.success)return f;c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:e.value,errorCode:f.value,errorIdentityKeyMixin:c.value},a.value))}g.parseRotateSignedResponseValidationError=a}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){a=a.signedPreKeyMixinArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"},d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxJsx").smax("rotate",null),a)));return a}g.makeRotateSignedRequest=a}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(b,a);if(c.success)return{name:"RotateSignedResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(b,a);if(e.success)return{name:"RotateSignedResponseValidationError",value:e.value};var f=d("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(b,a);if(f.success)return{name:"RotateSignedResponseRequestError",value:f.value};b=d("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(b,a);if(b.success)return{name:"RotateSignedResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:c,ValidationError:e,RequestError:f,ServerError:b}))});return h.apply(this,arguments)}g.sendRotateSignedRPC=a}),98);
__d("WARotateSignedPreKeyProtocol",["WACryptoManager","WAErrorMessage","WAGlobals","WAHandleFailureUtils","WAMakeSignedPreKeyMixin","WAResultOrError","WASmaxPreKeysRotateSignedRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("WATagsLogger").TAGS(["rotateSignedPreKeyProtocol"]);function a(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){n.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start generating skey..."])));try{var a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WACryptoManager").generateSignedPreKey(a)},{operationType:"generate_signed_prekey",flush:!0,afterInit:!0}));n.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["generated skey. Start rotating skey..."])));a=(yield d("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a)}));switch(a.name){case"RotateSignedResponseValidationError":var b=a.value,c=b.errorCode,e=b.errorText;b=b.errorIdentityKeyMixin;n.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["ValidationError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"validation-error",identity:b.elementValue});case"RotateSignedResponseRequestError":c=a.value.errorRequestErrors.value.code;e=a.value.errorRequestErrors.name;n.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["RequestError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"request-error"});case"RotateSignedResponseServerError":b=a.value.errorServerErrors.value.code;c=a.value.errorServerErrors.name;n.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["ServerError: "," ",""])),b,c);return d("WAResultOrError").makeError({type:"server-error"});default:a.name;n.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["successfully rotated new skey"])));return d("WAResultOrError").makeResult()}}catch(a){e=d("WAErrorMessage").maybeGetMessageFromError(a);if(e.includes("No lastSignedPrekeyId and registration")){yield d("WAHandleFailureUtils").reregisterPhone();return d("WAResultOrError").makeError({type:"no-prekey-reregistered"})}throw a}});return o.apply(this,arguments)}g.rotateSignedPreKeyProtocol=a}),98);
__d("WARotateSignedPreKey",["Promise","WAGenerateAndUploadPreKeys","WALoggerTag","WARotateSignedPreKeyProtocol","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekeyRotation,c("WALoggerTag").SignedPrekey]);function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WARotateSignedPreKeyProtocol").rotateSignedPreKeyProtocol());if(a.success||a.error.type==="no-prekey-reregistered")return;if(a.error.type==="validation-error"){l.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Signed prekey failed server validation. need to upload all keys."])));d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"signed prekey failed server validation"})["catch"](function(a){l.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),a)});return(k||(k=b("Promise"))).resolve()}l.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey failed."])));throw c("err")("rotateSignedPreKey RPC failed: "+a.error.type)});return m.apply(this,arguments)}g.rotateSignedPreKey=a}),98);
__d("WASmaxInMessagePublishAckAdminEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","3");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminEditMixin=a}),98);
__d("WASmaxInMessagePublishAckAdminRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","8");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckAdminRevokeMixin=a}),98);
__d("WASmaxInMessagePublishAckMessageEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","1");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessageEditMixin=a}),98);
__d("WASmaxInMessagePublishAckMessagePinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","2");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckMessagePinMixin=a}),98);
__d("WASmaxInMessagePublishEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={CBP:"CBP",NBP:"NBP",PMP:"PMP"};b={delivery:"delivery",no_optimization:"no_optimization"};c={"false":"false","true":"true"};e={free_customer_service:"free_customer_service",free_entry_point:"free_entry_point",regular:"regular"};f={lid:"lid",pn:"pn"};var h={validators:[(d=d("WAJids")).validateDeviceJid,d.validateDeviceJid,d.validateUserJid,d.validateUserJid],typeName:"DeviceJid|DeviceJid|UserJid|UserJid"};d={validators:[d.validateUserJid,d.validateUserJid],typeName:"UserJid|UserJid"};g.ENUM_CBP_NBP_PMP=a;g.ENUM_DELIVERY_NOOPTIMIZATION=b;g.ENUM_FALSE_TRUE=c;g.ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR=e;g.ENUM_LID_PN=f;g.DEVICEJID_DEVICEJID_USERJID_USERJID=h;g.USERJID_USERJID=d}),98);
__d("WASmaxInMessagePublishAckPaidConversationMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"delivery_context");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"optimization_goal",d("WASmaxInMessagePublishEnums").ENUM_DELIVERY_NOOPTIMIZATION);return!b.success?b:d("WAResultOrError").makeResult({optimizationGoal:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"source_url");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"referral");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"source_url",i);if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"source_type");return!a.success?a:d("WAResultOrError").makeResult({sourceType:a.value,sourceUrl:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"origin");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"referral",j);if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"type");return!a.success?a:d("WAResultOrError").makeResult({type:a.value,referral:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"pricing");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"consumer_country_code");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"business_country_code");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"conversation_status",0,void 0);if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"latest_c2b_timestamp",0,void 0);if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"analytics_conversation_id");if(!g.success)return g;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"b2c_timestamp",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({consumerCountryCode:b.value,businessCountryCode:c.value,conversationStatus:e.value,latestC2bTimestamp:f.value,analyticsConversationId:g.value,b2cTimestamp:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"biz");if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(b.value,"delivery_context",h);if(!a.success)return a;var c=d("WASmaxParseUtils").optionalChildWithTag(b.value,"origin",k);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(b.value,"pricing",l);if(!e.success)return e;var f=d("WASmaxParseUtils").attrString(b.value,"paid_convo_id");if(!f.success)return f;var g=d("WASmaxParseUtils").attrStringEnum(b.value,"pricing_model",d("WASmaxInMessagePublishEnums").ENUM_CBP_NBP_PMP);if(!g.success)return g;var i=d("WASmaxParseUtils").attrStringEnum(b.value,"billable",d("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);if(!i.success)return i;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"expiration_timestamp",0,void 0);if(!j.success)return j;var m=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"pricing_category");if(!m.success)return m;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"pricing_type",d("WASmaxInMessagePublishEnums").ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR);return!b.success?b:d("WAResultOrError").makeResult({bizPaidConvoId:f.value,bizPricingModel:g.value,bizBillable:i.value,bizExpirationTimestamp:j.value,bizPricingCategory:m.value,bizPricingType:b.value,bizDeliveryContext:a.value,bizOrigin:c.value,bizPricing:e.value})}g.parseAckPaidConversationBizDeliveryContext=h;g.parseAckPaidConversationBizOriginReferralSourceUrl=i;g.parseAckPaidConversationBizOriginReferral=j;g.parseAckPaidConversationBizOrigin=k;g.parseAckPaidConversationBizPricing=l;g.parseAckPaidConversationMixin=a}),98);
__d("WASmaxInMessagePublishAckPaidGroupConversationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"biz");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"pricing");if(!a.success)return a;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a.value,"business_country_code");return!b.success?b:d("WAResultOrError").makeResult({bizPricingBusinessCountryCode:b.value})}g.parseAckPaidGroupConversationMixin=a}),98);
__d("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup",["WAResultOrError","WASmaxInMessagePublishAckPaidConversationMixin","WASmaxInMessagePublishAckPaidGroupConversationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMessagePublishAckPaidConversationMixin").parseAckPaidConversationMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AckPaidConversation",value:b.value});var c=d("WASmaxInMessagePublishAckPaidGroupConversationMixin").parseAckPaidGroupConversationMixin(a);return c.success?d("WAResultOrError").makeResult({name:"AckPaidGroupConversation",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AckPaidConversation","AckPaidGroupConversation"],[b,c])}g.parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup=a}),98);
__d("WASmaxInMessagePublishAckRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","7");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAckRevokeMixin=a}),98);
__d("WASmaxInMessagePublishServerFrankingTagMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"franking");if(!a.success)return a;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"reporting_tag");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,9,128);return!a.success?a:d("WAResultOrError").makeResult({frankingReportingTagElementValue:a.value})}g.parseServerFrankingTagMixin=a}),98);
__d("WASmaxInMessagePublishAckMixin",["WAResultOrError","WASmaxInMessagePublishAckAdminEditMixin","WASmaxInMessagePublishAckAdminRevokeMixin","WASmaxInMessagePublishAckMessageEditMixin","WASmaxInMessagePublishAckMessagePinMixin","WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup","WASmaxInMessagePublishAckRevokeMixin","WASmaxInMessagePublishServerFrankingTagMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"class","message");if(!c.success)return c;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var e=d("WASmaxInMessagePublishAckMessageEditMixin").parseAckMessageEditMixin(a),f=d("WASmaxInMessagePublishAckAdminEditMixin").parseAckAdminEditMixin(a),g=d("WASmaxInMessagePublishAckMessagePinMixin").parseAckMessagePinMixin(a),h=d("WASmaxInMessagePublishAckAdminRevokeMixin").parseAckAdminRevokeMixin(a),i=d("WASmaxInMessagePublishAckRevokeMixin").parseAckRevokeMixin(a),j=d("WASmaxInMessagePublishServerFrankingTagMixin").parseServerFrankingTagMixin(a);a=d("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup").parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup(a);return d("WAResultOrError").makeResult({"class":c.value,t:b.value,ackMessageEditMixin:e.success?e.value:null,ackAdminEditMixin:f.success?f.value:null,ackMessagePinMixin:g.success?g.value:null,ackAdminRevokeMixin:h.success?h.value:null,ackRevokeMixin:i.success?i.value:null,serverFrankingTagMixin:j.success?j.value:null,ackPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup:a.success?a.value:null})}g.parseAckMixin=a}),98);
__d("WASmaxInMessagePublishApplicationNegativeAckMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"application_error",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({applicationError:b.value})}g.parseApplicationNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishMessageNackRetryAttributesMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"backoff",0,86400);return!b.success?b:d("WAResultOrError").makeResult({backoff:b.value})}g.parseMessageNackRetryAttributesMixin=a}),98);
__d("WASmaxInMessagePublishNegativeAckMixin",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishApplicationNegativeAckMixin","WASmaxInMessagePublishMessageNackRetryAttributesMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(a,"error");if(!c.success)return c;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var e=d("WASmaxInMessagePublishApplicationNegativeAckMixin").parseApplicationNegativeAckMixin(a);a=d("WASmaxInMessagePublishMessageNackRetryAttributesMixin").parseMessageNackRetryAttributesMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({error:c.value},b.value,{applicationNegativeAckMixin:e.success?e.value:null,messageNackRetryAttributesMixin:a.success?a.value:null}))}g.parseNegativeAckMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseNegative",["WAResultOrError","WASmaxInMessagePublishNegativeAckMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;a=d("WASmaxInMessagePublishNegativeAckMixin").parseNegativeAckMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value},a.value))}g.parseIndividualResponseNegative=a}),98);
__d("WASmaxInMessagePublishAckRcatMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"rcat");if(!b.success)return b;a=d("WASmaxParseUtils").contentBytes(b.value);return!a.success?a:d("WAResultOrError").makeResult({rcatElementValue:a.value})}g.parseAckRcatMixin=a}),98);
__d("WASmaxInMessagePublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"phash");return!b.success?b:d("WAResultOrError").makeResult({phash:b.value})}g.parseDeviceListStaleMixin=a}),98);
__d("WASmaxInMessagePublishRefreshLIDMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"refresh_lid",d("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);return!b.success?b:d("WAResultOrError").makeResult({refreshLid:b.value})}g.parseRefreshLIDMixin=a}),98);
__d("WASmaxInMessagePublishIndividualResponseSuccess",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishAckRcatMixin","WASmaxInMessagePublishDeviceListStaleMixin","WASmaxInMessagePublishEnums","WASmaxInMessagePublishRefreshLIDMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"recipient");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrJidEnum,a,"participant",d("WASmaxInMessagePublishEnums").USERJID_USERJID);if(!e.success)return e;b=d("WASmaxInMessagePublishAckMixin").parseAckMixin(a,b);if(!b.success)return b;var f=d("WASmaxInMessagePublishDeviceListStaleMixin").parseDeviceListStaleMixin(a),g=d("WASmaxInMessagePublishRefreshLIDMixin").parseRefreshLIDMixin(a);a=d("WASmaxInMessagePublishAckRcatMixin").parseAckRcatMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({recipient:c.value,participant:e.value},b.value,{deviceListStaleMixin:f.success?f.value:null,refreshLIDMixin:g.success?g.value:null,ackRcatMixin:a.success?a.value:null}))}g.parseIndividualResponseSuccess=a}),98);
__d("WASmaxOutMessagePublishAppdataMetaAttributeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaAppdata;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{appdata:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAppdataMetaAttributeMixin=a}),98);
__d("WASmaxOutMessagePublishAutomatedMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("automated",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAutomatedMixin=a}),98);
__d("WASmaxOutMessagePublishAuthMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.authVerificationTimestamp,c=a.authDisableIosAutofill;a=a.authEnableRiskCheck;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("auth",{verification_timestamp:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b),disable_ios_autofill:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c),enable_risk_check:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAuthMixin=a}),98);
__d("WASmaxOutMessagePublishBizAcceptTsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAcceptTs;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{accept_ts:d("WAWap").INT(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAcceptTsMixin=a}),98);
__d("WASmaxOutMessagePublishBizAutoResponseMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizAutoResponse;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{auto_response:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizAutoResponseMixin=a}),98);
__d("WASmaxOutMessagePublishBizCampaignMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.bizCampaignId;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{campaign_id:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizCampaignMixin=a}),98);
__d("WASmaxOutMessagePublishBizEngagementDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.engagementConversationState;a=a.engagementCustomerServiceState;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("engagement",{conversation_state:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),customer_service_state:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizEngagementDataMixin=a}),98);
__d("WASmaxOutMessagePublishBizMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.metadataAppOwner,f=a.metadataCsidBm,g=a.metadataPaymentBm,h=a.metadataCustomerCategory;a=a.metadataDidBepRun;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("metadata",{app_owner:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),csid_bm:b.OPTIONAL(c.CUSTOM_STRING,f),payment_bm:b.OPTIONAL(c.CUSTOM_STRING,g),customer_category:b.OPTIONAL(c.CUSTOM_STRING,h),did_bep_run:b.OPTIONAL(c.CUSTOM_STRING,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishBizPricingDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.pricingConsumerCountryCode;a=a.pricingBusinessCountryCode;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("pricing",{consumer_country_code:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),business_country_code:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizPricingDataMixin=a}),98);
__d("WASmaxOutMessagePublishBizRolesMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizHostStorage,c=a.bizActualActors;a=a.bizPrivacyModeTs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{host_storage:d("WAWap").INT(b),actual_actors:d("WAWap").INT(c),privacy_mode_ts:d("WAWap").INT(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizRolesMixin=a}),98);
__d("WASmaxMixinGroupExhaustiveError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(){var b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return(b=a.call.apply(a,[this].concat(d))||this,b.name="SmaxMixinGroupExhaustiveError",babelHelpers.assertThisInitialized(b))||babelHelpers.assertThisInitialized(b)}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxMixinGroupExhaustiveError=a}),66);
__d("WASmaxOutMessagePublishButtonsMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("buttons",null)));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeButtonsMixin=a}),98);
__d("WASmaxOutMessagePublishExtensionsMetadataMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.capabilityArgs;a=d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").REPEATED_CHILD(i,a,1,50));return a}function i(a){a=a.capabilityName;a=d("WASmaxJsx").smax("capability",{name:d("WAWap").CUSTOM_STRING(a)});return a}function j(a){var b=a.capabilitiesArgs,c=a.extensionsMetadataWellVersion,e=a.extensionsMetadataDataApiVersion;a=a.extensionsMetadataFlowMessageVersion;c=d("WASmaxJsx").smax("native_flow",null,d("WASmaxJsx").smax("extensions_metadata",{well_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),data_api_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),flow_message_version:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)));return c}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeExtensionsMetadataExtensionsMetadataCapabilities=h;g.makeExtensionsMetadataExtensionsMetadataCapabilitiesCapability=i;g.mergeExtensionsMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishMixedMetadataMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.paymentsMetadataVersion;a=d("WASmaxJsx").smax("native_flow",null,d("WASmaxJsx").smax("mixed_metadata",null,d("WASmaxJsx").smax("payments_metadata",{version:d("WAWap").INT(a)})));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMixedMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishExtensionsMetadataMixin","WASmaxOutMessagePublishMixedMetadataMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.nativeFlowName,c=a.nativeFlowV,e=a.extensionsMetadataMixinArgs;a=a.mixedMetadataMixinArgs;b=d("WASmaxJsx").smax("interactive",{type:"native_flow"},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishMixedMetadataMixin").mergeMixedMetadataMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishExtensionsMetadataMixin").mergeExtensionsMetadataMixin,d("WASmaxJsx").smax("native_flow",{name:d("WAWap").CUSTOM_STRING(b),v:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c)}),e),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishInteractiveMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishNativeFlowMessageTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.hasInteractiveV1;a=a.nativeFlowMessageTypeMixinArgs;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin").mergeNativeFlowMessageTypeMixin(d("WASmaxJsx").smax("interactive",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",b)}),a)));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInteractiveMixin=a}),98);
__d("WASmaxOutMessagePublishNativeFlowMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.bizNativeFlowName;a=a.bizNativeFlowVersion;b=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",{native_flow_name:d("WAWap").CUSTOM_STRING(b),native_flow_version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNativeFlowMixin=a}),98);
__d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishButtonsMixin","WASmaxOutMessagePublishInteractiveMixin","WASmaxOutMessagePublishNativeFlowMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isButtons)return d("WASmaxOutMessagePublishButtonsMixin").mergeButtonsMixin(a);if(b.nativeFlow)return d("WASmaxOutMessagePublishNativeFlowMixin").mergeNativeFlowMixin(a,b.nativeFlow);if(b.interactive)return d("WASmaxOutMessagePublishInteractiveMixin").mergeInteractiveMixin(a,b.interactive);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeButtonsOrNativeFlowOrInteractiveMixinGroup=a}),98);
__d("WASmaxOutMessagePublishConversionRecipientStatusMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.conversionRecipientStatus;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("conversion",{recipient_status:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeConversionRecipientStatusMixin=a}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.ctwaAttributionElementValue;a=d("WASmaxJsx").smax("ctwa_attribution",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClickToWhatsAppAttributionMixin=a}),98);
__d("WASmaxOutMessagePublishCtwaAttributionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppAttributionMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin").mergeClickToWhatsAppAttributionMixin(d("WASmaxJsx").smax("ctwa_attribution",null),a);return a}function i(a){a=a.ctwaAttributionArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCtwaAttributionCtwaAttribution=h;g.mergeCtwaAttributionMixin=a}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.sourceUrlElementValue;a=d("WASmaxJsx").smax("source_url",null,a);return a}function i(a){var b,c,e=a.sourceUrlArgs,f=a.ctwaConversionSource,g=a.ctwaConversionData,i=a.ctwaSourceType,j=a.ctwaEntryPointConversionSource,k=a.ctwaEntryPointConversionApp;a=a.ctwaSignals;f=d("WASmaxJsx").smax("ctwa",{conversion_source:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,f),conversion_data:b.OPTIONAL(c.CUSTOM_STRING,g),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),entry_point_conversion_source:b.OPTIONAL(c.CUSTOM_STRING,j),entry_point_conversion_app:b.OPTIONAL(c.CUSTOM_STRING,k),signals:b.OPTIONAL(c.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,e));return f}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeClickToWhatsAppTypeSourceUrl=h;g.mergeClickToWhatsAppTypeMixin=a}),98);
__d("WASmaxOutMessagePublishCtwaConversionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppTypeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin").mergeClickToWhatsAppTypeMixin(d("WASmaxJsx").smax("ctwa",null),a);return a}function i(a){a=a.ctwaArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCtwaConversionCtwa=h;g.mergeCtwaConversionMixin=a}),98);
__d("WASmaxOutMessagePublishDeliveryContextMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.deliveryContextHsmMaxBid,f=a.deliveryContextOptimizationGoal,g=a.deliveryContextTemplateId,h=a.deliveryContextCampaignId,i=a.deliveryContextSourceType,j=a.deliveryContextTierType,k=a.deliveryContextDeliveryType,l=a.deliveryContextClientToken,m=a.deliveryContextPrice,n=a.deliveryContextWabaId,o=a.deliveryContextQualityFlag,p=a.deliveryContextIsZeroRatedTemplate,q=a.deliveryContextPartnerId,r=a.deliveryContextAppId,s=a.deliveryContextVertical,t=a.deliveryContextBmMessageLimitStatus;a=a.deliveryContextShouldBypassIntegrityPhoneLimit;e=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("delivery_context",{hsm_max_bid:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).INT,e),optimization_goal:b.OPTIONAL(c.CUSTOM_STRING,f),template_id:b.OPTIONAL(c.CUSTOM_STRING,g),campaign_id:b.OPTIONAL(c.CUSTOM_STRING,h),source_type:b.OPTIONAL(c.CUSTOM_STRING,i),tier_type:b.OPTIONAL(c.CUSTOM_STRING,j),delivery_type:b.OPTIONAL(c.CUSTOM_STRING,k),client_token:b.OPTIONAL(c.CUSTOM_STRING,l),price:b.OPTIONAL(c.INT,m),waba_id:b.OPTIONAL(c.CUSTOM_STRING,n),quality_flag:b.OPTIONAL(c.CUSTOM_STRING,o),is_zero_rated_template:b.OPTIONAL(c.CUSTOM_STRING,p),partner_id:b.OPTIONAL(c.CUSTOM_STRING,q),app_id:b.OPTIONAL(c.CUSTOM_STRING,r),vertical:b.OPTIONAL(c.INT,s),bm_message_limit_status:b.OPTIONAL(c.CUSTOM_STRING,t),should_bypass_integrity_phone_limit:b.OPTIONAL(c.CUSTOM_STRING,a)})));return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeliveryContextMixin=a}),98);
__d("WASmaxOutMessagePublishCapabilitiesMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasFeatureV1;a=d("WASmaxJsx").smax("feature",{name:"full_catalog",v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",a)});return a}function i(a){a=a.featureArgs;a=d("WASmaxJsx").smax("hsm",null,d("WASmaxJsx").smax("capabilities",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeCapabilitiesCapabilitiesFeature=h;g.mergeCapabilitiesMixin=a}),98);
__d("WASmaxOutMessagePublishHSMReviewMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c,e=a.anyCategory,f=a.anyTag,g=a.anyId,h=a.anySubTag,i=a.anyLibraryTemplateId;a=a.anyIsTemplateFromLibraryEdited;e=d("WASmaxJsx").smax("smax$any",{category:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,e),tag:b.OPTIONAL(c.CUSTOM_STRING,f),id:b.OPTIONAL(c.CUSTOM_STRING,g),sub_tag:b.OPTIONAL(c.CUSTOM_STRING,h),library_template_id:b.OPTIONAL(c.CUSTOM_STRING,i),is_template_from_library_edited:b.OPTIONAL(c.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHSMReviewMetadataMixin=a}),98);
__d("WASmaxOutMessagePublishQualityTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){var b=a.hasQualityTokenV1;a=a.qualityTokenElementValue;b=d("WASmaxJsx").smax("hsm",null,d("WASmaxJsx").smax("quality_token",{v:d("WASmaxAttrs").OPTIONAL_LITERAL("1",b)},a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeQualityTokenMixin=a}),98);
__d("WASmaxOutMessagePublishHsmMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishCapabilitiesMixin","WASmaxOutMessagePublishHSMReviewMetadataMixin","WASmaxOutMessagePublishQualityTokenMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.messageTtl,e=a.hasHsmV1,f=a.hasHsmButtons1,g=a.hsmObjective,h=a.hSMReviewMetadataMixinArgs,i=a.capabilitiesMixinArgs;a=a.qualityTokenMixinArgs;c=d("WASmaxJsx").smax("message",{ttl:(b=d("WASmaxAttrs")).OPTIONAL(d("WAWap").INT,c)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishQualityTokenMixin").mergeQualityTokenMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishCapabilitiesMixin").mergeCapabilitiesMixin,d("WASmaxOutMessagePublishHSMReviewMetadataMixin").mergeHSMReviewMetadataMixin(d("WASmaxJsx").smax("hsm",{v:b.OPTIONAL_LITERAL("1",e),buttons:b.OPTIONAL_LITERAL("1",f),objective:b.OPTIONAL(d("WAWap").CUSTOM_STRING,g)}),h),i),a));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHsmMixin=a}),98);
__d("WASmaxOutMessagePublishQualityControlMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.decisionSourceValue;a=d("WASmaxJsx").smax("decision_source",{value:d("WAWap").CUSTOM_STRING(a)});return a}function i(a){var b=a.decisionSourceArgs,c=a.qualityControlSourceType;a=a.qualityControlDecisionId;c=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("quality_control",{source_type:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c),decision_id:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)},d("WASmaxChildren").REPEATED_CHILD(h,b,0,Infinity))));return c}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeQualityControlBizQualityControlDecisionSource=h;g.mergeQualityControlMixin=a}),98);
__d("WASmaxOutMessagePublishBizMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAuthMixin","WASmaxOutMessagePublishBizAcceptTsMixin","WASmaxOutMessagePublishBizAutoResponseMixin","WASmaxOutMessagePublishBizCampaignMixin","WASmaxOutMessagePublishBizEngagementDataMixin","WASmaxOutMessagePublishBizMetadataMixin","WASmaxOutMessagePublishBizPricingDataMixin","WASmaxOutMessagePublishBizRolesMixin","WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup","WASmaxOutMessagePublishConversionRecipientStatusMixin","WASmaxOutMessagePublishCtwaAttributionMixin","WASmaxOutMessagePublishCtwaConversionMixin","WASmaxOutMessagePublishDeliveryContextMixin","WASmaxOutMessagePublishHsmMixin","WASmaxOutMessagePublishQualityControlMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.hsmMixinArgs,e=a.bizRolesMixinArgs,f=a.bizAutoResponseMixinArgs,g=a.bizAcceptTsMixinArgs,h=a.bizCampaignMixinArgs,i=a.deliveryContextMixinArgs,j=a.qualityControlMixinArgs,k=a.authMixinArgs,l=a.conversionRecipientStatusMixinArgs,m=a.ctwaConversionMixinArgs,n=a.bizMetadataMixinArgs,o=a.ctwaAttributionMixinArgs,p=a.bizEngagementDataMixinArgs,q=a.bizPricingDataMixinArgs;a=a.buttonsOrNativeFlowOrInteractiveMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup").mergeButtonsOrNativeFlowOrInteractiveMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishBizPricingDataMixin").mergeBizPricingDataMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizEngagementDataMixin").mergeBizEngagementDataMixin,b.optionalMerge(d("WASmaxOutMessagePublishCtwaAttributionMixin").mergeCtwaAttributionMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizMetadataMixin").mergeBizMetadataMixin,b.optionalMerge(d("WASmaxOutMessagePublishCtwaConversionMixin").mergeCtwaConversionMixin,b.optionalMerge(d("WASmaxOutMessagePublishConversionRecipientStatusMixin").mergeConversionRecipientStatusMixin,b.optionalMerge(d("WASmaxOutMessagePublishAuthMixin").mergeAuthMixin,b.optionalMerge(d("WASmaxOutMessagePublishQualityControlMixin").mergeQualityControlMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeliveryContextMixin").mergeDeliveryContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizCampaignMixin").mergeBizCampaignMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAcceptTsMixin").mergeBizAcceptTsMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizAutoResponseMixin").mergeBizAutoResponseMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizRolesMixin").mergeBizRolesMixin,b.optionalMerge(d("WASmaxOutMessagePublishHsmMixin").mergeHsmMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),n),o),p),q),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBizMixin=a}),98);
__d("WASmaxOutMessagePublishClientFrankingTagMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.frankingTagElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("franking",null,d("WASmaxJsx").smax("franking_tag",null,a)));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientFrankingTagMixin=a}),98);
__d("WASmaxOutMessagePublishClientReportingTokenMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.reportingTokenV;a=a.reportingTokenElementValue;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("reporting",null,d("WASmaxJsx").smax("reporting_token",{v:d("WAWap").INT(b)},a)));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientReportingTokenMixin=a}),98);
__d("WASmaxOutMessagePublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("device-identity",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeviceIdentityMixin=a}),98);
__d("WASmaxOutMessagePublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("test",{config:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutMessagePublishLIDSessionDeprecationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaDeprecatedLidSession;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{deprecated_lid_session:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLIDSessionDeprecationMixin=a}),98);
__d("WASmaxOutMessagePublishMessageAssociationTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaMessageAssociationType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{message_association_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageAssociationTypeMixin=a}),98);
__d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("meta",{"decrypt-fail":"hide"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMetaHideDecryptionPlaceholderMixin=a}),98);
__d("WASmaxOutMessagePublishMulticastMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("multicast",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMulticastMixin=a}),98);
__d("WASmaxOutMessagePublishNoExtraFanoutMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{device_fanout:"false"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNoExtraFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishAnonPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.taPadElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("ta_pad",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAnonPaddingMixin=a}),98);
__d("WASmaxOutMessagePublishWireSizePaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.paddingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("padding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeWireSizePaddingMixin=a}),98);
__d("WASmaxOutMessagePublishPaddingMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAnonPaddingMixin","WASmaxOutMessagePublishWireSizePaddingMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.anonPaddingMixinArgs;a=a.wireSizePaddingMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishWireSizePaddingMixin").mergeWireSizePaddingMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAnonPaddingMixin").mergeAnonPaddingMixin,d("WASmaxJsx").smax("message",null),b),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePaddingMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledNumberMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_number",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledNumberMixin=a}),98);
__d("WASmaxOutMessagePublishPreFilledTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("url_text",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePreFilledTextMixin=a}),98);
__d("WASmaxOutMessagePublishSenderIntentMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{sender_intent:"hosted"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderIntentMixin=a}),98);
__d("WASmaxOutMessagePublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("request_id",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestIDMixin=a}),98);
__d("WASmaxOutMessagePublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.edgeIdElementValue;a=d("WASmaxJsx").smax("edge_id",null,a);return a}function i(a){var b=a.deviceArgs,c=a.correlationIdType;a=a.idElementValue;c=d("WASmaxJsx").smax("correlation_id",{type:d("WAWap").CUSTOM_STRING(c)},d("WASmaxJsx").smax("id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(k,b));return c}function j(a){a=a.observabilityFlagsId;a=d("WASmaxJsx").smax("observability_flags",{id:d("WAWap").INT(a)});return a}function k(a){a=a.deviceId;a=d("WASmaxJsx").smax("device",{id:d("WAWap").INT(a)});return a}function l(a){var b=a.edgeIdArgs,c=a.correlationIdArgs,e=a.observabilityFlagsArgs;a=a.traceIdElementValue;a=d("WASmaxJsx").smax("trace",null,[d("WASmaxJsx").smax("trace_id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,b)].concat(d("WASmaxChildren").REPEATED_CHILD(i,c,0,10),[d("WASmaxChildren").OPTIONAL_CHILD(j,e)]));return a}function a(a,b){b=l(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeTraceIDEdgeId=h;g.makeTraceIDCorrelationId=i;g.makeTraceIDObservabilityFlags=j;g.makeTraceIDCorrelationIdDevice=k;g.mergeTraceIDMixin=a}),98);
__d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRequestIDMixin","WASmaxOutMessagePublishTraceIDMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.requestID)return d("WASmaxOutMessagePublishRequestIDMixin").mergeRequestIDMixin(a,b.requestID);if(b.traceID)return d("WASmaxOutMessagePublishTraceIDMixin").mergeTraceIDMixin(a,b.traceID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRequestOrTraceIDMixinGroup=a}),98);
__d("WASmaxOutMessagePublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishRequestOrTraceIDMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestOrTraceIDMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(d("WASmaxJsx").smax("trace",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTraceContextMixin=a}),98);
__d("WASmaxOutMessagePublishVerifiedNameNameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageVerifiedName;a=d("WASmaxJsx").smax("message",{verified_name:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameNameMixin=a}),98);
__d("WASmaxOutMessagePublishWebDriverConfigMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaWebdriverConfig;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{webdriver_config:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeWebDriverConfigMixin=a}),98);
__d("WASmaxOutMessagePublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAutomatedMixin","WASmaxOutMessagePublishBizMixin","WASmaxOutMessagePublishClientFrankingTagMixin","WASmaxOutMessagePublishClientReportingTokenMixin","WASmaxOutMessagePublishDeviceIdentityMixin","WASmaxOutMessagePublishInternalTestMixin","WASmaxOutMessagePublishLIDSessionDeprecationMixin","WASmaxOutMessagePublishMessageAssociationTypeMixin","WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin","WASmaxOutMessagePublishMulticastMixin","WASmaxOutMessagePublishNoExtraFanoutMixin","WASmaxOutMessagePublishPaddingMixin","WASmaxOutMessagePublishPreFilledNumberMixin","WASmaxOutMessagePublishPreFilledTextMixin","WASmaxOutMessagePublishSenderIntentMixin","WASmaxOutMessagePublishTraceContextMixin","WASmaxOutMessagePublishVerifiedNameNameMixin","WASmaxOutMessagePublishWebDriverConfigMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.deviceIdentityMixinArgs,e=a.hasNoExtraFanout,f=a.hasMulticast,g=a.hasPreFilledText,h=a.hasPreFilledNumber,i=a.hasAutomated,j=a.bizMixinArgs,k=a.verifiedNameNameMixinArgs,l=a.clientFrankingTagMixinArgs,m=a.clientReportingTokenMixinArgs,n=a.internalTestMixinArgs,o=a.hasMetaHideDecryptionPlaceholder,p=a.traceContextMixinArgs,q=a.hasSenderIntent,r=a.lIDSessionDeprecationMixinArgs,s=a.paddingMixinArgs,t=a.webDriverConfigMixinArgs;a=a.messageAssociationTypeMixinArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishMessageAssociationTypeMixin").mergeMessageAssociationTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishWebDriverConfigMixin").mergeWebDriverConfigMixin,b.optionalMerge(d("WASmaxOutMessagePublishPaddingMixin").mergePaddingMixin,b.optionalMerge(d("WASmaxOutMessagePublishLIDSessionDeprecationMixin").mergeLIDSessionDeprecationMixin,b.optionalMerge(d("WASmaxOutMessagePublishSenderIntentMixin").mergeSenderIntentMixin,b.optionalMerge(d("WASmaxOutMessagePublishTraceContextMixin").mergeTraceContextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin").mergeMetaHideDecryptionPlaceholderMixin,b.optionalMerge(d("WASmaxOutMessagePublishInternalTestMixin").mergeInternalTestMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientReportingTokenMixin").mergeClientReportingTokenMixin,b.optionalMerge(d("WASmaxOutMessagePublishClientFrankingTagMixin").mergeClientFrankingTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishVerifiedNameNameMixin").mergeVerifiedNameNameMixin,b.optionalMerge(d("WASmaxOutMessagePublishBizMixin").mergeBizMixin,b.optionalMerge(d("WASmaxOutMessagePublishAutomatedMixin").mergeAutomatedMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledNumberMixin").mergePreFilledNumberMixin,b.optionalMerge(d("WASmaxOutMessagePublishPreFilledTextMixin").mergePreFilledTextMixin,b.optionalMerge(d("WASmaxOutMessagePublishMulticastMixin").mergeMulticastMixin,b.optionalMerge(d("WASmaxOutMessagePublishNoExtraFanoutMixin").mergeNoExtraFanoutMixin,b.optionalMerge(d("WASmaxOutMessagePublishDeviceIdentityMixin").mergeDeviceIdentityMixin,d("WASmaxJsx").smax("message",null),c),e),f),g),h),i),j),k),l),m),n),o),p),q),r),s),t),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseMixin=a}),98);
__d("WASmaxOutMessagePublishGroupInviteTargetMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaGroupInvite;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{group_invite:d("WAWap").GROUP_JID(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupInviteTargetMixin=a}),98);
__d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("bot",{type:"feedback"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotFeedbackMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encCount;a=d("WASmaxJsx").smax("enc",{count:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncRetryMixin=a}),98);
__d("WASmaxOutMessagePublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.encElementValue;a=d("WASmaxJsx").smax("enc",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncPayloadMixin=a}),98);
__d("WASmaxOutMessagePublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encType;b=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:d("WAWap").CUSTOM_STRING(b)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion2Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion2Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encV;a=d("WASmaxJsx").smax("enc",{v:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersionFutureproofMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersionBot",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.encVersionFutureproof)return d("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(a,b.encVersionFutureproof);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersionBot=a}),98);
__d("WASmaxOutMessagePublishMediaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encMediatype;a=d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotRequestMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encRetryMixinArgs,e=a.encTypeIndividualMixinArgs,f=a.mediaTypeMixinArgs;a=a.encVersionBotArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),c),e),f),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotRequestMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"media"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"text"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeTextMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeTextMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrMediaMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBotMetricsEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaOrigin;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMetricsEntryPointMixin=a}),98);
__d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botLocalAutomatedType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{local_automated_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotLocalAutomatedTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotMessageTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMessageTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadOrigin;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{thread_origin:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotMetricsThreadEntryPointMixin=a}),98);
__d("WASmaxOutMessagePublishBotPersonaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botPersonaType;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{persona_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotPersonaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botFeedbackRequested;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{feedback_requested:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBusinessBotMessageFeedbackRequestedMixin=a}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.botBizBot;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("bot",{biz_bot:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBusinessBotMessageMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeEventMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaEventType;a=d("WASmaxJsx").smax("message",{type:"event"},d("WASmaxJsx").smax("meta",{event_type:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeEventMixin=a}),98);
__d("WASmaxOutMessagePublishProductListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"product_list"})));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeProductListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectListMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.listV;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("biz",null,d("WASmaxJsx").smax("list",{type:"single_select",v:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSingleSelectListMixin=a}),98);
__d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishProductListMixin","WASmaxOutMessagePublishSingleSelectListMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.singleSelectList)return d("WASmaxOutMessagePublishSingleSelectListMixin").mergeSingleSelectListMixin(a,b.singleSelectList);if(b.isProductList)return d("WASmaxOutMessagePublishProductListMixin").mergeProductListMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeSingleSelectOrProductListMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeListFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"list"}));return a}function i(a){var b=a.toCount;a=a.singleSelectOrProductListMixinGroupArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD_COUNT(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeListFanoutParticipantsTo=h;g.mergeContentTypeListFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishLiveLocationModeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaLivelocMode;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{liveloc_mode:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLiveLocationModeMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)}));return a}function i(a){var b=a.toArgs;a=a.liveLocationModeMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b)))),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeLiveLocationFanoutParticipantsTo=h;g.mergeContentTypeLiveLocationFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMedianotifyMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"medianotify"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMedianotifyMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeMedia)return d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeMediaOrMedianotifyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishSenderContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.senderContentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("sender_content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSenderContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutDeprecatedParticipantsTo=h;g.mergeContentTypeMediaFanoutDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.hasEncStickerTypeAvatar;a=a.encNativeFlowName;b=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:d("WAWap").CUSTOM_STRING(b),sticker_type:d("WASmaxAttrs").OPTIONAL_LITERAL("avatar",c),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return b}function i(a){var b=a.toArgs,c=a.senderContentBindingMixinArgs;a=a.contentTypeMediaOrMedianotifyMixinGroupArgs;b=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").HOMOGENEOUS_CHILD(h,b))),c),a);return b}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeContentTypeMediaFanoutParticipantsTo=h;g.mergeContentTypeMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollCreationMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaContenttype;a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"creation",contenttype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollCreationMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"result_snapshot"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollResultSnapshotMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePollVoteMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaContenttype;a=d("WASmaxJsx").smax("message",{type:"poll"},d("WASmaxJsx").smax("meta",{polltype:"vote",contenttype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePollVoteMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeReactionMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"reaction"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeReactionMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypePayMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{type:"pay"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypePayMixin=a}),98);
__d("WASmaxOutMessagePublishPayNodeTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payType;a=d("WASmaxJsx").smax("pay",{type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayNodeTypeMixin=a}),98);
__d("WASmaxOutMessagePublishBasePayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPayNodeTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCountry,c=a.payVersion,e=a.payIsFirstSend;b=d("WASmaxOutMessagePublishPayNodeTypeMixin").mergePayNodeTypeMixin(d("WASmaxJsx").smax("pay",{country:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),version:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,c),is_first_send:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,e)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBasePayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishLegacyAmountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.payCurrency;a=a.payAmount;b=d("WASmaxJsx").smax("pay",{currency:d("WAWap").CUSTOM_STRING(b),amount:d("WAWap").CUSTOM_STRING(a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLegacyAmountMixin=a}),98);
__d("WASmaxOutMessagePublishMoneyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.moneyValue,c=a.moneyOffset;a=a.moneyCurrency;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("money",{value:d("WAWap").CUSTOM_STRING(b),offset:d("WAWap").CUSTOM_STRING(c),currency:d("WAWap").CUSTOM_STRING(a)}));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMoneyMixin=a}),98);
__d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WASmaxOutMessagePublishLegacyAmountMixin","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("amount",null),a);return a}function i(a){var b=a.amountArgs,c=a.payCredentialId,e=a.payDeviceId,f=a.payRequestId,g=a.legacyAmountMixinArgs;c=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLegacyAmountMixin").mergeLegacyAmountMixin,d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{"credential-id":d("WAWap").CUSTOM_STRING(c),"device-id":d("WAWap").CUSTOM_STRING(e),"request-id":d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,f)},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a),g);return c}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBaseIndividualPublishSendPayNodeAmount=h;g.mergeBaseIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishInstallmentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("due_amount",null),a);return a}function i(a){a=d("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(d("WASmaxJsx").smax("interest",null),a);return a}function j(a){var b=a.dueAmountArgs,c=a.interestArgs,e=a.installmentMaxCount;a=a.installmentSelectedCount;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("installment",{max_count:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,e),selected_count:d("WAWap").INT(a)},d("WASmaxChildren").OPTIONAL_CHILD(h,b),d("WASmaxChildren").OPTIONAL_CHILD(i,c)));return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeInstallmentInstallmentDueAmount=h;g.makeInstallmentInstallmentInterest=i;g.mergeInstallmentMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiaryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.beneficiaryName,e=a.beneficiaryAddressLine1,f=a.beneficiaryAddressLine2,g=a.beneficiaryCity,h=a.beneficiaryState,i=a.beneficiaryPhoneNumber,j=a.beneficiaryCountry;a=a.beneficiaryPostalCode;e=d("WASmaxJsx").smax("beneficiary",{name:(b=d("WAWap")).CUSTOM_STRING(c),address_line1:b.CUSTOM_STRING(e),address_line2:(c=d("WASmaxAttrs")).OPTIONAL(b.CUSTOM_STRING,f),city:c.OPTIONAL(b.CUSTOM_STRING,g),state:c.OPTIONAL(b.CUSTOM_STRING,h),phone_number:c.OPTIONAL(b.CUSTOM_STRING,i),country:b.CUSTOM_STRING(j),postal_code:b.CUSTOM_STRING(a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBeneficiaryMixin=a}),98);
__d("WASmaxOutMessagePublishBeneficiariesMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiaryMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiaryMixin").mergeBeneficiaryMixin(d("WASmaxJsx").smax("beneficiary",null),a);return a}function i(a){a=a.beneficiaryArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,5));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeBeneficiariesBeneficiary=h;g.mergeBeneficiariesMixin=a}),98);
__d("WASmaxOutMessagePublishOrderInPaymentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiariesMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishBeneficiariesMixin").mergeBeneficiariesMixin(d("WASmaxJsx").smax("beneficiaries",null),a);return a}function i(a){var b,c=a.beneficiariesArgs,e=a.orderId,f=a.orderMessageId,g=a.orderPaymentConfigId;a=a.orderType;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("order",{id:(b=d("WAWap")).CUSTOM_STRING(e),message_id:d("WASmaxAttrs").OPTIONAL(b.STANZA_ID,f),payment_config_id:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,g),type:d("WASmaxAttrs").OPTIONAL(b.CUSTOM_STRING,a)},d("WASmaxChildren").OPTIONAL_CHILD(h,c)));return e}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeOrderInPaymentOrderBeneficiaries=h;g.mergeOrderInPaymentMixin=a}),98);
__d("WASmaxOutMessagePublishPaymentInitiatorMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPaymentInitiator;a=d("WASmaxJsx").smax("smax$any",{payment_initiator:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePaymentInitiatorMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishInstallmentMixin","WASmaxOutMessagePublishOrderInPaymentMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.orderInPaymentMixinArgs,c=a.paymentInitiatorMixinArgs;a=a.installmentMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishInstallmentMixin").mergeInstallmentMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishOrderInPaymentMixin").mergeOrderInPaymentMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"}),b),c),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("pay",{"transaction-type":"p2p"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isBRPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin").mergeBRPublishSendPayNodeP2PMixin(a);if(b.bRPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin").mergeBRPublishSendPayNodeP2MMixin(a,b.bRPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishBRSendPayEloNodeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.eloDeviceSignature,e=a.eloWalletSignature,f=a.eloChallengeId;a=a.eloCardholderVerificationMethod;c=d("WASmaxJsx").smax("pay",null,d("WASmaxJsx").smax("elo",{device_signature:(b=d("WAWap")).CUSTOM_STRING(c),wallet_signature:b.CUSTOM_STRING(e),challenge_id:b.CUSTOM_STRING(f),cardholder_verification_method:b.CUSTOM_STRING(a)}));return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRSendPayEloNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.payId,e=a.payPaymentRails,f=a.payTrustedDeviceInfo,g=a.payNonce,h=a.bRSendPayEloNodeMixinArgs;a=a.bRPublishSendPayNodeP2POrMMixinGroupArgs;c=d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,d("WASmaxJsx").smax("pay",{id:(b=d("WAWap")).CUSTOM_STRING(c),"payment-rails":b.CUSTOM_STRING(e),"trusted-device-info":b.CUSTOM_STRING(f),nonce:b.CUSTOM_STRING(g)}),h),a);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBRPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishUPILiteDetailsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.upiLiteDetailsLiteReferenceNumber,e=a.upiLiteDetailsLiteArqc,f=a.upiLiteDetailsLiteTimestamp;a=a.upiLiteDetailsLitePurpose;c=d("WASmaxJsx").smax("upi_lite_details",{lite_reference_number:(b=d("WAWap")).CUSTOM_STRING(c),lite_arqc:b.CUSTOM_STRING(e),lite_timestamp:b.INT(f),lite_purpose:b.CUSTOM_STRING(a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUPILiteDetailsMixin=a}),98);
__d("WASmaxOutMessagePublishOrderMessageMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.orderOrderId,e=a.orderOrderMessageId,f=a.orderExpiryTs,g=a.orderOrderType;a=a.orderDiscountProgramName;e=d("WASmaxJsx").smax("order",{"order-id":(b=d("WAWap")).CUSTOM_STRING(c),"order-message-id":(c=d("WASmaxAttrs")).OPTIONAL(b.CUSTOM_STRING,e),"expiry-ts":c.OPTIONAL(b.INT,f),"order-type":c.OPTIONAL(b.CUSTOM_STRING,g),"discount-program-name":c.OPTIONAL(b.CUSTOM_STRING,a)});return e}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeOrderMessageMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishOrderMessageMixin","WASmaxOutMessagePublishPaymentInitiatorMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.orderArgs;a=a.paymentLinkArgs;b=d("WASmaxJsx").smax("upi",null,d("WASmaxChildren").OPTIONAL_CHILD(i,b),d("WASmaxChildren").OPTIONAL_CHILD(j,a));return b}function i(a){a=d("WASmaxOutMessagePublishOrderMessageMixin").mergeOrderMessageMixin(d("WASmaxJsx").smax("order",null),a);return a}function j(a){var b=a.paymentLinkOrderId;a=a.paymentLinkMessageId;b=d("WASmaxJsx").smax("payment_link",{order_id:d("WAWap").CUSTOM_STRING(b),message_id:d("WAWap").CUSTOM_STRING(a)});return b}function k(a){var b=a.upiArgs;a=a.paymentInitiatorMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,d("WASmaxJsx").smax("pay",{"transaction-type":"p2m"},d("WASmaxChildren").OPTIONAL_CHILD(h,b)),a);return b}function a(a,b){b=k(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeP2MUpi=h;g.makeUPIPublishSendPayNodeP2MUpiOrder=i;g.makeUPIPublishSendPayNodeP2MUpiPaymentLink=j;g.mergeUPIPublishSendPayNodeP2MMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasPayTransactionTypeP2P;a=d("WASmaxJsx").smax("pay",{"transaction-type":d("WASmaxAttrs").OPTIONAL_LITERAL("p2p",a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUPIPublishSendPayNodeP2PMixin=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.uPIPublishSendPayNodeP2P)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin").mergeUPIPublishSendPayNodeP2PMixin(a,b.uPIPublishSendPayNodeP2P);if(b.uPIPublishSendPayNodeP2M)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin").mergeUPIPublishSendPayNodeP2MMixin(a,b.uPIPublishSendPayNodeP2M);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeUPIPublishSendPayNodeP2POrMMixinGroup=a}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishUPILiteDetailsMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.upiToken;a=d("WASmaxJsx").smax("upi",{token:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return a}function i(a){a=d("WASmaxOutMessagePublishUPILiteDetailsMixin").mergeUPILiteDetailsMixin(d("WASmaxJsx").smax("upi_lite_details",null),a);return a}function j(a){var b,c,e=a.upiArgs,f=a.upiLiteDetailsArgs,g=a.payId,j=a.payMpin,k=a.payReceiverVpa,l=a.payReceiverVpaId,m=a.paySenderVpa,n=a.paySenderVpaId,o=a.paySeqNo,p=a.payUpiBankInfo,q=a.payMode,r=a.payPurposeCode,s=a.payMcc,t=a.payRefId,u=a.payDeviceSsid,v=a.payNote;a=a.uPIPublishSendPayNodeP2POrMMixinGroupArgs;g=d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup").mergeUPIPublishSendPayNodeP2POrMMixinGroup(d("WASmaxJsx").smax("pay",{id:(b=d("WASmaxAttrs")).OPTIONAL((c=d("WAWap")).CUSTOM_STRING,g),mpin:b.OPTIONAL(c.CUSTOM_STRING,j),"receiver-vpa":c.CUSTOM_STRING(k),"receiver-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,l),"sender-vpa":c.CUSTOM_STRING(m),"sender-vpa-id":b.OPTIONAL(c.CUSTOM_STRING,n),"seq-no":c.CUSTOM_STRING(o),"upi-bank-info":c.CUSTOM_STRING(p),mode:b.OPTIONAL(c.CUSTOM_STRING,q),"purpose-code":b.OPTIONAL(c.CUSTOM_STRING,r),mcc:b.OPTIONAL(c.CUSTOM_STRING,s),"ref-id":b.OPTIONAL(c.CUSTOM_STRING,t),device_ssid:b.OPTIONAL(c.CUSTOM_STRING,u),note:b.OPTIONAL(c.CUSTOM_STRING,v)},d("WASmaxChildren").OPTIONAL_CHILD(h,e),d("WASmaxChildren").OPTIONAL_CHILD(i,f)),a);return g}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeUPIPublishSendPayNodeUpi=h;g.makeUPIPublishSendPayNodeUpiLiteDetails=i;g.mergeUPIPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.bRPublishSendPayNode)return d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin").mergeBRPublishSendPayNodeMixin(a,b.bRPublishSendPayNode);if(b.uPIPublishSendPayNode)return d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin").mergeUPIPublishSendPayNodeMixin(a,b.uPIPublishSendPayNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeBRPublishOrUPIPublishSendPayNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.bRPublishOrUPIPublishSendPayNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup").mergeBRPublishOrUPIPublishSendPayNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIntegrationPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIntegrationPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin").mergeIntegrationPublishPayNodeMixin(d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin").mergeBaseIndividualPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualNonNoviPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin").mergeIndividualNonNoviPublishSendPayNodeMixin(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishSendPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.paySender,c=a.payExpiryTs,e=a.payRequestId;b=d("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(d("WASmaxJsx").smax("pay",{sender:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,b),"expiry-ts":d("WAWap").CUSTOM_STRING(c),"request-id":d("WAWap").CUSTOM_STRING(e)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRequestPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishPayInviteNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.payService;a=d("WASmaxJsx").smax("pay",{type:"invite",service:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePayInviteNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIndividualRequestPayNodeMixin","WASmaxOutMessagePublishPayInviteNodeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualPublishSendPayNode)return d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin").mergeIndividualPublishSendPayNodeMixin(a,b.individualPublishSendPayNode);if(b.individualRequestPayNode)return d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin").mergeIndividualRequestPayNodeMixin(a,b.individualRequestPayNode);if(b.payInviteNode)return d("WASmaxOutMessagePublishPayInviteNodeMixin").mergePayInviteNodeMixin(a,b.payInviteNode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroupArgs;a=d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup").mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup(d("WASmaxJsx").smax("pay",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualPublishPayNodeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishPayNodeMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin").mergeIndividualPublishPayNodeMixin(d("WASmaxJsx").smax("pay",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualPublishPayNodeMessageMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypePayMixin","WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.individualIndividualPublishPayNodeMessageMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin").mergeIndividualIndividualPublishPayNodeMessageMixin,d("WASmaxOutMessagePublishContentTypePayMixin").mergeContentTypePayMixin(d("WASmaxJsx").smax("message",null)),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualContentTypePayIndividualMixin=a}),98);
__d("WASmaxOutMessagePublishContentFanoutMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListFanoutMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin","WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeMediaFanoutMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaFanout)return d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin").mergeContentTypeMediaFanoutMixin(a,b.contentTypeMediaFanout);if(b.contentTypeMediaFanoutDeprecated)return d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin").mergeContentTypeMediaFanoutDeprecatedMixin(a,b.contentTypeMediaFanoutDeprecated);if(b.contentTypeLiveLocationFanout)return d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin").mergeContentTypeLiveLocationFanoutMixin(a,b.contentTypeLiveLocationFanout);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeListFanout)return d("WASmaxOutMessagePublishContentTypeListFanoutMixin").mergeContentTypeListFanoutMixin(a,b.contentTypeListFanout);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.contentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a,b.contentTypePollCreation);if(b.contentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a,b.contentTypePollVote);if(b.isContentTypePollResultSnapshot)return d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(a);if(b.isContentTypeMedianotify)return d("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(a);if(b.contentTypeEvent)return d("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(a,b.contentTypeEvent);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentFanoutMixins=a}),98);
__d("WASmaxOutMessagePublishLidChatOriginMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:"ctwa"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLidChatOriginMixin=a}),98);
__d("WASmaxOutMessagePublishMsgMetaOriginMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaOrigin;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{origin:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMsgMetaOriginMixin=a}),98);
__d("WASmaxOutMessagePublishTDeprecatedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageT;a=d("WASmaxJsx").smax("message",{t:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishToContentBindingMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid;a=a.contentBindingElementValue;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxJsx").smax("content_binding",null,a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishAvatarStickerTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{sticker_type:"avatar"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAvatarStickerTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encMediatype,c=a.encNativeFlowName;a=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxJsx").smax("enc",{mediatype:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion3Mixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{v:"3"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersion3Mixin=a}),98);
__d("WASmaxOutMessagePublishEncVersion",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersion3Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isEncVersion2)return d("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(a);if(b.isEncVersion3)return d("WASmaxOutMessagePublishEncVersion3Mixin").mergeEncVersion3Mixin(a);if(b.encVersionFutureproof)return d("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(a,b.encVersionFutureproof);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncVersion=a}),98);
__d("WASmaxOutMessagePublishToDeviceMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encTypeIndividualMixinArgs,e=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersionArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").JID(b)},d("WASmaxOutMessagePublishEncVersion").mergeEncVersion(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),c),e),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeToDeviceMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentFanoutMixins","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WASmaxOutMessagePublishTDeprecatedMixin","WASmaxOutMessagePublishToContentBindingMixin","WASmaxOutMessagePublishToDeviceMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toContentBindingMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishToContentBindingMixin").mergeToContentBindingMixin,d("WASmaxOutMessagePublishToDeviceMixin").mergeToDeviceMixin(d("WASmaxJsx").smax("to",null),a),b);return a}function a(){var a=d("WASmaxJsx").smax("enc",null);return a}function i(a){var b,c=a.toArgs,e=a.messageTo,f=a.tDeprecatedMixinArgs,g=a.botMessageTypeMixinArgs,i=a.businessBotMessageMixinArgs,j=a.botMetricsEntryPointMixinArgs,k=a.botMetricsThreadEntryPointMixinArgs,l=a.msgMetaOriginMixinArgs,m=a.hasLidChatOrigin,n=a.botLocalAutomatedTypeMixinArgs,o=a.businessBotMessageFeedbackRequestedMixinArgs,p=a.botPersonaTypeMixinArgs;a=a.contentFanoutMixinsArgs;b=d("WASmaxOutMessagePublishContentFanoutMixins").mergeContentFanoutMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishTDeprecatedMixin").mergeTDeprecatedMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(e)},d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(h,c,1,1997))),f),g),i),j),k),l),m),n),o),p),a);return b}function b(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualIndividualFanoutParticipantsTo=h;g.makeIndividualIndividualFanoutEnc=a;g.mergeIndividualIndividualFanoutMixin=b}),98);
__d("WASmaxOutMessagePublishEncListMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("enc",{mediatype:"list"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncListMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeListMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncListMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.singleSelectOrProductListMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncListMixin").mergeEncListMixin(d("WASmaxJsx").smax("enc",null)))),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeListMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationDeprecatedMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encDuration;a=d("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncLiveLocationMixin=a}),98);
__d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin","WASmaxOutMessagePublishEncLiveLocationMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encLiveLocation)return d("WASmaxOutMessagePublishEncLiveLocationMixin").mergeEncLiveLocationMixin(a,b.encLiveLocation);if(b.encLiveLocationDeprecated)return d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin").mergeEncLiveLocationDeprecatedMixin(a,b.encLiveLocationDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup","WASmaxOutMessagePublishLiveLocationModeMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.liveLocationModeMixinArgs;a=a.encLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroupArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup").mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a))),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeLiveLocationSingleMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encNativeFlowName,c=a.hasAvatarStickerType;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,d("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin(d("WASmaxJsx").smax("enc",{native_flow_name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b)}),a),c);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncMediaTypeMixin=a}),98);
__d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncMediaTypeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.encMediaType)return d("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin(a,b.encMediaType);if(b.encMediaTypeDeprecated)return d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin(a,b.encMediaTypeDeprecated);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup=a}),98);
__d("WASmaxOutMessagePublishContentTypeMediaSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.senderContentBindingMixinArgs,c=a.contentTypeMediaOrMedianotifyMixinGroupArgs;a=a.encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs;a=d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup").mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup(d("WASmaxJsx").smax("enc",null),a)),b),c);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeContentTypeMediaSingleMixin=a}),98);
__d("WASmaxOutMessagePublishContentMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListMixin","WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin","WASmaxOutMessagePublishContentTypeMediaSingleMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.contentTypeMediaSingle)return d("WASmaxOutMessagePublishContentTypeMediaSingleMixin").mergeContentTypeMediaSingleMixin(a,b.contentTypeMediaSingle);if(b.contentTypeLiveLocationSingle)return d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin").mergeContentTypeLiveLocationSingleMixin(a,b.contentTypeLiveLocationSingle);if(b.individualContentTypePayIndividual)return d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(a,b.individualContentTypePayIndividual);if(b.contentTypeList)return d("WASmaxOutMessagePublishContentTypeListMixin").mergeContentTypeListMixin(a,b.contentTypeList);if(b.isContentTypeReaction)return d("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(a);if(b.contentTypePollCreation)return d("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(a,b.contentTypePollCreation);if(b.contentTypePollVote)return d("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(a,b.contentTypePollVote);if(b.isContentTypePollResultSnapshot)return d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(a);if(b.contentTypeEvent)return d("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(a,b.contentTypeEvent);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentMixins=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryToPeerMixin=a}),98);
__d("WASmaxOutMessagePublishRetryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageT;a=a.encRetryMixinArgs;b=d("WASmaxJsx").smax("message",{t:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,d("WASmaxJsx").smax("enc",null),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin","WASmaxOutMessagePublishRetryMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.individualIndividualRetryToPeerMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin").mergeIndividualIndividualRetryToPeerMixin,d("WASmaxOutMessagePublishRetryMixin").mergeRetryMixin(d("WASmaxJsx").smax("message",null),a),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualRetryMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.contentBindingElementValue;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("content_binding",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleContentBindingMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WASmaxOutMessagePublishIndividualIndividualRetryMixin","WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.messageTo,e=a.individualIndividualRetryMixinArgs,f=a.individualIndividualSingleContentBindingMixinArgs,g=a.botMessageTypeMixinArgs,h=a.businessBotMessageMixinArgs,i=a.botMetricsEntryPointMixinArgs,j=a.botMetricsThreadEntryPointMixinArgs,k=a.msgMetaOriginMixinArgs,l=a.hasLidChatOrigin,m=a.botLocalAutomatedTypeMixinArgs,n=a.businessBotMessageFeedbackRequestedMixinArgs,o=a.botPersonaTypeMixinArgs,p=a.contentMixinsArgs,q=a.encTypeIndividualMixinArgs,r=a.encMediaTypeDeprecatedMixinArgs;a=a.encVersionArgs;c=d("WASmaxOutMessagePublishContentMixins").mergeContentMixins((b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,b.optionalMerge(d("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleContentBindingMixin").mergeIndividualIndividualSingleContentBindingMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualRetryMixin").mergeIndividualIndividualRetryMixin,d("WASmaxJsx").smax("message",{to:d("WAWap").JID(c)},d("WASmaxOutMessagePublishEncVersion").mergeEncVersion(b.optionalMerge(d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,d("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxJsx").smax("enc",null),q),r),a)),e),f),g),h),i),j),k),l),m),n),o),p);return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualIndividualSingleMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);if(b.botMetricsEntryPoint)return d("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin(a,b.botMetricsEntryPoint);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotFeedbackMessageTypeMixin","WASmaxOutMessagePublishBotRequestMixin","WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup","WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.messageTo,c=a.contentTypeTextOrMediaMixinGroupArgs,e=a.individualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroupArgs,f=a.hasBotFeedbackMessageType;a=a.botRequestMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup").mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup,d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup").mergeContentTypeTextOrMediaMixinGroup(d("WASmaxJsx").smax("message",{to:d("WAWap").USER_JID(b)},d("WASmaxMixins").optionalMerge(d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin").mergeBotFeedbackMessageTypeMixin,d("WASmaxJsx").smax("bot",null,d("WASmaxOutMessagePublishBotRequestMixin").mergeBotRequestMixin(d("WASmaxJsx").smax("to",null),a)),f)),c),e);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualBotRequestMessageMixin=a}),98);
__d("WASmaxOutMessagePublishBotResponseMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.botEditTargetId,e=a.botSenderTimestampMs,f=a.botEdit;a=a.hasBotTypeVoice;c=d("WASmaxJsx").smax("bot",{edit_target_id:(b=d("WASmaxAttrs")).OPTIONAL(d("WAWap").STANZA_ID,c),sender_timestamp_ms:b.OPTIONAL(d("WAWap").INT,e),edit:b.OPTIONAL(d("WAWap").CUSTOM_STRING,f),type:b.OPTIONAL_LITERAL("voice",a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotResponseMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin"],(function(a,b,c,d,e,f,g){function h(a){a=a.toCount;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD_COUNT(i,a,2,2));return a}function i(){var a=d("WASmaxJsx").smax("to",null,d("WASmaxJsx").smax("enc",{mediatype:"image"}));return a}function j(a){a=a.participantsArgs;a=d("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(d("WASmaxJsx").smax("message",null,d("WASmaxChildren").OPTIONAL_CHILD(h,a)));return a}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualContentTypeBotResponseMediaFanoutParticipants=h;g.makeIndividualContentTypeBotResponseMediaFanoutParticipantsTo=i;g.mergeIndividualContentTypeBotResponseMediaFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isContentTypeText)return d("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(a);if(b.individualContentTypeBotResponseMediaFanout)return d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin").mergeIndividualContentTypeBotResponseMediaFanoutMixin(a,b.individualContentTypeBotResponseMediaFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:"msmsg"}),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeMessageSecretMessageMixin=a}),98);
__d("WASmaxOutMessagePublishMessageTargetMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.metaTargetId,e=a.metaTargetSenderJid,f=a.metaTargetChatJid;a=a.metaTargetChatJidLid;c=d("WASmaxJsx").smax("meta",{target_id:(b=d("WAWap")).STANZA_ID(c),target_sender_jid:d("WASmaxAttrs").OPTIONAL(b.USER_JID,e),target_chat_jid:d("WASmaxAttrs").OPTIONAL(b.JID,f),target_chat_jid_lid:d("WASmaxAttrs").OPTIONAL(b.JID,a)});return c}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageTargetMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotResponseMixin","WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup","WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMessageTargetMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.toArgs;a=d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(i,a,2,2));return a}function i(a){a=a.toJid;a=d("WASmaxJsx").smax("to",{jid:d("WAWap").USER_JID(a)});return a}function j(a){var b,c=a.participantsArgs,e=a.messageTo,f=a.contentTypeTextOrIndividualBotResponseMediaFanoutMixinGroupArgs,g=a.botResponseMixinArgs,i=a.messageTargetMixinArgs,j=a.encTypeMessageSecretMessageMixinArgs;a=a.encVersionBotArgs;e=d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup").mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup((b=d("WASmaxJsx")).smax("message",{to:d("WAWap").USER_JID(e)},d("WASmaxOutMessagePublishBotResponseMixin").mergeBotResponseMixin(b.smax("bot",null),g),d("WASmaxOutMessagePublishMessageTargetMixin").mergeMessageTargetMixin(b.smax("meta",null),i),d("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin").mergeEncTypeMessageSecretMessageMixin(b.smax("enc",null),j),a),d("WASmaxChildren").OPTIONAL_CHILD(h,c)),f);return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeIndividualBotResponseFanoutParticipants=h;g.makeIndividualBotResponseFanoutParticipantsTo=i;g.mergeIndividualBotResponseFanoutMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualBotRequestMessageMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.individualBotResponseFanout)return d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin").mergeIndividualBotResponseFanoutMixin(a,b.individualBotResponseFanout);if(b.individualBotRequestMessage)return d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin").mergeIndividualBotRequestMessageMixin(a,b.individualBotRequestMessage);if(b.individualIndividualSingle)return d("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(a,b.individualIndividualSingle);if(b.individualIndividualFanout)return d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(a,b.individualIndividualFanout);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup=a}),98);
__d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipient;a=d("WASmaxJsx").smax("message",{recipient:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIndividualRecipientDeprecaredMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"1"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessageEditMixin=a}),98);
__d("WASmaxOutMessagePublishMessagePinMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"2"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMessagePinMixin=a}),98);
__d("WASmaxOutMessagePublishRevokeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",{edit:"7"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRevokeMixin=a}),98);
__d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishMessageEditMixin","WASmaxOutMessagePublishMessagePinMixin","WASmaxOutMessagePublishRevokeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isMessageEdit)return d("WASmaxOutMessagePublishMessageEditMixin").mergeMessageEditMixin(a);if(b.isMessagePin)return d("WASmaxOutMessagePublishMessagePinMixin").mergeMessagePinMixin(a);if(b.isRevoke)return d("WASmaxOutMessagePublishRevokeMixin").mergeRevokeMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeMessageEditOrMessagePinOrRevokeMixinGroup=a}),98);
__d("WASmaxOutMessagePublishMetaDestinationIdMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaDestinationId;a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{destination_id:d("WAWap").CUSTOM_STRING(a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMetaDestinationIdMixin=a}),98);
__d("WASmaxOutMessagePublishPeerRecipientUsernameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPeerRecipientUsername;a=d("WASmaxJsx").smax("smax$any",{peer_recipient_username:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerRecipientUsernameMixin=a}),98);
__d("WASmaxOutMessagePublishPeerRecipientLIDMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPeerRecipientLid;a=d("WASmaxJsx").smax("smax$any",{peer_recipient_lid:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerRecipientLIDMixin=a}),98);
__d("WASmaxOutMessagePublishPeerRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyPeerRecipientPn;a=d("WASmaxJsx").smax("smax$any",{peer_recipient_pn:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerRecipientPNMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.messageRecipientPn;a=d("WASmaxJsx").smax("message",{recipient_pn:d("WAWap").JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRecipientPNMixin=a}),98);
__d("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishPeerRecipientLIDMixin","WASmaxOutMessagePublishPeerRecipientPNMixin","WASmaxOutMessagePublishRecipientPNMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.recipientPN)return d("WASmaxOutMessagePublishRecipientPNMixin").mergeRecipientPNMixin(a,b.recipientPN);if(b.peerRecipientPN)return d("WASmaxOutMessagePublishPeerRecipientPNMixin").mergePeerRecipientPNMixin(a,b.peerRecipientPN);if(b.peerRecipientLID)return d("WASmaxOutMessagePublishPeerRecipientLIDMixin").mergePeerRecipientLIDMixin(a,b.peerRecipientLID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup=a}),98);
__d("WASmaxOutMessagePublishStatusMentionMessageMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{is_status_mention:"true"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeStatusMentionMessageMixin=a}),98);
__d("WASmaxOutMessagePublishPrivacyTokenContentsMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePrivacyTokenContentsMixin=a}),98);
__d("WASmaxOutMessagePublishTCTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPrivacyTokenContentsMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.tctokenT;a=a.privacyTokenContentsMixinArgs;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutMessagePublishPrivacyTokenContentsMixin").mergePrivacyTokenContentsMixin(d("WASmaxJsx").smax("tctoken",{t:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,b)}),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTCTokenMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagEnumMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.metaThreadType;a=d("WASmaxJsx").smax("meta",{thread_type:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagLegacyMixin=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishThreadTypeTagEnumMixin","WASmaxOutMessagePublishThreadTypeTagLegacyMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.threadTypeTagEnum)return d("WASmaxOutMessagePublishThreadTypeTagEnumMixin").mergeThreadTypeTagEnumMixin(a,b.threadTypeTagEnum);if(b.threadTypeTagLegacy)return d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin").mergeThreadTypeTagLegacyMixin(a,b.threadTypeTagLegacy);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeThreadTypeTagEnumOrLegacyMixinGroup=a}),98);
__d("WASmaxOutMessagePublishThreadTypeTagMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.threadTypeTagEnumOrLegacyMixinGroupArgs;a=d("WASmaxJsx").smax("message",null,d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup").mergeThreadTypeTagEnumOrLegacyMixinGroup(d("WASmaxJsx").smax("meta",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeThreadTypeTagMixin=a}),98);
__d("WASmaxOutMessagePublishViewOnceMetaAttributeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("message",null,d("WASmaxJsx").smax("meta",{view_once:"true"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeViewOnceMetaAttributeMixin=a}),98);
__d("WASmaxOutMessagePublishIndividualRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAppdataMetaAttributeMixin","WASmaxOutMessagePublishBaseMixin","WASmaxOutMessagePublishGroupInviteTargetMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup","WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin","WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup","WASmaxOutMessagePublishMetaDestinationIdMixin","WASmaxOutMessagePublishPeerRecipientUsernameMixin","WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup","WASmaxOutMessagePublishStatusMentionMessageMixin","WASmaxOutMessagePublishTCTokenMixin","WASmaxOutMessagePublishThreadTypeTagMixin","WASmaxOutMessagePublishViewOnceMetaAttributeMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.messageId,e=a.groupInviteTargetMixinArgs,f=a.threadTypeTagMixinArgs,g=a.peerRecipientUsernameMixinArgs,h=a.individualRecipientDeprecaredMixinArgs,i=a.appdataMetaAttributeMixinArgs,j=a.hasStatusMentionMessage,k=a.tCTokenMixinArgs,l=a.hasViewOnceMetaAttribute,m=a.metaDestinationIdMixinArgs,n=a.individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs,o=a.messageEditOrMessagePinOrRevokeMixinGroupArgs,p=a.recipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroupArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup").mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup,b.optionalMerge(d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup").mergeMessageEditOrMessagePinOrRevokeMixinGroup,d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup").mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup(b.optionalMerge(d("WASmaxOutMessagePublishMetaDestinationIdMixin").mergeMetaDestinationIdMixin,b.optionalMerge(d("WASmaxOutMessagePublishViewOnceMetaAttributeMixin").mergeViewOnceMetaAttributeMixin,b.optionalMerge(d("WASmaxOutMessagePublishTCTokenMixin").mergeTCTokenMixin,b.optionalMerge(d("WASmaxOutMessagePublishStatusMentionMessageMixin").mergeStatusMentionMessageMixin,b.optionalMerge(d("WASmaxOutMessagePublishAppdataMetaAttributeMixin").mergeAppdataMetaAttributeMixin,b.optionalMerge(d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin").mergeIndividualRecipientDeprecaredMixin,b.optionalMerge(d("WASmaxOutMessagePublishPeerRecipientUsernameMixin").mergePeerRecipientUsernameMixin,b.optionalMerge(d("WASmaxOutMessagePublishThreadTypeTagMixin").mergeThreadTypeTagMixin,b.optionalMerge(d("WASmaxOutMessagePublishGroupInviteTargetMixin").mergeGroupInviteTargetMixin,d("WASmaxOutMessagePublishBaseMixin").mergeBaseMixin(d("WASmaxJsx").smax("message",{id:d("WAWap").STANZA_ID(c)}),a),e),f),g),h),i),j),k),l),m),n),o),p);return b}g.makeIndividualRequest=a}),98);
__d("WASmaxMessagePublishIndividualRPC",["WAComms","WASmaxInMessagePublishIndividualResponseNegative","WASmaxInMessagePublishIndividualResponseSuccess","WASmaxOutMessagePublishIndividualRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutMessagePublishIndividualRequest").makeIndividualRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInMessagePublishIndividualResponseNegative").parseIndividualResponseNegative(b,a);if(c.success)return{name:"IndividualResponseNegative",value:c.value};b=d("WASmaxInMessagePublishIndividualResponseSuccess").parseIndividualResponseSuccess(b,a);if(b.success)return{name:"IndividualResponseSuccess",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Individual",{Negative:c,Success:b}))});return h.apply(this,arguments)}g.sendIndividualRPC=a}),98);
__d("WASendMsgRPC",["WADeprecatedSendIq","WADeprecatedWapParser","WAFrankingTypes","WAGetDeviceIdentityMixin","WAJids","WALogger","WAParseFranking","WASmaxMessagePublishIndividualRPC","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){f===void 0&&(f=!1);var g=d("WAJids").interpretAsGroupJid(a.protocolMsgId.chat),h=a.messageType.type==="text"&&a.messageType.invitedParticipantUserJid!=null;if(b.type==="direct_user"){var i={individualIndividualSingle:{messageTo:b.message.to,individualIndividualRetryMixinArgs:n(a.count,b.recipient),contentMixinsArgs:m(a,b.message),encTypeIndividualMixinArgs:o(b.message),encVersionArgs:p(b.message)}};i={messageId:a.externalId,deviceIdentityMixinArgs:d("WAGetDeviceIdentityMixin").getDeviceIdentityMixin(a.deviceIdentity),hasNoExtraFanout:a.messageType.isInvisible===!0?!0:null,messageEditOrMessagePinOrRevokeMixinGroupArgs:q(a.messageType),clientFrankingTagMixinArgs:c!=null&&c.frankingTag?{frankingTagElementValue:c.frankingTag}:null,hasMetaHideDecryptionPlaceholder:a.messageType.isInvisible===!0?!0:null,groupInviteTargetMixinArgs:h&&g!=null?{metaGroupInvite:g}:null,individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs:i,internalTestMixinArgs:f?{testConfig:"armadillo_express"}:null};e==null||e.addPoint("send_individual_rpc");i=(yield d("WASmaxMessagePublishIndividualRPC").sendIndividualRPC(i));if(i.name==="IndividualResponseSuccess"){var j;j=((j=i.value.deviceListStaleMixin)==null?void 0:j.phash)!=null?{type:"mismatch",local:null,server:i.value.deviceListStaleMixin.phash}:{type:"ok"};var s=i.value.serverFrankingTagMixin!=null&&c!=null?babelHelpers["extends"]({},c,{reportingTag:d("WAFrankingTypes").castToReportingTag(i.value.serverFrankingTagMixin.frankingReportingTagElementValue)}):null;return{type:"success",ts:d("WATimeUtils").castToUnixTime(i.value.t),phash:j,count:null,reportingMeta:s}}else{i.name;return{type:"error",errorCode:parseInt(i.value.error,10),backoff:parseInt((j=i.value.messageNackRetryAttributesMixin)==null?void 0:j.backoff,10),applicationError:(s=i.value.applicationNegativeAckMixin)==null?void 0:s.applicationError}}}j=a.messageType.isInvisible===!0?"false":d("WAWap").DROP_ATTR;i=b.participant!=null?d("WAWap").JID(b.participant):d("WAWap").DROP_ATTR;s=b.phash!=null&&b.type==="group"?d("WAWap").CUSTOM_STRING(b.phash):d("WAWap").DROP_ATTR;function t(){if(a.messageType.type==="text"&&a.messageType.isRevoked)return d("WAWap").CUSTOM_STRING("7");else if(a.messageType.type==="text"&&a.messageType.isEdit===!0)return d("WAWap").CUSTOM_STRING("1");return d("WAWap").DROP_ATTR}t=t();function u(){if(h&&g!=null)return d("WAWap").wap("meta",{"decrypt-fail":"hide",group_invite:d("WAWap").CUSTOM_STRING(g)});return a.messageType.isInvisible===!0||a.messageType.isEdit===!0?d("WAWap").wap("meta",{"decrypt-fail":"hide"}):null}u=u();f=f?d("WAWap").wap("test",{config:d("WAWap").CUSTOM_STRING("armadillo_express")}):null;var v=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null,w=(c==null?void 0:c.frankingTag)!=null?d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,c.frankingTag)):null,x=null;b.participants!=null&&(x=d("WAWap").wap("participants",null,b.participants.map(function(a){return k(a)})));var y=null;b.message!=null&&(y=k(b.message,!0));j=d("WAWap").wap("message",{device_fanout:j,edit:t,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:i,phash:s,to:d("WAWap").JID(b.messageTo),type:d("WAWap").CUSTOM_STRING(a.messageType.type)},u,w,x,y,v,f);r(a.externalId);e==null||e.addPoint("send_stanza_and_return_ack");t=(yield d("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(j,{id:a.externalId,"class":"message",from:b.messageTo,participant:b.participant!=null?b.participant:null}));e==null||e.addPoint("send_msg_ack_parser");i=l.parse(t);if(i.success){e==null||e.addPoint("send_msg_ack_parser_success");s=i.success;u=s.errorCode;w=s.applicationError;x=s.backoff;if(u==null){y=i.success;v=y.ts;f=y.phash;j=y.count;s=c!=null?babelHelpers["extends"]({},c,{reportingTag:(t=i.success.reportingMeta)==null?void 0:t.reportingTag}):null;return{type:"success",ts:v,phash:f==null||f===b.phash?{type:"ok"}:{type:"mismatch",local:b.phash,server:f},count:j,reportingMeta:s}}else{e==null||e.addPoint("send_msg_ack_parser_failed",{"int":{errorCode:u,applicationError:w}});return{type:"error",errorCode:u,applicationError:w,backoff:x}}}else return{type:"parsing_error"}});return j.apply(this,arguments)}function k(a,b){b===void 0&&(b=!1);var c=d("WAWap").wap("enc",{count:a.count!=null?d("WAWap").INT(a.count):d("WAWap").DROP_ATTR,mediatype:a.mediaType!=null?d("WAWap").CUSTOM_STRING(a.mediaType):d("WAWap").DROP_ATTR,type:d("WAWap").CUSTOM_STRING(a.type),v:d("WAWap").CUSTOM_STRING(a.v)},a.ciphertext);if(b||a.encType==="group")return c;else return d("WAWap").wap("to",{jid:d("WAWap").DEVICE_JID(a.to)},c)}var l=new(c("WADeprecatedWapParser"))("sendMsgAck",function(a){a.assertTag("ack");return{count:a.maybeAttrInt("count"),errorCode:a.maybeAttrInt("error"),phash:a.maybeAttrString("phash"),applicationError:a.maybeAttrInt("application_error"),ts:a.attrTime("t"),reportingMeta:d("WAParseFranking").parseFrankingNode(a.maybeChild("franking")),backoff:a.maybeAttrInt("backoff")}});function m(a,b){if(a.messageType.type==="reaction")return{isContentTypeReaction:!0};if(a.messageType.type==="text")return{isContentTypeText:!0};a.messageType.type;if(b.mediaType!=null){b={contentTypeMediaOrMedianotifyMixinGroupArgs:{isContentTypeMedia:!0},encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs:{encMediaType:{encMediatype:b.mediaType}}};return{contentTypeMediaSingle:b}}d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["WASendMsgRPC: Wrong media type: ",""])),a.messageType.mediaType);return{isContentTypeText:!0}}function n(a,b){a=a!=null?{encCount:a}:null;b=b!=null?{messageRecipient:b}:null;return{encRetryMixinArgs:a,individualIndividualRetryToPeerMixinArgs:b}}function o(a){return{encType:a.type,encElementValue:a.ciphertext}}function p(a){return a.v==="2"?{isEncVersion2:!0}:{isEncVersion3:!0}}function q(a){return a.type==="text"&&a.isRevoked?{isRevoke:!0}:null}function r(a){try{BigInt(a)}catch(b){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[WASendMsgRPC] Sending message with not allowed stanzaId: ",", error: ",""])),a,b)}}g.sendStanza=a;g.createEncWapNode=k}),98);
__d("WASendMsgInternal",["FBLogger","Promise","WABridge","WADevicesState","WAEncGroupMsg","WAEncUserMsg","WAGlobals","WAJids","WALogger","WAMarkSenderKeyAsSentApi","WAOdsEnums","WAQueryGroups","WAResultOrError","WASendMsgRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=10002,p=10009;function a(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;b.addPoint("encrypt_start",{string:{sentMessageType:a.messageType.isRevoked===!0?"revoke":a.messageType.type},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}});var f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(c){c=c.cryptoManager;return a.type==="chat"?w(a,b,2,{cryptoManager:c}):u(a,{cryptoManager:c},2)},{operationType:"encrypt",flush:!0}));b.addPoint("finish_encrypt",{string:{chatType:f.success?f.value.type:f.error}});if(f.success===!1)throw c("FBLogger")("wmi").mustfixThrow("Encryption failed %s",f.error);f=f.value;b.addPoint("sending_stanza_start",{string:{encryptionType:f.type},"int":{ciphertextByteLength:(e=(e=(e=f.message)==null||(e=e.ciphertext)==null?void 0:e.length)!=null?e:(e=f.participants)==null||(e=e[0].ciphertext)==null?void 0:e.length)!=null?e:0}});e=(yield d("WASendMsgRPC").sendStanza(a,f,a.reportingMeta,b));b.addPoint("sending_stanza_end",{bool:{wai:e.type==="success"}});return{serverResponse:e,encryption:f}});return q.apply(this,arguments)}function e(a,b,c){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f;e===void 0&&(e=!1);B(a,c);var g=e?3:2,h=function(b){return a.type==="chat"?w(a,c,g,{cryptoManager:b}):u(a,{cryptoManager:b},g)},i=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return h(a)},{operationType:"encrypt",flush:!0})),j=i.success?i.value.type:i.error;c.addPoint("finish_encrypt",{string:{chatType:j}});if(i.success===!1){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMsg Failed to encrypt message for "," message"])),j);return d("WAResultOrError").makeError({type:"encryption-error",isRetriable:!1})}i=i.value;c.addPoint("sending_stanza_start",{string:{encryptionType:i.type},"int":{ciphertextByteLength:(f=(f=(f=i.message)==null||(f=f.ciphertext)==null?void 0:f.length)!=null?f:(f=i.participants)==null||(f=f[0].ciphertext)==null?void 0:f.length)!=null?f:0}});f=(yield d("WASendMsgRPC").sendStanza(a,i,a.reportingMeta,c,e));c.addPoint("sending_stanza_end");if(f.type==="success"){c.addPoint("send_stanza_success");try{e=(yield (n||(n=b("Promise"))).all([x(a,i,f,c),z(i)]));e=e[0];c.addPoint("mark_sender_key_sent");return d("WAResultOrError").makeResult({baseKey:(i=i.message)==null?void 0:i.baseKey,reportingMeta:f.reportingMeta,serverTs:f.ts,meta:{pOrDhashMismatch:e}})}catch(a){c.addPoint("send_stanza_failed");throw a}}f.type;C(f,j,c);f.applicationError===o&&(yield d("WAGlobals").getDependencies().handleReachabilityErrorAdminMsg(a.chat));if(f.type==="parsing_error")return d("WAResultOrError").makeError({type:"result-parsing-error",isRetriable:!0});if(f.type==="error"){i=f.errorCode!=null&&f.errorCode>=500;if(i)return d("WAResultOrError").makeError({type:"retryable-error",backoff:f.backoff,isRetriable:!0});else return d("WAResultOrError").makeError({type:"non-retryable-error",applicationErrorCode:f.applicationError,errorCode:f.errorCode,isRetriable:!1})}return d("WAResultOrError").makeError({type:"unexpected-message-codepath",details:"impossible-server-error-result",isRetriable:!0,applicationErrorCode:f.applicationError})});return r.apply(this,arguments)}function s(a){d("WADevicesState").getDevicesState().reset([a]);return d("WADevicesState").getDevicesState().waitForUserDevices([a],"SendMsgUtil_recoverUser",!0)}function t(a){return d("WAJids").switchOnChatJidType(a,{interopUser:s,msgrUser:s,lidUser:s,phoneUser:s,group:function(a){return d("WAQueryGroups").queryGroups(null,{type:"array",groups:[a]},!0)}})}function u(a,b,c){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.chat,f=a.to,g=a.messageBytes,h=a.messageType,i=a.count,j=a.sessionInfo,k=a.identityKey,l=a.backupDirective,m=(yield d("WAEncUserMsg").encryptDeviceJidMessage(f,{type:"message",chat:e,messageBytes:g,messageType:h,applicationPayloadVersion:c,backupDirective:l},b,i,j,k));return d("WAJids").switchOnUserChatJidType(e,{user:function(b){return m!=null?d("WAResultOrError").makeResult({type:"direct_user",messageTo:a.to,message:m,recipient:d("WAGlobals").isPeerDevice(a.to)?b:null}):d("WAResultOrError").makeError("direct_user")},group:function(b){return m!=null?d("WAResultOrError").makeResult({type:"direct_group",messageTo:b,participant:a.to,message:m}):d("WAResultOrError").makeError("direct_group")}})});return v.apply(this,arguments)}function w(a,c,e,f){var g=a.recipients,j=a.messageBytes,k=a.messageType,l=a.chat,m=a.backupDirective;return d("WAJids").switchOnUserChatJidType(l,{user:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAEncUserMsg").encryptUserMsg(g,{type:"message",messageBytes:j,messageType:k,chat:a,applicationPayloadVersion:e,backupDirective:m},f,c)),h=b.participants;return h!=null&&h.length>0?d("WAResultOrError").makeResult({type:"user",messageTo:a,participants:h,phash:b.phash}):d("WAResultOrError").makeError("user")});function h(b){return a.apply(this,arguments)}return h}(),group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- group message"])));var b=(yield d("WAEncGroupMsg").encryptGroupMsg(a,g,j,k,f,m,c));d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- finish encrypt group message"])));var e=b.participants,l=b.encNode;return e==null&&l==null?d("WAResultOrError").makeError("group"):d("WAResultOrError").makeResult({type:"group",messageTo:a,participants:e,message:l,senderKeyDistributionInfo:b.senderKeyDistributionInfo,phash:b.phash})});function e(b){return a.apply(this,arguments)}return e}()})}function x(a,b,c,d){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){if(c.type!=="success")return!1;c=c.phash;if(c.type==="mismatch"){e.addPoint("phash_mismatch");d("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch, local[","] server[","]"])),c.local,c.server);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:b.type});yield t(a.chat);e.addPoint("participant_recovery_finished");return!0}return!1});return y.apply(this,arguments)}function z(a){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.senderKeyDistributionInfo!=null){a=a.senderKeyDistributionInfo;var b=a.group,c=a.senderKeyId;a=a.knowsSenderKey;yield d("WAMarkSenderKeyAsSentApi").markSenderKeyAsSent(b,c,a)}});return A.apply(this,arguments)}function B(a,b){var c=0;a.type==="chat"&&(c=a.recipients.reduce(function(a,b){return a+b.devicesInfo.length},0));var d=a.messageType.type==="text"&&a.messageType.isRevoked;d=d?"revoke":a.messageType.type;b.addPoint("start_encrypt",{string:{sentMessageType:d},"int":{numDevices:c},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}})}function C(a,b,c){if(a.type==="success")return;a.type==="parsing_error"&&(d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is false, chatType:",""])),b),c.addPoint("ack_parse_fail"));var e=a.errorCode;a=a.applicationError;a===o&&c.addPoint("reachability_error_code");d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is true, error: ",", applicationError: ",", chatType:",""])),e,a,b);e!=null&&c.addPoint("ack_success_error_"+e,{"int":{applicationError:a}});a===p&&c.addPoint("sender_blocked",{})}g.sendMessageV2=a;g.sendMessage=e}),98);
__d("WASentBytesCacheApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";c=(a=d("WADbTransactor")).makeSignalTransactor({sentBytesCache:(b=d("MAWTransactionMode")).READWRITE},"deleteSentBytes",function(a){return function(b){return a.sentBytesCache.bulkDelete(b)}});e=a.makeSignalTransactor({sentBytesCache:b.READONLY},"loadExpired",function(a){return function(b){return a.sentBytesCache.where("ts").belowOrEqual(b).toArray().then(function(a){return a.map(function(a){return a.waMsgId})})}});f=a.makeSignalTransactor({sentBytesCache:b.READONLY},"loadSentBytes",function(a){return function(b){return a.sentBytesCache.bulkGet(b).then(function(a){return a.filter(Boolean)})}});d=a.makeSignalTransactor({sentBytesCache:b.READWRITE},"saveSentBytes",function(a){return function(b){return a.sentBytesCache.put(b).then(function(){})}});g.deleteSentBytes=c;g.loadExpired=e;g.loadSentBytes=f;g.saveSentBytes=d}),98);
__d("WASentBytesCache",["WAGlobals","WAJids","WAMsg","WASentBytesCacheApi","WATagsLogger","WATimeUtils","WAWaitForUserUnblocked","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS(["SentBytesCache"]),k=30*24*60*60;c=function(){function a(){var a=this;void d("WAWaitForUserUnblocked").waitForUserUnblocked().then(function(){a.$1()["catch"](function(a){j.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to prune sent bytes: ",""])),a)})})}var c=a.prototype;c.loadSentBytes=function(a){return d("WASentBytesCacheApi").loadSentBytes(a)};c.getMsgsForRetry=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=Array.from(new Set(a.map(function(a){a=a.deviceJid;return d("WAJids").extractUserJid(a)}))),c=new Map();try{c=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(b)},{operationType:"retries_load_identities",flush:!1,afterInit:!0}))}catch(a){j.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["It fails to bulkLoadIdentities: ",""])),a.toString())}var e=(yield this.loadSentBytes(a.map(function(a){a=a.protocolMsgId;return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.chat,externalId:a.externalId})})));return a.map(function(a){var b=a.deviceJid,f=a.protocolMsgId,g=d("WAMsg").craftWAMsgIdString({author:f.author,chat:f.chat,externalId:f.externalId});f=(f=c.get(d("WAJids").extractUserJid(b)))==null?void 0:f.get(b);if(f==null)return{type:"unauthorized"};b=e.find(function(a){return a.waMsgId===g});if(b==null)return{type:"missing"};else if(!d("WATimeUtils").happenedWithin(b.ts,k))return{type:"unauthorized"};return{frankingKey:b.frankingKey,frankingVersion:b.frankingVersion,messageBytes:b.messageBytes,backupDirective:b.backupDirective,messageType:b.messageType,protocolMsgId:b.protocolMsgId,retryCount:a.retryCount+1,type:"unacked"}})});function c(b){return a.apply(this,arguments)}return c}();c.saveSentBytes=function(a){return d("WASentBytesCacheApi").saveSentBytes(a)};c.$1=function(){return d("WASentBytesCacheApi").loadExpired(d("WATimeUtils").pastUnixTime(k)).then(function(a){return d("WASentBytesCacheApi").deleteSentBytes(a)})};return a}();var l=new c();function a(){return l}g.SentBytesCache=c;g.sentBytesCache=a}),98);
__d("WASetMetaApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(b){return b.stores.meta.bulkPut(Object.entries(a).map(function(a){var b,c=a[0];a=a[1];return{key:c,value:(b={},b[c]=a,b)}}))},d("WASignalDB").signalOp("setMeta"))};g.setMeta=a}),98);
__d("WASmaxInAppdataPublishAckMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"class","appdata");if(!c.success)return c;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({"class":c.value,t:b.value})}g.parseAckMixin=a}),98);
__d("WASmaxInAppdataPublishPeerResponseNegative",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(a,"error");if(!c.success)return c;a=d("WASmaxInAppdataPublishAckMixin").parseAckMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({error:c.value},a.value))}g.parsePeerResponseNegative=a}),98);
__d("WASmaxInAppdataPublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ack");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"phash");return!b.success?b:d("WAResultOrError").makeResult({phash:b.value})}g.parseDeviceListStaleMixin=a}),98);
__d("WASmaxInAppdataPublishPeerResponseSuccess",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxInAppdataPublishDeviceListStaleMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"ack");if(!c.success)return c;c=d("WASmaxInAppdataPublishAckMixin").parseAckMixin(a,b);if(!c.success)return c;b=d("WASmaxInAppdataPublishDeviceListStaleMixin").parseDeviceListStaleMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{deviceListStaleMixin:b.success?b.value:null}))}g.parsePeerResponseSuccess=a}),98);
__d("WASmaxOutAppdataPublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("device-identity",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDeviceIdentityMixin=a}),98);
__d("WASmaxOutAppdataPublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("test",{config:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutAppdataPublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestIdElementValue;a=d("WASmaxJsx").smax("trace",null,d("WASmaxJsx").smax("request_id",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRequestIDMixin=a}),98);
__d("WASmaxOutAppdataPublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.edgeIdElementValue;a=d("WASmaxJsx").smax("edge_id",null,a);return a}function i(a){var b=a.deviceArgs,c=a.correlationIdType;a=a.idElementValue;c=d("WASmaxJsx").smax("correlation_id",{type:d("WAWap").CUSTOM_STRING(c)},d("WASmaxJsx").smax("id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(j,b));return c}function j(a){a=a.deviceId;a=d("WASmaxJsx").smax("device",{id:d("WAWap").INT(a)});return a}function k(a){var b=a.edgeIdArgs,c=a.correlationIdArgs;a=a.traceIdElementValue;a=d("WASmaxJsx").smax("trace",null,[d("WASmaxJsx").smax("trace_id",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,b)].concat(d("WASmaxChildren").REPEATED_CHILD(i,c,0,10)));return a}function a(a,b){b=k(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeTraceIDEdgeId=h;g.makeTraceIDCorrelationId=i;g.makeTraceIDCorrelationIdDevice=j;g.mergeTraceIDMixin=a}),98);
__d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishRequestIDMixin","WASmaxOutAppdataPublishTraceIDMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.requestID)return d("WASmaxOutAppdataPublishRequestIDMixin").mergeRequestIDMixin(a,b.requestID);if(b.traceID)return d("WASmaxOutAppdataPublishTraceIDMixin").mergeTraceIDMixin(a,b.traceID);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeRequestOrTraceIDMixinGroup=a}),98);
__d("WASmaxOutAppdataPublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.requestOrTraceIDMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(d("WASmaxJsx").smax("trace",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeTraceContextMixin=a}),98);
__d("WASmaxOutAppdataPublishWithDeviceListCheckMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.appdataDeviceListCheck;a=d("WASmaxJsx").smax("appdata",{device_list_check:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeWithDeviceListCheckMixin=a}),98);
__d("WASmaxOutAppdataPublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishDeviceIdentityMixin","WASmaxOutAppdataPublishInternalTestMixin","WASmaxOutAppdataPublishTraceContextMixin","WASmaxOutAppdataPublishWithDeviceListCheckMixin"],(function(a,b,c,d,e,f,g){function h(a){var b,c=a.deviceIdentityMixinArgs,e=a.withDeviceListCheckMixinArgs,f=a.internalTestMixinArgs;a=a.traceContextMixinArgs;b=(b=d("WASmaxMixins")).optionalMerge(d("WASmaxOutAppdataPublishTraceContextMixin").mergeTraceContextMixin,b.optionalMerge(d("WASmaxOutAppdataPublishInternalTestMixin").mergeInternalTestMixin,b.optionalMerge(d("WASmaxOutAppdataPublishWithDeviceListCheckMixin").mergeWithDeviceListCheckMixin,b.optionalMerge(d("WASmaxOutAppdataPublishDeviceIdentityMixin").mergeDeviceIdentityMixin,d("WASmaxJsx").smax("appdata",null),c),e),f),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseMixin=a}),98);
__d("WASmaxOutAppdataPublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.encElementValue;a=d("WASmaxJsx").smax("enc",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncPayloadMixin=a}),98);
__d("WASmaxOutAppdataPublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncPayloadMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.encType;b=d("WASmaxOutAppdataPublishEncPayloadMixin").mergeEncPayloadMixin(d("WASmaxJsx").smax("enc",{type:d("WAWap").CUSTOM_STRING(b)}),a);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncTypeIndividualMixin=a}),98);
__d("WASmaxOutAppdataPublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encV;a=d("WASmaxJsx").smax("enc",{v:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncVersionFutureproofMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerPeerFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.toJid,c=a.encVersionFutureproofMixinArgs;a=a.encTypeIndividualMixinArgs;b=d("WASmaxJsx").smax("to",{jid:d("WAWap").DEVICE_JID(b)},d("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(d("WASmaxJsx").smax("enc",null),c),a));return b}function i(a){var b=a.toArgs;a=a.appdataTo;a=d("WASmaxJsx").smax("appdata",{to:d("WAWap").USER_JID(a)},d("WASmaxJsx").smax("participants",null,d("WASmaxChildren").REPEATED_CHILD(h,b,1,24)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makePeerPeerFanoutParticipantsTo=h;g.mergePeerPeerFanoutMixin=a}),98);
__d("WASmaxOutAppdataPublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.encCount;a=d("WASmaxJsx").smax("enc",{count:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeEncRetryMixin=a}),98);
__d("WASmaxOutAppdataPublishRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.appdataT;a=a.encRetryMixinArgs;b=d("WASmaxJsx").smax("appdata",{t:d("WAWap").INT(b)},d("WASmaxOutAppdataPublishEncRetryMixin").mergeEncRetryMixin(d("WASmaxJsx").smax("enc",null),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRetryMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerPeerSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WASmaxOutAppdataPublishRetryMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.appdataTo,c=a.retryMixinArgs,e=a.encVersionFutureproofMixinArgs;a=a.encTypeIndividualMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutAppdataPublishRetryMixin").mergeRetryMixin,d("WASmaxJsx").smax("appdata",{to:d("WAWap").DEVICE_JID(b)},d("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(d("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(d("WASmaxJsx").smax("enc",null),e),a)),c);return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePeerPeerSingleMixin=a}),98);
__d("WASmaxOutAppdataPublishPeerMsgTypes",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishPeerPeerFanoutMixin","WASmaxOutAppdataPublishPeerPeerSingleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.peerPeerFanout)return d("WASmaxOutAppdataPublishPeerPeerFanoutMixin").mergePeerPeerFanoutMixin(a,b.peerPeerFanout);if(b.peerPeerSingle)return d("WASmaxOutAppdataPublishPeerPeerSingleMixin").mergePeerPeerSingleMixin(a,b.peerPeerSingle);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergePeerMsgTypes=a}),98);
__d("WASmaxOutAppdataPublishPeerRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAppdataPublishBaseMixin","WASmaxOutAppdataPublishPeerMsgTypes","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.appdataId,c=a.appdataPushPriority,e=a.peerMsgTypesArgs;b=d("WASmaxOutAppdataPublishPeerMsgTypes").mergePeerMsgTypes(d("WASmaxOutAppdataPublishBaseMixin").mergeBaseMixin(d("WASmaxJsx").smax("appdata",{id:d("WAWap").STANZA_ID(b),category:"peer",push_priority:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,c)}),a),e);return b}g.makePeerRequest=a}),98);
__d("WASmaxAppdataPublishPeerRPC",["WAComms","WASmaxInAppdataPublishPeerResponseNegative","WASmaxInAppdataPublishPeerResponseSuccess","WASmaxOutAppdataPublishPeerRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutAppdataPublishPeerRequest").makePeerRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInAppdataPublishPeerResponseNegative").parsePeerResponseNegative(b,a);if(c.success)return{name:"PeerResponseNegative",value:c.value};b=d("WASmaxInAppdataPublishPeerResponseSuccess").parsePeerResponseSuccess(b,a);if(b.success)return{name:"PeerResponseSuccess",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Peer",{Negative:c,Success:b}))});return h.apply(this,arguments)}g.sendPeerRPC=a}),98);
__d("WAStartMediaDownloadQplFlow",["WAGetPlatformFromStanzaId","WAGetStorageQplAnnotations","WAJids","WAMediaUtils","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.downloadEntry,c=a.msgType,e=a.triggerUIView,f=a.protocolMsgId,g=a.isPreview;a=a.xmaMediaType;var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isTransformStreamSupported:d("WAMediaUtils").isTransformStreamSupported()},string:{chat_type:f==null?null:d("WAJids").switchOnMsgrChatJidType(f.chat,{group:function(){return"group"},user:function(){return"user"}}),downloadEntry:g===!0?b+"-preview":b,e2eePlatform:f==null?null:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(f.externalId),msgType:c,trigger_ui_view:e,xmaMediaType:a!=null?a:void 0}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){h.addAnnotations(a)});return babelHelpers["extends"]({},h,{downloadEntry:b,triggerUIView:e})}g.startMediaDownloadQplFlow=a}),98);
__d("WAWorkerGlobalScope",[],(function(a,b,c,d,e,f){"use strict";a=function(){if(typeof window!=="undefined")return window;return typeof globalThis!=="undefined"?globalThis:self}();f.workerGlobalScope=a}),66);